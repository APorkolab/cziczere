<div class="container">
  <header>
    <h1>ðŸŒ± Cziczere: The Digital Memory Garden</h1>
    <ng-container *ngIf="user | async as currentUser; else showLogin">
      <div class="user-info">
        <button (click)="toggleArView()">Enter AR Mode</button>
        <span>Welcome, {{ currentUser.displayName }}!</span>
        <button (click)="logout()">Logout</button>
      </div>
    </ng-container>
    <ng-template #showLogin>
      <button (click)="login()">Login with Google</button>
    </ng-template>
  </header>

  <main *ngIf="user | async">
    <app-memory-create (memorySubmit)="onMemorySubmit($event)" [class.disabled]="isLoading$ | async"></app-memory-create>

    <div class="garden-display">
      <h2>Your Latest Creation</h2>
      <div *ngIf="isLoading$ | async" class="loading-spinner">
        <p>Planting your memory... the AI is hard at work!</p>
        <div class="spinner"></div>
      </div>

    <app-garden-canvas [memories]="memories$ | async"></app-garden-canvas>

    <div class="gardener-actions">
      <button (click)="requestInsight()" [disabled]="isInsightLoading$ | async">
        <ng-container *ngIf="!(isInsightLoading$ | async); else insightLoading">
          Ask the Gardener for an Insight
        </ng-container>
        <ng-template #insightLoading>
          <div class="spinner-small"></div>
          The Gardener is reflecting...
        </ng-template>
      </button>

      <button (click)="onExportPoster()" [disabled]="isExporting$ | async">
        <ng-container *ngIf="!(isExporting$ | async); else exporting">
          Export Garden as Poster
        </ng-container>
        <ng-template #exporting>
          <div class="spinner-small"></div>
          Exporting...
        </ng-template>
      </button>
    </div>

    <app-insight-display [insight]="latestInsight$ | async"></app-insight-display>

  </main>

  <div *ngIf="!(user | async)" class="login-prompt">
    <p>Please log in to cultivate your memory garden.</p>
  </div>
</div>

<app-ar-view *ngIf="isArViewVisible"></app-ar-view>
