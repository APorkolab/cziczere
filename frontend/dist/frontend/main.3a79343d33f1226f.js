"use strict";(self.webpackChunkfrontend=self.webpackChunkfrontend||[]).push([[792],{246:()=>{let dd;function Ip(){return dd}function Fo(n){const e=dd;return dd=n,e}const EZ=Symbol("NotFound");function cI(n){return n===EZ||"\u0275NotFound"===n?.name}function lI(n,e){return Object.is(n,e)}Error;let oi=null,Sp=!1,uI=1;const Xr=Symbol("SIGNAL");function gt(n){const e=oi;return oi=n,e}const hd={version:0,lastCleanEpoch:0,dirty:!1,producers:void 0,producersTail:void 0,consumers:void 0,consumersTail:void 0,recomputing:!1,consumerAllowSignalWrites:!1,consumerIsAlwaysLive:!1,kind:"unknown",producerMustRecompute:()=>!1,producerRecomputeValue:()=>{},consumerMarkedDirty:()=>{},consumerOnSignalRead:()=>{}};function fy(n){if(Sp)throw new Error("");if(null===oi)return;oi.consumerOnSignalRead(n);const e=oi.producersTail;if(void 0!==e&&e.producer===n)return;let t;const r=oi.recomputing;if(r&&(t=void 0!==e?e.nextProducer:oi.producers,void 0!==t&&t.producer===n))return oi.producersTail=t,void(t.lastReadVersion=n.version);const i=n.consumersTail;if(void 0!==i&&i.consumer===oi&&(!r||function wZ(n,e){const t=e.producersTail;if(void 0!==t){let r=e.producers;do{if(r===n)return!0;if(r===t)break;r=r.nextProducer}while(void 0!==r)}return!1}(i,oi)))return;const s=pd(oi),o={producer:n,consumer:oi,nextProducer:t,prevConsumer:i,lastReadVersion:n.version,nextConsumer:void 0};oi.producersTail=o,void 0!==e?e.nextProducer=o:oi.producers=o,s&&SF(n,o)}function xp(n){if((!pd(n)||n.dirty)&&(n.dirty||n.lastCleanEpoch!==uI)){if(!n.producerMustRecompute(n)&&!my(n))return void py(n);n.producerRecomputeValue(n),py(n)}}function wF(n){if(void 0===n.consumers)return;const e=Sp;Sp=!0;try{for(let t=n.consumers;void 0!==t;t=t.nextConsumer){const r=t.consumer;r.dirty||TZ(r)}}finally{Sp=e}}function IF(){return!1!==oi?.consumerAllowSignalWrites}function TZ(n){n.dirty=!0,wF(n),n.consumerMarkedDirty?.(n)}function py(n){n.dirty=!1,n.lastCleanEpoch=uI}function fd(n){return n&&(n.producersTail=void 0,n.recomputing=!0),gt(n)}function Ap(n,e){if(gt(e),!n)return;n.recomputing=!1;const t=n.producersTail;let r=void 0!==t?t.nextProducer:n.producers;if(void 0!==r){if(pd(n))do{r=fI(r)}while(void 0!==r);void 0!==t?t.nextProducer=void 0:n.producers=void 0}}function my(n){for(let e=n.producers;void 0!==e;e=e.nextProducer){const t=e.producer,r=e.lastReadVersion;if(r!==t.version||(xp(t),r!==t.version))return!0}return!1}function Mp(n){if(pd(n)){let e=n.producers;for(;void 0!==e;)e=fI(e)}n.producers=void 0,n.producersTail=void 0,n.consumers=void 0,n.consumersTail=void 0}function SF(n,e){const t=n.consumersTail,r=pd(n);if(void 0!==t?(e.nextConsumer=t.nextConsumer,t.nextConsumer=e):(e.nextConsumer=void 0,n.consumers=e),e.prevConsumer=t,n.consumersTail=e,!r)for(let i=n.producers;void 0!==i;i=i.nextProducer)SF(i.producer,i)}function fI(n){const e=n.producer,t=n.nextProducer,r=n.nextConsumer,i=n.prevConsumer;if(n.nextConsumer=void 0,n.prevConsumer=void 0,void 0!==r?r.prevConsumer=i:e.consumersTail=i,void 0!==i)i.nextConsumer=r;else if(e.consumers=r,!pd(e)){let s=e.producers;for(;void 0!==s;)s=fI(s)}return t}function pd(n){return n.consumerIsAlwaysLive||void 0!==n.consumers}const ll=Symbol("UNSET"),md=Symbol("COMPUTING"),za=Symbol("ERRORED"),SZ={...hd,value:ll,dirty:!0,error:null,equal:lI,kind:"computed",producerMustRecompute:n=>n.value===ll||n.value===md,producerRecomputeValue(n){if(n.value===md)throw new Error("");const e=n.value;n.value=md;const t=fd(n);let r,i=!1;try{r=n.computation(),gt(null),i=e!==ll&&e!==za&&r!==za&&n.equal(e,r)}catch(s){r=za,n.error=s}finally{Ap(n,t)}i?n.value=e:(n.value=r,n.version++)}};let xF=function xZ(){throw new Error};function AF(n){xF(n)}function MZ(n,e){const t=Object.create(CF);t.value=n,void 0!==e&&(t.equal=e);const r=()=>function CZ(n){return fy(n),n.value}(t);return r[Xr]=t,[r,o=>mI(t,o),o=>function MF(n,e){IF()||AF(n),mI(n,e(n.value))}(t,o)]}function mI(n,e){IF()||AF(n),n.equal(n.value,e)||(n.value=e,function DZ(n){n.version++,function bZ(){uI++}(),wF(n)}(n))}const CF={...hd,equal:lI,value:void 0,kind:"signal"};function Zn(n){return"function"==typeof n}function gI(n){const t=n(r=>{Error.call(r),r.stack=(new Error).stack});return t.prototype=Object.create(Error.prototype),t.prototype.constructor=t,t}const _I=gI(n=>function(t){n(this),this.message=t?`${t.length} errors occurred during unsubscription:\n${t.map((r,i)=>`${i+1}) ${r.toString()}`).join("\n  ")}`:"",this.name="UnsubscriptionError",this.errors=t});function _y(n,e){if(n){const t=n.indexOf(e);0<=t&&n.splice(t,1)}}class ns{constructor(e){this.initialTeardown=e,this.closed=!1,this._parentage=null,this._finalizers=null}unsubscribe(){let e;if(!this.closed){this.closed=!0;const{_parentage:t}=this;if(t)if(this._parentage=null,Array.isArray(t))for(const s of t)s.remove(this);else t.remove(this);const{initialTeardown:r}=this;if(Zn(r))try{r()}catch(s){e=s instanceof _I?s.errors:[s]}const{_finalizers:i}=this;if(i){this._finalizers=null;for(const s of i)try{PF(s)}catch(o){e=e??[],o instanceof _I?e=[...e,...o.errors]:e.push(o)}}if(e)throw new _I(e)}}add(e){var t;if(e&&e!==this)if(this.closed)PF(e);else{if(e instanceof ns){if(e.closed||e._hasParent(this))return;e._addParent(this)}(this._finalizers=null!==(t=this._finalizers)&&void 0!==t?t:[]).push(e)}}_hasParent(e){const{_parentage:t}=this;return t===e||Array.isArray(t)&&t.includes(e)}_addParent(e){const{_parentage:t}=this;this._parentage=Array.isArray(t)?(t.push(e),t):t?[t,e]:e}_removeParent(e){const{_parentage:t}=this;t===e?this._parentage=null:Array.isArray(t)&&_y(t,e)}remove(e){const{_finalizers:t}=this;t&&_y(t,e),e instanceof ns&&e._removeParent(this)}}ns.EMPTY=(()=>{const n=new ns;return n.closed=!0,n})();const DF=ns.EMPTY;function RF(n){return n instanceof ns||n&&"closed"in n&&Zn(n.remove)&&Zn(n.add)&&Zn(n.unsubscribe)}function PF(n){Zn(n)?n():n.unsubscribe()}const ul={onUnhandledError:null,onStoppedNotification:null,Promise:void 0,useDeprecatedSynchronousErrorHandling:!1,useDeprecatedNextContext:!1},yy={setTimeout(n,e,...t){const{delegate:r}=yy;return r?.setTimeout?r.setTimeout(n,e,...t):setTimeout(n,e,...t)},clearTimeout(n){const{delegate:e}=yy;return(e?.clearTimeout||clearTimeout)(n)},delegate:void 0};function NF(n){yy.setTimeout(()=>{const{onUnhandledError:e}=ul;if(!e)throw n;e(n)})}function OF(){}const RZ=yI("C",void 0,void 0);function yI(n,e,t){return{kind:n,value:e,error:t}}let dl=null;function vy(n){if(ul.useDeprecatedSynchronousErrorHandling){const e=!dl;if(e&&(dl={errorThrown:!1,error:null}),n(),e){const{errorThrown:t,error:r}=dl;if(dl=null,t)throw r}}else n()}class vI extends ns{constructor(e){super(),this.isStopped=!1,e?(this.destination=e,RF(e)&&e.add(this)):this.destination=VZ}static create(e,t,r){return new bI(e,t,r)}next(e){this.isStopped?TI(function NZ(n){return yI("N",n,void 0)}(e),this):this._next(e)}error(e){this.isStopped?TI(function PZ(n){return yI("E",void 0,n)}(e),this):(this.isStopped=!0,this._error(e))}complete(){this.isStopped?TI(RZ,this):(this.isStopped=!0,this._complete())}unsubscribe(){this.closed||(this.isStopped=!0,super.unsubscribe(),this.destination=null)}_next(e){this.destination.next(e)}_error(e){try{this.destination.error(e)}finally{this.unsubscribe()}}_complete(){try{this.destination.complete()}finally{this.unsubscribe()}}}const kZ=Function.prototype.bind;function EI(n,e){return kZ.call(n,e)}class LZ{constructor(e){this.partialObserver=e}next(e){const{partialObserver:t}=this;if(t.next)try{t.next(e)}catch(r){Ey(r)}}error(e){const{partialObserver:t}=this;if(t.error)try{t.error(e)}catch(r){Ey(r)}else Ey(e)}complete(){const{partialObserver:e}=this;if(e.complete)try{e.complete()}catch(t){Ey(t)}}}class bI extends vI{constructor(e,t,r){let i;if(super(),Zn(e)||!e)i={next:e??void 0,error:t??void 0,complete:r??void 0};else{let s;this&&ul.useDeprecatedNextContext?(s=Object.create(e),s.unsubscribe=()=>this.unsubscribe(),i={next:e.next&&EI(e.next,s),error:e.error&&EI(e.error,s),complete:e.complete&&EI(e.complete,s)}):i=e}this.destination=new LZ(i)}}function Ey(n){ul.useDeprecatedSynchronousErrorHandling?function OZ(n){ul.useDeprecatedSynchronousErrorHandling&&dl&&(dl.errorThrown=!0,dl.error=n)}(n):NF(n)}function TI(n,e){const{onStoppedNotification:t}=ul;t&&yy.setTimeout(()=>t(n,e))}const VZ={closed:!0,next:OF,error:function FZ(n){throw n},complete:OF},wI="function"==typeof Symbol&&Symbol.observable||"@@observable";function II(n){return n}let jn=(()=>{class n{constructor(t){t&&(this._subscribe=t)}lift(t){const r=new n;return r.source=this,r.operator=t,r}subscribe(t,r,i){const s=function BZ(n){return n&&n instanceof vI||function UZ(n){return n&&Zn(n.next)&&Zn(n.error)&&Zn(n.complete)}(n)&&RF(n)}(t)?t:new bI(t,r,i);return vy(()=>{const{operator:o,source:a}=this;s.add(o?o.call(s,a):a?this._subscribe(s):this._trySubscribe(s))}),s}_trySubscribe(t){try{return this._subscribe(t)}catch(r){t.error(r)}}forEach(t,r){return new(r=LF(r))((i,s)=>{const o=new bI({next:a=>{try{t(a)}catch(c){s(c),o.unsubscribe()}},error:s,complete:i});this.subscribe(o)})}_subscribe(t){var r;return null===(r=this.source)||void 0===r?void 0:r.subscribe(t)}[wI](){return this}pipe(...t){return function kF(n){return 0===n.length?II:1===n.length?n[0]:function(t){return n.reduce((r,i)=>i(r),t)}}(t)(this)}toPromise(t){return new(t=LF(t))((r,i)=>{let s;this.subscribe(o=>s=o,o=>i(o),()=>r(s))})}}return n.create=e=>new n(e),n})();function LF(n){var e;return null!==(e=n??ul.Promise)&&void 0!==e?e:Promise}const HZ=gI(n=>function(){n(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"});let gd=(()=>{class n extends jn{constructor(){super(),this.closed=!1,this.currentObservers=null,this.observers=[],this.isStopped=!1,this.hasError=!1,this.thrownError=null}lift(t){const r=new FF(this,this);return r.operator=t,r}_throwIfClosed(){if(this.closed)throw new HZ}next(t){vy(()=>{if(this._throwIfClosed(),!this.isStopped){this.currentObservers||(this.currentObservers=Array.from(this.observers));for(const r of this.currentObservers)r.next(t)}})}error(t){vy(()=>{if(this._throwIfClosed(),!this.isStopped){this.hasError=this.isStopped=!0,this.thrownError=t;const{observers:r}=this;for(;r.length;)r.shift().error(t)}})}complete(){vy(()=>{if(this._throwIfClosed(),!this.isStopped){this.isStopped=!0;const{observers:t}=this;for(;t.length;)t.shift().complete()}})}unsubscribe(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null}get observed(){var t;return(null===(t=this.observers)||void 0===t?void 0:t.length)>0}_trySubscribe(t){return this._throwIfClosed(),super._trySubscribe(t)}_subscribe(t){return this._throwIfClosed(),this._checkFinalizedStatuses(t),this._innerSubscribe(t)}_innerSubscribe(t){const{hasError:r,isStopped:i,observers:s}=this;return r||i?DF:(this.currentObservers=null,s.push(t),new ns(()=>{this.currentObservers=null,_y(s,t)}))}_checkFinalizedStatuses(t){const{hasError:r,thrownError:i,isStopped:s}=this;r?t.error(i):s&&t.complete()}asObservable(){const t=new jn;return t.source=this,t}}return n.create=(e,t)=>new FF(e,t),n})();class FF extends gd{constructor(e,t){super(),this.destination=e,this.source=t}next(e){var t,r;null===(r=null===(t=this.destination)||void 0===t?void 0:t.next)||void 0===r||r.call(t,e)}error(e){var t,r;null===(r=null===(t=this.destination)||void 0===t?void 0:t.error)||void 0===r||r.call(t,e)}complete(){var e,t;null===(t=null===(e=this.destination)||void 0===e?void 0:e.complete)||void 0===t||t.call(e)}_subscribe(e){var t,r;return null!==(r=null===(t=this.source)||void 0===t?void 0:t.subscribe(e))&&void 0!==r?r:DF}}class ao extends gd{constructor(e){super(),this._value=e}get value(){return this.getValue()}_subscribe(e){const t=super._subscribe(e);return!t.closed&&e.next(this._value),t}getValue(){const{hasError:e,thrownError:t,_value:r}=this;if(e)throw t;return this._throwIfClosed(),r}next(e){super.next(this._value=e)}}const VF="https://angular.dev/best-practices/security#preventing-cross-site-scripting-xss";class ue extends Error{code;constructor(e,t){super(function Vs(n,e){return`${function zZ(n){return`NG0${Math.abs(n)}`}(n)}${e?": "+e:""}`}(e,t)),this.code=e}}const Qn=globalThis;function Qt(n){for(let e in n)if(n[e]===Qt)return e;throw Error("")}function GZ(n,e){for(const t in e)e.hasOwnProperty(t)&&!n.hasOwnProperty(t)&&(n[t]=e[t])}function Fi(n){if("string"==typeof n)return n;if(Array.isArray(n))return`[${n.map(Fi).join(", ")}]`;if(null==n)return""+n;const e=n.overriddenName||n.name;if(e)return`${e}`;const t=n.toString();if(null==t)return""+t;const r=t.indexOf("\n");return r>=0?t.slice(0,r):t}function SI(n,e){return n?e?`${n} ${e}`:n:e||""}const WZ=Qt({__forward_ref__:Qt});function bn(n){return n.__forward_ref__=bn,n.toString=function(){return Fi(this())},n}function Ct(n){return by(n)?n():n}function by(n){return"function"==typeof n&&n.hasOwnProperty(WZ)&&n.__forward_ref__===bn}function Et(n){return{token:n.token,providedIn:n.providedIn||null,factory:n.factory,value:void 0}}function Vo(n){return{providers:n.providers||[],imports:n.imports||[]}}function Ty(n){return function YZ(n,e){return n.hasOwnProperty(e)&&n[e]||null}(n,Iy)}function wy(n){return n&&n.hasOwnProperty(xI)?n[xI]:null}const Iy=Qt({\u0275prov:Qt}),xI=Qt({\u0275inj:Qt});class Ae{_desc;ngMetadataName="InjectionToken";\u0275prov;constructor(e,t){this._desc=e,this.\u0275prov=void 0,"number"==typeof t?this.__NG_ELEMENT_ID__=t:void 0!==t&&(this.\u0275prov=Et({token:this,providedIn:t.providedIn||"root",factory:t.factory}))}get multi(){return this}toString(){return`InjectionToken ${this._desc}`}}function MI(n){return n&&!!n.\u0275providers}const CI=Qt({\u0275cmp:Qt}),nQ=Qt({\u0275dir:Qt}),rQ=Qt({\u0275pipe:Qt}),UF=Qt({\u0275mod:Qt}),fl=Qt({\u0275fac:Qt}),Rp=Qt({__NG_ELEMENT_ID__:Qt}),BF=Qt({__NG_ENV_ID__:Qt});function Tt(n){return"string"==typeof n?n:null==n?"":String(n)}const DI=Qt({ngErrorCode:Qt}),HF=Qt({ngErrorMessage:Qt}),Pp=Qt({ngTokenPath:Qt});function RI(n,e){return GF("",-200,e)}function PI(n,e){throw new ue(-201,!1)}function GF(n,e,t){const r=new ue(e,n);return r[DI]=e,r[HF]=n,t&&(r[Pp]=t),r}let NI;function WF(){return NI}function Vi(n){const e=NI;return NI=n,e}function jF(n,e,t){const r=Ty(n);return r&&"root"==r.providedIn?void 0===r.value?r.value=r.factory():r.value:8&t?null:void 0!==e?e:void PI()}const pl={},OI="__NG_DI_FLAG__";class lQ{injector;constructor(e){this.injector=e}retrieve(e,t){const r=Np(t)||0;try{return this.injector.get(e,8&r?null:pl,r)}catch(i){if(cI(i))return i;throw i}}}function uQ(n,e=0){const t=Ip();if(void 0===t)throw new ue(-203,!1);if(null===t)return jF(n,void 0,e);{const r=function dQ(n){return{optional:!!(8&n),host:!!(1&n),self:!!(2&n),skipSelf:!!(4&n)}}(e),i=t.retrieve(n,r);if(cI(i)){if(r.optional)return null;throw i}return i}}function Rt(n,e=0){return(WF()||uQ)(Ct(n),e)}function Ie(n,e){return Rt(n,Np(e))}function Np(n){return typeof n>"u"||"number"==typeof n?n:0|(n.optional&&8)|(n.host&&1)|(n.self&&2)|(n.skipSelf&&4)}function kI(n){const e=[];for(let t=0;t<n.length;t++){const r=Ct(n[t]);if(Array.isArray(r)){if(0===r.length)throw new ue(900,!1);let i,s=0;for(let o=0;o<r.length;o++){const a=r[o],c=hQ(a);"number"==typeof c?-1===c?i=a.token:s|=c:i=a}e.push(Rt(i,s))}else e.push(Rt(r))}return e}function Op(n,e){return n[OI]=e,n.prototype[OI]=e,n}function hQ(n){return n[OI]}function ml(n,e){return n.hasOwnProperty(fl)?n[fl]:null}function _d(n,e){n.forEach(t=>Array.isArray(t)?_d(t,e):e(t))}function qF(n,e,t){e>=n.length?n.push(t):n.splice(e,0,t)}function xy(n,e){return e>=n.length-1?n.pop():n.splice(e,1)[0]}function My(n,e,t){let r=kp(n,e);return r>=0?n[1|r]=t:(r=~r,function KF(n,e,t,r){let i=n.length;if(i==e)n.push(t,r);else if(1===i)n.push(r,n[0]),n[0]=t;else{for(i--,n.push(n[i-1],n[i]);i>e;)n[i]=n[i-2],i--;n[e]=t,n[e+1]=r}}(n,r,e,t)),r}function LI(n,e){const t=kp(n,e);if(t>=0)return n[1|t]}function kp(n,e){return function pQ(n,e,t){let r=0,i=n.length>>t;for(;i!==r;){const s=r+(i-r>>1),o=n[s<<t];if(e===o)return s<<t;o>e?i=s:r=s+1}return~(i<<t)}(n,e,1)}const co={},Tn=[],gl=new Ae(""),YF=new Ae("",-1),FI=new Ae("");class Cy{get(e,t=pl){if(t===pl){const i=GF("",-201);throw i.name="\u0275NotFound",i}return t}}function tn(n){return n[CI]||null}function Ti(n){return n[nQ]||null}function Us(n){return n[rQ]||null}function _l(n){return{\u0275providers:n}}function gQ(...n){return{\u0275providers:UI(0,n),\u0275fromNgModule:!0}}function UI(n,...e){const t=[],r=new Set;let i;const s=o=>{t.push(o)};return _d(e,o=>{const a=o;Dy(a,s,[],r)&&(i||=[],i.push(a))}),void 0!==i&&JF(i,s),t}function JF(n,e){for(let t=0;t<n.length;t++){const{ngModule:r,providers:i}=n[t];BI(i,s=>{e(s,r)})}}function Dy(n,e,t,r){if(!(n=Ct(n)))return!1;let i=null,s=wy(n);const o=!s&&tn(n);if(s||o){if(o&&!o.standalone)return!1;i=n}else{const c=n.ngModule;if(s=wy(c),!s)return!1;i=c}const a=r.has(i);if(o){if(a)return!1;if(r.add(i),o.dependencies){const c="function"==typeof o.dependencies?o.dependencies():o.dependencies;for(const l of c)Dy(l,e,t,r)}}else{if(!s)return!1;{if(null!=s.imports&&!a){let l;r.add(i);try{_d(s.imports,u=>{Dy(u,e,t,r)&&(l||=[],l.push(u))})}finally{}void 0!==l&&JF(l,e)}if(!a){const l=ml(i)||(()=>new i);e({provide:i,useFactory:l,deps:Tn},i),e({provide:FI,useValue:i,multi:!0},i),e({provide:gl,useValue:()=>Rt(i),multi:!0},i)}const c=s.providers;if(null!=c&&!a){const l=n;BI(c,u=>{e(u,l)})}}}return i!==n&&void 0!==n.providers}function BI(n,e){for(let t of n)MI(t)&&(t=t.\u0275providers),Array.isArray(t)?BI(t,e):e(t)}const _Q=Qt({provide:String,useValue:Qt});function HI(n){return null!==n&&"object"==typeof n&&_Q in n}function Uo(n){return"function"==typeof n}const zI=new Ae(""),Ry={},t2={};let GI;function WI(){return void 0===GI&&(GI=new Cy),GI}class Ui{}class yl extends Ui{parent;source;scopes;records=new Map;_ngOnDestroyHooks=new Set;_onDestroyHooks=[];get destroyed(){return this._destroyed}_destroyed=!1;injectorDefTypes;constructor(e,t,r,i){super(),this.parent=t,this.source=r,this.scopes=i,$I(e,o=>this.processProvider(o)),this.records.set(YF,yd(void 0,this)),i.has("environment")&&this.records.set(Ui,yd(void 0,this));const s=this.records.get(zI);null!=s&&"string"==typeof s.value&&this.scopes.add(s.value),this.injectorDefTypes=new Set(this.get(FI,Tn,{self:!0}))}retrieve(e,t){const r=Np(t)||0;try{return this.get(e,pl,r)}catch(i){if(cI(i))return i;throw i}}destroy(){Fp(this),this._destroyed=!0;const e=gt(null);try{for(const r of this._ngOnDestroyHooks)r.ngOnDestroy();const t=this._onDestroyHooks;this._onDestroyHooks=[];for(const r of t)r()}finally{this.records.clear(),this._ngOnDestroyHooks.clear(),this.injectorDefTypes.clear(),gt(e)}}onDestroy(e){return Fp(this),this._onDestroyHooks.push(e),()=>this.removeOnDestroy(e)}runInContext(e){Fp(this);const t=Fo(this),r=Vi(void 0);try{return e()}finally{Fo(t),Vi(r)}}get(e,t=pl,r){if(Fp(this),e.hasOwnProperty(BF))return e[BF](this);const i=Np(r),o=Fo(this),a=Vi(void 0);try{if(!(4&i)){let l=this.records.get(e);if(void 0===l){const u=function TQ(n){return"function"==typeof n||"object"==typeof n&&"InjectionToken"===n.ngMetadataName}(e)&&Ty(e);l=u&&this.injectableDefInScope(u)?yd(jI(e),Ry):null,this.records.set(e,l)}if(null!=l)return this.hydrate(e,l,i)}return(2&i?WI():this.parent).get(e,t=8&i&&t===pl?null:t)}catch(c){const l=function aQ(n){return n[DI]}(c);throw-200===l||-201===l?new ue(l,null):c}finally{Vi(a),Fo(o)}}resolveInjectorInitializers(){const e=gt(null),t=Fo(this),r=Vi(void 0);try{const s=this.get(gl,Tn,{self:!0});for(const o of s)o()}finally{Fo(t),Vi(r),gt(e)}}toString(){const e=[],t=this.records;for(const r of t.keys())e.push(Fi(r));return`R3Injector[${e.join(", ")}]`}processProvider(e){let t=Uo(e=Ct(e))?e:Ct(e&&e.provide);const r=function vQ(n){return HI(n)?yd(void 0,n.useValue):yd(n2(n),Ry)}(e);if(!Uo(e)&&!0===e.multi){let i=this.records.get(t);i||(i=yd(void 0,Ry,!0),i.factory=()=>kI(i.multi),this.records.set(t,i)),t=e,i.multi.push(e)}this.records.set(t,r)}hydrate(e,t,r){const i=gt(null);try{if(t.value===t2)throw RI(Fi(e));return t.value===Ry&&(t.value=t2,t.value=t.factory(void 0,r)),"object"==typeof t.value&&t.value&&function bQ(n){return null!==n&&"object"==typeof n&&"function"==typeof n.ngOnDestroy}(t.value)&&this._ngOnDestroyHooks.add(t.value),t.value}finally{gt(i)}}injectableDefInScope(e){if(!e.providedIn)return!1;const t=Ct(e.providedIn);return"string"==typeof t?"any"===t||this.scopes.has(t):this.injectorDefTypes.has(t)}removeOnDestroy(e){const t=this._onDestroyHooks.indexOf(e);-1!==t&&this._onDestroyHooks.splice(t,1)}}function jI(n){const e=Ty(n),t=null!==e?e.factory:ml(n);if(null!==t)return t;if(n instanceof Ae)throw new ue(204,!1);if(n instanceof Function)return function yQ(n){if(n.length>0)throw new ue(204,!1);const t=function JZ(n){return(n?.[Iy]??null)||null}(n);return null!==t?()=>t.factory(n):()=>new n}(n);throw new ue(204,!1)}function n2(n,e,t){let r;if(Uo(n)){const i=Ct(n);return ml(i)||jI(i)}if(HI(n))r=()=>Ct(n.useValue);else if(function QF(n){return!(!n||!n.useFactory)}(n))r=()=>n.useFactory(...kI(n.deps||[]));else if(function ZF(n){return!(!n||!n.useExisting)}(n))r=(i,s)=>Rt(Ct(n.useExisting),void 0!==s&&8&s?8:void 0);else{const i=Ct(n&&(n.useClass||n.provide));if(!function EQ(n){return!!n.deps}(n))return ml(i)||jI(i);r=()=>new i(...kI(n.deps))}return r}function Fp(n){if(n.destroyed)throw new ue(205,!1)}function yd(n,e,t=!1){return{factory:n,value:e,multi:t?[]:void 0}}function $I(n,e){for(const t of n)Array.isArray(t)?$I(t,e):t&&MI(t)?$I(t.\u0275providers,e):e(t)}function vd(n,e){let t;n instanceof yl?(Fp(n),t=n):t=new lQ(n);const i=Fo(t),s=Vi(void 0);try{return e()}finally{Fo(i),Vi(s)}}function qI(){return void 0!==WF()||null!=Ip()}function qn(n){return Array.isArray(n)&&"object"==typeof n[1]}function wi(n){return Array.isArray(n)&&!0===n[1]}function i2(n){return!!(4&n.flags)}function zo(n){return n.componentOffset>-1}function Id(n){return!(1&~n.flags)}function ss(n){return!!n.template}function qa(n){return!!(512&n[2])}function Go(n){return!(256&~n[2])}function Vr(n){for(;Array.isArray(n);)n=n[0];return n}function Sd(n,e){return Vr(e[n])}function vr(n,e){return Vr(e[n.index])}function xd(n,e){return n.data[e]}function Tl(n,e){return n[e]}function Ii(n,e){const t=e[n];return qn(t)?t:t[0]}function JI(n){return!(128&~n[2])}function li(n,e){return null==e?null:n[e]}function u2(n){n[17]=0}function d2(n){1024&n[2]||(n[2]|=1024,JI(n)&&Ad(n))}function ky(n){return!!(9216&n[2]||n[24]?.dirty)}function ZI(n){n[10].changeDetectionScheduler?.notify(8),64&n[2]&&(n[2]|=1024),ky(n)&&Ad(n)}function Ad(n){n[10].changeDetectionScheduler?.notify(0);let e=Wo(n);for(;null!==e&&!(8192&e[2])&&(e[2]|=8192,JI(e));)e=Wo(e)}function Ly(n,e){if(Go(n))throw new ue(911,!1);null===n[21]&&(n[21]=[]),n[21].push(e)}function Wo(n){const e=n[3];return wi(e)?e[3]:e}function f2(n){return n[7]??=[]}function p2(n){return n.cleanup??=[]}const _t={lFrame:D2(null),bindingsEnabled:!0,skipHydrationRootTNode:null};let tS=!1;function g2(){_t.lFrame.elementDepthCount--}function nS(){return _t.bindingsEnabled}function y2(n){return _t.skipHydrationRootTNode===n}function v2(){_t.skipHydrationRootTNode=null}function re(){return _t.lFrame.lView}function wt(){return _t.lFrame.tView}function An(n){return _t.lFrame.contextLView=n,n[8]}function Mn(n){return _t.lFrame.contextLView=null,n}function bt(){let n=E2();for(;null!==n&&64===n.type;)n=n.parent;return n}function E2(){return _t.lFrame.currentTNode}function jo(n,e){const t=_t.lFrame;t.currentTNode=n,t.isParent=e}function b2(){return _t.lFrame.isParent}function S2(){return tS}function Fy(n){const e=tS;return tS=n,e}function Si(){const n=_t.lFrame;let e=n.bindingRootIndex;return-1===e&&(e=n.bindingRootIndex=n.tView.bindingStartIndex),e}function Bi(){return _t.lFrame.bindingIndex++}function OQ(n,e){const t=_t.lFrame;t.bindingIndex=t.bindingRootIndex=n,rS(e)}function rS(n){_t.lFrame.currentDirectiveIndex=n}function sS(){return _t.lFrame.currentQueryIndex}function Vy(n){_t.lFrame.currentQueryIndex=n}function LQ(n){const e=n[1];return 2===e.type?e.declTNode:1===e.type?n[5]:null}function M2(n,e,t){if(4&t){let i=e,s=n;for(;!(i=i.parent,null!==i||1&t||(i=LQ(s),null===i||(s=s[14],10&i.type))););if(null===i)return!1;e=i,n=s}const r=_t.lFrame=C2();return r.currentTNode=e,r.lView=n,!0}function oS(n){const e=C2(),t=n[1];_t.lFrame=e,e.currentTNode=t.firstChild,e.lView=n,e.tView=t,e.contextLView=n,e.bindingIndex=t.bindingStartIndex,e.inI18n=!1}function C2(){const n=_t.lFrame,e=null===n?null:n.child;return null===e?D2(n):e}function D2(n){const e={currentTNode:null,isParent:!0,lView:null,tView:null,selectedIndex:-1,contextLView:null,elementDepthCount:0,currentNamespace:null,currentDirectiveIndex:-1,bindingRootIndex:-1,bindingIndex:-1,currentQueryIndex:0,parent:n,child:null,inI18n:!1};return null!==n&&(n.child=e),e}function R2(){const n=_t.lFrame;return _t.lFrame=n.parent,n.currentTNode=null,n.lView=null,n}const P2=R2;function aS(){const n=R2();n.isParent=!0,n.tView=null,n.selectedIndex=-1,n.contextLView=null,n.elementDepthCount=0,n.currentDirectiveIndex=-1,n.currentNamespace=null,n.bindingRootIndex=-1,n.bindingIndex=-1,n.currentQueryIndex=0}function Kr(){return _t.lFrame.selectedIndex}function wl(n){_t.lFrame.selectedIndex=n}let N2=!0;function Uy(){return N2}function Hp(n){N2=n}let cS={elements:void 0};function O2(n,e=null,t=null,r){const i=k2(n,e,t,r);return i.resolveInjectorInitializers(),i}function k2(n,e=null,t=null,r,i=new Set){const s=[t||Tn,gQ(n)];return r=r||("object"==typeof n?void 0:Fi(n)),new yl(s,e||WI(),r||null,i)}class Yr{static THROW_IF_NOT_FOUND=pl;static NULL=new Cy;static create(e,t){if(Array.isArray(e))return O2({name:""},t,e,"");{const r=e.name??"";return O2({name:r},e.parent,e.providers,r)}}static \u0275prov=Et({token:Yr,providedIn:"any",factory:()=>Rt(YF)});static __NG_ELEMENT_ID__=-1}const Xo=new Ae("");let uo=(()=>class n{static __NG_ELEMENT_ID__=WQ;static __NG_ENV_ID__=t=>t})();class L2 extends uo{_lView;constructor(e){super(),this._lView=e}get destroyed(){return Go(this._lView)}onDestroy(e){const t=this._lView;return Ly(t,e),()=>function QI(n,e){if(null===n[21])return;const t=n[21].indexOf(e);-1!==t&&n[21].splice(t,1)}(t,e)}}function WQ(){return new L2(re())}class Cd{_console=console;handleError(e){this._console.error("ERROR",e)}}const Ko=new Ae("",{providedIn:"root",factory:()=>{const n=Ie(Ui);let e;return t=>{n.destroyed&&!e?setTimeout(()=>{throw t}):(e??=n.get(Cd),e.handleError(t))}}}),jQ={provide:gl,useValue:()=>{Ie(Cd)},multi:!0};function Il(n,e){const[t,r,i]=MZ(n,e?.equal),s=t;return s.set=r,s.update=i,s.asReadonly=uS.bind(s),s}function uS(){const n=this[Xr];if(void 0===n.readonlyFn){const e=()=>this();e[Xr]=n,n.readonlyFn=e}return n.readonlyFn}class Dd{}const U2=new Ae("",{providedIn:"root",factory:()=>!1}),B2=new Ae(""),H2=new Ae("");let Sl=(()=>{class n{taskId=0;pendingTasks=new Set;destroyed=!1;pendingTask=new ao(!1);get hasPendingTasks(){return!this.destroyed&&this.pendingTask.value}get hasPendingTasksObservable(){return this.destroyed?new jn(t=>{t.next(!1),t.complete()}):this.pendingTask}add(){!this.hasPendingTasks&&!this.destroyed&&this.pendingTask.next(!0);const t=this.taskId++;return this.pendingTasks.add(t),t}has(t){return this.pendingTasks.has(t)}remove(t){this.pendingTasks.delete(t),0===this.pendingTasks.size&&this.hasPendingTasks&&this.pendingTask.next(!1)}ngOnDestroy(){this.pendingTasks.clear(),this.hasPendingTasks&&this.pendingTask.next(!1),this.destroyed=!0,this.pendingTask.unsubscribe()}static \u0275prov=Et({token:n,providedIn:"root",factory:()=>new n})}return n})(),Rd=(()=>{class n{internalPendingTasks=Ie(Sl);scheduler=Ie(Dd);errorHandler=Ie(Ko);add(){const t=this.internalPendingTasks.add();return()=>{this.internalPendingTasks.has(t)&&(this.scheduler.notify(11),this.internalPendingTasks.remove(t))}}run(t){const r=this.add();t().catch(this.errorHandler).finally(r)}static \u0275prov=Et({token:n,providedIn:"root",factory:()=>new n})}return n})();function zp(...n){}let z2=(()=>{class n{static \u0275prov=Et({token:n,providedIn:"root",factory:()=>new XQ})}return n})();class XQ{dirtyEffectCount=0;queues=new Map;add(e){this.enqueue(e),this.schedule(e)}schedule(e){e.dirty&&this.dirtyEffectCount++}remove(e){const r=this.queues.get(e.zone);r.has(e)&&(r.delete(e),e.dirty&&this.dirtyEffectCount--)}enqueue(e){const t=e.zone;this.queues.has(t)||this.queues.set(t,new Set);const r=this.queues.get(t);r.has(e)||r.add(e)}flush(){for(;this.dirtyEffectCount>0;){let e=!1;for(const[t,r]of this.queues)e||=null===t?this.flushQueue(r):t.run(()=>this.flushQueue(r));e||(this.dirtyEffectCount=0)}}flushQueue(e){let t=!1;for(const r of e)r.dirty&&(this.dirtyEffectCount--,t=!0,r.run());return t}}let G2=null;function Gp(){return G2}class YQ{}function W2(n,e){e=encodeURIComponent(e);for(const t of n.split(";")){const r=t.indexOf("="),[i,s]=-1==r?[t,""]:[t.slice(0,r),t.slice(r+1)];if(i.trim()===e)return decodeURIComponent(s)}return null}class j2{}function $2(n,e,t,r,i,s,o){try{var a=n[s](o),c=a.value}catch(l){return void t(l)}a.done?e(c):Promise.resolve(c).then(r,i)}function O(n){return function(){var e=this,t=arguments;return new Promise(function(r,i){var s=n.apply(e,t);function o(c){$2(s,r,i,o,a,"next",c)}function a(c){$2(s,r,i,o,a,"throw",c)}o(void 0)})}}function Ss(n){return e=>{if(function QQ(n){return Zn(n?.lift)}(e))return e.lift(function(t){try{return n(t,this)}catch(r){this.error(r)}});throw new TypeError("Unable to lift unknown Observable type")}}function os(n,e,t,r,i){return new eee(n,e,t,r,i)}class eee extends vI{constructor(e,t,r,i,s,o){super(e),this.onFinalize=s,this.shouldUnsubscribe=o,this._next=t?function(a){try{t(a)}catch(c){e.error(c)}}:super._next,this._error=i?function(a){try{i(a)}catch(c){e.error(c)}finally{this.unsubscribe()}}:super._error,this._complete=r?function(){try{r()}catch(a){e.error(a)}finally{this.unsubscribe()}}:super._complete}unsubscribe(){var e;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){const{closed:t}=this;super.unsubscribe(),!t&&(null===(e=this.onFinalize)||void 0===e||e.call(this))}}}function Hs(n,e){return Ss((t,r)=>{let i=0;t.subscribe(os(r,s=>{r.next(n.call(e,s,i++))}))})}function Yo(n){return{toString:n}.toString()}const Nd="__parameters__";function kd(n,e,t){return Yo(()=>{const r=function hS(n){return function(...t){if(n){const r=n(...t);for(const i in r)this[i]=r[i]}}}(e);function i(...s){if(this instanceof i)return r.apply(this,s),this;const o=new i(...s);return a.annotation=o,a;function a(c,l,u){const d=c.hasOwnProperty(Nd)?c[Nd]:Object.defineProperty(c,Nd,{value:[]})[Nd];for(;d.length<=u;)d.push(null);return(d[u]=d[u]||[]).push(o),c}}return i.prototype.ngMetadataName=n,i.annotationCls=i,i})}const ui=Op(kd("Optional"),8);class hee{previousValue;currentValue;firstChange;constructor(e,t,r){this.previousValue=e,this.currentValue=t,this.firstChange=r}isFirstChange(){return this.firstChange}}function K2(n,e,t,r){null!==e?e.applyValueToInputSignal(e,r):n[t]=r}const Xa=(()=>{const n=()=>Y2;return n.ngInherit=!0,n})();function Y2(n){return n.type.prototype.ngOnChanges&&(n.setInput=pee),fee}function fee(){const n=Z2(this),e=n?.current;if(e){const t=n.previous;if(t===co)n.previous=e;else for(let r in e)t[r]=e[r];n.current=null,this.ngOnChanges(e)}}function pee(n,e,t,r,i){const s=this.declaredInputs[r],o=Z2(n)||function mee(n,e){return n[J2]=e}(n,{previous:co,current:null}),a=o.current||(o.current={}),c=o.previous,l=c[s];a[s]=new hee(l&&l.currentValue,t,c===co),K2(n,e,i,t)}const J2="__ngSimpleChanges__";function Z2(n){return n[J2]||null}const xl=[],ln=function(n,e=null,t){for(let r=0;r<xl.length;r++)(0,xl[r])(n,e,t)};function Q2(n,e){for(let t=e.directiveStart,r=e.directiveEnd;t<r;t++){const s=n.data[t].type.prototype,{ngAfterContentInit:o,ngAfterContentChecked:a,ngAfterViewInit:c,ngAfterViewChecked:l,ngOnDestroy:u}=s;o&&(n.contentHooks??=[]).push(-t,o),a&&((n.contentHooks??=[]).push(t,a),(n.contentCheckHooks??=[]).push(t,a)),c&&(n.viewHooks??=[]).push(-t,c),l&&((n.viewHooks??=[]).push(t,l),(n.viewCheckHooks??=[]).push(t,l)),null!=u&&(n.destroyHooks??=[]).push(t,u)}}function Hy(n,e,t){eV(n,e,3,t)}function zy(n,e,t,r){(3&n[2])===t&&eV(n,e,t,r)}function pS(n,e){let t=n[2];(3&t)===e&&(t&=16383,t+=1,n[2]=t)}function eV(n,e,t,r){const s=r??-1,o=e.length-1;let a=0;for(let c=void 0!==r?65535&n[17]:0;c<o;c++)if("number"==typeof e[c+1]){if(a=e[c],null!=r&&a>=r)break}else e[c]<0&&(n[17]+=65536),(a<s||-1==s)&&(Eee(n,t,e,c),n[17]=(4294901760&n[17])+c+2),c++}function tV(n,e){ln(4,n,e);const t=gt(null);try{e.call(n)}finally{gt(t),ln(5,n,e)}}function Eee(n,e,t,r){const i=t[r]<0,s=t[r+1],a=n[i?-t[r]:t[r]];i?n[2]>>14<n[17]>>16&&(3&n[2])===e&&(n[2]+=16384,tV(a,s)):tV(a,s)}class jp{factory;name;injectImpl;resolving=!1;canSeeViewProviders;multi;componentProviders;index;providerFactory;constructor(e,t,r,i){this.factory=e,this.name=i,this.canSeeViewProviders=t,this.injectImpl=r}}function rV(n){return 3===n||4===n||6===n}function iV(n){return 64===n.charCodeAt(0)}function Fd(n,e){if(null!==e&&0!==e.length)if(null===n||0===n.length)n=e.slice();else{let t=-1;for(let r=0;r<e.length;r++){const i=e[r];"number"==typeof i?t=i:0===t||sV(n,t,i,0,-1===t||2===t?e[++r]:null)}}return n}function sV(n,e,t,r,i){let s=0,o=n.length;if(-1===e)o=-1;else for(;s<n.length;){const a=n[s++];if("number"==typeof a){if(a===e){o=-1;break}if(a>e){o=s-1;break}}}for(;s<n.length;){const a=n[s];if("number"==typeof a)break;if(a===t)return void(null!==i&&(n[s+1]=i));s++,null!==i&&s++}-1!==o&&(n.splice(o,0,e),s=o+1),n.splice(s++,0,t),null!==i&&n.splice(s++,0,i)}function gS(n){return-1!==n}function $p(n){return 32767&n}function qp(n,e){let t=function Iee(n){return n>>16}(n),r=e;for(;t>0;)r=r[14],t--;return r}let _S=!0;function Gy(n){const e=_S;return _S=n,e}let See=0;const ho={};function Wy(n,e){const t=cV(n,e);if(-1!==t)return t;const r=e[1];r.firstCreatePass&&(n.injectorIndex=e.length,yS(r.data,n),yS(e,null),yS(r.blueprint,null));const i=jy(n,e),s=n.injectorIndex;if(gS(i)){const o=$p(i),a=qp(i,e),c=a[1].data;for(let l=0;l<8;l++)e[s+l]=a[o+l]|c[o+l]}return e[s+8]=i,s}function yS(n,e){n.push(0,0,0,0,0,0,0,0,e)}function cV(n,e){return-1===n.injectorIndex||n.parent&&n.parent.injectorIndex===n.injectorIndex||null===e[n.injectorIndex+8]?-1:n.injectorIndex}function jy(n,e){if(n.parent&&-1!==n.parent.injectorIndex)return n.parent.injectorIndex;let t=0,r=null,i=e;for(;null!==i;){if(r=mV(i),null===r)return-1;if(t++,i=i[14],-1!==r.injectorIndex)return r.injectorIndex|t<<16}return-1}function vS(n,e,t){!function xee(n,e,t){let r;"string"==typeof t?r=t.charCodeAt(0)||0:t.hasOwnProperty(Rp)&&(r=t[Rp]),null==r&&(r=t[Rp]=See++);const i=255&r;e.data[n+(i>>5)]|=1<<i}(n,e,t)}function lV(n,e,t){if(8&t||void 0!==n)return n;PI()}function uV(n,e,t,r){if(8&t&&void 0===r&&(r=null),!(3&t)){const i=n[9],s=Vi(void 0);try{return i?i.get(e,r,8&t):jF(e,r,8&t)}finally{Vi(s)}}return lV(r,0,t)}function dV(n,e,t,r=0,i){if(null!==n){if(2048&e[2]&&!(2&r)){const o=function Ree(n,e,t,r,i){let s=n,o=e;for(;null!==s&&null!==o&&2048&o[2]&&!qa(o);){const a=hV(s,o,t,2|r,ho);if(a!==ho)return a;let c=s.parent;if(!c){const l=o[20];if(l){const u=l.get(t,ho,r);if(u!==ho)return u}c=mV(o),o=o[14]}s=c}return i}(n,e,t,r,ho);if(o!==ho)return o}const s=hV(n,e,t,r,ho);if(s!==ho)return s}return uV(e,t,r,i)}function hV(n,e,t,r,i){const s=function Cee(n){if("string"==typeof n)return n.charCodeAt(0)||0;const e=n.hasOwnProperty(Rp)?n[Rp]:void 0;return"number"==typeof e?e>=0?255&e:Dee:e}(t);if("function"==typeof s){if(!M2(e,n,r))return 1&r?lV(i,0,r):uV(e,t,r,i);try{let o;if(o=s(r),null!=o||8&r)return o;PI()}finally{P2()}}else if("number"==typeof s){let o=null,a=cV(n,e),c=-1,l=1&r?e[15][5]:null;for((-1===a||4&r)&&(c=-1===a?jy(n,e):e[a+8],-1!==c&&pV(r,!1)?(o=e[1],a=$p(c),e=qp(c,e)):a=-1);-1!==a;){const u=e[1];if(fV(s,a,u.data)){const d=Mee(a,e,t,o,r,l);if(d!==ho)return d}c=e[a+8],-1!==c&&pV(r,e[1].data[a+8]===l)&&fV(s,a,e)?(o=u,a=$p(c),e=qp(c,e)):a=-1}}return i}function Mee(n,e,t,r,i,s){const o=e[1],a=o.data[n+8],u=$y(a,o,t,null==r?zo(a)&&_S:r!=o&&!!(3&a.type),1&i&&s===a);return null!==u?Xp(e,o,u,a,i):ho}function $y(n,e,t,r,i){const s=n.providerIndexes,o=e.data,a=1048575&s,c=n.directiveStart,u=s>>20,h=i?a+u:n.directiveEnd;for(let f=r?a:a+u;f<h;f++){const m=o[f];if(f<c&&t===m||f>=c&&m.type===t)return f}if(i){const f=o[c];if(f&&ss(f)&&f.type===t)return c}return null}function Xp(n,e,t,r,i){let s=n[t];const o=e.data;if(s instanceof jp){const a=s;if(a.resolving)throw function Yt(n){return"function"==typeof n?n.name||n.toString():"object"==typeof n&&null!=n&&"function"==typeof n.type?n.type.name||n.type.toString():Tt(n)}(o[t]),RI();const c=Gy(a.canSeeViewProviders);a.resolving=!0;const d=a.injectImpl?Vi(a.injectImpl):null;M2(n,r,0);try{s=n[t]=a.factory(void 0,i,o,n,r),e.firstCreatePass&&t>=r.directiveStart&&function vee(n,e,t){const{ngOnChanges:r,ngOnInit:i,ngDoCheck:s}=e.type.prototype;if(r){const o=Y2(e);(t.preOrderHooks??=[]).push(n,o),(t.preOrderCheckHooks??=[]).push(n,o)}i&&(t.preOrderHooks??=[]).push(0-n,i),s&&((t.preOrderHooks??=[]).push(n,s),(t.preOrderCheckHooks??=[]).push(n,s))}(t,o[t],e)}finally{null!==d&&Vi(d),Gy(c),a.resolving=!1,P2()}}return s}function fV(n,e,t){return!!(t[e+(n>>5)]&1<<n)}function pV(n,e){return!(2&n||1&n&&e)}class tr{_tNode;_lView;constructor(e,t){this._tNode=e,this._lView=t}get(e,t,r){return dV(this._tNode,this._lView,e,Np(r),t)}}function Dee(){return new tr(bt(),re())}function ES(n){return by(n)?()=>{const e=ES(Ct(n));return e&&e()}:ml(n)}function mV(n){const e=n[1],t=e.type;return 2===t?e.declTNode:1===t?n[5]:null}function Uee(){return Vd(bt(),re())}function Vd(n,e){return new zs(vr(n,e))}let zs=(()=>class n{nativeElement;constructor(t){this.nativeElement=t}static __NG_ELEMENT_ID__=Uee})();function EV(n){return n instanceof zs?n.nativeElement:n}function Bee(){return this._results[Symbol.iterator]()}class Hee{_emitDistinctChangesOnly;dirty=!0;_onDirty=void 0;_results=[];_changesDetected=!1;_changes=void 0;length=0;first=void 0;last=void 0;get changes(){return this._changes??=new gd}constructor(e=!1){this._emitDistinctChangesOnly=e}get(e){return this._results[e]}map(e){return this._results.map(e)}filter(e){return this._results.filter(e)}find(e){return this._results.find(e)}reduce(e,t){return this._results.reduce(e,t)}forEach(e){this._results.forEach(e)}some(e){return this._results.some(e)}toArray(){return this._results.slice()}toString(){return this._results.toString()}reset(e,t){this.dirty=!1;const r=function ws(n){return n.flat(Number.POSITIVE_INFINITY)}(e);(this._changesDetected=!function fQ(n,e,t){if(n.length!==e.length)return!1;for(let r=0;r<n.length;r++){let i=n[r],s=e[r];if(t&&(i=t(i),s=t(s)),s!==i)return!1}return!0}(this._results,r,t))&&(this._results=r,this.length=r.length,this.last=r[this.length-1],this.first=r[0])}notifyOnChanges(){void 0!==this._changes&&(this._changesDetected||!this._emitDistinctChangesOnly)&&this._changes.next(this)}onDirty(e){this._onDirty=e}setDirty(){this.dirty=!0,this._onDirty?.()}destroy(){void 0!==this._changes&&(this._changes.complete(),this._changes.unsubscribe())}[Symbol.iterator]=Bee}function Kp(n){return!(128&~n.flags)}var Xy=function(n){return n[n.OnPush=0]="OnPush",n[n.Default=1]="Default",n}(Xy||{});const Ky=new Map;let Wee=0;function IS(n){Ky.delete(n[19])}const xS="__ngContext__";function zi(n,e){qn(e)?(n[xS]=e[19],function $ee(n){Ky.set(n[19],n)}(e)):n[xS]=e}function RV(n){return NV(n[12])}function PV(n){return NV(n[4])}function NV(n){for(;null!==n&&!wi(n);)n=n[4];return n}let AS;const Jp=new Ae("",{providedIn:"root",factory:()=>pte}),pte="ng",BV=new Ae(""),Zp=new Ae("",{providedIn:"platform",factory:()=>"unknown"}),HV=new Ae("",{providedIn:"root",factory:()=>function Ya(){if(void 0!==AS)return AS;if(typeof document<"u")return document;throw new ue(210,!1)}().body?.querySelector("[ngCspNonce]")?.getAttribute("ngCspNonce")||null}),Tte=new Ae("",{providedIn:"root",factory:()=>!1});function ev(n){return!(32&~n.flags)}function hU(n,e){const t=n.contentQueries;if(null!==t){const r=gt(null);try{for(let i=0;i<t.length;i+=2){const o=t[i+1];if(-1!==o){const a=n.data[o];Vy(t[i]),a.contentQueries(2,e[o],o)}}}finally{gt(r)}}}function WS(n,e,t){Vy(0);const r=gt(null);try{e(n,t)}finally{gt(r)}}function jS(n,e,t){if(i2(e)){const r=gt(null);try{const s=e.directiveEnd;for(let o=e.directiveStart;o<s;o++){const a=n.data[o];a.contentQueries&&a.contentQueries(1,t[o],o)}}finally{gt(r)}}}var Jo=function(n){return n[n.Emulated=0]="Emulated",n[n.None=2]="None",n[n.ShadowDom=3]="ShadowDom",n}(Jo||{});class _U{changingThisBreaksApplicationSecurity;constructor(e){this.changingThisBreaksApplicationSecurity=e}toString(){return`SafeValue must use [property]=binding: ${this.changingThisBreaksApplicationSecurity} (see ${VF})`}}function Za(n){return n instanceof _U?n.changingThisBreaksApplicationSecurity:n}const one=/^(?!javascript:)(?:[a-z0-9+.-]+:|[^&:\/?#]*(?:[\/?#]|$))/i;var Wd=function(n){return n[n.NONE=0]="NONE",n[n.HTML=1]="HTML",n[n.STYLE=2]="STYLE",n[n.SCRIPT=3]="SCRIPT",n[n.URL=4]="URL",n[n.RESOURCE_URL=5]="RESOURCE_URL",n}(Wd||{});function JS(n){const e=function rm(){const n=re();return n&&n[10].sanitizer}();return e?e.sanitize(Wd.URL,n)||"":function tm(n,e){const t=function nne(n){return n instanceof _U&&n.getTypeName()||null}(n);if(null!=t&&t!==e){if("ResourceURL"===t&&"URL"===e)return!0;throw new Error(`Required a safe ${e}, got a ${t} (see ${VF})`)}return t===e}(n,"URL")?Za(n):function qS(n){return(n=String(n)).match(one)?n:"unsafe:"+n}(Tt(n))}const wne=/^>|^->|<!--|-->|--!>|<!-$/g,Ine=/(<|>)/g;function Fne(n,e,t){let r=n.length;for(;;){const i=n.indexOf(e,t);if(-1===i)return i;if(0===i||n.charCodeAt(i-1)<=32){const s=e.length;if(i+s===r||n.charCodeAt(i+s)<=32)return i}t=i+1}}const kU="ng-template";function Vne(n,e,t,r){let i=0;if(r){for(;i<e.length&&"string"==typeof e[i];i+=2)if("class"===e[i]&&-1!==Fne(e[i+1].toLowerCase(),t,0))return!0}else if(ex(n))return!1;if(i=e.indexOf(1,i),i>-1){let s;for(;++i<e.length&&"string"==typeof(s=e[i]);)if(s.toLowerCase()===t)return!0}return!1}function ex(n){return 4===n.type&&n.value!==kU}function Une(n,e,t){return e===(4!==n.type||t?n.value:kU)}function Bne(n,e,t){let r=4;const i=n.attrs,s=null!==i?function Gne(n){for(let e=0;e<n.length;e++)if(rV(n[e]))return e;return n.length}(i):0;let o=!1;for(let a=0;a<e.length;a++){const c=e[a];if("number"!=typeof c){if(!o)if(4&r){if(r=2|1&r,""!==c&&!Une(n,c,t)||""===c&&1===e.length){if(Gs(r))return!1;o=!0}}else if(8&r){if(null===i||!Vne(n,i,c,t)){if(Gs(r))return!1;o=!0}}else{const l=e[++a],u=Hne(c,i,ex(n),t);if(-1===u){if(Gs(r))return!1;o=!0;continue}if(""!==l){let d;if(d=u>s?"":i[u+1].toLowerCase(),2&r&&l!==d){if(Gs(r))return!1;o=!0}}}}else{if(!o&&!Gs(r)&&!Gs(c))return!1;if(o&&Gs(c))continue;o=!1,r=c|1&r}}return Gs(r)||o}function Gs(n){return!(1&n)}function Hne(n,e,t,r){if(null===e)return-1;let i=0;if(r||!t){let s=!1;for(;i<e.length;){const o=e[i];if(o===n)return i;if(3===o||6===o)s=!0;else{if(1===o||2===o){let a=e[++i];for(;"string"==typeof a;)a=e[++i];continue}if(4===o)break;if(0===o){i+=4;continue}}i+=s?1:2}return-1}return function Wne(n,e){let t=n.indexOf(4);if(t>-1)for(t++;t<n.length;){const r=n[t];if("number"==typeof r)return-1;if(r===e)return t;t++}return-1}(e,n)}function LU(n,e,t=!1){for(let r=0;r<e.length;r++)if(Bne(n,e[r],t))return!0;return!1}function FU(n,e){return n?":not("+e.trim()+")":e}function $ne(n){let e=n[0],t=1,r=2,i="",s=!1;for(;t<n.length;){let o=n[t];if("string"==typeof o)if(2&r){const a=n[++t];i+="["+o+(a.length>0?'="'+a+'"':"")+"]"}else 8&r?i+="."+o:4&r&&(i+=" "+o);else""!==i&&!Gs(o)&&(e+=FU(s,i),i=""),r=o,s=s||!Gs(r);t++}return""!==i&&(e+=FU(s,i)),e}const nn={};function nx(n,e){return n.createComment(function AU(n){return n.replace(wne,e=>e.replace(Ine,"\u200b$1\u200b"))}(e))}function uv(n,e,t){return n.createElement(e,t)}function Ml(n,e,t,r,i){n.insertBefore(e,t,r,i)}function UU(n,e,t){n.appendChild(e,t)}function BU(n,e,t,r,i){null!==r?Ml(n,e,t,r,i):UU(n,e,t)}function zU(n,e,t){const{mergedAttrs:r,classes:i,styles:s}=t;null!==r&&function wee(n,e,t){let r=0;for(;r<t.length;){const i=t[r];if("number"==typeof i){if(0!==i)break;r++;const s=t[r++],o=t[r++],a=t[r++];n.setAttribute(e,o,a,s)}else{const s=i,o=t[++r];iV(s)?n.setProperty(e,s,o):n.setAttribute(e,s,o),r++}}}(n,e,r),null!==i&&function Yne(n,e,t){""===t?n.removeAttribute(e,"class"):n.setAttribute(e,"class",t)}(n,e,i),null!==s&&function Kne(n,e,t){n.setAttribute(e,"style",t)}(n,e,s)}function rx(n,e,t,r,i,s,o,a,c,l,u){const d=26+r,h=d+i,f=function Jne(n,e){const t=[];for(let r=0;r<e;r++)t.push(r<n?null:nn);return t}(d,h),m="function"==typeof l?l():l;return f[1]={type:n,blueprint:f,template:t,queries:null,viewQuery:a,declTNode:e,data:f.slice().fill(null,d),bindingStartIndex:d,expandoStartIndex:h,hostBindingOpCodes:null,firstCreatePass:!0,firstUpdatePass:!0,staticViewQueries:!1,staticContentQueries:!1,preOrderHooks:null,preOrderCheckHooks:null,contentHooks:null,contentCheckHooks:null,viewHooks:null,viewCheckHooks:null,destroyHooks:null,cleanup:null,contentQueries:null,components:null,directiveRegistry:"function"==typeof s?s():s,pipeRegistry:"function"==typeof o?o():o,firstChild:null,schemas:c,consts:m,incompleteFirstPass:!1,ssrId:u}}function dv(n,e,t,r,i,s,o,a,c,l,u){const d=e.blueprint.slice();return d[0]=i,d[2]=1228|r,(null!==l||n&&2048&n[2])&&(d[2]|=2048),u2(d),d[3]=d[14]=n,d[8]=t,d[10]=o||n&&n[10],d[11]=a||n&&n[11],d[9]=c||n&&n[9]||null,d[5]=s,d[19]=function jee(){return Wee++}(),d[6]=u,d[20]=l,d[15]=2==e.type?n[15]:d,d}function ix(n){let e=16;return n.signals?e=4096:n.onPush&&(e=64),e}function sm(n,e,t,r){if(0===t)return-1;const i=e.length;for(let s=0;s<t;s++)e.push(r),n.blueprint.push(r),n.data.push(null);return i}function sx(n,e){return n[12]?n[13][4]=e:n[12]=e,n[13]=e,e}function Je(n=1){WU(wt(),re(),Kr()+n,!1)}function WU(n,e,t,r){if(!r)if(3&~e[2]){const s=n.preOrderHooks;null!==s&&zy(e,s,0,t)}else{const s=n.preOrderCheckHooks;null!==s&&Hy(e,s,t)}wl(t)}var hv=function(n){return n[n.None=0]="None",n[n.SignalBased=1]="SignalBased",n[n.HasDecoratorInputTransform=2]="HasDecoratorInputTransform",n}(hv||{});function om(n,e,t,r){const i=gt(null);try{const[s,o,a]=n.inputs[t];let c=null;0!==(o&hv.SignalBased)&&(c=e[s][Xr]),null!==c&&void 0!==c.transformFn?r=c.transformFn(r):null!==a&&(r=a.call(e,r)),null!==n.setInput?n.setInput(e,c,r,t,s):K2(e,c,s,r)}finally{gt(i)}}var Qa=function(n){return n[n.Important=1]="Important",n[n.DashCase=2]="DashCase",n}(Qa||{});function ax(n,e){return undefined(n,e)}function $d(n,e,t,r,i){if(null!=r){let s,o=!1;wi(r)?s=r:qn(r)&&(o=!0,r=r[0]);const a=Vr(r);0===n&&null!==t?null==i?UU(e,t,a):Ml(e,t,a,i||null,!0):1===n&&null!==t?Ml(e,t,a,i||null,!0):2===n?function im(n,e,t){n.removeChild(null,e,t)}(e,a,o):3===n&&e.destroyNode(a),null!=s&&function sre(n,e,t,r,i){const s=t[7];s!==Vr(t)&&$d(e,n,r,s,i);for(let a=10;a<t.length;a++){const c=t[a];pv(c[1],c,n,e,r,s)}}(e,n,s,t,i)}}function $U(n,e){e[10].changeDetectionScheduler?.notify(9),pv(n,e,e[11],2,null,null)}function cx(n,e){const t=n[9],r=t.indexOf(e);t.splice(r,1)}function am(n,e){if(Go(e))return;const t=e[11];t.destroyNode&&pv(n,e,t,3,null,null),function tre(n){let e=n[12];if(!e)return lx(n[1],n);for(;e;){let t=null;if(qn(e))t=e[12];else{const r=e[10];r&&(t=r)}if(!t){for(;e&&!e[4]&&e!==n;)qn(e)&&lx(e[1],e),e=e[3];null===e&&(e=n),qn(e)&&lx(e[1],e),t=e&&e[4]}e=t}}(e)}function lx(n,e){if(Go(e))return;const t=gt(null);try{e[2]&=-129,e[2]|=256,e[24]&&Mp(e[24]),function rre(n,e){let t;if(null!=n&&null!=(t=n.destroyHooks))for(let r=0;r<t.length;r+=2){const i=e[t[r]];if(!(i instanceof jp)){const s=t[r+1];if(Array.isArray(s))for(let o=0;o<s.length;o+=2){const a=i[s[o]],c=s[o+1];ln(4,a,c);try{c.call(a)}finally{ln(5,a,c)}}else{ln(4,i,s);try{s.call(i)}finally{ln(5,i,s)}}}}}(n,e),function nre(n,e){const t=n.cleanup,r=e[7];if(null!==t)for(let o=0;o<t.length-1;o+=2)if("string"==typeof t[o]){const a=t[o+3];a>=0?r[a]():r[-a].unsubscribe(),o+=2}else t[o].call(r[t[o+1]]);null!==r&&(e[7]=null);const i=e[21];if(null!==i){e[21]=null;for(let o=0;o<i.length;o++)(0,i[o])()}const s=e[23];if(null!==s){e[23]=null;for(const o of s)o.destroy()}}(n,e),1===e[1].type&&e[11].destroy();const r=e[16];if(null!==r&&wi(e[3])){r!==e[3]&&cx(r,e);const i=e[18];null!==i&&i.detachView(n)}IS(e)}finally{gt(t)}}function ux(n,e,t){return function qU(n,e,t){let r=e;for(;null!==r&&168&r.type;)r=(e=r).parent;if(null===r)return t[0];if(zo(r)){const{encapsulation:i}=n.data[r.directiveStart+r.componentOffset];if(i===Jo.None||i===Jo.Emulated)return null}return vr(r,t)}(n,e.parent,t)}let YU=function KU(n,e,t){return 40&n.type?vr(n,t):null};function hx(n,e,t,r){const i=ux(n,r,e),s=e[11],a=function XU(n,e,t){return YU(n,e,t)}(r.parent||e[5],r,e);if(null!=i)if(Array.isArray(t))for(let c=0;c<t.length;c++)BU(s,i,t[c],a,!1);else BU(s,i,t,a,!1)}function Cl(n,e){if(null!==e){const t=e.type;if(3&t)return vr(e,n);if(4&t)return fv(-1,n[e.index]);if(8&t){const r=e.child;if(null!==r)return Cl(n,r);{const i=n[e.index];return wi(i)?fv(-1,i):Vr(i)}}if(128&t)return Cl(n,e.next);if(32&t)return ax(e,n)()||Vr(n[e.index]);{const r=ZU(n,e);return null!==r?Array.isArray(r)?r[0]:Cl(Wo(n[15]),r):Cl(n,e.next)}}return null}function ZU(n,e){return null!==e?n[15][5].projection[e.projection]:null}function fv(n,e){const t=10+n+1;if(t<e.length){const r=e[t],i=r[1].firstChild;if(null!==i)return Cl(r,i)}return e[7]}function fx(n,e,t,r,i,s,o){for(;null!=t;){if(128===t.type){t=t.next;continue}const a=r[t.index],c=t.type;if(o&&0===e&&(a&&zi(Vr(a),r),t.flags|=2),!ev(t))if(8&c)fx(n,e,t.child,r,i,s,!1),$d(e,n,i,a,s);else if(32&c){const l=ax(t,r);let u;for(;u=l();)$d(e,n,i,u,s);$d(e,n,i,a,s)}else 16&c?QU(n,e,r,t,i,s):$d(e,n,i,a,s);t=o?t.projectionNext:t.next}}function pv(n,e,t,r,i,s){fx(t,r,n.firstChild,e,i,s,!1)}function QU(n,e,t,r,i,s){const o=t[15],c=o[5].projection[r.projection];if(Array.isArray(c))for(let l=0;l<c.length;l++)$d(e,n,i,c[l],s);else{let l=c;const u=o[3];Kp(r)&&(l.flags|=128),fx(n,e,l,u,i,s,!0)}}function e3(n,e,t,r,i){const s=Kr(),o=2&r;try{wl(-1),o&&e.length>26&&WU(n,e,26,!1),ln(o?2:0,i,t),t(r,i)}finally{wl(s),ln(o?3:1,i,t)}}function mv(n,e,t){(function dre(n,e,t){const r=t.directiveStart,i=t.directiveEnd;zo(t)&&function Zne(n,e,t){const r=vr(e,n),i=function GU(n){const e=n.tView;return null===e||e.incompleteFirstPass?n.tView=rx(1,null,n.template,n.decls,n.vars,n.directiveDefs,n.pipeDefs,n.viewQuery,n.schemas,n.consts,n.id):e}(t),s=n[10].rendererFactory,o=sx(n,dv(n,i,null,ix(t),r,e,null,s.createRenderer(r,t),null,null,null));n[e.index]=o}(e,t,n.data[r+t.componentOffset]),n.firstCreatePass||Wy(t,e);const s=t.initialInputs;for(let o=r;o<i;o++){const a=n.data[o],c=Xp(e,n,o,t);zi(c,e),null!==s&&mre(0,o-r,c,a,0,s),ss(a)&&(Ii(t.index,e)[8]=Xp(e,n,o,t))}})(n,e,t),!(64&~t.flags)&&function hre(n,e,t){const r=t.directiveStart,i=t.directiveEnd,s=t.index,o=function kQ(){return _t.lFrame.currentDirectiveIndex}();try{wl(s);for(let a=r;a<i;a++){const c=n.data[a],l=e[a];rS(a),(null!==c.hostBindings||0!==c.hostVars||null!==c.hostAttrs)&&fre(c,l)}}finally{wl(-1),rS(o)}}(n,e,t)}function qd(n,e,t=vr){const r=e.localNames;if(null!==r){let i=e.index+1;for(let s=0;s<r.length;s+=2){const o=r[s+1],a=-1===o?t(e,n):n[o];n[i++]=a}}}let t3=()=>null;function px(n,e,t,r,i,s){vv(n,e[1],e,t,r)?zo(n)&&function n3(n,e){const t=Ii(e,n);16&t[2]||(t[2]|=64)}(e,n.index):(3&n.type&&(t=function ure(n){return"class"===n?"className":"for"===n?"htmlFor":"formaction"===n?"formAction":"innerHtml"===n?"innerHTML":"readonly"===n?"readOnly":"tabindex"===n?"tabIndex":n}(t)),function mx(n,e,t,r,i,s){if(3&n.type){const o=vr(n,e);r=null!=s?s(r,n.value||"",t):r,i.setProperty(o,t,r)}}(n,e,t,r,i,s))}function fre(n,e){null!==n.hostBindings&&n.hostBindings(1,e)}function gx(n,e){const t=n.directiveRegistry;let r=null;if(t)for(let i=0;i<t.length;i++){const s=t[i];LU(e,s.selectors,!1)&&(r??=[],ss(s)?r.unshift(s):r.push(s))}return r}function mre(n,e,t,r,i,s){const o=s[e];if(null!==o)for(let a=0;a<o.length;a+=2)om(r,t,o[a],o[a+1])}function _v(n,e,t,r,i){const s=26+t,o=e[1],a=i(o,e,n,r,t);e[s]=a,jo(n,!0);const c=2===n.type;return c?(zU(e[11],a,n),(0===function CQ(){return _t.lFrame.elementDepthCount}()||Id(n))&&zi(a,e),function DQ(){_t.lFrame.elementDepthCount++}()):zi(a,e),Uy()&&(!c||!ev(n))&&hx(o,e,a,n),n}function yv(n){let e=n;return b2()?function T2(){_t.lFrame.isParent=!1}():(e=e.parent,jo(e,!1)),e}function vv(n,e,t,r,i){const s=n.inputs?.[r],o=n.hostDirectiveInputs?.[r];let a=!1;if(o)for(let c=0;c<o.length;c+=2){const l=o[c];om(e.data[l],t[l],o[c+1],i),a=!0}if(s)for(const c of s)om(e.data[c],t[c],r,i),a=!0;return a}function _re(n,e){const t=Ii(e,n),r=t[1];!function yre(n,e){for(let t=e.length;t<n.blueprint.length;t++)e.push(n.blueprint[t])}(r,t);const i=t[0];null!==i&&null===t[6]&&(t[6]=null),ln(18),Ev(r,t,t[8]),ln(19,t[8])}function Ev(n,e,t){oS(e);try{const r=n.viewQuery;null!==r&&WS(1,r,t);const i=n.template;null!==i&&e3(n,e,i,1,t),n.firstCreatePass&&(n.firstCreatePass=!1),e[18]?.finishViewCreation(n),n.staticContentQueries&&hU(n,e),n.staticViewQueries&&WS(2,n.viewQuery,t);const s=n.components;null!==s&&function vre(n,e){for(let t=0;t<e.length;t++)_re(n,e[t])}(e,s)}catch(r){throw n.firstCreatePass&&(n.incompleteFirstPass=!0,n.firstCreatePass=!1),r}finally{e[2]&=-5,aS()}}function Dl(n,e){return!e||null===e.firstChild||Kp(n)}function cm(n,e,t,r,i=!1){for(;null!==t;){if(128===t.type){t=i?t.projectionNext:t.next;continue}const s=e[t.index];null!==s&&r.push(Vr(s)),wi(s)&&bre(s,r);const o=t.type;if(8&o)cm(n,e,t.child,r);else if(32&o){const a=ax(t,e);let c;for(;c=a();)r.push(c)}else if(16&o){const a=ZU(e,t);if(Array.isArray(a))r.push(...a);else{const c=Wo(e[15]);cm(c[1],c,a,r,!0)}}t=i?t.projectionNext:t.next}return r}function bre(n,e){for(let t=10;t<n.length;t++){const r=n[t],i=r[1].firstChild;null!==i&&cm(r[1],r,i,e)}n[7]!==n[0]&&e.push(n[7])}function o3(n){if(null!==n[25]){for(const e of n[25])e.impl.addSequence(e);n[25].length=0}}let a3=[];const Sre={...hd,consumerIsAlwaysLive:!0,kind:"template",consumerMarkedDirty:n=>{Ad(n.lView)},consumerOnSignalRead(){this.lView[24]=this}},Are={...hd,consumerIsAlwaysLive:!0,kind:"template",consumerMarkedDirty:n=>{let e=Wo(n.lView);for(;e&&!c3(e[1]);)e=Wo(e);e&&d2(e)},consumerOnSignalRead(){this.lView[24]=this}};function c3(n){return 2!==n.type}function l3(n){if(null===n[23])return;let e=!0;for(;e;){let t=!1;for(const r of n[23])r.dirty&&(t=!0,null===r.zone||Zone.current===r.zone?r.run():r.zone.run(()=>r.run()));e=t&&!!(8192&n[2])}}function bv(n,e=0){const r=n[10].rendererFactory;r.begin?.();try{!function Cre(n,e){const t=S2();try{Fy(!0),yx(n,e);let r=0;for(;ky(n);){if(100===r)throw new ue(103,!1);r++,yx(n,1)}}finally{Fy(t)}}(n,e)}finally{r.end?.()}}function u3(n,e,t,r){if(Go(e))return;const i=e[2];oS(e);let a=!0,c=null,l=null;c3(n)?(l=function Tre(n){return n[24]??function wre(n){const e=a3.pop()??Object.create(Sre);return e.lView=n,e}(n)}(e),c=fd(l)):null===function hI(){return oi}()?(a=!1,l=function xre(n){const e=n[24]??Object.create(Are);return e.lView=n,e}(e),c=fd(l)):e[24]&&(Mp(e[24]),e[24]=null);try{u2(e),function x2(n){return _t.lFrame.bindingIndex=n}(n.bindingStartIndex),null!==t&&e3(n,e,t,2,r);const u=!(3&~i);if(u){const f=n.preOrderCheckHooks;null!==f&&Hy(e,f,null)}else{const f=n.preOrderHooks;null!==f&&zy(e,f,0,null),pS(e,0)}if(function Rre(n){for(let e=RV(n);null!==e;e=PV(e)){if(!(2&e[2]))continue;const t=e[9];for(let r=0;r<t.length;r++)d2(t[r])}}(e),l3(e),d3(e,0),null!==n.contentQueries&&hU(n,e),u){const f=n.contentCheckHooks;null!==f&&Hy(e,f)}else{const f=n.contentHooks;null!==f&&zy(e,f,1),pS(e,1)}!function Nre(n,e){const t=n.hostBindingOpCodes;if(null!==t)try{for(let r=0;r<t.length;r++){const i=t[r];if(i<0)wl(~i);else{const s=i,o=t[++r],a=t[++r];OQ(o,s);const c=e[s];ln(24,c),a(2,c),ln(25,c)}}}finally{wl(-1)}}(n,e);const d=n.components;null!==d&&f3(e,d,0);const h=n.viewQuery;if(null!==h&&WS(2,h,r),u){const f=n.viewCheckHooks;null!==f&&Hy(e,f)}else{const f=n.viewHooks;null!==f&&zy(e,f,2),pS(e,2)}if(!0===n.firstUpdatePass&&(n.firstUpdatePass=!1),e[22]){for(const f of e[22])f();e[22]=null}o3(e),e[2]&=-73}catch(u){throw Ad(e),u}finally{null!==l&&(Ap(l,c),a&&function Ire(n){n.lView[24]!==n&&(n.lView=null,a3.push(n))}(l)),aS()}}function d3(n,e){for(let t=RV(n);null!==t;t=PV(t))for(let r=10;r<t.length;r++)h3(t[r],e)}function Pre(n,e,t){ln(18);const r=Ii(e,n);h3(r,t),ln(19,r[8])}function h3(n,e){JI(n)&&yx(n,e)}function yx(n,e){const r=n[1],i=n[2],s=n[24];let o=!!(0===e&&16&i);if(o||=!!(64&i&&0===e),o||=!!(1024&i),o||=!(!s?.dirty||!my(s)),o||=!1,s&&(s.dirty=!1),n[2]&=-9217,o)u3(r,n,r.template,n[8]);else if(8192&i){const a=gt(null);try{l3(n),d3(n,1);const c=r.components;null!==c&&f3(n,c,1),o3(n)}finally{gt(a)}}}function f3(n,e,t){for(let r=0;r<e.length;r++)Pre(n,e[r],t)}function Kd(n,e){const t=S2()?64:1088;for(n[10].changeDetectionScheduler?.notify(e);n;){n[2]|=t;const r=Wo(n);if(qa(n)&&!r)return n;n=r}return null}function p3(n,e,t,r){return[n,!0,0,e,null,r,null,t,null,null]}function lm(n,e){if(n.length<=10)return;const t=10+e,r=n[t];if(r){const i=r[16];null!==i&&i!==n&&cx(i,r),e>0&&(n[t-1][4]=r[4]);const s=xy(n,10+e);!function jU(n,e){$U(n,e),e[0]=null,e[5]=null}(r[1],r);const o=s[18];null!==o&&o.detachView(s[1]),r[3]=null,r[4]=null,r[2]&=-129}return r}function g3(n,e){const t=n[9],r=e[3];(qn(r)||e[15]!==r[3][15])&&(n[2]|=2),null===t?n[9]=[e]:t.push(e)}class um{_lView;_cdRefInjectingView;_appRef=null;_attachedToViewContainer=!1;exhaustive;get rootNodes(){const e=this._lView,t=e[1];return cm(t,e,t.firstChild,[])}constructor(e,t){this._lView=e,this._cdRefInjectingView=t}get context(){return this._lView[8]}set context(e){this._lView[8]=e}get destroyed(){return Go(this._lView)}destroy(){if(this._appRef)this._appRef.detachView(this);else if(this._attachedToViewContainer){const e=this._lView[3];if(wi(e)){const t=e[8],r=t?t.indexOf(this):-1;r>-1&&(lm(e,r),xy(t,r))}this._attachedToViewContainer=!1}am(this._lView[1],this._lView)}onDestroy(e){Ly(this._lView,e)}markForCheck(){Kd(this._cdRefInjectingView||this._lView,4)}detach(){this._lView[2]&=-129}reattach(){ZI(this._lView),this._lView[2]|=128}detectChanges(){this._lView[2]|=1024,bv(this._lView)}checkNoChanges(){}attachToViewContainerRef(){if(this._appRef)throw new ue(902,!1);this._attachedToViewContainer=!0}detachFromAppRef(){this._appRef=null;const e=qa(this._lView),t=this._lView[16];null!==t&&!e&&cx(t,this._lView),$U(this._lView[1],this._lView)}attachToAppRef(e){if(this._attachedToViewContainer)throw new ue(902,!1);this._appRef=e;const t=qa(this._lView),r=this._lView[16];null!==r&&!t&&g3(r,this._lView),ZI(this._lView)}}let Qo=(()=>class n{_declarationLView;_declarationTContainer;elementRef;static __NG_ELEMENT_ID__=kre;constructor(t,r,i){this._declarationLView=t,this._declarationTContainer=r,this.elementRef=i}get ssrId(){return this._declarationTContainer.tView?.ssrId||null}createEmbeddedView(t,r){return this.createEmbeddedViewImpl(t,r)}createEmbeddedViewImpl(t,r,i){const s=function Xd(n,e,t,r){const i=gt(null);try{const s=e.tView,c=dv(n,s,t,4096&n[2]?4096:16,null,e,null,null,r?.injector??null,r?.embeddedViewInjector??null,r?.dehydratedView??null);c[16]=n[e.index];const u=n[18];return null!==u&&(c[18]=u.createEmbeddedView(s)),Ev(s,c,t),c}finally{gt(i)}}(this._declarationLView,this._declarationTContainer,t,{embeddedViewInjector:r,dehydratedView:i});return new um(s)}})();function kre(){return Tv(bt(),re())}function Tv(n,e){return 4&n.type?new Qo(e,n,Vd(n,e)):null}function Rl(n,e,t,r,i){let s=n.data[e];if(null===s)s=function wx(n,e,t,r,i){const s=E2(),o=b2(),c=n.data[e]=function Wre(n,e,t,r,i,s){let o=e?e.injectorIndex:-1,a=0;return function _2(){return null!==_t.skipHydrationRootTNode}()&&(a|=128),{type:t,index:r,insertBeforeIndex:null,injectorIndex:o,directiveStart:-1,directiveEnd:-1,directiveStylingLast:-1,componentOffset:-1,propertyBindings:null,flags:a,providerIndexes:0,value:i,attrs:s,mergedAttrs:null,localNames:null,initialInputs:null,inputs:null,hostDirectiveInputs:null,outputs:null,hostDirectiveOutputs:null,directiveToIndex:null,tView:null,next:null,prev:null,projectionNext:null,child:null,parent:e,projection:null,styles:null,stylesWithoutHost:null,residualStyles:void 0,classes:null,classesWithoutHost:null,residualClasses:void 0,classBindings:0,styleBindings:0}}(0,o?s:s&&s.parent,t,e,r,i);return function Gre(n,e,t,r){null===n.firstChild&&(n.firstChild=e),null!==t&&(r?null==t.child&&null!==e.parent&&(t.child=e):null===t.next&&(t.next=e,e.prev=t))}(n,c,s,o),c}(n,e,t,r,i),function NQ(){return _t.lFrame.inI18n}()&&(s.flags|=32);else if(64&s.type){s.type=t,s.value=r,s.attrs=i;const o=function Bp(){const n=_t.lFrame,e=n.currentTNode;return n.isParent?e:e.parent}();s.injectorIndex=null===o?-1:o.injectorIndex}return jo(s,!0),s}let xie=class{},H3=class{};class Aie{resolveComponentFactory(e){throw new ue(917,!1)}}let Dv=class{static NULL=new Aie};class Dx{}let Nl=(()=>class n{destroyNode=null;static __NG_ELEMENT_ID__=()=>function Mie(){const n=re(),t=Ii(bt().index,n);return(qn(t)?t:n)[11]}()})(),Cie=(()=>{class n{static \u0275prov=Et({token:n,providedIn:"root",factory:()=>null})}return n})();const Px={};class Qd{injector;parentInjector;constructor(e,t){this.injector=e,this.parentInjector=t}get(e,t,r){const i=this.injector.get(e,Px,r);return i!==Px||t===Px?i:this.parentInjector.get(e,t,r)}}function Pv(n,e,t){let r=t?n.styles:null,i=t?n.classes:null,s=0;if(null!==e)for(let o=0;o<e.length;o++){const a=e[o];"number"==typeof a?s=a:1==s?i=SI(i,a):2==s&&(r=SI(r,a+": "+e[++o]+";"))}t?n.styles=r:n.stylesWithoutHost=r,t?n.classes=i:n.classesWithoutHost=i}function Me(n,e=0){const t=re();return null===t?Rt(n,e):dV(bt(),t,Ct(n),e)}function G3(n,e,t,r,i){const s=null===r?null:{"":-1},o=i(n,t);if(null!==o){let a=o,c=null,l=null;for(const u of o)if(null!==u.resolveHostDirectives){[a,c,l]=u.resolveHostDirectives(o);break}!function Lie(n,e,t,r,i,s,o){const a=r.length;let c=!1;for(let h=0;h<a;h++){const f=r[h];!c&&ss(f)&&(c=!0,kie(n,t,h)),vS(Wy(t,e),n,f.type)}!function zie(n,e,t){n.flags|=1,n.directiveStart=e,n.directiveEnd=e+t,n.providerIndexes=e}(t,n.data.length,a);for(let h=0;h<a;h++){const f=r[h];f.providersResolver&&f.providersResolver(f)}let l=!1,u=!1,d=sm(n,e,a,null);a>0&&(t.directiveToIndex=new Map);for(let h=0;h<a;h++){const f=r[h];if(t.mergedAttrs=Fd(t.mergedAttrs,f.hostAttrs),Vie(n,t,e,d,f),Hie(d,f,i),null!==o&&o.has(f)){const[y,_]=o.get(f);t.directiveToIndex.set(f.type,[d,y+t.directiveStart,_+t.directiveStart])}else(null===s||!s.has(f))&&t.directiveToIndex.set(f.type,d);null!==f.contentQueries&&(t.flags|=4),(null!==f.hostBindings||null!==f.hostAttrs||0!==f.hostVars)&&(t.flags|=64);const m=f.type.prototype;!l&&(m.ngOnChanges||m.ngOnInit||m.ngDoCheck)&&((n.preOrderHooks??=[]).push(t.index),l=!0),!u&&(m.ngOnChanges||m.ngDoCheck)&&((n.preOrderCheckHooks??=[]).push(t.index),u=!0),d++}!function Fie(n,e,t){for(let r=e.directiveStart;r<e.directiveEnd;r++){const i=n.data[r];if(null!==t&&t.has(i)){const s=t.get(i);j3(0,e,s,r),j3(1,e,s,r),q3(e,r,!0)}else W3(0,e,i,r),W3(1,e,i,r),q3(e,r,!1)}}(n,t,s)}(n,e,t,a,s,c,l)}null!==s&&null!==r&&function Oie(n,e,t){const r=n.localNames=[];for(let i=0;i<e.length;i+=2){const s=t[e[i+1]];if(null==s)throw new ue(-301,!1);r.push(e[i],s)}}(t,r,s)}function kie(n,e,t){e.componentOffset=t,(n.components??=[]).push(e.index)}function W3(n,e,t,r){const i=0===n?t.inputs:t.outputs;for(const s in i)if(i.hasOwnProperty(s)){let o;o=0===n?e.inputs??={}:e.outputs??={},o[s]??=[],o[s].push(r),$3(e,s)}}function j3(n,e,t,r){const i=0===n?t.inputs:t.outputs;for(const s in i)if(i.hasOwnProperty(s)){const o=i[s];let a;a=0===n?e.hostDirectiveInputs??={}:e.hostDirectiveOutputs??={},a[o]??=[],a[o].push(r,s),$3(e,o)}}function $3(n,e){"class"===e?n.flags|=8:"style"===e&&(n.flags|=16)}function q3(n,e,t){const{attrs:r,inputs:i,hostDirectiveInputs:s}=n;if(null===r||!t&&null===i||t&&null===s||ex(n))return n.initialInputs??=[],void n.initialInputs.push(null);let o=null,a=0;for(;a<r.length;){const c=r[a];if(0!==c)if(5!==c){if("number"==typeof c)break;if(!t&&i.hasOwnProperty(c)){const l=i[c];for(const u of l)if(u===e){o??=[],o.push(c,r[a+1]);break}}else if(t&&s.hasOwnProperty(c)){const l=s[c];for(let u=0;u<l.length;u+=2)if(l[u]===e){o??=[],o.push(l[u+1],r[a+1]);break}}a+=2}else a+=2;else a+=4}n.initialInputs??=[],n.initialInputs.push(o)}function Vie(n,e,t,r,i){n.data[r]=i;const s=i.factory||(i.factory=ml(i.type)),o=new jp(s,ss(i),Me,null);n.blueprint[r]=o,t[r]=o,function Uie(n,e,t,r,i){const s=i.hostBindings;if(s){let o=n.hostBindingOpCodes;null===o&&(o=n.hostBindingOpCodes=[]);const a=~e.index;(function Bie(n){let e=n.length;for(;e>0;){const t=n[--e];if("number"==typeof t&&t<0)return t}return 0})(o)!=a&&o.push(a),o.push(t,r,s)}}(n,e,r,sm(n,t,i.hostVars,nn),i)}function Hie(n,e,t){if(t){if(e.exportAs)for(let r=0;r<e.exportAs.length;r++)t[e.exportAs[r]]=n;ss(e)&&(t[""]=n)}}function Nx(n,e,t,r,i,s,o,a){const c=e[1],l=c.consts,d=Rl(c,n,t,r,li(l,o));return s&&G3(c,e,d,li(l,a),i),d.mergedAttrs=Fd(d.mergedAttrs,d.attrs),null!==d.attrs&&Pv(d,d.attrs,!1),null!==d.mergedAttrs&&Pv(d,d.mergedAttrs,!0),null!==c.queries&&c.queries.elementStart(c,d),d}function Ox(n,e){Q2(n,e),i2(e)&&n.queries.elementEnd(e)}function Nv(n){return!!function kx(n){return null!==n&&("function"==typeof n||"object"==typeof n)}(n)&&(Array.isArray(n)||!(n instanceof Map)&&Symbol.iterator in n)}function po(n,e,t){return n[e]=t}function Cn(n,e,t){return t!==nn&&(!Object.is(n[e],t)&&(n[e]=t,!0))}function bm(n,e,t){return function r(i){Kd(zo(n)?Ii(n.index,e):e,5);const o=e[8];let a=K3(e,o,t,i),c=r.__ngNextListenerFn__;for(;c;)a=K3(e,o,c,i)&&a,c=c.__ngNextListenerFn__;return a}}function K3(n,e,t,r){const i=gt(null);try{return ln(6,e,t),!1!==t(r)}catch(s){return function _x(n,e){const t=n[9];if(!t)return;let r;try{r=t.get(Ko,null)}catch{r=null}r?.(e)}(n,s),!1}finally{ln(7,e,t),gt(i)}}function Y3(n,e,t,r,i,s,o,a){const c=Id(n);let l=!1,u=null;if(!r&&c&&(u=function $ie(n,e,t,r){const i=n.cleanup;if(null!=i)for(let s=0;s<i.length-1;s+=2){const o=i[s];if(o===t&&i[s+1]===r){const a=e[7],c=i[s+2];return a&&a.length>c?a[c]:null}"string"==typeof o&&(s+=2)}return null}(e,t,s,n.index)),null!==u)(u.__ngLastListenerFn__||u).__ngNextListenerFn__=o,u.__ngLastListenerFn__=o,l=!0;else{const d=vr(n,t),h=r?r(d):d,f=i.listen(h,s,a);J3(r?y=>r(Vr(y[n.index])):n.index,e,t,s,a,f,!1)}return l}function J3(n,e,t,r,i,s,o){const a=e.firstCreatePass?p2(e):null,c=f2(t),l=c.length;c.push(i,s),a&&a.push(r,n,l,(l+1)*(o?-1:1))}function kv(n,e,t,r,i,s){const a=e[1],d=e[t][a.data[t].outputs[r]].subscribe(s);J3(n.index,a,e,i,s,d,!0)}const tc=Symbol("BINDING");class Z3 extends Dv{ngModule;constructor(e){super(),this.ngModule=e}resolveComponentFactory(e){const t=tn(e);return new Lx(t,this.ngModule)}}class Lx extends H3{componentDef;ngModule;selector;componentType;ngContentSelectors;isBoundToModule;cachedInputs=null;cachedOutputs=null;get inputs(){return this.cachedInputs??=function ese(n){return Object.keys(n).map(e=>{const[t,r,i]=n[e],s={propName:t,templateName:e,isSignal:0!==(r&hv.SignalBased)};return i&&(s.transform=i),s})}(this.componentDef.inputs),this.cachedInputs}get outputs(){return this.cachedOutputs??=function tse(n){return Object.keys(n).map(e=>({propName:n[e],templateName:e}))}(this.componentDef.outputs),this.cachedOutputs}constructor(e,t){super(),this.componentDef=e,this.ngModule=t,this.componentType=e.type,this.selector=function qne(n){return n.map($ne).join(",")}(e.selectors),this.ngContentSelectors=e.ngContentSelectors??[],this.isBoundToModule=!!t}create(e,t,r,i,s,o){ln(22);const a=gt(null);try{const c=this.componentDef,l=function ose(n,e,t,r){const i=n?["ng-version","20.3.0"]:function Xne(n){const e=[],t=[];let r=1,i=2;for(;r<n.length;){let s=n[r];if("string"==typeof s)2===i?""!==s&&e.push(s,n[++r]):8===i&&t.push(s);else{if(!Gs(i))break;i=s}r++}return t.length&&e.push(1,...t),e}(e.selectors[0]);let s=null,o=null,a=0;if(t)for(const u of t)a+=u[tc].requiredVars,u.create&&(u.targetIdx=0,(s??=[]).push(u)),u.update&&(u.targetIdx=0,(o??=[]).push(u));if(r)for(let u=0;u<r.length;u++){const d=r[u];if("function"!=typeof d)for(const h of d.bindings){a+=h[tc].requiredVars;const f=u+1;h.create&&(h.targetIdx=f,(s??=[]).push(h)),h.update&&(h.targetIdx=f,(o??=[]).push(h))}}const c=[e];if(r)for(const u of r){const h=Ti("function"==typeof u?u:u.type);c.push(h)}return rx(0,null,function ase(n,e){return n||e?t=>{if(1&t&&n)for(const r of n)r.create();if(2&t&&e)for(const r of e)r.update()}:null}(s,o),1,a,c,null,null,null,[i],null)}(r,c,o,s),u=function nse(n,e,t){let r=e instanceof Ui?e:e?.injector;return r&&null!==n.getStandaloneInjector&&(r=n.getStandaloneInjector(r)||r),r?new Qd(t,r):t}(c,i||this.ngModule,e),d=function rse(n){const e=n.get(Dx,null);if(null===e)throw new ue(407,!1);return{rendererFactory:e,sanitizer:n.get(Cie,null),changeDetectionScheduler:n.get(Dd,null),ngReflect:!1}}(u),h=d.rendererFactory.createRenderer(null,c),f=r?function are(n,e,t,r){const s=r.get(Tte,!1)||t===Jo.ShadowDom,o=n.selectRootElement(e,s);return function cre(n){t3(n)}(o),o}(h,r,c.encapsulation,u):function ise(n,e){const t=function sse(n){return(n.selectors[0][0]||"div").toLowerCase()}(n);return uv(e,t,"svg"===t?"svg":"math"===t?"math":null)}(c,h),m=o?.some(Q3)||s?.some(g=>"function"!=typeof g&&g.bindings.some(Q3)),y=dv(null,l,null,512|ix(c),null,null,d,h,u,null,null);y[26]=f,oS(y);let _=null;try{const g=Nx(26,y,2,"#host",()=>l.directiveRegistry,!0,0);f&&(zU(h,f,g),zi(f,y)),mv(l,y,g),jS(l,g,y),Ox(l,g),void 0!==t&&function lse(n,e,t){const r=n.projection=[];for(let i=0;i<e.length;i++){const s=t[i];r.push(null!=s&&s.length?Array.from(s):null)}}(g,this.ngContentSelectors,t),_=Ii(g.index,y),y[8]=_[8],Ev(l,y,null)}catch(g){throw null!==_&&IS(_),IS(y),g}finally{ln(23),aS()}return new cse(this.componentType,y,!!m)}finally{gt(a)}}}function Q3(n){const e=n[tc].kind;return"input"===e||"twoWay"===e}class cse extends xie{_rootLView;_hasInputBindings;instance;hostView;changeDetectorRef;componentType;location;previousInputValues=null;_tNode;constructor(e,t,r){super(),this._rootLView=t,this._hasInputBindings=r,this._tNode=xd(t[1],26),this.location=Vd(this._tNode,t),this.instance=Ii(this._tNode.index,t)[8],this.hostView=this.changeDetectorRef=new um(t,void 0),this.componentType=e}setInput(e,t){const r=this._tNode;if(this.previousInputValues??=new Map,this.previousInputValues.has(e)&&Object.is(this.previousInputValues.get(e),t))return;const i=this._rootLView;vv(r,i[1],i,e,t),this.previousInputValues.set(e,t),Kd(Ii(r.index,i),1)}get injector(){return new tr(this._tNode,this._rootLView)}destroy(){this.hostView.destroy()}onDestroy(e){this.hostView.onDestroy(e)}}let mo=(()=>class n{static __NG_ELEMENT_ID__=use})();function use(){return nB(bt(),re())}const dse=mo,eB=class extends dse{_lContainer;_hostTNode;_hostLView;constructor(e,t,r){super(),this._lContainer=e,this._hostTNode=t,this._hostLView=r}get element(){return Vd(this._hostTNode,this._hostLView)}get injector(){return new tr(this._hostTNode,this._hostLView)}get parentInjector(){const e=jy(this._hostTNode,this._hostLView);if(gS(e)){const t=qp(e,this._hostLView),r=$p(e);return new tr(t[1].data[r+8],t)}return new tr(null,this._hostLView)}clear(){for(;this.length>0;)this.remove(this.length-1)}get(e){const t=tB(this._lContainer);return null!==t&&t[e]||null}get length(){return this._lContainer.length-10}createEmbeddedView(e,t,r){let i,s;"number"==typeof r?i=r:null!=r&&(i=r.index,s=r.injector);const a=e.createEmbeddedViewImpl(t||{},s,null);return this.insertImpl(a,i,Dl(this._hostTNode,null)),a}createComponent(e,t,r,i,s,o,a){const c=e&&!function Wp(n){return"function"==typeof n}(e);let l;if(c)l=t;else{const _=t||{};l=_.index,r=_.injector,i=_.projectableNodes,s=_.environmentInjector||_.ngModuleRef,o=_.directives,a=_.bindings}const u=c?e:new Lx(tn(e)),d=r||this.parentInjector;if(!s&&null==u.ngModule){const g=(c?d:this.parentInjector).get(Ui,null);g&&(s=g)}tn(u.componentType??{});const y=u.create(d,i,null,s,o,a);return this.insertImpl(y.hostView,l,Dl(this._hostTNode,null)),y}insert(e,t){return this.insertImpl(e,t,!0)}insertImpl(e,t,r){const i=e._lView;if(function MQ(n){return wi(n[3])}(i)){const a=this.indexOf(e);if(-1!==a)this.detach(a);else{const c=i[3],l=new eB(c,c[5],c[3]);l.detach(l.indexOf(e))}}const s=this._adjustIndex(t),o=this._lContainer;return function Yd(n,e,t,r=!0){const i=e[1];if(function Ore(n,e,t,r){const i=10+r,s=t.length;r>0&&(t[i-1][4]=e),r<s-10?(e[4]=t[i],qF(t,10+r,e)):(t.push(e),e[4]=null),e[3]=t;const o=e[16];null!==o&&t!==o&&g3(o,e);const a=e[18];null!==a&&a.insertView(n),ZI(e),e[2]|=128}(i,e,n,t),r){const o=fv(t,n),a=e[11],c=a.parentNode(n[7]);null!==c&&function ere(n,e,t,r,i,s){r[0]=i,r[5]=e,pv(n,r,t,1,i,s)}(i,n[5],a,e,c,o)}const s=e[6];null!==s&&null!==s.firstChild&&(s.firstChild=null)}(o,i,s,r),e.attachToViewContainerRef(),qF(Fx(o),s,e),e}move(e,t){return this.insert(e,t)}indexOf(e){const t=tB(this._lContainer);return null!==t?t.indexOf(e):-1}remove(e){const t=this._adjustIndex(e,-1),r=lm(this._lContainer,t);r&&(xy(Fx(this._lContainer),t),am(r[1],r))}detach(e){const t=this._adjustIndex(e,-1),r=lm(this._lContainer,t);return r&&null!=xy(Fx(this._lContainer),t)?new um(r):null}_adjustIndex(e,t=0){return e??this.length+t}};function tB(n){return n[8]}function Fx(n){return n[8]||(n[8]=[])}function nB(n,e){let t;const r=e[n.index];return wi(r)?t=r:(t=p3(r,e,null,n),e[n.index]=t,sx(e,t)),rB(t,e,n,r),new eB(t,n,e)}let rB=function sB(n,e,t,r){if(n[7])return;let i;i=8&t.type?Vr(r):function hse(n,e){const t=n[11],r=t.createComment(""),i=vr(e,n),s=t.parentNode(i);return Ml(t,s,r,t.nextSibling(i),!1),r}(e,t),n[7]=i};class Ux{queryList;matches=null;constructor(e){this.queryList=e}clone(){return new Ux(this.queryList)}setDirty(){this.queryList.setDirty()}}class Bx{queries;constructor(e=[]){this.queries=e}createEmbeddedView(e){const t=e.queries;if(null!==t){const r=null!==e.contentQueries?e.contentQueries[0]:t.length,i=[];for(let s=0;s<r;s++){const o=t.getByIndex(s);i.push(this.queries[o.indexInDeclarationView].clone())}return new Bx(i)}return null}insertView(e){this.dirtyQueriesWithMatches(e)}detachView(e){this.dirtyQueriesWithMatches(e)}finishViewCreation(e){this.dirtyQueriesWithMatches(e)}dirtyQueriesWithMatches(e){for(let t=0;t<this.queries.length;t++)null!==jx(e,t).matches&&this.queries[t].setDirty()}}class oB{flags;read;predicate;constructor(e,t,r=null){this.flags=t,this.read=r,this.predicate="string"==typeof e?function vse(n){return n.split(",").map(e=>e.trim())}(e):e}}class Hx{queries;constructor(e=[]){this.queries=e}elementStart(e,t){for(let r=0;r<this.queries.length;r++)this.queries[r].elementStart(e,t)}elementEnd(e){for(let t=0;t<this.queries.length;t++)this.queries[t].elementEnd(e)}embeddedTView(e){let t=null;for(let r=0;r<this.length;r++){const i=null!==t?t.length:0,s=this.getByIndex(r).embeddedTView(e,i);s&&(s.indexInDeclarationView=r,null!==t?t.push(s):t=[s])}return null!==t?new Hx(t):null}template(e,t){for(let r=0;r<this.queries.length;r++)this.queries[r].template(e,t)}getByIndex(e){return this.queries[e]}get length(){return this.queries.length}track(e){this.queries.push(e)}}class zx{metadata;matches=null;indexInDeclarationView=-1;crossesNgTemplate=!1;_declarationNodeIndex;_appliesToNextNode=!0;constructor(e,t=-1){this.metadata=e,this._declarationNodeIndex=t}elementStart(e,t){this.isApplyingToNode(t)&&this.matchTNode(e,t)}elementEnd(e){this._declarationNodeIndex===e.index&&(this._appliesToNextNode=!1)}template(e,t){this.elementStart(e,t)}embeddedTView(e,t){return this.isApplyingToNode(e)?(this.crossesNgTemplate=!0,this.addMatch(-e.index,t),new zx(this.metadata)):null}isApplyingToNode(e){if(this._appliesToNextNode&&1&~this.metadata.flags){const t=this._declarationNodeIndex;let r=e.parent;for(;null!==r&&8&r.type&&r.index!==t;)r=r.parent;return t===(null!==r?r.index:-1)}return this._appliesToNextNode}matchTNode(e,t){const r=this.metadata.predicate;if(Array.isArray(r))for(let i=0;i<r.length;i++){const s=r[i];this.matchTNodeWithReadOption(e,t,mse(t,s)),this.matchTNodeWithReadOption(e,t,$y(t,e,s,!1,!1))}else r===Qo?4&t.type&&this.matchTNodeWithReadOption(e,t,-1):this.matchTNodeWithReadOption(e,t,$y(t,e,r,!1,!1))}matchTNodeWithReadOption(e,t,r){if(null!==r){const i=this.metadata.read;if(null!==i)if(i===zs||i===mo||i===Qo&&4&t.type)this.addMatch(t.index,-2);else{const s=$y(t,e,i,!1,!1);null!==s&&this.addMatch(t.index,s)}else this.addMatch(t.index,r)}}addMatch(e,t){null===this.matches?this.matches=[e,t]:this.matches.push(e,t)}}function mse(n,e){const t=n.localNames;if(null!==t)for(let r=0;r<t.length;r+=2)if(t[r]===e)return t[r+1];return null}function _se(n,e,t,r){return-1===t?function gse(n,e){return 11&n.type?Vd(n,e):4&n.type?Tv(n,e):null}(e,n):-2===t?function yse(n,e,t){return t===zs?Vd(e,n):t===Qo?Tv(e,n):t===mo?nB(e,n):void 0}(n,e,r):Xp(n,n[1],t,e)}function aB(n,e,t,r){const i=e[18].queries[r];if(null===i.matches){const s=n.data,o=t.matches,a=[];for(let c=0;null!==o&&c<o.length;c+=2){const l=o[c];a.push(l<0?null:_se(e,s[l],o[c+1],t.metadata.read))}i.matches=a}return i.matches}function Gx(n,e,t,r){const i=n.queries.getByIndex(t),s=i.matches;if(null!==s){const o=aB(n,e,i,t);for(let a=0;a<s.length;a+=2){const c=s[a];if(c>0)r.push(o[a/2]);else{const l=s[a+1],u=e[-c];for(let d=10;d<u.length;d++){const h=u[d];h[16]===h[3]&&Gx(h[1],h,l,r)}if(null!==u[9]){const d=u[9];for(let h=0;h<d.length;h++){const f=d[h];Gx(f[1],f,l,r)}}}}}return r}function cB(n,e,t){const r=new Hee(!(4&~t));return function m2(n,e,t,r){const i=f2(e);i.push(t),n.firstCreatePass&&p2(n).push(r,i.length-1)}(n,e,r,r.destroy),(e[18]??=new Bx).queries.push(new Ux(r))-1}function lB(n,e,t){const r=wt();return r.firstCreatePass&&(function dB(n,e,t){null===n.queries&&(n.queries=new Hx),n.queries.track(new zx(e,t))}(r,new oB(n,e,t),-1),!(2&~e)&&(r.staticViewQueries=!0)),cB(r,re(),e)}function jx(n,e){return n.queries.getByIndex(e)}function hB(n,e){const t=n[1],r=jx(t,e);return r.crossesNgTemplate?Gx(t,n,e,[]):aB(t,n,r,e)}const _B=new Set;let kl=class{},Dse=class{};class Xx extends kl{ngModuleType;_parent;_bootstrapComponents=[];_r3Injector;instance;destroyCbs=[];componentFactoryResolver=new Z3(this);constructor(e,t,r,i=!0){super(),this.ngModuleType=e,this._parent=t;const s=function lo(n){return n[UF]||null}(e);this._bootstrapComponents=function fo(n){return n instanceof Function?n():n}(s.bootstrap),this._r3Injector=k2(e,t,[{provide:kl,useValue:this},{provide:Dv,useValue:this.componentFactoryResolver},...r],Fi(e),new Set(["environment"])),i&&this.resolveInjectorInitializers()}resolveInjectorInitializers(){this._r3Injector.resolveInjectorInitializers(),this.instance=this._r3Injector.get(this.ngModuleType)}get injector(){return this._r3Injector}destroy(){const e=this._r3Injector;!e.destroyed&&e.destroy(),this.destroyCbs.forEach(t=>t()),this.destroyCbs=null}onDestroy(e){this.destroyCbs.push(e)}}class yB extends Dse{moduleType;constructor(e){super(),this.moduleType=e}create(e){return new Xx(this.moduleType,e,[])}}class Nse extends kl{injector;componentFactoryResolver=new Z3(this);instance=null;constructor(e){super();const t=new yl([...e.providers,{provide:kl,useValue:this},{provide:Dv,useValue:this.componentFactoryResolver}],e.parent||WI(),e.debugName,new Set(["environment"]));this.injector=t,e.runEnvironmentInitializers&&t.resolveInjectorInitializers()}destroy(){this.injector.destroy()}onDestroy(e){this.injector.onDestroy(e)}}let Ose=(()=>{class n{_injector;cachedInjectors=new Map;constructor(t){this._injector=t}getOrCreateStandaloneInjector(t){if(!t.standalone)return null;if(!this.cachedInjectors.has(t)){const r=UI(0,t.type),i=r.length>0?function vB(n,e,t=null){return new Nse({providers:n,parent:e,debugName:t,runEnvironmentInitializers:!0}).injector}([r],this._injector,`Standalone[${t.type.name}]`):null;this.cachedInjectors.set(t,i)}return this.cachedInjectors.get(t)}ngOnDestroy(){try{for(const t of this.cachedInjectors.values())null!==t&&t.destroy()}finally{this.cachedInjectors.clear()}}static \u0275prov=Et({token:n,providedIn:"environment",factory:()=>new n(Rt(Ui))})}return n})();function Ll(n){return Yo(()=>{const e=bB(n),t={...e,decls:n.decls,vars:n.vars,template:n.template,consts:n.consts||null,ngContentSelectors:n.ngContentSelectors,onPush:n.changeDetection===Xy.OnPush,directiveDefs:null,pipeDefs:null,dependencies:e.standalone&&n.dependencies||null,getStandaloneInjector:e.standalone?i=>i.get(Ose).getOrCreateStandaloneInjector(t):null,getExternalStyles:null,signals:n.signals??!1,data:n.data||{},encapsulation:n.encapsulation||Jo.Emulated,styles:n.styles||Tn,_:null,schemas:n.schemas||null,tView:null,id:""};e.standalone&&function hi(n){_B.has(n)||(_B.add(n),performance?.mark?.("mark_feature_usage",{detail:{feature:n}}))}("NgStandalone"),TB(t);const r=n.dependencies;return t.directiveDefs=Lv(r,EB),t.pipeDefs=Lv(r,Us),t.id=function Vse(n){let e=0;const r=[n.selectors,n.ngContentSelectors,n.hostVars,n.hostAttrs,"function"==typeof n.consts?"":n.consts,n.vars,n.decls,n.encapsulation,n.standalone,n.signals,n.exportAs,JSON.stringify(n.inputs),JSON.stringify(n.outputs),Object.getOwnPropertyNames(n.type.prototype),!!n.contentQueries,!!n.viewQuery];for(const s of r.join("|"))e=Math.imul(31,e)+s.charCodeAt(0)|0;return e+=2147483648,"c"+e}(t),t})}function EB(n){return tn(n)||Ti(n)}function nc(n){return Yo(()=>({type:n.type,bootstrap:n.bootstrap||Tn,declarations:n.declarations||Tn,imports:n.imports||Tn,exports:n.exports||Tn,transitiveCompileScopes:null,schemas:n.schemas||null,id:n.id||null}))}function kse(n,e){if(null==n)return co;const t={};for(const r in n)if(n.hasOwnProperty(r)){const i=n[r];let s,o,a,c;Array.isArray(i)?(a=i[0],s=i[1],o=i[2]??s,c=i[3]||null):(s=i,o=i,a=hv.None,c=null),t[s]=[r,a,c],e[s]=o}return t}function Lse(n){if(null==n)return co;const e={};for(const t in n)n.hasOwnProperty(t)&&(e[n[t]]=t);return e}function At(n){return Yo(()=>{const e=bB(n);return TB(e),e})}function Gi(n){return{type:n.type,name:n.name,factory:null,pure:!1!==n.pure,standalone:n.standalone??!0,onDestroy:n.type.prototype.ngOnDestroy||null}}function bB(n){const e={};return{type:n.type,providersResolver:null,factory:null,hostBindings:n.hostBindings||null,hostVars:n.hostVars||0,hostAttrs:n.hostAttrs||null,contentQueries:n.contentQueries||null,declaredInputs:e,inputConfig:n.inputs||co,exportAs:n.exportAs||null,standalone:n.standalone??!0,signals:!0===n.signals,selectors:n.selectors||Tn,viewQuery:n.viewQuery||null,features:n.features||null,setInput:null,resolveHostDirectives:null,hostDirectives:null,inputs:kse(n.inputs,e),outputs:Lse(n.outputs),debugInfo:null}}function TB(n){n.features?.forEach(e=>e(n))}function Lv(n,e){return n?()=>{const t="function"==typeof n?n():n,r=[];for(const i of t){const s=e(i);null!==s&&r.push(s)}return r}:null}function rn(n){let e=function wB(n){return Object.getPrototypeOf(n.prototype).constructor}(n.type),t=!0;const r=[n];for(;e;){let i;if(ss(n))i=e.\u0275cmp||e.\u0275dir;else{if(e.\u0275cmp)throw new ue(903,!1);i=e.\u0275dir}if(i){if(t){r.push(i);const o=n;o.inputs=Kx(n.inputs),o.declaredInputs=Kx(n.declaredInputs),o.outputs=Kx(n.outputs);const a=i.hostBindings;a&&Gse(n,a);const c=i.viewQuery,l=i.contentQueries;if(c&&Hse(n,c),l&&zse(n,l),Use(n,i),GZ(n.outputs,i.outputs),ss(i)&&i.data.animation){const u=n.data;u.animation=(u.animation||[]).concat(i.data.animation)}}const s=i.features;if(s)for(let o=0;o<s.length;o++){const a=s[o];a&&a.ngInherit&&a(n),a===rn&&(t=!1)}}e=Object.getPrototypeOf(e)}!function Bse(n){let e=0,t=null;for(let r=n.length-1;r>=0;r--){const i=n[r];i.hostVars=e+=i.hostVars,i.hostAttrs=Fd(i.hostAttrs,t=Fd(t,i.hostAttrs))}}(r)}function Use(n,e){for(const t in e.inputs){if(!e.inputs.hasOwnProperty(t)||n.inputs.hasOwnProperty(t))continue;const r=e.inputs[t];void 0!==r&&(n.inputs[t]=r,n.declaredInputs[t]=e.declaredInputs[t])}}function Kx(n){return n===co?{}:n===Tn?[]:n}function Hse(n,e){const t=n.viewQuery;n.viewQuery=t?(r,i)=>{e(r,i),t(r,i)}:e}function zse(n,e){const t=n.contentQueries;n.contentQueries=t?(r,i,s)=>{e(r,i,s),t(r,i,s)}:e}function Gse(n,e){const t=n.hostBindings;n.hostBindings=t?(r,i)=>{e(r,i),t(r,i)}:e}function un(n,e,t,r,i,s,o,a){const c=re(),l=wt();return function Yse(n,e,t,r,i,s,o,a,c,l,u){const d=t+26;let h;e.firstCreatePass?(h=Rl(e,d,4,o||null,a||null),nS()&&G3(e,n,h,li(e.consts,l),gx),Q2(e,h)):h=e.data[d],function MB(n,e,t,r,i,s,o,a){if(t.firstCreatePass){n.mergedAttrs=Fd(n.mergedAttrs,n.attrs);const u=n.tView=rx(2,n,i,s,o,t.directiveRegistry,t.pipeRegistry,null,t.schemas,t.consts,null);null!==t.queries&&(t.queries.template(t,n),u.queries=t.queries.embeddedTView(n))}a&&(n.flags|=a),jo(n,!1);const c=DB(t,e,n,r);Uy()&&hx(t,e,c,n),zi(c,e);const l=p3(c,e,c,n);e[r+26]=l,sx(e,l)}(h,n,e,t,r,i,s,c),Id(h)&&mv(e,n,h),null!=l&&qd(n,h,u)}(c,l,n,e,t,r,i,li(l.consts,s),void 0,o,a),un}let DB=function RB(n,e,t,r){return Hp(!0),e[11].createComment("")};var Jx=function(n){return n[n.CHANGE_DETECTION=0]="CHANGE_DETECTION",n[n.AFTER_NEXT_RENDER=1]="AFTER_NEXT_RENDER",n}(Jx||{});const Sm=new Ae(""),LB=!1,Er=class noe extends gd{__isAsync;destroyRef=void 0;pendingTasks=void 0;constructor(e=!1){super(),this.__isAsync=e,qI()&&(this.destroyRef=Ie(uo,{optional:!0})??void 0,this.pendingTasks=Ie(Sl,{optional:!0})??void 0)}emit(e){const t=gt(null);try{super.next(e)}finally{gt(t)}}subscribe(e,t,r){let i=e,s=t||(()=>null),o=r;if(e&&"object"==typeof e){const c=e;i=c.next?.bind(c),s=c.error?.bind(c),o=c.complete?.bind(c)}this.__isAsync&&(s=this.wrapInTimeout(s),i&&(i=this.wrapInTimeout(i)),o&&(o=this.wrapInTimeout(o)));const a=super.subscribe({next:i,error:s,complete:o});return e instanceof ns&&e.add(a),a}wrapInTimeout(e){return t=>{const r=this.pendingTasks?.add();setTimeout(()=>{try{e(t)}finally{void 0!==r&&this.pendingTasks?.remove(r)}})}}};function FB(n){let e,t;function r(){n=zp;try{void 0!==t&&"function"==typeof cancelAnimationFrame&&cancelAnimationFrame(t),void 0!==e&&clearTimeout(e)}catch{}}return e=setTimeout(()=>{n(),r()}),"function"==typeof requestAnimationFrame&&(t=requestAnimationFrame(()=>{n(),r()})),()=>r()}function VB(n){return queueMicrotask(()=>n()),()=>{n=zp}}const Zx="isAngularZone",Bv=Zx+"_ID";let roe=0;class Vt{hasPendingMacrotasks=!1;hasPendingMicrotasks=!1;isStable=!0;onUnstable=new Er(!1);onMicrotaskEmpty=new Er(!1);onStable=new Er(!1);onError=new Er(!1);constructor(e){const{enableLongStackTrace:t=!1,shouldCoalesceEventChangeDetection:r=!1,shouldCoalesceRunChangeDetection:i=!1,scheduleInRootZone:s=LB}=e;if(typeof Zone>"u")throw new ue(908,!1);Zone.assertZonePatched();const o=this;o._nesting=0,o._outer=o._inner=Zone.current,Zone.TaskTrackingZoneSpec&&(o._inner=o._inner.fork(new Zone.TaskTrackingZoneSpec)),t&&Zone.longStackTraceZoneSpec&&(o._inner=o._inner.fork(Zone.longStackTraceZoneSpec)),o.shouldCoalesceEventChangeDetection=!i&&r,o.shouldCoalesceRunChangeDetection=i,o.callbackScheduled=!1,o.scheduleInRootZone=s,function ooe(n){const e=()=>{!function soe(n){function e(){FB(()=>{n.callbackScheduled=!1,eA(n),n.isCheckStableRunning=!0,Qx(n),n.isCheckStableRunning=!1})}n.isCheckStableRunning||n.callbackScheduled||(n.callbackScheduled=!0,n.scheduleInRootZone?Zone.root.run(()=>{e()}):n._outer.run(()=>{e()}),eA(n))}(n)},t=roe++;n._inner=n._inner.fork({name:"angular",properties:{[Zx]:!0,[Bv]:t,[Bv+t]:!0},onInvokeTask:(r,i,s,o,a,c)=>{if(function aoe(n){return HB(n,"__ignore_ng_zone__")}(c))return r.invokeTask(s,o,a,c);try{return UB(n),r.invokeTask(s,o,a,c)}finally{(n.shouldCoalesceEventChangeDetection&&"eventTask"===o.type||n.shouldCoalesceRunChangeDetection)&&e(),BB(n)}},onInvoke:(r,i,s,o,a,c,l)=>{try{return UB(n),r.invoke(s,o,a,c,l)}finally{n.shouldCoalesceRunChangeDetection&&!n.callbackScheduled&&!function coe(n){return HB(n,"__scheduler_tick__")}(c)&&e(),BB(n)}},onHasTask:(r,i,s,o)=>{r.hasTask(s,o),i===s&&("microTask"==o.change?(n._hasPendingMicrotasks=o.microTask,eA(n),Qx(n)):"macroTask"==o.change&&(n.hasPendingMacrotasks=o.macroTask))},onHandleError:(r,i,s,o)=>(r.handleError(s,o),n.runOutsideAngular(()=>n.onError.emit(o)),!1)})}(o)}static isInAngularZone(){return typeof Zone<"u"&&!0===Zone.current.get(Zx)}static assertInAngularZone(){if(!Vt.isInAngularZone())throw new ue(909,!1)}static assertNotInAngularZone(){if(Vt.isInAngularZone())throw new ue(909,!1)}run(e,t,r){return this._inner.run(e,t,r)}runTask(e,t,r,i){const s=this._inner,o=s.scheduleEventTask("NgZoneEvent: "+i,e,ioe,zp,zp);try{return s.runTask(o,t,r)}finally{s.cancelTask(o)}}runGuarded(e,t,r){return this._inner.runGuarded(e,t,r)}runOutsideAngular(e){return this._outer.run(e)}}const ioe={};function Qx(n){if(0==n._nesting&&!n.hasPendingMicrotasks&&!n.isStable)try{n._nesting++,n.onMicrotaskEmpty.emit(null)}finally{if(n._nesting--,!n.hasPendingMicrotasks)try{n.runOutsideAngular(()=>n.onStable.emit(null))}finally{n.isStable=!0}}}function eA(n){n.hasPendingMicrotasks=!!(n._hasPendingMicrotasks||(n.shouldCoalesceEventChangeDetection||n.shouldCoalesceRunChangeDetection)&&!0===n.callbackScheduled)}function UB(n){n._nesting++,n.isStable&&(n.isStable=!1,n.onUnstable.emit(null))}function BB(n){n._nesting--,Qx(n)}class tA{hasPendingMicrotasks=!1;hasPendingMacrotasks=!1;isStable=!0;onUnstable=new Er;onMicrotaskEmpty=new Er;onStable=new Er;onError=new Er;run(e,t,r){return e.apply(t,r)}runGuarded(e,t,r){return e.apply(t,r)}runOutsideAngular(e){return e()}runTask(e,t,r,i){return e.apply(t,r)}}function HB(n,e){return!(!Array.isArray(n)||1!==n.length)&&!0===n[0]?.data?.[e]}let zB=(()=>{class n{impl=null;execute(){this.impl?.execute()}static \u0275prov=Et({token:n,providedIn:"root",factory:()=>new n})}return n})();const m4=new Ae(""),jv=new Ae("");let uA,cA=(()=>{class n{_ngZone;registry;_isZoneStable=!0;_callbacks=[];_taskTrackingZone=null;_destroyRef;constructor(t,r,i){this._ngZone=t,this.registry=r,qI()&&(this._destroyRef=Ie(uo,{optional:!0})??void 0),uA||(function gae(n){uA=n}(i),i.addToWindow(r)),this._watchAngularEvents(),t.run(()=>{this._taskTrackingZone=typeof Zone>"u"?null:Zone.current.get("TaskTrackingZone")})}_watchAngularEvents(){const t=this._ngZone.onUnstable.subscribe({next:()=>{this._isZoneStable=!1}}),r=this._ngZone.runOutsideAngular(()=>this._ngZone.onStable.subscribe({next:()=>{Vt.assertNotInAngularZone(),queueMicrotask(()=>{this._isZoneStable=!0,this._runCallbacksIfReady()})}}));this._destroyRef?.onDestroy(()=>{t.unsubscribe(),r.unsubscribe()})}isStable(){return this._isZoneStable&&!this._ngZone.hasPendingMacrotasks}_runCallbacksIfReady(){if(this.isStable())queueMicrotask(()=>{for(;0!==this._callbacks.length;){let t=this._callbacks.pop();clearTimeout(t.timeoutId),t.doneCb()}});else{let t=this.getPendingTasks();this._callbacks=this._callbacks.filter(r=>!r.updateCb||!r.updateCb(t)||(clearTimeout(r.timeoutId),!1))}}getPendingTasks(){return this._taskTrackingZone?this._taskTrackingZone.macroTasks.map(t=>({source:t.source,creationLocation:t.creationLocation,data:t.data})):[]}addCallback(t,r,i){let s=-1;r&&r>0&&(s=setTimeout(()=>{this._callbacks=this._callbacks.filter(o=>o.timeoutId!==s),t()},r)),this._callbacks.push({doneCb:t,timeoutId:s,updateCb:i})}whenStable(t,r,i){if(i&&!this._taskTrackingZone)throw new Error('Task tracking zone is required when passing an update callback to whenStable(). Is "zone.js/plugins/task-tracking" loaded?');this.addCallback(t,r,i),this._runCallbacksIfReady()}registerApplication(t){this.registry.registerApplication(t,this)}unregisterApplication(t){this.registry.unregisterApplication(t)}findProviders(t,r,i){return[]}static \u0275fac=function(r){return new(r||n)(Rt(Vt),Rt(lA),Rt(jv))};static \u0275prov=Et({token:n,factory:n.\u0275fac})}return n})(),lA=(()=>{class n{_applications=new Map;registerApplication(t,r){this._applications.set(t,r)}unregisterApplication(t){this._applications.delete(t)}unregisterAllApplications(){this._applications.clear()}getTestability(t){return this._applications.get(t)||null}getAllTestabilities(){return Array.from(this._applications.values())}getAllRootElements(){return Array.from(this._applications.keys())}findTestabilityInTree(t,r=!0){return uA?.findTestabilityInTree(this,t,r)??null}static \u0275fac=function(r){return new(r||n)};static \u0275prov=Et({token:n,factory:n.\u0275fac,providedIn:"platform"})}return n})();function $v(n){return!!n&&"function"==typeof n.then}function g4(n){return!!n&&"function"==typeof n.subscribe}const _4=new Ae("");let y4=(()=>{class n{resolve;reject;initialized=!1;done=!1;donePromise=new Promise((t,r)=>{this.resolve=t,this.reject=r});appInits=Ie(_4,{optional:!0})??[];injector=Ie(Yr);constructor(){}runInitializers(){if(this.initialized)return;const t=[];for(const i of this.appInits){const s=vd(this.injector,i);if($v(s))t.push(s);else if(g4(s)){const o=new Promise((a,c)=>{s.subscribe({complete:a,error:c})});t.push(o)}}const r=()=>{this.done=!0,this.resolve()};Promise.all(t).then(()=>{r()}).catch(i=>{this.reject(i)}),0===t.length&&r(),this.initialized=!0}static \u0275fac=function(r){return new(r||n)};static \u0275prov=Et({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();const _ae=new Ae("");function v4(n,e){return Array.isArray(e)?e.reduce(v4,n):{...n,...e}}let ic=(()=>{class n{_runningTick=!1;_destroyed=!1;_destroyListeners=[];_views=[];internalErrorHandler=Ie(Ko);afterRenderManager=Ie(zB);zonelessEnabled=Ie(U2);rootEffectScheduler=Ie(z2);dirtyFlags=0;tracingSnapshot=null;allTestViews=new Set;autoDetectTestViews=new Set;includeAllTestViews=!1;afterTick=new gd;get allViews(){return[...(this.includeAllTestViews?this.allTestViews:this.autoDetectTestViews).keys(),...this._views]}get destroyed(){return this._destroyed}componentTypes=[];components=[];internalPendingTask=Ie(Sl);get isStable(){return this.internalPendingTask.hasPendingTasksObservable.pipe(Hs(t=>!t))}constructor(){Ie(Sm,{optional:!0})}whenStable(){let t;return new Promise(r=>{t=this.isStable.subscribe({next:i=>{i&&r()}})}).finally(()=>{t.unsubscribe()})}_injector=Ie(Ui);_rendererFactory=null;get injector(){return this._injector}bootstrap(t,r){return this.bootstrapImpl(t,r)}bootstrapImpl(t,r,i=Yr.NULL){return this._injector.get(Vt).run(()=>{ln(10);const o=t instanceof H3;if(!this._injector.get(y4).done)throw new ue(405,"");let c;c=o?t:this._injector.get(Dv).resolveComponentFactory(t),this.componentTypes.push(c.componentType);const l=function vae(n){return n.isBoundToModule}(c)?void 0:this._injector.get(kl),d=c.create(i,[],r||c.selector,l),h=d.location.nativeElement,f=d.injector.get(m4,null);return f?.registerApplication(h),d.onDestroy(()=>{this.detachView(d.hostView),qv(this.components,d),f?.unregisterApplication(h)}),this._loadComponent(d),ln(11,d),d})}tick(){this.zonelessEnabled||(this.dirtyFlags|=1),this._tick()}_tick(){ln(12),null!==this.tracingSnapshot?this.tracingSnapshot.run(Jx.CHANGE_DETECTION,this.tickImpl):this.tickImpl()}tickImpl=()=>{if(this._runningTick)throw new ue(101,!1);const t=gt(null);try{this._runningTick=!0,this.synchronize()}finally{this._runningTick=!1,this.tracingSnapshot?.dispose(),this.tracingSnapshot=null,gt(t),this.afterTick.next(),ln(13)}};synchronize(){null===this._rendererFactory&&!this._injector.destroyed&&(this._rendererFactory=this._injector.get(Dx,null,{optional:!0}));let t=0;for(;0!==this.dirtyFlags&&t++<10;)ln(14),this.synchronizeOnce(),ln(15)}synchronizeOnce(){16&this.dirtyFlags&&(this.dirtyFlags&=-17,this.rootEffectScheduler.flush());let t=!1;if(7&this.dirtyFlags){const r=!!(1&this.dirtyFlags);this.dirtyFlags&=-8,this.dirtyFlags|=8;for(let{_lView:i}of this.allViews)(r||ky(i))&&(bv(i,r&&!this.zonelessEnabled?0:1),t=!0);if(this.dirtyFlags&=-5,this.syncDirtyFlagsWithViews(),23&this.dirtyFlags)return}t||(this._rendererFactory?.begin?.(),this._rendererFactory?.end?.()),8&this.dirtyFlags&&(this.dirtyFlags&=-9,this.afterRenderManager.execute()),this.syncDirtyFlagsWithViews()}syncDirtyFlagsWithViews(){this.allViews.some(({_lView:t})=>ky(t))?this.dirtyFlags|=2:this.dirtyFlags&=-8}attachView(t){const r=t;this._views.push(r),r.attachToAppRef(this)}detachView(t){const r=t;qv(this._views,r),r.detachFromAppRef()}_loadComponent(t){this.attachView(t.hostView);try{this.tick()}catch(i){this.internalErrorHandler(i)}this.components.push(t),this._injector.get(_ae,[]).forEach(i=>i(t))}ngOnDestroy(){if(!this._destroyed)try{this._destroyListeners.forEach(t=>t()),this._views.slice().forEach(t=>t.destroy())}finally{this._destroyed=!0,this._views=[],this._destroyListeners=[]}}onDestroy(t){return this._destroyListeners.push(t),()=>qv(this._destroyListeners,t)}destroy(){if(this._destroyed)throw new ue(406,!1);const t=this._injector;t.destroy&&!t.destroyed&&t.destroy()}get viewCount(){return this._views.length}static \u0275fac=function(r){return new(r||n)};static \u0275prov=Et({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();function qv(n,e){const t=n.indexOf(e);t>-1&&n.splice(t,1)}const C4=new Ae("",{providedIn:"root",factory:()=>!1}),nce=new Ae("",{providedIn:"root",factory:()=>rce}),rce=4e3;function mt(n,e,t){const r=re();return Cn(r,Bi(),e)&&(wt(),px(function Bs(){const n=_t.lFrame;return xd(n.tView,n.selectedIndex)}(),r,n,e,r[11],t)),mt}function IA(n,e,t,r,i){vv(e,n,t,i?"class":"style",r)}function Fe(n,e,t,r){const i=re(),s=i[1],o=n+26,a=s.firstCreatePass?Nx(o,i,2,e,gx,nS(),t,r):s.data[o];if(_v(a,i,n,e,xA),Id(a)){const c=i[1];mv(c,i,a),jS(c,a,i)}return null!=r&&qd(i,a),Fe}function Ve(){const n=wt(),t=yv(bt());return n.firstCreatePass&&Ox(n,t),y2(t)&&v2(),g2(),null!=t.classesWithoutHost&&function bee(n){return!!(8&n.flags)}(t)&&IA(n,t,re(),t.classesWithoutHost,!0),null!=t.stylesWithoutHost&&function Tee(n){return!!(16&n.flags)}(t)&&IA(n,t,re(),t.stylesWithoutHost,!1),Ve}function Ms(n,e,t,r){return Fe(n,e,t,r),Ve(),Ms}function Cm(n,e,t,r){const i=re(),s=i[1],o=n+26,a=s.firstCreatePass?function X3(n,e,t,r,i,s){const o=e.consts,c=Rl(e,n,t,r,li(o,i));if(c.mergedAttrs=Fd(c.mergedAttrs,c.attrs),null!=s){const l=li(o,s);c.localNames=[];for(let u=0;u<l.length;u+=2)c.localNames.push(l[u],-1)}return null!==c.attrs&&Pv(c,c.attrs,!1),null!==c.mergedAttrs&&Pv(c,c.mergedAttrs,!0),null!==e.queries&&e.queries.elementStart(e,c),c}(o,s,2,e,t,r):s.data[o];return _v(a,i,n,e,xA),null!=r&&qd(i,a),Cm}function Dm(){return y2(yv(bt()))&&v2(),g2(),Dm}function SA(n,e,t,r){return Cm(n,e,t,r),Dm(),SA}typeof document<"u"&&document;let xA=(n,e,t,r,i)=>(Hp(!0),uv(e[11],r,function zQ(){return _t.lFrame.currentNamespace}()));function ac(n,e,t){const r=re(),i=r[1],s=n+26,o=i.firstCreatePass?Nx(s,r,8,"ng-container",gx,nS(),e,t):i.data[s];if(_v(o,r,n,"ng-container",MA),Id(o)){const a=r[1];mv(a,r,o),jS(a,o,r)}return null!=t&&qd(r,o),ac}function ta(){const n=wt(),t=yv(bt());return n.firstCreatePass&&Ox(n,t),ta}let MA=(n,e,t,r,i)=>(Hp(!0),nx(e[11],""));function $i(){return re()}const Gl=void 0;var Oce=["en",[["a","p"],["AM","PM"],Gl],[["AM","PM"],Gl,Gl],[["S","M","T","W","T","F","S"],["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],["Su","Mo","Tu","We","Th","Fr","Sa"]],Gl,[["J","F","M","A","M","J","J","A","S","O","N","D"],["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],["January","February","March","April","May","June","July","August","September","October","November","December"]],Gl,[["B","A"],["BC","AD"],["Before Christ","Anno Domini"]],0,[6,0],["M/d/yy","MMM d, y","MMMM d, y","EEEE, MMMM d, y"],["h:mm a","h:mm:ss a","h:mm:ss a z","h:mm:ss a zzzz"],["{1}, {0}",Gl,"{1} 'at' {0}",Gl],[".",",",";","%","+","-","E","\xd7","\u2030","\u221e","NaN",":"],["#,##0.###","#,##0%","\xa4#,##0.00","#E0"],"USD","$","US Dollar",{},"ltr",function Nce(n){const e=Math.floor(Math.abs(n)),t=n.toString().replace(/^[^.]*\.?/,"").length;return 1===e&&0===t?1:5}];let uh={};function xi(n){const e=function kce(n){return n.toLowerCase().replace(/_/g,"-")}(n);let t=$4(e);if(t)return t;const r=e.split("-")[0];if(t=$4(r),t)return t;if("en"===r)return Oce;throw new ue(701,!1)}function $4(n){return n in uh||(uh[n]=Qn.ng&&Qn.ng.common&&Qn.ng.common.locales&&Qn.ng.common.locales[n]),uh[n]}var Dn=function(n){return n[n.LocaleId=0]="LocaleId",n[n.DayPeriodsFormat=1]="DayPeriodsFormat",n[n.DayPeriodsStandalone=2]="DayPeriodsStandalone",n[n.DaysFormat=3]="DaysFormat",n[n.DaysStandalone=4]="DaysStandalone",n[n.MonthsFormat=5]="MonthsFormat",n[n.MonthsStandalone=6]="MonthsStandalone",n[n.Eras=7]="Eras",n[n.FirstDayOfWeek=8]="FirstDayOfWeek",n[n.WeekendRange=9]="WeekendRange",n[n.DateFormat=10]="DateFormat",n[n.TimeFormat=11]="TimeFormat",n[n.DateTimeFormat=12]="DateTimeFormat",n[n.NumberSymbols=13]="NumberSymbols",n[n.NumberFormats=14]="NumberFormats",n[n.CurrencyCode=15]="CurrencyCode",n[n.CurrencySymbol=16]="CurrencySymbol",n[n.CurrencyName=17]="CurrencyName",n[n.Currencies=18]="Currencies",n[n.Directionality=19]="Directionality",n[n.PluralCase=20]="PluralCase",n[n.ExtraData=21]="ExtraData",n}(Dn||{});const eE="en-US";let q4=eE;function Gt(n,e,t){const r=re(),i=wt(),s=bt();return function RA(n,e,t,r,i,s,o){let a=!0,c=null;if((3&r.type||o)&&(c??=bm(r,e,s),Y3(r,n,e,o,t,i,s,c)&&(a=!1)),a){const l=r.outputs?.[i],u=r.hostDirectiveOutputs?.[i];if(u&&u.length)for(let d=0;d<u.length;d+=2){const h=u[d],f=u[d+1];c??=bm(r,e,s),kv(r,e,h,f,i,c)}if(l&&l.length)for(const d of l)c??=bm(r,e,s),kv(r,e,d,i,i,c)}}(i,r,r[11],s,n,e,t),Gt}function iE(n,e,t){const r=re(),i=wt(),s=bt();return(3&s.type||t)&&Y3(s,i,r,t,r[11],n,e,bm(s,r,e)),iE}function Wt(n=1){return function FQ(n){return(_t.lFrame.contextLView=function h2(n,e){for(;n>0;)e=e[14],n--;return e}(n,_t.lFrame.contextLView))[8]}(n)}function sE(n,e,t){lB(n,e,t)}function oE(n){const e=re(),t=wt(),r=sS();Vy(r+1);const i=jx(t,r);if(n.dirty&&function AQ(n){return!(4&~n[2])}(e)===!(2&~i.metadata.flags)){if(null===i.matches)n.reset([]);else{const s=hB(e,r);n.reset(s,EV),n.notifyOnChanges()}return!0}return!1}function aE(){return function Wx(n,e){return n[18].queries[e].queryList}(re(),sS())}function Lm(n){return Tl(function w2(){return _t.lFrame.contextLView}(),26+n)}function cE(n,e){return n<<17|e<<2}function Wl(n){return n>>17&32767}function PA(n){return 2|n}function dh(n){return(131068&n)>>2}function NA(n,e){return-131069&n|e<<2}function OA(n){return 1|n}function hH(n,e,t,r){const i=n[t+1],s=null===e;let o=r?Wl(i):dh(i),a=!1;for(;0!==o&&(!1===a||s);){const l=n[o+1];kle(n[o],e)&&(a=!0,n[o+1]=r?OA(l):PA(l)),o=r?Wl(l):dh(l)}a&&(n[t+1]=r?PA(i):OA(i))}function kle(n,e){return null===n||null==e||(Array.isArray(n)?n[1]:n)===e||!(!Array.isArray(n)||"string"!=typeof e)&&kp(n,e)>=0}function kA(n,e,t){return vH(n,e,t,!1),kA}function lE(n,e){return vH(n,e,null,!0),lE}function vH(n,e,t,r){const i=re(),s=wt(),o=function qo(n){const e=_t.lFrame,t=e.bindingIndex;return e.bindingIndex=e.bindingIndex+n,t}(2);s.firstUpdatePass&&function TH(n,e,t,r){const i=n.data;if(null===i[t+1]){const s=i[Kr()],o=function bH(n,e){return e>=n.expandoStartIndex}(n,t);(function xH(n,e){return!!(n.flags&(e?8:16))})(s,r)&&null===e&&!o&&(e=!1),e=function $le(n,e,t,r){const i=function iS(n){const e=_t.lFrame.currentDirectiveIndex;return-1===e?null:n[e]}(n);let s=r?e.residualClasses:e.residualStyles;if(null===i)0===(r?e.classBindings:e.styleBindings)&&(t=Fm(t=LA(null,n,e,t,r),e.attrs,r),s=null);else{const o=e.directiveStylingLast;if(-1===o||n[o]!==i)if(t=LA(i,n,e,t,r),null===s){let c=function qle(n,e,t){const r=t?e.classBindings:e.styleBindings;if(0!==dh(r))return n[Wl(r)]}(n,e,r);void 0!==c&&Array.isArray(c)&&(c=LA(null,n,e,c[1],r),c=Fm(c,e.attrs,r),function Xle(n,e,t,r){n[Wl(t?e.classBindings:e.styleBindings)]=r}(n,e,r,c))}else s=function Kle(n,e,t){let r;const i=e.directiveEnd;for(let s=1+e.directiveStylingLast;s<i;s++)r=Fm(r,n[s].hostAttrs,t);return Fm(r,e.attrs,t)}(n,e,r)}return void 0!==s&&(r?e.residualClasses=s:e.residualStyles=s),t}(i,s,e,r),function Nle(n,e,t,r,i,s){let o=s?e.classBindings:e.styleBindings,a=Wl(o),c=dh(o);n[r]=t;let u,l=!1;if(Array.isArray(t)?(u=t[1],(null===u||kp(t,u)>0)&&(l=!0)):u=t,i)if(0!==c){const h=Wl(n[a+1]);n[r+1]=cE(h,a),0!==h&&(n[h+1]=NA(n[h+1],r)),n[a+1]=function Rle(n,e){return 131071&n|e<<17}(n[a+1],r)}else n[r+1]=cE(a,0),0!==a&&(n[a+1]=NA(n[a+1],r)),a=r;else n[r+1]=cE(c,0),0===a?a=r:n[c+1]=NA(n[c+1],r),c=r;l&&(n[r+1]=PA(n[r+1])),hH(n,u,r,!0),hH(n,u,r,!1),function Ole(n,e,t,r,i){const s=i?n.residualClasses:n.residualStyles;null!=s&&"string"==typeof e&&kp(s,e)>=0&&(t[r+1]=OA(t[r+1]))}(e,u,n,r,s),o=cE(a,c),s?e.classBindings=o:e.styleBindings=o}(i,s,e,t,o,r)}}(s,n,o,r),e!==nn&&Cn(i,o,e)&&function IH(n,e,t,r,i,s,o,a){if(!(3&e.type))return;const c=n.data,l=c[a+1],u=function Ple(n){return!(1&~n)}(l)?SH(c,e,t,i,dh(l),o):void 0;uE(u)||(uE(s)||function Dle(n){return!(2&~n)}(l)&&(s=SH(c,null,t,i,a,o)),function ore(n,e,t,r,i){if(e)i?n.addClass(t,r):n.removeClass(t,r);else{let s=-1===r.indexOf("-")?void 0:Qa.DashCase;null==i?n.removeStyle(t,r,s):("string"==typeof i&&i.endsWith("!important")&&(i=i.slice(0,-10),s|=Qa.Important),n.setStyle(t,r,i,s))}}(r,o,Sd(Kr(),t),i,s))}(s,s.data[Kr()],i,i[11],n,i[o+1]=function Qle(n,e){return null==n||""===n||("string"==typeof e?n+=e:"object"==typeof n&&(n=Fi(Za(n)))),n}(e,t),r,o)}function LA(n,e,t,r,i){let s=null;const o=t.directiveEnd;let a=t.directiveStylingLast;for(-1===a?a=t.directiveStart:a++;a<o&&(s=e[a],r=Fm(r,s.hostAttrs,i),s!==n);)a++;return null!==n&&(t.directiveStylingLast=a),r}function Fm(n,e,t){const r=t?1:2;let i=-1;if(null!==e)for(let s=0;s<e.length;s++){const o=e[s];"number"==typeof o?i=o:i===r&&(Array.isArray(n)||(n=void 0===n?[]:["",n]),My(n,o,!!t||e[++s]))}return void 0===n?null:n}function SH(n,e,t,r,i,s){const o=null===e;let a;for(;i>0;){const c=n[i],l=Array.isArray(c),u=l?c[1]:c,d=null===u;let h=t[i+1];h===nn&&(h=d?Tn:void 0);let f=d?LI(h,r):u===r?h:void 0;if(l&&!uE(f)&&(f=LI(c,r)),uE(f)&&(a=f,o))return a;const m=n[i+1];i=o?Wl(m):dh(m)}if(null!==e){let c=s?e.residualClasses:e.residualStyles;null!=c&&(a=LI(c,r))}return a}function uE(n){return void 0!==n}function tt(n,e=""){const t=re(),r=wt(),i=n+26,s=r.firstCreatePass?Rl(r,i,1,e,null):r.data[i],o=AH(r,t,s,e,n);t[i]=o,Uy()&&hx(r,t,o,s),jo(s,!1)}let AH=(n,e,t,r,i)=>(Hp(!0),function tx(n,e){return n.createText(e)}(e[11],r));function as(n){return jl("",n),as}function jl(n,e,t){const r=re(),i=function CH(n,e,t,r=""){return Cn(n,Bi(),t)?e+Tt(t)+r:nn}(r,n,e,t);return i!==nn&&function na(n,e,t){const r=Sd(e,n);!function VU(n,e,t){n.setValue(e,t)}(n[11],r,t)}(r,Kr(),i),jl}function FA(n,e,t,r,i){if(n=Ct(n),Array.isArray(n))for(let s=0;s<n.length;s++)FA(n[s],e,t,r,i);else{const s=wt(),o=re(),a=bt();let c=Uo(n)?n:Ct(n.provide);const l=n2(n),u=1048575&a.providerIndexes,d=a.directiveStart,h=a.providerIndexes>>20;if(Uo(n)||!n.multi){const f=new jp(l,i,Me,null),m=UA(c,e,i?u:u+h,d);-1===m?(vS(Wy(a,o),s,c),VA(s,n,e.length),e.push(c),a.directiveStart++,a.directiveEnd++,i&&(a.providerIndexes+=1048576),t.push(f),o.push(f)):(t[m]=f,o[m]=f)}else{const f=UA(c,e,u+h,d),m=UA(c,e,u,u+h),_=m>=0&&t[m];if(i&&!_||!i&&!(f>=0&&t[f])){vS(Wy(a,o),s,c);const g=function yue(n,e,t,r,i){const o=new jp(n,t,Me,null);return o.multi=[],o.index=e,o.componentProviders=0,KH(o,i,r&&!t),o}(i?_ue:gue,t.length,i,r,l);!i&&_&&(t[m].providerFactory=g),VA(s,n,e.length,0),e.push(c),a.directiveStart++,a.directiveEnd++,i&&(a.providerIndexes+=1048576),t.push(g),o.push(g)}else VA(s,n,f>-1?f:m,KH(t[i?m:f],l,!i&&r));!i&&r&&_&&t[m].componentProviders++}}}function VA(n,e,t,r){const i=Uo(e),s=function e2(n){return!!n.useClass}(e);if(i||s){const c=(s?Ct(e.useClass):e).prototype.ngOnDestroy;if(c){const l=n.destroyHooks||(n.destroyHooks=[]);if(!i&&e.multi){const u=l.indexOf(t);-1===u?l.push(t,[r,c]):l[u+1].push(r,c)}else l.push(t,c)}}}function KH(n,e,t){return t&&n.componentProviders++,n.multi.push(e)-1}function UA(n,e,t,r){for(let i=t;i<r;i++)if(e[i]===n)return i;return-1}function gue(n,e,t,r,i){return BA(this.multi,[])}function _ue(n,e,t,r,i){const s=this.multi;let o;if(this.providerFactory){const a=this.providerFactory.componentProviders,c=Xp(r,r[1],this.providerFactory.index,i);o=c.slice(0,a),BA(s,o);for(let l=a;l<c.length;l++)o.push(c[l])}else o=[],BA(s,o);return o}function BA(n,e){for(let t=0;t<n.length;t++)e.push((0,n[t])());return e}function Un(n,e=[]){return t=>{t.providersResolver=(r,i)=>function mue(n,e,t){const r=wt();if(r.firstCreatePass){const i=ss(n);FA(t,r.data,r.blueprint,i,!0),FA(e,r.data,r.blueprint,i,!1)}}(r,i?i(n):n,e)}}function Vm(n,e){const t=n[e];return t===nn?void 0:t}function ZH(n,e,t,r,i,s,o){const a=e+t;return function Ol(n,e,t,r){const i=Cn(n,e,t);return Cn(n,e+1,r)||i}(n,a,i,s)?po(n,a+2,o?r.call(o,i,s):r(i,s)):Vm(n,a+2)}function Rr(n,e){const t=wt();let r;const i=n+26;t.firstCreatePass?(r=function Nue(n,e){if(e)for(let t=e.length-1;t>=0;t--){const r=e[t];if(n===r.name)return r}}(e,t.pipeRegistry),t.data[i]=r,r.onDestroy&&(t.destroyHooks??=[]).push(i,r.onDestroy)):r=t.data[i];const s=r.factory||(r.factory=ml(r.type)),a=Vi(Me);try{const c=Gy(!1),l=s();return Gy(c),function YI(n,e,t,r){t>=n.data.length&&(n.data[t]=null,n.blueprint[t]=null),e[t]=r}(t,re(),i,l),l}finally{Vi(a)}}function Zr(n,e,t){const r=n+26,i=re(),s=Tl(i,r);return Um(i,r)?function JH(n,e,t,r,i,s){const o=e+t;return Cn(n,o,i)?po(n,o+1,s?r.call(s,i):r(i)):Vm(n,o+1)}(i,Si(),e,s.transform,t,s):s.transform(t)}function HA(n,e,t,r){const i=n+26,s=re(),o=Tl(s,i);return Um(s,i)?ZH(s,Si(),e,o.transform,t,r,o):o.transform(t,r)}function Um(n,e){return n[1].data[e].pure}function fh(n,e){return Tv(n,e)}let hde=(()=>{class n{zone=Ie(Vt);changeDetectionScheduler=Ie(Dd);applicationRef=Ie(ic);applicationErrorHandler=Ie(Ko);_onMicrotaskEmptySubscription;initialize(){this._onMicrotaskEmptySubscription||(this._onMicrotaskEmptySubscription=this.zone.onMicrotaskEmpty.subscribe({next:()=>{this.changeDetectionScheduler.runningTick||this.zone.run(()=>{try{this.applicationRef.dirtyFlags|=1,this.applicationRef._tick()}catch(t){this.applicationErrorHandler(t)}})}}))}ngOnDestroy(){this._onMicrotaskEmptySubscription?.unsubscribe()}static \u0275fac=function(r){return new(r||n)};static \u0275prov=Et({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();function vz({ngZoneFactory:n,ignoreChangesOutsideZone:e,scheduleInRootZone:t}){return n??=()=>new Vt({...$A(),scheduleInRootZone:t}),[{provide:Vt,useFactory:n},{provide:gl,multi:!0,useFactory:()=>{const r=Ie(hde,{optional:!0});return()=>r.initialize()}},{provide:gl,multi:!0,useFactory:()=>{const r=Ie(pde);return()=>{r.initialize()}}},!0===e?{provide:B2,useValue:!0}:[],{provide:H2,useValue:t??LB},{provide:Ko,useFactory:()=>{const r=Ie(Vt),i=Ie(Ui);let s;return o=>{r.runOutsideAngular(()=>{i.destroyed&&!s?setTimeout(()=>{throw o}):(s??=i.get(Cd),s.handleError(o))})}}}]}function $A(n){return{enableLongStackTrace:!1,shouldCoalesceEventChangeDetection:n?.eventCoalescing??!1,shouldCoalesceRunChangeDetection:n?.runCoalescing??!1}}let pde=(()=>{class n{subscription=new ns;initialized=!1;zone=Ie(Vt);pendingTasks=Ie(Sl);initialize(){if(this.initialized)return;this.initialized=!0;let t=null;!this.zone.isStable&&!this.zone.hasPendingMacrotasks&&!this.zone.hasPendingMicrotasks&&(t=this.pendingTasks.add()),this.zone.runOutsideAngular(()=>{this.subscription.add(this.zone.onStable.subscribe(()=>{Vt.assertNotInAngularZone(),queueMicrotask(()=>{null!==t&&!this.zone.hasPendingMacrotasks&&!this.zone.hasPendingMicrotasks&&(this.pendingTasks.remove(t),t=null)})}))}),this.subscription.add(this.zone.onUnstable.subscribe(()=>{Vt.assertInAngularZone(),t??=this.pendingTasks.add()}))}ngOnDestroy(){this.subscription.unsubscribe()}static \u0275fac=function(r){return new(r||n)};static \u0275prov=Et({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})(),Tz=(()=>{class n{applicationErrorHandler=Ie(Ko);appRef=Ie(ic);taskService=Ie(Sl);ngZone=Ie(Vt);zonelessEnabled=Ie(U2);tracing=Ie(Sm,{optional:!0});disableScheduling=Ie(B2,{optional:!0})??!1;zoneIsDefined=typeof Zone<"u"&&!!Zone.root.run;schedulerTickApplyArgs=[{data:{__scheduler_tick__:!0}}];subscriptions=new ns;angularZoneId=this.zoneIsDefined?this.ngZone._inner?.get(Bv):null;scheduleInRootZone=!this.zonelessEnabled&&this.zoneIsDefined&&(Ie(H2,{optional:!0})??!1);cancelScheduledCallback=null;useMicrotaskScheduler=!1;runningTick=!1;pendingRenderTaskId=null;constructor(){this.subscriptions.add(this.appRef.afterTick.subscribe(()=>{this.runningTick||this.cleanup()})),this.subscriptions.add(this.ngZone.onUnstable.subscribe(()=>{this.runningTick||this.cleanup()})),this.disableScheduling||=!this.zonelessEnabled&&(this.ngZone instanceof tA||!this.zoneIsDefined)}notify(t){if(!this.zonelessEnabled&&5===t)return;let r=!1;switch(t){case 0:this.appRef.dirtyFlags|=2;break;case 3:case 2:case 4:case 5:case 1:this.appRef.dirtyFlags|=4;break;case 6:case 13:this.appRef.dirtyFlags|=2,r=!0;break;case 12:this.appRef.dirtyFlags|=16,r=!0;break;case 11:r=!0;break;default:this.appRef.dirtyFlags|=8}if(this.appRef.tracingSnapshot=this.tracing?.snapshot(this.appRef.tracingSnapshot)??null,!this.shouldScheduleTick(r))return;const i=this.useMicrotaskScheduler?VB:FB;this.pendingRenderTaskId=this.taskService.add(),this.cancelScheduledCallback=this.scheduleInRootZone?Zone.root.run(()=>i(()=>this.tick())):this.ngZone.runOutsideAngular(()=>i(()=>this.tick()))}shouldScheduleTick(t){return!(this.disableScheduling&&!t||this.appRef.destroyed||null!==this.pendingRenderTaskId||this.runningTick||this.appRef._runningTick||!this.zonelessEnabled&&this.zoneIsDefined&&Zone.current.get(Bv+this.angularZoneId))}tick(){if(this.runningTick||this.appRef.destroyed)return;if(0===this.appRef.dirtyFlags)return void this.cleanup();!this.zonelessEnabled&&7&this.appRef.dirtyFlags&&(this.appRef.dirtyFlags|=1);const t=this.taskService.add();try{this.ngZone.run(()=>{this.runningTick=!0,this.appRef._tick()},void 0,this.schedulerTickApplyArgs)}catch(r){this.taskService.remove(t),this.applicationErrorHandler(r)}finally{this.cleanup()}this.useMicrotaskScheduler=!0,VB(()=>{this.useMicrotaskScheduler=!1,this.taskService.remove(t)})}ngOnDestroy(){this.subscriptions.unsubscribe(),this.cleanup()}cleanup(){if(this.runningTick=!1,this.cancelScheduledCallback?.(),this.cancelScheduledCallback=null,null!==this.pendingRenderTaskId){const t=this.pendingRenderTaskId;this.pendingRenderTaskId=null,this.taskService.remove(t)}}static \u0275fac=function(r){return new(r||n)};static \u0275prov=Et({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();const lc=new Ae("",{providedIn:"root",factory:()=>Ie(lc,{optional:!0,skipSelf:!0})||function mde(){return typeof $localize<"u"&&$localize.locale||eE}()});new Ae("").__NG_ELEMENT_ID__=n=>{const e=bt();if(null===e)throw new ue(204,!1);if(2&e.type)return e.value;if(8&n)return null;throw new ue(204,!1)};class _E{full;major;minor;patch;constructor(e){this.full=e;const t=e.split(".");this.major=t[0],this.minor=t[1],this.patch=t.slice(2).join(".")}}const Ide=new _E("20.3.0"),yE=new Ae(""),Cde=new Ae("");function Hm(n){return!n.moduleRef}let Nz;function Oz(){Nz=Dde}function Dde(n,e){const t=n.injector.get(ic);if(n._bootstrapComponents.length>0)n._bootstrapComponents.forEach(r=>t.bootstrap(r));else{if(!n.instance.ngDoBootstrap)throw new ue(-403,!1);n.instance.ngDoBootstrap(t)}e.push(n)}let kz=(()=>{class n{_injector;_modules=[];_destroyListeners=[];_destroyed=!1;constructor(t){this._injector=t}bootstrapModuleFactory(t,r){const i=r?.scheduleInRootZone,o=r?.ignoreChangesOutsideZone,a=[vz({ngZoneFactory:()=>function loe(n="zone.js",e){return"noop"===n?new tA:"zone.js"===n?new Vt(e):n}(r?.ngZone,{...$A({eventCoalescing:r?.ngZoneEventCoalescing,runCoalescing:r?.ngZoneRunCoalescing}),scheduleInRootZone:i}),ignoreChangesOutsideZone:o}),{provide:Dd,useExisting:Tz},jQ],c=function Pse(n,e,t){return new Xx(n,e,t,!1)}(t.moduleType,this.injector,a);return Oz(),function Pz(n){const e=Hm(n)?n.r3Injector:n.moduleRef.injector,t=e.get(Vt);return t.run(()=>{Hm(n)?n.r3Injector.resolveInjectorInitializers():n.moduleRef.resolveInjectorInitializers();const r=e.get(Ko);let i;if(t.runOutsideAngular(()=>{i=t.onError.subscribe({next:r})}),Hm(n)){const s=()=>e.destroy(),o=n.platformInjector.get(yE);o.add(s),e.onDestroy(()=>{i.unsubscribe(),o.delete(s)})}else{const s=()=>n.moduleRef.destroy(),o=n.platformInjector.get(yE);o.add(s),n.moduleRef.onDestroy(()=>{qv(n.allPlatformModules,n.moduleRef),i.unsubscribe(),o.delete(s)})}return function Rde(n,e,t){try{const r=t();return $v(r)?r.catch(i=>{throw e.runOutsideAngular(()=>n(i)),i}):r}catch(r){throw e.runOutsideAngular(()=>n(r)),r}}(r,t,()=>{const s=e.get(Sl),o=s.add(),a=e.get(y4);return a.runInitializers(),a.donePromise.then(()=>{if(function Uce(n){"string"==typeof n&&(q4=n.toLowerCase().replace(/_/g,"-"))}(e.get(lc,eE)||eE),!e.get(Cde,!0))return Hm(n)?e.get(ic):(n.allPlatformModules.push(n.moduleRef),n.moduleRef);if(Hm(n)){const u=e.get(ic);return void 0!==n.rootComponent&&u.bootstrap(n.rootComponent),u}return Nz?.(n.moduleRef,n.allPlatformModules),n.moduleRef}).finally(()=>{s.remove(o)})})})}({moduleRef:c,allPlatformModules:this._modules,platformInjector:this.injector})}bootstrapModule(t,r=[]){const i=v4({},r);return Oz(),function Sde(n,e,t){const r=new yB(t);return Promise.resolve(r)}(0,0,t).then(s=>this.bootstrapModuleFactory(s,i))}onDestroy(t){this._destroyListeners.push(t)}get injector(){return this._injector}destroy(){if(this._destroyed)throw new ue(404,!1);this._modules.slice().forEach(r=>r.destroy()),this._destroyListeners.forEach(r=>r());const t=this._injector.get(yE,null);t&&(t.forEach(r=>r()),t.clear()),this._destroyed=!0}get destroyed(){return this._destroyed}static \u0275fac=function(r){return new(r||n)(Rt(Yr))};static \u0275prov=Et({token:n,factory:n.\u0275fac,providedIn:"platform"})}return n})(),gh=null;function Lz(n,e,t=[]){const r=`Platform: ${e}`,i=new Ae(r);return(s=[])=>{let o=vE();if(!o){const a=[...t,...s,{provide:i,useValue:!0}];o=n?.(a)??function Pde(n){if(vE())throw new ue(400,!1);(function yae(){!function AZ(n){xF=n}(()=>{throw new ue(600,"")})})(),gh=n;const e=n.get(kz);return function Vz(n){const e=n.get(BV,null);vd(n,()=>{e?.forEach(t=>t())})}(n),e}(function Fz(n=[],e){return Yr.create({name:e,providers:[{provide:zI,useValue:"platform"},{provide:yE,useValue:new Set([()=>gh=null])},...n]})}(a,r))}return function Nde(){const e=vE();if(!e)throw new ue(401,!1);return e}()}}function vE(){return gh?.get(kz)??null}function Uz(){return!1}let JA=(()=>class n{static __NG_ELEMENT_ID__=kde})();function kde(n){return function Lde(n,e,t){if(zo(n)&&!t){const r=Ii(n.index,e);return new um(r,r)}return 175&n.type?new um(e[15],e):null}(bt(),re(),!(16&~n))}class Hz{constructor(){}supports(e){return Nv(e)}create(e){return new Vde(e)}}const Fde=(n,e)=>e;class Vde{length=0;collection;_linkedRecords=null;_unlinkedRecords=null;_previousItHead=null;_itHead=null;_itTail=null;_additionsHead=null;_additionsTail=null;_movesHead=null;_movesTail=null;_removalsHead=null;_removalsTail=null;_identityChangesHead=null;_identityChangesTail=null;_trackByFn;constructor(e){this._trackByFn=e||Fde}forEachItem(e){let t;for(t=this._itHead;null!==t;t=t._next)e(t)}forEachOperation(e){let t=this._itHead,r=this._removalsHead,i=0,s=null;for(;t||r;){const o=!r||t&&t.currentIndex<Gz(r,i,s)?t:r,a=Gz(o,i,s),c=o.currentIndex;if(o===r)i--,r=r._nextRemoved;else if(t=t._next,null==o.previousIndex)i++;else{s||(s=[]);const l=a-i,u=c-i;if(l!=u){for(let h=0;h<l;h++){const f=h<s.length?s[h]:s[h]=0,m=f+h;u<=m&&m<l&&(s[h]=f+1)}s[o.previousIndex]=u-l}}a!==c&&e(o,a,c)}}forEachPreviousItem(e){let t;for(t=this._previousItHead;null!==t;t=t._nextPrevious)e(t)}forEachAddedItem(e){let t;for(t=this._additionsHead;null!==t;t=t._nextAdded)e(t)}forEachMovedItem(e){let t;for(t=this._movesHead;null!==t;t=t._nextMoved)e(t)}forEachRemovedItem(e){let t;for(t=this._removalsHead;null!==t;t=t._nextRemoved)e(t)}forEachIdentityChange(e){let t;for(t=this._identityChangesHead;null!==t;t=t._nextIdentityChange)e(t)}diff(e){if(null==e&&(e=[]),!Nv(e))throw new ue(900,!1);return this.check(e)?this:null}onDestroy(){}check(e){this._reset();let i,s,o,t=this._itHead,r=!1;if(Array.isArray(e)){this.length=e.length;for(let a=0;a<this.length;a++)s=e[a],o=this._trackByFn(a,s),null!==t&&Object.is(t.trackById,o)?(r&&(t=this._verifyReinsertion(t,s,o,a)),Object.is(t.item,s)||this._addIdentityChange(t,s)):(t=this._mismatch(t,s,o,a),r=!0),t=t._next}else i=0,function Wie(n,e){if(Array.isArray(n))for(let t=0;t<n.length;t++)e(n[t]);else{const t=n[Symbol.iterator]();let r;for(;!(r=t.next()).done;)e(r.value)}}(e,a=>{o=this._trackByFn(i,a),null!==t&&Object.is(t.trackById,o)?(r&&(t=this._verifyReinsertion(t,a,o,i)),Object.is(t.item,a)||this._addIdentityChange(t,a)):(t=this._mismatch(t,a,o,i),r=!0),t=t._next,i++}),this.length=i;return this._truncate(t),this.collection=e,this.isDirty}get isDirty(){return null!==this._additionsHead||null!==this._movesHead||null!==this._removalsHead||null!==this._identityChangesHead}_reset(){if(this.isDirty){let e;for(e=this._previousItHead=this._itHead;null!==e;e=e._next)e._nextPrevious=e._next;for(e=this._additionsHead;null!==e;e=e._nextAdded)e.previousIndex=e.currentIndex;for(this._additionsHead=this._additionsTail=null,e=this._movesHead;null!==e;e=e._nextMoved)e.previousIndex=e.currentIndex;this._movesHead=this._movesTail=null,this._removalsHead=this._removalsTail=null,this._identityChangesHead=this._identityChangesTail=null}}_mismatch(e,t,r,i){let s;return null===e?s=this._itTail:(s=e._prev,this._remove(e)),null!==(e=null===this._unlinkedRecords?null:this._unlinkedRecords.get(r,null))?(Object.is(e.item,t)||this._addIdentityChange(e,t),this._reinsertAfter(e,s,i)):null!==(e=null===this._linkedRecords?null:this._linkedRecords.get(r,i))?(Object.is(e.item,t)||this._addIdentityChange(e,t),this._moveAfter(e,s,i)):e=this._addAfter(new Ude(t,r),s,i),e}_verifyReinsertion(e,t,r,i){let s=null===this._unlinkedRecords?null:this._unlinkedRecords.get(r,null);return null!==s?e=this._reinsertAfter(s,e._prev,i):e.currentIndex!=i&&(e.currentIndex=i,this._addToMoves(e,i)),e}_truncate(e){for(;null!==e;){const t=e._next;this._addToRemovals(this._unlink(e)),e=t}null!==this._unlinkedRecords&&this._unlinkedRecords.clear(),null!==this._additionsTail&&(this._additionsTail._nextAdded=null),null!==this._movesTail&&(this._movesTail._nextMoved=null),null!==this._itTail&&(this._itTail._next=null),null!==this._removalsTail&&(this._removalsTail._nextRemoved=null),null!==this._identityChangesTail&&(this._identityChangesTail._nextIdentityChange=null)}_reinsertAfter(e,t,r){null!==this._unlinkedRecords&&this._unlinkedRecords.remove(e);const i=e._prevRemoved,s=e._nextRemoved;return null===i?this._removalsHead=s:i._nextRemoved=s,null===s?this._removalsTail=i:s._prevRemoved=i,this._insertAfter(e,t,r),this._addToMoves(e,r),e}_moveAfter(e,t,r){return this._unlink(e),this._insertAfter(e,t,r),this._addToMoves(e,r),e}_addAfter(e,t,r){return this._insertAfter(e,t,r),this._additionsTail=null===this._additionsTail?this._additionsHead=e:this._additionsTail._nextAdded=e,e}_insertAfter(e,t,r){const i=null===t?this._itHead:t._next;return e._next=i,e._prev=t,null===i?this._itTail=e:i._prev=e,null===t?this._itHead=e:t._next=e,null===this._linkedRecords&&(this._linkedRecords=new zz),this._linkedRecords.put(e),e.currentIndex=r,e}_remove(e){return this._addToRemovals(this._unlink(e))}_unlink(e){null!==this._linkedRecords&&this._linkedRecords.remove(e);const t=e._prev,r=e._next;return null===t?this._itHead=r:t._next=r,null===r?this._itTail=t:r._prev=t,e}_addToMoves(e,t){return e.previousIndex===t||(this._movesTail=null===this._movesTail?this._movesHead=e:this._movesTail._nextMoved=e),e}_addToRemovals(e){return null===this._unlinkedRecords&&(this._unlinkedRecords=new zz),this._unlinkedRecords.put(e),e.currentIndex=null,e._nextRemoved=null,null===this._removalsTail?(this._removalsTail=this._removalsHead=e,e._prevRemoved=null):(e._prevRemoved=this._removalsTail,this._removalsTail=this._removalsTail._nextRemoved=e),e}_addIdentityChange(e,t){return e.item=t,this._identityChangesTail=null===this._identityChangesTail?this._identityChangesHead=e:this._identityChangesTail._nextIdentityChange=e,e}}class Ude{item;trackById;currentIndex=null;previousIndex=null;_nextPrevious=null;_prev=null;_next=null;_prevDup=null;_nextDup=null;_prevRemoved=null;_nextRemoved=null;_nextAdded=null;_nextMoved=null;_nextIdentityChange=null;constructor(e,t){this.item=e,this.trackById=t}}class Bde{_head=null;_tail=null;add(e){null===this._head?(this._head=this._tail=e,e._nextDup=null,e._prevDup=null):(this._tail._nextDup=e,e._prevDup=this._tail,e._nextDup=null,this._tail=e)}get(e,t){let r;for(r=this._head;null!==r;r=r._nextDup)if((null===t||t<=r.currentIndex)&&Object.is(r.trackById,e))return r;return null}remove(e){const t=e._prevDup,r=e._nextDup;return null===t?this._head=r:t._nextDup=r,null===r?this._tail=t:r._prevDup=t,null===this._head}}class zz{map=new Map;put(e){const t=e.trackById;let r=this.map.get(t);r||(r=new Bde,this.map.set(t,r)),r.add(e)}get(e,t){const i=this.map.get(e);return i?i.get(e,t):null}remove(e){const t=e.trackById;return this.map.get(t).remove(e)&&this.map.delete(t),e}get isEmpty(){return 0===this.map.size}clear(){this.map.clear()}}function Gz(n,e,t){const r=n.previousIndex;if(null===r)return r;let i=0;return t&&r<t.length&&(i=t[r]),r+e+i}function jz(){return new ZA([new Hz])}let ZA=(()=>{class n{factories;static \u0275prov=Et({token:n,providedIn:"root",factory:jz});constructor(t){this.factories=t}static create(t,r){if(null!=r){const i=r.factories.slice();t=t.concat(i)}return new n(t)}static extend(t){return{provide:n,useFactory:()=>{const r=Ie(n,{optional:!0,skipSelf:!0});return n.create(t,r||jz())}}}find(t){const r=this.factories.find(i=>i.supports(t));if(null!=r)return r;throw new ue(901,!1)}}return n})();const jde=Lz(null,"core",[]);let $de=(()=>{class n{constructor(t){}static \u0275fac=function(r){return new(r||n)(Rt(ic))};static \u0275mod=nc({type:n});static \u0275inj=Vo({})}return n})();function br(n){return function Jhe(n){const e=gt(null);try{return n()}finally{gt(e)}}(n)}function Ws(n,e){return function IZ(n,e){const t=Object.create(SZ);t.computation=n,void 0!==e&&(t.equal=e);const r=()=>{if(xp(t),fy(t),t.value===za)throw t.error;return t.value};return r[Xr]=t,r}(n,e?.equal)}Error,Error;var Ai=function(n){return n[n.Format=0]="Format",n[n.Standalone=1]="Standalone",n}(Ai||{}),gn=function(n){return n[n.Narrow=0]="Narrow",n[n.Abbreviated=1]="Abbreviated",n[n.Wide=2]="Wide",n[n.Short=3]="Short",n}(gn||{}),cs=function(n){return n[n.Short=0]="Short",n[n.Medium=1]="Medium",n[n.Long=2]="Long",n[n.Full=3]="Full",n}(cs||{});function CE(n,e){return Ds(xi(n)[Dn.DateFormat],e)}function DE(n,e){return Ds(xi(n)[Dn.TimeFormat],e)}function RE(n,e){return Ds(xi(n)[Dn.DateTimeFormat],e)}function Cs(n,e){const t=xi(n),r=t[Dn.NumberSymbols][e];if(typeof r>"u"){if(12===e)return t[Dn.NumberSymbols][0];if(13===e)return t[Dn.NumberSymbols][1]}return r}function AG(n){if(!n[Dn.ExtraData])throw new ue(2303,!1)}function Ds(n,e){for(let t=e;t>-1;t--)if(typeof n[t]<"u")return n[t];throw new ue(2304,!1)}function aM(n){const[e,t]=n.split(":");return{hours:+e,minutes:+t}}const Afe=/^(\d{4,})-?(\d\d)-?(\d\d)(?:T(\d\d)(?::?(\d\d)(?::?(\d\d)(?:\.(\d+))?)?)?(Z|([+-])(\d\d):?(\d\d))?)?$/,PE={},Mfe=/((?:[^BEGHLMOSWYZabcdhmswyz']+)|(?:'(?:[^']|'')*')|(?:G{1,5}|y{1,4}|Y{1,4}|M{1,5}|L{1,5}|w{1,2}|W{1}|d{1,2}|E{1,6}|c{1,6}|a{1,5}|b{1,5}|B{1,5}|h{1,2}|H{1,2}|m{1,2}|s{1,2}|S{1,3}|z{1,4}|Z{1,5}|O{1,4}))([\s\S]*)/;function Cfe(n,e,t,r){let i=function Vfe(n){if(DG(n))return n;if("number"==typeof n&&!isNaN(n))return new Date(n);if("string"==typeof n){if(n=n.trim(),/^(\d{4}(-\d{1,2}(-\d{1,2})?)?)$/.test(n)){const[i,s=1,o=1]=n.split("-").map(a=>+a);return NE(i,s-1,o)}const t=parseFloat(n);if(!isNaN(n-t))return new Date(t);let r;if(r=n.match(Afe))return function Ufe(n){const e=new Date(0);let t=0,r=0;const i=n[8]?e.setUTCFullYear:e.setFullYear,s=n[8]?e.setUTCHours:e.setHours;n[9]&&(t=Number(n[9]+n[10]),r=Number(n[9]+n[11])),i.call(e,Number(n[1]),Number(n[2])-1,Number(n[3]));const o=Number(n[4]||0)-t,a=Number(n[5]||0)-r,c=Number(n[6]||0),l=Math.floor(1e3*parseFloat("0."+(n[7]||0)));return s.call(e,o,a,c,l),e}(r)}const e=new Date(n);if(!DG(e))throw new ue(2302,!1);return e}(n);e=ra(t,e)||e;let a,o=[];for(;e;){if(a=Mfe.exec(e),!a){o.push(e);break}{o=o.concat(a.slice(1));const u=o.pop();if(!u)break;e=u}}let c=i.getTimezoneOffset();r&&(c=CG(r,c),i=function Ffe(n,e){const i=n.getTimezoneOffset();return function Lfe(n,e){return(n=new Date(n.getTime())).setMinutes(n.getMinutes()+e),n}(n,-1*(CG(e,i)-i))}(i,r));let l="";return o.forEach(u=>{const d=function kfe(n){if(lM[n])return lM[n];let e;switch(n){case"G":case"GG":case"GGG":e=In(3,gn.Abbreviated);break;case"GGGG":e=In(3,gn.Wide);break;case"GGGGG":e=In(3,gn.Narrow);break;case"y":e=wr(0,1,0,!1,!0);break;case"yy":e=wr(0,2,0,!0,!0);break;case"yyy":e=wr(0,3,0,!1,!0);break;case"yyyy":e=wr(0,4,0,!1,!0);break;case"Y":e=FE(1);break;case"YY":e=FE(2,!0);break;case"YYY":e=FE(3);break;case"YYYY":e=FE(4);break;case"M":case"L":e=wr(1,1,1);break;case"MM":case"LL":e=wr(1,2,1);break;case"MMM":e=In(2,gn.Abbreviated);break;case"MMMM":e=In(2,gn.Wide);break;case"MMMMM":e=In(2,gn.Narrow);break;case"LLL":e=In(2,gn.Abbreviated,Ai.Standalone);break;case"LLLL":e=In(2,gn.Wide,Ai.Standalone);break;case"LLLLL":e=In(2,gn.Narrow,Ai.Standalone);break;case"w":e=cM(1);break;case"ww":e=cM(2);break;case"W":e=cM(1,!0);break;case"d":e=wr(2,1);break;case"dd":e=wr(2,2);break;case"c":case"cc":e=wr(7,1);break;case"ccc":e=In(1,gn.Abbreviated,Ai.Standalone);break;case"cccc":e=In(1,gn.Wide,Ai.Standalone);break;case"ccccc":e=In(1,gn.Narrow,Ai.Standalone);break;case"cccccc":e=In(1,gn.Short,Ai.Standalone);break;case"E":case"EE":case"EEE":e=In(1,gn.Abbreviated);break;case"EEEE":e=In(1,gn.Wide);break;case"EEEEE":e=In(1,gn.Narrow);break;case"EEEEEE":e=In(1,gn.Short);break;case"a":case"aa":case"aaa":e=In(0,gn.Abbreviated);break;case"aaaa":e=In(0,gn.Wide);break;case"aaaaa":e=In(0,gn.Narrow);break;case"b":case"bb":case"bbb":e=In(0,gn.Abbreviated,Ai.Standalone,!0);break;case"bbbb":e=In(0,gn.Wide,Ai.Standalone,!0);break;case"bbbbb":e=In(0,gn.Narrow,Ai.Standalone,!0);break;case"B":case"BB":case"BBB":e=In(0,gn.Abbreviated,Ai.Format,!0);break;case"BBBB":e=In(0,gn.Wide,Ai.Format,!0);break;case"BBBBB":e=In(0,gn.Narrow,Ai.Format,!0);break;case"h":e=wr(3,1,-12);break;case"hh":e=wr(3,2,-12);break;case"H":e=wr(3,1);break;case"HH":e=wr(3,2);break;case"m":e=wr(4,1);break;case"mm":e=wr(4,2);break;case"s":e=wr(5,1);break;case"ss":e=wr(5,2);break;case"S":e=wr(6,1);break;case"SS":e=wr(6,2);break;case"SSS":e=wr(6,3);break;case"Z":case"ZZ":case"ZZZ":e=kE(0);break;case"ZZZZZ":e=kE(3);break;case"O":case"OO":case"OOO":case"z":case"zz":case"zzz":e=kE(1);break;case"OOOO":case"ZZZZ":case"zzzz":e=kE(2);break;default:return null}return lM[n]=e,e}(u);l+=d?d(i,t,c):"''"===u?"'":u.replace(/(^'|'$)/g,"").replace(/''/g,"'")}),l}function NE(n,e,t){const r=new Date(0);return r.setFullYear(n,e,t),r.setHours(0,0,0),r}function ra(n,e){const t=function mfe(n){return xi(n)[Dn.LocaleId]}(n);if(PE[t]??={},PE[t][e])return PE[t][e];let r="";switch(e){case"shortDate":r=CE(n,cs.Short);break;case"mediumDate":r=CE(n,cs.Medium);break;case"longDate":r=CE(n,cs.Long);break;case"fullDate":r=CE(n,cs.Full);break;case"shortTime":r=DE(n,cs.Short);break;case"mediumTime":r=DE(n,cs.Medium);break;case"longTime":r=DE(n,cs.Long);break;case"fullTime":r=DE(n,cs.Full);break;case"short":const i=ra(n,"shortTime"),s=ra(n,"shortDate");r=OE(RE(n,cs.Short),[i,s]);break;case"medium":const o=ra(n,"mediumTime"),a=ra(n,"mediumDate");r=OE(RE(n,cs.Medium),[o,a]);break;case"long":const c=ra(n,"longTime"),l=ra(n,"longDate");r=OE(RE(n,cs.Long),[c,l]);break;case"full":const u=ra(n,"fullTime"),d=ra(n,"fullDate");r=OE(RE(n,cs.Full),[u,d])}return r&&(PE[t][e]=r),r}function OE(n,e){return e&&(n=n.replace(/\{([^}]+)}/g,function(t,r){return null!=e&&r in e?e[r]:t})),n}function js(n,e,t="-",r,i){let s="";(n<0||i&&n<=0)&&(i?n=1-n:(n=-n,s=t));let o=String(n);for(;o.length<e;)o="0"+o;return r&&(o=o.slice(o.length-e)),s+o}function wr(n,e,t=0,r=!1,i=!1){return function(s,o){let a=function Rfe(n,e){switch(n){case 0:return e.getFullYear();case 1:return e.getMonth();case 2:return e.getDate();case 3:return e.getHours();case 4:return e.getMinutes();case 5:return e.getSeconds();case 6:return e.getMilliseconds();case 7:return e.getDay();default:throw new ue(2301,!1)}}(n,s);if((t>0||a>-t)&&(a+=t),3===n)0===a&&-12===t&&(a=12);else if(6===n)return function Dfe(n,e){return js(n,3).substring(0,e)}(a,e);const c=Cs(o,5);return js(a,e,c,r,i)}}function In(n,e,t=Ai.Format,r=!1){return function(i,s){return function Pfe(n,e,t,r,i,s){switch(t){case 2:return function yfe(n,e,t){const r=xi(n),s=Ds([r[Dn.MonthsFormat],r[Dn.MonthsStandalone]],e);return Ds(s,t)}(e,i,r)[n.getMonth()];case 1:return function _fe(n,e,t){const r=xi(n),s=Ds([r[Dn.DaysFormat],r[Dn.DaysStandalone]],e);return Ds(s,t)}(e,i,r)[n.getDay()];case 0:const o=n.getHours(),a=n.getMinutes();if(s){const l=function Tfe(n){const e=xi(n);return AG(e),(e[Dn.ExtraData][2]||[]).map(r=>"string"==typeof r?aM(r):[aM(r[0]),aM(r[1])])}(e),u=function wfe(n,e,t){const r=xi(n);AG(r);const s=Ds([r[Dn.ExtraData][0],r[Dn.ExtraData][1]],e)||[];return Ds(s,t)||[]}(e,i,r),d=l.findIndex(h=>{if(Array.isArray(h)){const[f,m]=h,y=o>=f.hours&&a>=f.minutes,_=o<m.hours||o===m.hours&&a<m.minutes;if(f.hours<m.hours){if(y&&_)return!0}else if(y||_)return!0}else if(h.hours===o&&h.minutes===a)return!0;return!1});if(-1!==d)return u[d]}return function gfe(n,e,t){const r=xi(n),s=Ds([r[Dn.DayPeriodsFormat],r[Dn.DayPeriodsStandalone]],e);return Ds(s,t)}(e,i,r)[o<12?0:1];case 3:return function vfe(n,e){return Ds(xi(n)[Dn.Eras],e)}(e,r)[n.getFullYear()<=0?0:1];default:throw new ue(2302,!1)}}(i,s,n,e,t,r)}}function kE(n){return function(e,t,r){const i=-1*r,s=Cs(t,5),o=i>0?Math.floor(i/60):Math.ceil(i/60);switch(n){case 0:return(i>=0?"+":"")+js(o,2,s)+js(Math.abs(i%60),2,s);case 1:return"GMT"+(i>=0?"+":"")+js(o,1,s);case 2:return"GMT"+(i>=0?"+":"")+js(o,2,s)+":"+js(Math.abs(i%60),2,s);case 3:return 0===r?"Z":(i>=0?"+":"")+js(o,2,s)+":"+js(Math.abs(i%60),2,s);default:throw new ue(2302,!1)}}}const Nfe=0,LE=4;function MG(n){const e=n.getDay(),t=0===e?-3:LE-e;return NE(n.getFullYear(),n.getMonth(),n.getDate()+t)}function cM(n,e=!1){return function(t,r){let i;if(e){const s=new Date(t.getFullYear(),t.getMonth(),1).getDay()-1,o=t.getDate();i=1+Math.floor((o+s)/7)}else{const s=MG(t),o=function Ofe(n){const e=NE(n,Nfe,1).getDay();return NE(n,0,1+(e<=LE?LE:LE+7)-e)}(s.getFullYear()),a=s.getTime()-o.getTime();i=1+Math.round(a/6048e5)}return js(i,n,Cs(r,5))}}function FE(n,e=!1){return function(t,r){return js(MG(t).getFullYear(),n,Cs(r,5),e)}}const lM={};function CG(n,e){n=n.replace(/:/g,"");const t=Date.parse("Jan 01, 1970 00:00:00 "+n)/6e4;return isNaN(t)?e:t}function DG(n){return n instanceof Date&&!isNaN(n.valueOf())}class Qfe{$implicit;ngForOf;index;count;constructor(e,t,r,i){this.$implicit=e,this.ngForOf=t,this.index=r,this.count=i}get first(){return 0===this.index}get last(){return this.index===this.count-1}get even(){return this.index%2==0}get odd(){return!this.even}}let LG=(()=>{class n{_viewContainer;_template;_differs;set ngForOf(t){this._ngForOf=t,this._ngForOfDirty=!0}set ngForTrackBy(t){this._trackByFn=t}get ngForTrackBy(){return this._trackByFn}_ngForOf=null;_ngForOfDirty=!0;_differ=null;_trackByFn;constructor(t,r,i){this._viewContainer=t,this._template=r,this._differs=i}set ngForTemplate(t){t&&(this._template=t)}ngDoCheck(){if(this._ngForOfDirty){this._ngForOfDirty=!1;const t=this._ngForOf;!this._differ&&t&&(this._differ=this._differs.find(t).create(this.ngForTrackBy))}if(this._differ){const t=this._differ.diff(this._ngForOf);t&&this._applyChanges(t)}}_applyChanges(t){const r=this._viewContainer;t.forEachOperation((i,s,o)=>{if(null==i.previousIndex)r.createEmbeddedView(this._template,new Qfe(i.item,this._ngForOf,-1,-1),null===o?void 0:o);else if(null==o)r.remove(null===s?void 0:s);else if(null!==s){const a=r.get(s);r.move(a,o),FG(a,i)}});for(let i=0,s=r.length;i<s;i++){const a=r.get(i).context;a.index=i,a.count=s,a.ngForOf=this._ngForOf}t.forEachIdentityChange(i=>{FG(r.get(i.currentIndex),i)})}static ngTemplateContextGuard(t,r){return!0}static \u0275fac=function(r){return new(r||n)(Me(mo),Me(Qo),Me(ZA))};static \u0275dir=At({type:n,selectors:[["","ngFor","","ngForOf",""]],inputs:{ngForOf:"ngForOf",ngForTrackBy:"ngForTrackBy",ngForTemplate:"ngForTemplate"}})}return n})();function FG(n,e){n.context.$implicit=e.item}let qm=(()=>{class n{_viewContainer;_context=new epe;_thenTemplateRef=null;_elseTemplateRef=null;_thenViewRef=null;_elseViewRef=null;constructor(t,r){this._viewContainer=t,this._thenTemplateRef=r}set ngIf(t){this._context.$implicit=this._context.ngIf=t,this._updateView()}set ngIfThen(t){VG(t),this._thenTemplateRef=t,this._thenViewRef=null,this._updateView()}set ngIfElse(t){VG(t),this._elseTemplateRef=t,this._elseViewRef=null,this._updateView()}_updateView(){this._context.$implicit?this._thenViewRef||(this._viewContainer.clear(),this._elseViewRef=null,this._thenTemplateRef&&(this._thenViewRef=this._viewContainer.createEmbeddedView(this._thenTemplateRef,this._context))):this._elseViewRef||(this._viewContainer.clear(),this._thenViewRef=null,this._elseTemplateRef&&(this._elseViewRef=this._viewContainer.createEmbeddedView(this._elseTemplateRef,this._context)))}static ngIfUseIfTypeGuard;static ngTemplateGuard_ngIf;static ngTemplateContextGuard(t,r){return!0}static \u0275fac=function(r){return new(r||n)(Me(mo),Me(Qo))};static \u0275dir=At({type:n,selectors:[["","ngIf",""]],inputs:{ngIf:"ngIf",ngIfThen:"ngIfThen",ngIfElse:"ngIfElse"}})}return n})();class epe{$implicit=null;ngIf=null}function VG(n,e){if(n&&!n.createEmbeddedView)throw new ue(2020,!1)}function $s(n,e){return new ue(2100,!1)}class rpe{createSubscription(e,t,r){return br(()=>e.subscribe({next:t,error:r}))}dispose(e){br(()=>e.unsubscribe())}}class ipe{createSubscription(e,t,r){return e.then(i=>t?.(i),i=>r?.(i)),{unsubscribe:()=>{t=null,r=null}}}dispose(e){e.unsubscribe()}}const spe=new ipe,ope=new rpe;let yM=(()=>{class n{_ref;_latestValue=null;markForCheckOnValueUpdate=!0;_subscription=null;_obj=null;_strategy=null;applicationErrorHandler=Ie(Ko);constructor(t){this._ref=t}ngOnDestroy(){this._subscription&&this._dispose(),this._ref=null}transform(t){if(!this._obj){if(t)try{this.markForCheckOnValueUpdate=!1,this._subscribe(t)}finally{this.markForCheckOnValueUpdate=!0}return this._latestValue}return t!==this._obj?(this._dispose(),this.transform(t)):this._latestValue}_subscribe(t){this._obj=t,this._strategy=this._selectStrategy(t),this._subscription=this._strategy.createSubscription(t,r=>this._updateLatestValue(t,r),r=>this.applicationErrorHandler(r))}_selectStrategy(t){if($v(t))return spe;if(g4(t))return ope;throw $s()}_dispose(){this._strategy.dispose(this._subscription),this._latestValue=null,this._subscription=null,this._obj=null}_updateLatestValue(t,r){t===this._obj&&(this._latestValue=r,this.markForCheckOnValueUpdate&&this._ref?.markForCheck())}static \u0275fac=function(r){return new(r||n)(Me(JA,16))};static \u0275pipe=Gi({name:"async",type:n,pure:!1})}return n})();const hpe=new Ae(""),fpe=new Ae("");let vM=(()=>{class n{locale;defaultTimezone;defaultOptions;constructor(t,r,i){this.locale=t,this.defaultTimezone=r,this.defaultOptions=i}transform(t,r,i,s){if(null==t||""===t||t!=t)return null;try{return Cfe(t,r??this.defaultOptions?.dateFormat??"mediumDate",s||this.locale,i??this.defaultOptions?.timezone??this.defaultTimezone??void 0)}catch(o){throw $s()}}static \u0275fac=function(r){return new(r||n)(Me(lc,16),Me(hpe,24),Me(fpe,24))};static \u0275pipe=Gi({name:"date",type:n,pure:!0})}return n})(),ql=(()=>{class n{static \u0275fac=function(r){return new(r||n)};static \u0275mod=nc({type:n});static \u0275inj=Vo({})}return n})();const TM=new Ae("");let HG=(()=>{class n{_zone;_plugins;_eventNameToPlugin=new Map;constructor(t,r){this._zone=r,t.forEach(i=>{i.manager=this}),this._plugins=t.slice().reverse()}addEventListener(t,r,i,s){return this._findPluginFor(r).addEventListener(t,r,i,s)}getZone(){return this._zone}_findPluginFor(t){let r=this._eventNameToPlugin.get(t);if(r)return r;if(r=this._plugins.find(s=>s.supports(t)),!r)throw new ue(5101,!1);return this._eventNameToPlugin.set(t,r),r}static \u0275fac=function(r){return new(r||n)(Rt(TM),Rt(Vt))};static \u0275prov=Et({token:n,factory:n.\u0275fac})}return n})();class zG{_doc;constructor(e){this._doc=e}manager}const wM="ng-app-id";function GG(n){for(const e of n)e.remove()}function WG(n,e){const t=e.createElement("style");return t.textContent=n,t}function IM(n,e){const t=e.createElement("link");return t.setAttribute("rel","stylesheet"),t.setAttribute("href",n),t}let jG=(()=>{class n{doc;appId;nonce;inline=new Map;external=new Map;hosts=new Set;constructor(t,r,i,s={}){this.doc=t,this.appId=r,this.nonce=i,function wpe(n,e,t,r){const i=n.head?.querySelectorAll(`style[${wM}="${e}"],link[${wM}="${e}"]`);if(i)for(const s of i)s.removeAttribute(wM),s instanceof HTMLLinkElement?r.set(s.href.slice(s.href.lastIndexOf("/")+1),{usage:0,elements:[s]}):s.textContent&&t.set(s.textContent,{usage:0,elements:[s]})}(t,r,this.inline,this.external),this.hosts.add(t.head)}addStyles(t,r){for(const i of t)this.addUsage(i,this.inline,WG);r?.forEach(i=>this.addUsage(i,this.external,IM))}removeStyles(t,r){for(const i of t)this.removeUsage(i,this.inline);r?.forEach(i=>this.removeUsage(i,this.external))}addUsage(t,r,i){const s=r.get(t);s?s.usage++:r.set(t,{usage:1,elements:[...this.hosts].map(o=>this.addElement(o,i(t,this.doc)))})}removeUsage(t,r){const i=r.get(t);i&&(i.usage--,i.usage<=0&&(GG(i.elements),r.delete(t)))}ngOnDestroy(){for(const[,{elements:t}]of[...this.inline,...this.external])GG(t);this.hosts.clear()}addHost(t){this.hosts.add(t);for(const[r,{elements:i}]of this.inline)i.push(this.addElement(t,WG(r,this.doc)));for(const[r,{elements:i}]of this.external)i.push(this.addElement(t,IM(r,this.doc)))}removeHost(t){this.hosts.delete(t)}addElement(t,r){return this.nonce&&r.setAttribute("nonce",this.nonce),t.appendChild(r)}static \u0275fac=function(r){return new(r||n)(Rt(Xo),Rt(Jp),Rt(HV,8),Rt(Zp))};static \u0275prov=Et({token:n,factory:n.\u0275fac})}return n})();const SM={svg:"http://www.w3.org/2000/svg",xhtml:"http://www.w3.org/1999/xhtml",xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/",math:"http://www.w3.org/1998/Math/MathML"},xM=/%COMP%/g,Cpe=new Ae("",{providedIn:"root",factory:()=>!0});function qG(n,e){return e.map(t=>t.replace(xM,n))}let XG=(()=>{class n{eventManager;sharedStylesHost;appId;removeStylesOnCompDestroy;doc;platformId;ngZone;nonce;animationDisabled;maxAnimationTimeout;tracingService;rendererByCompId=new Map;defaultRenderer;platformIsServer;registry;constructor(t,r,i,s,o,a,c,l=null,u,d,h=null){this.eventManager=t,this.sharedStylesHost=r,this.appId=i,this.removeStylesOnCompDestroy=s,this.doc=o,this.platformId=a,this.ngZone=c,this.nonce=l,this.animationDisabled=u,this.maxAnimationTimeout=d,this.tracingService=h,this.platformIsServer=!1,this.defaultRenderer=new AM(t,o,c,this.platformIsServer,this.tracingService,this.registry=function lS(){return cS}(),this.maxAnimationTimeout)}createRenderer(t,r){if(!t||!r)return this.defaultRenderer;const i=this.getOrCreateRenderer(t,r);return i instanceof YG?i.applyToHost(t):i instanceof MM&&i.applyStyles(),i}getOrCreateRenderer(t,r){const i=this.rendererByCompId;let s=i.get(r.id);if(!s){const o=this.doc,a=this.ngZone,c=this.eventManager,l=this.sharedStylesHost,u=this.removeStylesOnCompDestroy,d=this.platformIsServer,h=this.tracingService;switch(r.encapsulation){case Jo.Emulated:s=new YG(c,l,r,this.appId,u,o,a,d,h,this.registry,this.animationDisabled,this.maxAnimationTimeout);break;case Jo.ShadowDom:return new Npe(c,l,t,r,o,a,this.nonce,d,h,this.registry,this.maxAnimationTimeout);default:s=new MM(c,l,r,u,o,a,d,h,this.registry,this.animationDisabled,this.maxAnimationTimeout)}i.set(r.id,s)}return s}ngOnDestroy(){this.rendererByCompId.clear()}componentReplaced(t){this.rendererByCompId.delete(t)}static \u0275fac=function(r){return new(r||n)(Rt(HG),Rt(jG),Rt(Jp),Rt(Cpe),Rt(Xo),Rt(Zp),Rt(Vt),Rt(HV),Rt(C4),Rt(nce),Rt(Sm,8))};static \u0275prov=Et({token:n,factory:n.\u0275fac})}return n})();class AM{eventManager;doc;ngZone;platformIsServer;tracingService;registry;maxAnimationTimeout;data=Object.create(null);throwOnSyntheticProps=!0;constructor(e,t,r,i,s,o,a){this.eventManager=e,this.doc=t,this.ngZone=r,this.platformIsServer=i,this.tracingService=s,this.registry=o,this.maxAnimationTimeout=a}destroy(){}destroyNode=null;createElement(e,t){return t?this.doc.createElementNS(SM[t]||t,e):this.doc.createElement(e)}createComment(e){return this.doc.createComment(e)}createText(e){return this.doc.createTextNode(e)}appendChild(e,t){(KG(e)?e.content:e).appendChild(t)}insertBefore(e,t,r){e&&(KG(e)?e.content:e).insertBefore(t,r)}removeChild(e,t){const{elements:r}=this.registry;r?r.animate(t,()=>t.remove(),this.maxAnimationTimeout):t.remove()}selectRootElement(e,t){let r="string"==typeof e?this.doc.querySelector(e):e;if(!r)throw new ue(-5104,!1);return t||(r.textContent=""),r}parentNode(e){return e.parentNode}nextSibling(e){return e.nextSibling}setAttribute(e,t,r,i){if(i){t=i+":"+t;const s=SM[i];s?e.setAttributeNS(s,t,r):e.setAttribute(t,r)}else e.setAttribute(t,r)}removeAttribute(e,t,r){if(r){const i=SM[r];i?e.removeAttributeNS(i,t):e.removeAttribute(`${r}:${t}`)}else e.removeAttribute(t)}addClass(e,t){e.classList.add(t)}removeClass(e,t){e.classList.remove(t)}setStyle(e,t,r,i){i&(Qa.DashCase|Qa.Important)?e.style.setProperty(t,r,i&Qa.Important?"important":""):e.style[t]=r}removeStyle(e,t,r){r&Qa.DashCase?e.style.removeProperty(t):e.style[t]=""}setProperty(e,t,r){null!=e&&(e[t]=r)}setValue(e,t){e.nodeValue=t}listen(e,t,r,i){if("string"==typeof e&&!(e=Gp().getGlobalEventTarget(this.doc,e)))throw new ue(5102,!1);let s=this.decoratePreventDefault(r);return this.tracingService?.wrapEventListener&&(s=this.tracingService.wrapEventListener(e,t,s)),this.eventManager.addEventListener(e,t,s,i)}decoratePreventDefault(e){return t=>{if("__ngUnwrap__"===t)return e;!1===e(t)&&t.preventDefault()}}}function KG(n){return"TEMPLATE"===n.tagName&&void 0!==n.content}class Npe extends AM{sharedStylesHost;hostEl;shadowRoot;constructor(e,t,r,i,s,o,a,c,l,u,d){super(e,s,o,c,l,u,d),this.sharedStylesHost=t,this.hostEl=r,this.shadowRoot=r.attachShadow({mode:"open"}),this.sharedStylesHost.addHost(this.shadowRoot);let h=i.styles;h=qG(i.id,h);for(const m of h){const y=document.createElement("style");a&&y.setAttribute("nonce",a),y.textContent=m,this.shadowRoot.appendChild(y)}const f=i.getExternalStyles?.();if(f)for(const m of f){const y=IM(m,s);a&&y.setAttribute("nonce",a),this.shadowRoot.appendChild(y)}}nodeOrShadowRoot(e){return e===this.hostEl?this.shadowRoot:e}appendChild(e,t){return super.appendChild(this.nodeOrShadowRoot(e),t)}insertBefore(e,t,r){return super.insertBefore(this.nodeOrShadowRoot(e),t,r)}removeChild(e,t){return super.removeChild(null,t)}parentNode(e){return this.nodeOrShadowRoot(super.parentNode(this.nodeOrShadowRoot(e)))}destroy(){this.sharedStylesHost.removeHost(this.shadowRoot)}}class MM extends AM{sharedStylesHost;removeStylesOnCompDestroy;styles;styleUrls;_animationDisabled;constructor(e,t,r,i,s,o,a,c,l,u,d,h){super(e,s,o,a,c,l,d),this.sharedStylesHost=t,this.removeStylesOnCompDestroy=i,this._animationDisabled=u;let f=r.styles;this.styles=h?qG(h,f):f,this.styleUrls=r.getExternalStyles?.(h)}applyStyles(){this.sharedStylesHost.addStyles(this.styles,this.styleUrls)}destroy(){if(this.removeStylesOnCompDestroy){if(!this._animationDisabled&&this.registry.elements)return void this.ngZone.runOutsideAngular(()=>{setTimeout(()=>{this.sharedStylesHost.removeStyles(this.styles,this.styleUrls)},this.maxAnimationTimeout)});this.sharedStylesHost.removeStyles(this.styles,this.styleUrls)}}}class YG extends MM{contentAttr;hostAttr;constructor(e,t,r,i,s,o,a,c,l,u,d,h){const f=i+"-"+r.id;super(e,t,r,s,o,a,c,l,u,d,h,f),this.contentAttr=function Dpe(n){return"_ngcontent-%COMP%".replace(xM,n)}(f),this.hostAttr=function Rpe(n){return"_nghost-%COMP%".replace(xM,n)}(f)}applyToHost(e){this.applyStyles(),this.setAttribute(e,this.hostAttr,"")}createElement(e,t){const r=super.createElement(e,t);return super.setAttribute(r,this.contentAttr,""),r}}class CM extends YQ{supportsDOMEvents=!0;static makeCurrent(){!function KQ(n){G2??=n}(new CM)}onAndCancel(e,t,r,i){return e.addEventListener(t,r,i),()=>{e.removeEventListener(t,r,i)}}dispatchEvent(e,t){e.dispatchEvent(t)}remove(e){e.remove()}createElement(e,t){return(t=t||this.getDefaultDocument()).createElement(e)}createHtmlDocument(){return document.implementation.createHTMLDocument("fakeTitle")}getDefaultDocument(){return document}isElementNode(e){return e.nodeType===Node.ELEMENT_NODE}isShadowRoot(e){return e instanceof DocumentFragment}getGlobalEventTarget(e,t){return"window"===t?window:"document"===t?e:"body"===t?e.body:null}getBaseHref(e){const t=function Ope(){return Xm=Xm||document.head.querySelector("base"),Xm?Xm.getAttribute("href"):null}();return null==t?null:function kpe(n){return new URL(n,document.baseURI).pathname}(t)}resetBaseElement(){Xm=null}getUserAgent(){return window.navigator.userAgent}getCookie(e){return W2(document.cookie,e)}}let Xm=null,Fpe=(()=>{class n{build(){return new XMLHttpRequest}static \u0275fac=function(r){return new(r||n)};static \u0275prov=Et({token:n,factory:n.\u0275fac})}return n})(),Vpe=(()=>{class n extends zG{constructor(t){super(t)}supports(t){return!0}addEventListener(t,r,i,s){return t.addEventListener(r,i,s),()=>this.removeEventListener(t,r,i,s)}removeEventListener(t,r,i,s){return t.removeEventListener(r,i,s)}static \u0275fac=function(r){return new(r||n)(Rt(Xo))};static \u0275prov=Et({token:n,factory:n.\u0275fac})}return n})();const JG=["alt","control","meta","shift"],Upe={"\b":"Backspace","\t":"Tab","\x7f":"Delete","\x1b":"Escape",Del:"Delete",Esc:"Escape",Left:"ArrowLeft",Right:"ArrowRight",Up:"ArrowUp",Down:"ArrowDown",Menu:"ContextMenu",Scroll:"ScrollLock",Win:"OS"},Bpe={alt:n=>n.altKey,control:n=>n.ctrlKey,meta:n=>n.metaKey,shift:n=>n.shiftKey};let Hpe=(()=>{class n extends zG{constructor(t){super(t)}supports(t){return null!=n.parseEventName(t)}addEventListener(t,r,i,s){const o=n.parseEventName(r),a=n.eventCallback(o.fullKey,i,this.manager.getZone());return this.manager.getZone().runOutsideAngular(()=>Gp().onAndCancel(t,o.domEventName,a,s))}static parseEventName(t){const r=t.toLowerCase().split("."),i=r.shift();if(0===r.length||"keydown"!==i&&"keyup"!==i)return null;const s=n._normalizeKey(r.pop());let o="",a=r.indexOf("code");if(a>-1&&(r.splice(a,1),o="code."),JG.forEach(l=>{const u=r.indexOf(l);u>-1&&(r.splice(u,1),o+=l+".")}),o+=s,0!=r.length||0===s.length)return null;const c={};return c.domEventName=i,c.fullKey=o,c}static matchEventFullKeyCode(t,r){let i=Upe[t.key]||t.key,s="";return r.indexOf("code.")>-1&&(i=t.code,s="code."),!(null==i||!i)&&(i=i.toLowerCase()," "===i?i="space":"."===i&&(i="dot"),JG.forEach(o=>{o!==i&&(0,Bpe[o])(t)&&(s+=o+".")}),s+=i,s===r)}static eventCallback(t,r,i){return s=>{n.matchEventFullKeyCode(s,t)&&i.runGuarded(()=>r(s))}}static _normalizeKey(t){return"esc"===t?"escape":t}static \u0275fac=function(r){return new(r||n)(Rt(Xo))};static \u0275prov=Et({token:n,factory:n.\u0275fac})}return n})();const jpe=Lz(jde,"browser",[{provide:Zp,useValue:"browser"},{provide:BV,useValue:function zpe(){CM.makeCurrent()},multi:!0},{provide:Xo,useFactory:function Wpe(){return function fte(n){AS=n}(document),document}}]),e5=[{provide:jv,useClass:class Lpe{addToWindow(e){Qn.getAngularTestability=(r,i=!0)=>{const s=e.findTestabilityInTree(r,i);if(null==s)throw new ue(5103,!1);return s},Qn.getAllAngularTestabilities=()=>e.getAllTestabilities(),Qn.getAllAngularRootElements=()=>e.getAllRootElements(),Qn.frameworkStabilizers||(Qn.frameworkStabilizers=[]),Qn.frameworkStabilizers.push(r=>{const i=Qn.getAllAngularTestabilities();let s=i.length;const o=function(){s--,0==s&&r()};i.forEach(a=>{a.whenStable(o)})})}findTestabilityInTree(e,t,r){return null==t?null:e.getTestability(t)??(r?Gp().isShadowRoot(t)?this.findTestabilityInTree(e,t.host,!0):this.findTestabilityInTree(e,t.parentElement,!0):null)}}},{provide:m4,useClass:cA,deps:[Vt,lA,jv]},{provide:cA,useClass:cA,deps:[Vt,lA,jv]}],t5=[{provide:zI,useValue:"root"},{provide:Cd,useFactory:function Gpe(){return new Cd}},{provide:TM,useClass:Vpe,multi:!0,deps:[Xo]},{provide:TM,useClass:Hpe,multi:!0,deps:[Xo]},XG,jG,HG,{provide:Dx,useExisting:XG},{provide:j2,useClass:Fpe},[]];let $pe=(()=>{class n{constructor(){}static \u0275fac=function(r){return new(r||n)};static \u0275mod=nc({type:n});static \u0275inj=Vo({providers:[...t5,...e5],imports:[ql,$de]})}return n})();function UE(n,e){var t={};for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&e.indexOf(r)<0&&(t[r]=n[r]);if(null!=n&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(n);i<r.length;i++)e.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(n,r[i])&&(t[r[i]]=n[r[i]])}return t}function uc(n){return this instanceof uc?(this.v=n,this):new uc(n)}function s5(n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t,e=n[Symbol.asyncIterator];return e?e.call(n):(n=function NM(n){var e="function"==typeof Symbol&&Symbol.iterator,t=e&&n[e],r=0;if(t)return t.call(n);if(n&&"number"==typeof n.length)return{next:function(){return n&&r>=n.length&&(n=void 0),{value:n&&n[r++],done:!n}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}(n),t={},r("next"),r("throw"),r("return"),t[Symbol.asyncIterator]=function(){return this},t);function r(s){t[s]=n[s]&&function(o){return new Promise(function(a,c){!function i(s,o,a,c){Promise.resolve(c).then(function(l){s({value:l,done:a})},o)}(a,c,(o=n[s](o)).done,o.value)})}}}"function"==typeof SuppressedError&&SuppressedError;const o5=n=>n&&"number"==typeof n.length&&"function"!=typeof n;function a5(n){return Zn(n?.then)}function c5(n){return Zn(n[wI])}function l5(n){return Symbol.asyncIterator&&Zn(n?.[Symbol.asyncIterator])}function u5(n){return new TypeError(`You provided ${null!==n&&"object"==typeof n?"an invalid object":`'${n}'`} where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.`)}const d5=function yme(){return"function"==typeof Symbol&&Symbol.iterator?Symbol.iterator:"@@iterator"}();function h5(n){return Zn(n?.[d5])}function f5(n){return function i5(n,e,t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var i,r=t.apply(n,e||[]),s=[];return i=Object.create(("function"==typeof AsyncIterator?AsyncIterator:Object).prototype),a("next"),a("throw"),a("return",function o(f){return function(m){return Promise.resolve(m).then(f,d)}}),i[Symbol.asyncIterator]=function(){return this},i;function a(f,m){r[f]&&(i[f]=function(y){return new Promise(function(_,g){s.push([f,y,_,g])>1||c(f,y)})},m&&(i[f]=m(i[f])))}function c(f,m){try{!function l(f){f.value instanceof uc?Promise.resolve(f.value.v).then(u,d):h(s[0][2],f)}(r[f](m))}catch(y){h(s[0][3],y)}}function u(f){c("next",f)}function d(f){c("throw",f)}function h(f,m){f(m),s.shift(),s.length&&c(s[0][0],s[0][1])}}(this,arguments,function*(){const t=n.getReader();try{for(;;){const{value:r,done:i}=yield uc(t.read());if(i)return yield uc(void 0);yield yield uc(r)}}finally{t.releaseLock()}})}function p5(n){return Zn(n?.getReader)}function dc(n){if(n instanceof jn)return n;if(null!=n){if(c5(n))return function vme(n){return new jn(e=>{const t=n[wI]();if(Zn(t.subscribe))return t.subscribe(e);throw new TypeError("Provided object does not correctly implement Symbol.observable")})}(n);if(o5(n))return function Eme(n){return new jn(e=>{for(let t=0;t<n.length&&!e.closed;t++)e.next(n[t]);e.complete()})}(n);if(a5(n))return function bme(n){return new jn(e=>{n.then(t=>{e.closed||(e.next(t),e.complete())},t=>e.error(t)).then(null,NF)})}(n);if(l5(n))return m5(n);if(h5(n))return function Tme(n){return new jn(e=>{for(const t of n)if(e.next(t),e.closed)return;e.complete()})}(n);if(p5(n))return function wme(n){return m5(f5(n))}(n)}throw u5(n)}function m5(n){return new jn(e=>{(function Ime(n,e){var t,r,i,s;return function n5(n,e,t,r){return new(t||(t=Promise))(function(s,o){function a(u){try{l(r.next(u))}catch(d){o(d)}}function c(u){try{l(r.throw(u))}catch(d){o(d)}}function l(u){u.done?s(u.value):function i(s){return s instanceof t?s:new t(function(o){o(s)})}(u.value).then(a,c)}l((r=r.apply(n,e||[])).next())})}(this,void 0,void 0,function*(){try{for(t=s5(n);!(r=yield t.next()).done;)if(e.next(r.value),e.closed)return}catch(o){i={error:o}}finally{try{r&&!r.done&&(s=t.return)&&(yield s.call(t))}finally{if(i)throw i.error}}e.complete()})})(n,e).catch(t=>e.error(t))})}function hc(n,e,t,r=0,i=!1){const s=e.schedule(function(){t(),i?n.add(this.schedule(null,r)):this.unsubscribe()},r);if(n.add(s),!i)return s}function BE(n,e=0){return Ss((t,r)=>{t.subscribe(os(r,i=>hc(r,n,()=>r.next(i),e),()=>hc(r,n,()=>r.complete(),e),i=>hc(r,n,()=>r.error(i),e)))})}function HE(n,e=0){return Ss((t,r)=>{r.add(n.schedule(()=>t.subscribe(r),e))})}function g5(n,e){if(!n)throw new Error("Iterable cannot be null");return new jn(t=>{hc(t,e,()=>{const r=n[Symbol.asyncIterator]();hc(t,e,()=>{r.next().then(i=>{i.done?t.complete():t.next(i.value)})},0,!0)})})}function kM(n,e){return e?function Dme(n,e){if(null!=n){if(c5(n))return function Sme(n,e){return dc(n).pipe(HE(e),BE(e))}(n,e);if(o5(n))return function Ame(n,e){return new jn(t=>{let r=0;return e.schedule(function(){r===n.length?t.complete():(t.next(n[r++]),t.closed||this.schedule())})})}(n,e);if(a5(n))return function xme(n,e){return dc(n).pipe(HE(e),BE(e))}(n,e);if(l5(n))return g5(n,e);if(h5(n))return function Mme(n,e){return new jn(t=>{let r;return hc(t,e,()=>{r=n[d5](),hc(t,e,()=>{let i,s;try{({value:i,done:s}=r.next())}catch(o){return void t.error(o)}s?t.complete():t.next(i)},0,!0)}),()=>Zn(r?.return)&&r.return()})}(n,e);if(p5(n))return function Cme(n,e){return g5(f5(n),e)}(n,e)}throw u5(n)}(n,e):dc(n)}const{isArray:Rme}=Array,{getPrototypeOf:Pme,prototype:Nme,keys:Ome}=Object;function LM(n){return n[n.length-1]}const{isArray:Bme}=Array;function Gme(n,e){return n.reduce((t,r,i)=>(t[r]=e[i],t),{})}function Wme(...n){const e=function Vme(n){return Zn(LM(n))?n.pop():void 0}(n),{args:t,keys:r}=function kme(n){if(1===n.length){const e=n[0];if(Rme(e))return{args:e,keys:null};if(function Lme(n){return n&&"object"==typeof n&&Pme(n)===Nme}(e)){const t=Ome(e);return{args:t.map(r=>e[r]),keys:t}}}return{args:n,keys:null}}(n),i=new jn(s=>{const{length:o}=t;if(!o)return void s.complete();const a=new Array(o);let c=o,l=o;for(let u=0;u<o;u++){let d=!1;dc(t[u]).subscribe(os(s,h=>{d||(d=!0,l--),a[u]=h},()=>c--,void 0,()=>{(!c||!d)&&(l||s.next(r?Gme(r,a):a),s.complete())}))}});return e?i.pipe(function zme(n){return Hs(e=>function Hme(n,e){return Bme(e)?n(...e):n(e)}(n,e))}(e)):i}let _5=(()=>{class n{_renderer;_elementRef;onChange=t=>{};onTouched=()=>{};constructor(t,r){this._renderer=t,this._elementRef=r}setProperty(t,r){this._renderer.setProperty(this._elementRef.nativeElement,t,r)}registerOnTouched(t){this.onTouched=t}registerOnChange(t){this.onChange=t}setDisabledState(t){this.setProperty("disabled",t)}static \u0275fac=function(r){return new(r||n)(Me(Nl),Me(zs))};static \u0275dir=At({type:n})}return n})(),Xl=(()=>{class n extends _5{static \u0275fac=(()=>{let t;return function(i){return(t||(t=function di(n){return Yo(()=>{const e=n.prototype.constructor,t=e[fl]||ES(e),r=Object.prototype;let i=Object.getPrototypeOf(n.prototype).constructor;for(;i&&i!==r;){const s=i[fl]||ES(i);if(s&&s!==t)return s;i=Object.getPrototypeOf(i)}return s=>new s})}(n)))(i||n)}})();static \u0275dir=At({type:n,features:[rn]})}return n})();const go=new Ae(""),$me={provide:go,useExisting:bn(()=>zE),multi:!0},Xme=new Ae("");let zE=(()=>{class n extends _5{_compositionMode;_composing=!1;constructor(t,r,i){super(t,r),this._compositionMode=i,null==this._compositionMode&&(this._compositionMode=!function qme(){const n=Gp()?Gp().getUserAgent():"";return/android (\d+)/.test(n.toLowerCase())}())}writeValue(t){this.setProperty("value",t??"")}_handleInput(t){(!this._compositionMode||this._compositionMode&&!this._composing)&&this.onChange(t)}_compositionStart(){this._composing=!0}_compositionEnd(t){this._composing=!1,this._compositionMode&&this.onChange(t)}static \u0275fac=function(r){return new(r||n)(Me(Nl),Me(zs),Me(Xme,8))};static \u0275dir=At({type:n,selectors:[["input","formControlName","",3,"type","checkbox"],["textarea","formControlName",""],["input","formControl","",3,"type","checkbox"],["textarea","formControl",""],["input","ngModel","",3,"type","checkbox"],["textarea","ngModel",""],["","ngDefaultControl",""]],hostBindings:function(r,i){1&r&&Gt("input",function(o){return i._handleInput(o.target.value)})("blur",function(){return i.onTouched()})("compositionstart",function(){return i._compositionStart()})("compositionend",function(o){return i._compositionEnd(o.target.value)})},standalone:!1,features:[Un([$me]),rn]})}return n})();function FM(n){return null==n||0===VM(n)}function VM(n){return null==n?null:Array.isArray(n)||"string"==typeof n?n.length:n instanceof Set?n.size:null}const fi=new Ae(""),fc=new Ae(""),Kme=/^(?=.{1,254}$)(?=.{1,64}@)[a-zA-Z0-9!#$%&'*+/=?^_`{|}~-]+(?:\.[a-zA-Z0-9!#$%&'*+/=?^_`{|}~-]+)*@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/;class v5{static min(e){return function E5(n){return e=>{if(null==e.value||null==n)return null;const t=parseFloat(e.value);return!isNaN(t)&&t<n?{min:{min:n,actual:e.value}}:null}}(e)}static max(e){return function b5(n){return e=>{if(null==e.value||null==n)return null;const t=parseFloat(e.value);return!isNaN(t)&&t>n?{max:{max:n,actual:e.value}}:null}}(e)}static required(e){return function T5(n){return FM(n.value)?{required:!0}:null}(e)}static requiredTrue(e){return function w5(n){return!0===n.value?null:{required:!0}}(e)}static email(e){return function I5(n){return FM(n.value)||Kme.test(n.value)?null:{email:!0}}(e)}static minLength(e){return function S5(n){return e=>{const t=e.value?.length??VM(e.value);return null===t||0===t?null:t<n?{minlength:{requiredLength:n,actualLength:t}}:null}}(e)}static maxLength(e){return function x5(n){return e=>{const t=e.value?.length??VM(e.value);return null!==t&&t>n?{maxlength:{requiredLength:n,actualLength:t}}:null}}(e)}static pattern(e){return function A5(n){if(!n)return GE;let e,t;return"string"==typeof n?(t="","^"!==n.charAt(0)&&(t+="^"),t+=n,"$"!==n.charAt(n.length-1)&&(t+="$"),e=new RegExp(t)):(t=n.toString(),e=n),r=>{if(FM(r.value))return null;const i=r.value;return e.test(i)?null:{pattern:{requiredPattern:t,actualValue:i}}}}(e)}static nullValidator(e){return null}static compose(e){return N5(e)}static composeAsync(e){return O5(e)}}function GE(n){return null}function M5(n){return null!=n}function C5(n){return $v(n)?kM(n):n}function D5(n){let e={};return n.forEach(t=>{e=null!=t?{...e,...t}:e}),0===Object.keys(e).length?null:e}function R5(n,e){return e.map(t=>t(n))}function P5(n){return n.map(e=>function Yme(n){return!n.validate}(e)?e:t=>e.validate(t))}function N5(n){if(!n)return null;const e=n.filter(M5);return 0==e.length?null:function(t){return D5(R5(t,e))}}function UM(n){return null!=n?N5(P5(n)):null}function O5(n){if(!n)return null;const e=n.filter(M5);return 0==e.length?null:function(t){return Wme(R5(t,e).map(C5)).pipe(Hs(D5))}}function BM(n){return null!=n?O5(P5(n)):null}function k5(n,e){return null===n?[e]:Array.isArray(n)?[...n,e]:[n,e]}function L5(n){return n._rawValidators}function F5(n){return n._rawAsyncValidators}function HM(n){return n?Array.isArray(n)?n:[n]:[]}function WE(n,e){return Array.isArray(n)?n.includes(e):n===e}function V5(n,e){const t=HM(e);return HM(n).forEach(i=>{WE(t,i)||t.push(i)}),t}function U5(n,e){return HM(e).filter(t=>!WE(n,t))}class B5{get value(){return this.control?this.control.value:null}get valid(){return this.control?this.control.valid:null}get invalid(){return this.control?this.control.invalid:null}get pending(){return this.control?this.control.pending:null}get disabled(){return this.control?this.control.disabled:null}get enabled(){return this.control?this.control.enabled:null}get errors(){return this.control?this.control.errors:null}get pristine(){return this.control?this.control.pristine:null}get dirty(){return this.control?this.control.dirty:null}get touched(){return this.control?this.control.touched:null}get status(){return this.control?this.control.status:null}get untouched(){return this.control?this.control.untouched:null}get statusChanges(){return this.control?this.control.statusChanges:null}get valueChanges(){return this.control?this.control.valueChanges:null}get path(){return null}_composedValidatorFn;_composedAsyncValidatorFn;_rawValidators=[];_rawAsyncValidators=[];_setValidators(e){this._rawValidators=e||[],this._composedValidatorFn=UM(this._rawValidators)}_setAsyncValidators(e){this._rawAsyncValidators=e||[],this._composedAsyncValidatorFn=BM(this._rawAsyncValidators)}get validator(){return this._composedValidatorFn||null}get asyncValidator(){return this._composedAsyncValidatorFn||null}_onDestroyCallbacks=[];_registerOnDestroy(e){this._onDestroyCallbacks.push(e)}_invokeOnDestroyCallbacks(){this._onDestroyCallbacks.forEach(e=>e()),this._onDestroyCallbacks=[]}reset(e=void 0){this.control&&this.control.reset(e)}hasError(e,t){return!!this.control&&this.control.hasError(e,t)}getError(e,t){return this.control?this.control.getError(e,t):null}}class Mi extends B5{name;get formDirective(){return null}get path(){return null}}class pc extends B5{_parent=null;name=null;valueAccessor=null}class H5{_cd;constructor(e){this._cd=e}get isTouched(){return this._cd?.control?._touched?.(),!!this._cd?.control?.touched}get isUntouched(){return!!this._cd?.control?.untouched}get isPristine(){return this._cd?.control?._pristine?.(),!!this._cd?.control?.pristine}get isDirty(){return!!this._cd?.control?.dirty}get isValid(){return this._cd?.control?._status?.(),!!this._cd?.control?.valid}get isInvalid(){return!!this._cd?.control?.invalid}get isPending(){return!!this._cd?.control?.pending}get isSubmitted(){return this._cd?._submitted?.(),!!this._cd?.submitted}}let z5=(()=>{class n extends H5{constructor(t){super(t)}static \u0275fac=function(r){return new(r||n)(Me(pc,2))};static \u0275dir=At({type:n,selectors:[["","formControlName",""],["","ngModel",""],["","formControl",""]],hostVars:14,hostBindings:function(r,i){2&r&&lE("ng-untouched",i.isUntouched)("ng-touched",i.isTouched)("ng-pristine",i.isPristine)("ng-dirty",i.isDirty)("ng-valid",i.isValid)("ng-invalid",i.isInvalid)("ng-pending",i.isPending)},standalone:!1,features:[rn]})}return n})(),G5=(()=>{class n extends H5{constructor(t){super(t)}static \u0275fac=function(r){return new(r||n)(Me(Mi,10))};static \u0275dir=At({type:n,selectors:[["","formGroupName",""],["","formArrayName",""],["","ngModelGroup",""],["","formGroup",""],["form",3,"ngNoForm",""],["","ngForm",""]],hostVars:16,hostBindings:function(r,i){2&r&&lE("ng-untouched",i.isUntouched)("ng-touched",i.isTouched)("ng-pristine",i.isPristine)("ng-dirty",i.isDirty)("ng-valid",i.isValid)("ng-invalid",i.isInvalid)("ng-pending",i.isPending)("ng-submitted",i.isSubmitted)},standalone:!1,features:[rn]})}return n})();const Km="VALID",$E="INVALID",yh="PENDING",Ym="DISABLED";class vh{}class j5 extends vh{value;source;constructor(e,t){super(),this.value=e,this.source=t}}class WM extends vh{pristine;source;constructor(e,t){super(),this.pristine=e,this.source=t}}class jM extends vh{touched;source;constructor(e,t){super(),this.touched=e,this.source=t}}class qE extends vh{status;source;constructor(e,t){super(),this.status=e,this.source=t}}class $5 extends vh{source;constructor(e){super(),this.source=e}}class q5 extends vh{source;constructor(e){super(),this.source=e}}function $M(n){return(XE(n)?n.validators:n)||null}function qM(n,e){return(XE(e)?e.asyncValidators:n)||null}function XE(n){return null!=n&&!Array.isArray(n)&&"object"==typeof n}class XM{_pendingDirty=!1;_hasOwnPendingAsyncValidator=null;_pendingTouched=!1;_onCollectionChange=()=>{};_updateOn;_parent=null;_asyncValidationSubscription;_composedValidatorFn;_composedAsyncValidatorFn;_rawValidators;_rawAsyncValidators;value;constructor(e,t){this._assignValidators(e),this._assignAsyncValidators(t)}get validator(){return this._composedValidatorFn}set validator(e){this._rawValidators=this._composedValidatorFn=e}get asyncValidator(){return this._composedAsyncValidatorFn}set asyncValidator(e){this._rawAsyncValidators=this._composedAsyncValidatorFn=e}get parent(){return this._parent}get status(){return br(this.statusReactive)}set status(e){br(()=>this.statusReactive.set(e))}_status=Ws(()=>this.statusReactive());statusReactive=Il(void 0);get valid(){return this.status===Km}get invalid(){return this.status===$E}get pending(){return this.status==yh}get disabled(){return this.status===Ym}get enabled(){return this.status!==Ym}errors;get pristine(){return br(this.pristineReactive)}set pristine(e){br(()=>this.pristineReactive.set(e))}_pristine=Ws(()=>this.pristineReactive());pristineReactive=Il(!0);get dirty(){return!this.pristine}get touched(){return br(this.touchedReactive)}set touched(e){br(()=>this.touchedReactive.set(e))}_touched=Ws(()=>this.touchedReactive());touchedReactive=Il(!1);get untouched(){return!this.touched}_events=new gd;events=this._events.asObservable();valueChanges;statusChanges;get updateOn(){return this._updateOn?this._updateOn:this.parent?this.parent.updateOn:"change"}setValidators(e){this._assignValidators(e)}setAsyncValidators(e){this._assignAsyncValidators(e)}addValidators(e){this.setValidators(V5(e,this._rawValidators))}addAsyncValidators(e){this.setAsyncValidators(V5(e,this._rawAsyncValidators))}removeValidators(e){this.setValidators(U5(e,this._rawValidators))}removeAsyncValidators(e){this.setAsyncValidators(U5(e,this._rawAsyncValidators))}hasValidator(e){return WE(this._rawValidators,e)}hasAsyncValidator(e){return WE(this._rawAsyncValidators,e)}clearValidators(){this.validator=null}clearAsyncValidators(){this.asyncValidator=null}markAsTouched(e={}){const t=!1===this.touched;this.touched=!0;const r=e.sourceControl??this;this._parent&&!e.onlySelf&&this._parent.markAsTouched({...e,sourceControl:r}),t&&!1!==e.emitEvent&&this._events.next(new jM(!0,r))}markAllAsDirty(e={}){this.markAsDirty({onlySelf:!0,emitEvent:e.emitEvent,sourceControl:this}),this._forEachChild(t=>t.markAllAsDirty(e))}markAllAsTouched(e={}){this.markAsTouched({onlySelf:!0,emitEvent:e.emitEvent,sourceControl:this}),this._forEachChild(t=>t.markAllAsTouched(e))}markAsUntouched(e={}){const t=!0===this.touched;this.touched=!1,this._pendingTouched=!1;const r=e.sourceControl??this;this._forEachChild(i=>{i.markAsUntouched({onlySelf:!0,emitEvent:e.emitEvent,sourceControl:r})}),this._parent&&!e.onlySelf&&this._parent._updateTouched(e,r),t&&!1!==e.emitEvent&&this._events.next(new jM(!1,r))}markAsDirty(e={}){const t=!0===this.pristine;this.pristine=!1;const r=e.sourceControl??this;this._parent&&!e.onlySelf&&this._parent.markAsDirty({...e,sourceControl:r}),t&&!1!==e.emitEvent&&this._events.next(new WM(!1,r))}markAsPristine(e={}){const t=!1===this.pristine;this.pristine=!0,this._pendingDirty=!1;const r=e.sourceControl??this;this._forEachChild(i=>{i.markAsPristine({onlySelf:!0,emitEvent:e.emitEvent})}),this._parent&&!e.onlySelf&&this._parent._updatePristine(e,r),t&&!1!==e.emitEvent&&this._events.next(new WM(!0,r))}markAsPending(e={}){this.status=yh;const t=e.sourceControl??this;!1!==e.emitEvent&&(this._events.next(new qE(this.status,t)),this.statusChanges.emit(this.status)),this._parent&&!e.onlySelf&&this._parent.markAsPending({...e,sourceControl:t})}disable(e={}){const t=this._parentMarkedDirty(e.onlySelf);this.status=Ym,this.errors=null,this._forEachChild(i=>{i.disable({...e,onlySelf:!0})}),this._updateValue();const r=e.sourceControl??this;!1!==e.emitEvent&&(this._events.next(new j5(this.value,r)),this._events.next(new qE(this.status,r)),this.valueChanges.emit(this.value),this.statusChanges.emit(this.status)),this._updateAncestors({...e,skipPristineCheck:t},this),this._onDisabledChange.forEach(i=>i(!0))}enable(e={}){const t=this._parentMarkedDirty(e.onlySelf);this.status=Km,this._forEachChild(r=>{r.enable({...e,onlySelf:!0})}),this.updateValueAndValidity({onlySelf:!0,emitEvent:e.emitEvent}),this._updateAncestors({...e,skipPristineCheck:t},this),this._onDisabledChange.forEach(r=>r(!1))}_updateAncestors(e,t){this._parent&&!e.onlySelf&&(this._parent.updateValueAndValidity(e),e.skipPristineCheck||this._parent._updatePristine({},t),this._parent._updateTouched({},t))}setParent(e){this._parent=e}getRawValue(){return this.value}updateValueAndValidity(e={}){if(this._setInitialStatus(),this._updateValue(),this.enabled){const r=this._cancelExistingSubscription();this.errors=this._runValidator(),this.status=this._calculateStatus(),(this.status===Km||this.status===yh)&&this._runAsyncValidator(r,e.emitEvent)}const t=e.sourceControl??this;!1!==e.emitEvent&&(this._events.next(new j5(this.value,t)),this._events.next(new qE(this.status,t)),this.valueChanges.emit(this.value),this.statusChanges.emit(this.status)),this._parent&&!e.onlySelf&&this._parent.updateValueAndValidity({...e,sourceControl:t})}_updateTreeValidity(e={emitEvent:!0}){this._forEachChild(t=>t._updateTreeValidity(e)),this.updateValueAndValidity({onlySelf:!0,emitEvent:e.emitEvent})}_setInitialStatus(){this.status=this._allControlsDisabled()?Ym:Km}_runValidator(){return this.validator?this.validator(this):null}_runAsyncValidator(e,t){if(this.asyncValidator){this.status=yh,this._hasOwnPendingAsyncValidator={emitEvent:!1!==t,shouldHaveEmitted:!1!==e};const r=C5(this.asyncValidator(this));this._asyncValidationSubscription=r.subscribe(i=>{this._hasOwnPendingAsyncValidator=null,this.setErrors(i,{emitEvent:t,shouldHaveEmitted:e})})}}_cancelExistingSubscription(){if(this._asyncValidationSubscription){this._asyncValidationSubscription.unsubscribe();const e=(this._hasOwnPendingAsyncValidator?.emitEvent||this._hasOwnPendingAsyncValidator?.shouldHaveEmitted)??!1;return this._hasOwnPendingAsyncValidator=null,e}return!1}setErrors(e,t={}){this.errors=e,this._updateControlsErrors(!1!==t.emitEvent,this,t.shouldHaveEmitted)}get(e){let t=e;return null==t||(Array.isArray(t)||(t=t.split(".")),0===t.length)?null:t.reduce((r,i)=>r&&r._find(i),this)}getError(e,t){const r=t?this.get(t):this;return r&&r.errors?r.errors[e]:null}hasError(e,t){return!!this.getError(e,t)}get root(){let e=this;for(;e._parent;)e=e._parent;return e}_updateControlsErrors(e,t,r){this.status=this._calculateStatus(),e&&this.statusChanges.emit(this.status),(e||r)&&this._events.next(new qE(this.status,t)),this._parent&&this._parent._updateControlsErrors(e,t,r)}_initObservables(){this.valueChanges=new Er,this.statusChanges=new Er}_calculateStatus(){return this._allControlsDisabled()?Ym:this.errors?$E:this._hasOwnPendingAsyncValidator||this._anyControlsHaveStatus(yh)?yh:this._anyControlsHaveStatus($E)?$E:Km}_anyControlsHaveStatus(e){return this._anyControls(t=>t.status===e)}_anyControlsDirty(){return this._anyControls(e=>e.dirty)}_anyControlsTouched(){return this._anyControls(e=>e.touched)}_updatePristine(e,t){const r=!this._anyControlsDirty(),i=this.pristine!==r;this.pristine=r,this._parent&&!e.onlySelf&&this._parent._updatePristine(e,t),i&&this._events.next(new WM(this.pristine,t))}_updateTouched(e={},t){this.touched=this._anyControlsTouched(),this._events.next(new jM(this.touched,t)),this._parent&&!e.onlySelf&&this._parent._updateTouched(e,t)}_onDisabledChange=[];_registerOnCollectionChange(e){this._onCollectionChange=e}_setUpdateStrategy(e){XE(e)&&null!=e.updateOn&&(this._updateOn=e.updateOn)}_parentMarkedDirty(e){return!e&&!(!this._parent||!this._parent.dirty)&&!this._parent._anyControlsDirty()}_find(e){return null}_assignValidators(e){this._rawValidators=Array.isArray(e)?e.slice():e,this._composedValidatorFn=function rge(n){return Array.isArray(n)?UM(n):n||null}(this._rawValidators)}_assignAsyncValidators(e){this._rawAsyncValidators=Array.isArray(e)?e.slice():e,this._composedAsyncValidatorFn=function ige(n){return Array.isArray(n)?BM(n):n||null}(this._rawAsyncValidators)}}class KE extends XM{constructor(e,t,r){super($M(t),qM(r,t)),this.controls=e,this._initObservables(),this._setUpdateStrategy(t),this._setUpControls(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator})}controls;registerControl(e,t){return this.controls[e]?this.controls[e]:(this.controls[e]=t,t.setParent(this),t._registerOnCollectionChange(this._onCollectionChange),t)}addControl(e,t,r={}){this.registerControl(e,t),this.updateValueAndValidity({emitEvent:r.emitEvent}),this._onCollectionChange()}removeControl(e,t={}){this.controls[e]&&this.controls[e]._registerOnCollectionChange(()=>{}),delete this.controls[e],this.updateValueAndValidity({emitEvent:t.emitEvent}),this._onCollectionChange()}setControl(e,t,r={}){this.controls[e]&&this.controls[e]._registerOnCollectionChange(()=>{}),delete this.controls[e],t&&this.registerControl(e,t),this.updateValueAndValidity({emitEvent:r.emitEvent}),this._onCollectionChange()}contains(e){return this.controls.hasOwnProperty(e)&&this.controls[e].enabled}setValue(e,t={}){(function K5(n,e,t){n._forEachChild((r,i)=>{if(void 0===t[i])throw new ue(1002,"")})})(this,0,e),Object.keys(e).forEach(r=>{(function X5(n,e,t){const r=n.controls;if(!(e?Object.keys(r):r).length)throw new ue(1e3,"");if(!r[t])throw new ue(1001,"")})(this,!0,r),this.controls[r].setValue(e[r],{onlySelf:!0,emitEvent:t.emitEvent})}),this.updateValueAndValidity(t)}patchValue(e,t={}){null!=e&&(Object.keys(e).forEach(r=>{const i=this.controls[r];i&&i.patchValue(e[r],{onlySelf:!0,emitEvent:t.emitEvent})}),this.updateValueAndValidity(t))}reset(e={},t={}){this._forEachChild((r,i)=>{r.reset(e?e[i]:null,{onlySelf:!0,emitEvent:t.emitEvent})}),this._updatePristine(t,this),this._updateTouched(t,this),this.updateValueAndValidity(t)}getRawValue(){return this._reduceChildren({},(e,t,r)=>(e[r]=t.getRawValue(),e))}_syncPendingControls(){let e=this._reduceChildren(!1,(t,r)=>!!r._syncPendingControls()||t);return e&&this.updateValueAndValidity({onlySelf:!0}),e}_forEachChild(e){Object.keys(this.controls).forEach(t=>{const r=this.controls[t];r&&e(r,t)})}_setUpControls(){this._forEachChild(e=>{e.setParent(this),e._registerOnCollectionChange(this._onCollectionChange)})}_updateValue(){this.value=this._reduceValue()}_anyControls(e){for(const[t,r]of Object.entries(this.controls))if(this.contains(t)&&e(r))return!0;return!1}_reduceValue(){return this._reduceChildren({},(t,r,i)=>((r.enabled||this.disabled)&&(t[i]=r.value),t))}_reduceChildren(e,t){let r=e;return this._forEachChild((i,s)=>{r=t(r,i,s)}),r}_allControlsDisabled(){for(const e of Object.keys(this.controls))if(this.controls[e].enabled)return!1;return Object.keys(this.controls).length>0||this.disabled}_find(e){return this.controls.hasOwnProperty(e)?this.controls[e]:null}}const Eh=new Ae("",{providedIn:"root",factory:()=>YE}),YE="always";function Jm(n,e,t=YE){KM(n,e),e.valueAccessor.writeValue(n.value),(n.disabled||"always"===t)&&e.valueAccessor.setDisabledState?.(n.disabled),function age(n,e){e.valueAccessor.registerOnChange(t=>{n._pendingValue=t,n._pendingChange=!0,n._pendingDirty=!0,"change"===n.updateOn&&Y5(n,e)})}(n,e),function lge(n,e){const t=(r,i)=>{e.valueAccessor.writeValue(r),i&&e.viewToModelUpdate(r)};n.registerOnChange(t),e._registerOnDestroy(()=>{n._unregisterOnChange(t)})}(n,e),function cge(n,e){e.valueAccessor.registerOnTouched(()=>{n._pendingTouched=!0,"blur"===n.updateOn&&n._pendingChange&&Y5(n,e),"submit"!==n.updateOn&&n.markAsTouched()})}(n,e),function oge(n,e){if(e.valueAccessor.setDisabledState){const t=r=>{e.valueAccessor.setDisabledState(r)};n.registerOnDisabledChange(t),e._registerOnDestroy(()=>{n._unregisterOnDisabledChange(t)})}}(n,e)}function ZE(n,e,t=!0){const r=()=>{};e.valueAccessor&&(e.valueAccessor.registerOnChange(r),e.valueAccessor.registerOnTouched(r)),e0(n,e),n&&(e._invokeOnDestroyCallbacks(),n._registerOnCollectionChange(()=>{}))}function QE(n,e){n.forEach(t=>{t.registerOnValidatorChange&&t.registerOnValidatorChange(e)})}function KM(n,e){const t=L5(n);null!==e.validator?n.setValidators(k5(t,e.validator)):"function"==typeof t&&n.setValidators([t]);const r=F5(n);null!==e.asyncValidator?n.setAsyncValidators(k5(r,e.asyncValidator)):"function"==typeof r&&n.setAsyncValidators([r]);const i=()=>n.updateValueAndValidity();QE(e._rawValidators,i),QE(e._rawAsyncValidators,i)}function e0(n,e){let t=!1;if(null!==n){if(null!==e.validator){const i=L5(n);if(Array.isArray(i)&&i.length>0){const s=i.filter(o=>o!==e.validator);s.length!==i.length&&(t=!0,n.setValidators(s))}}if(null!==e.asyncValidator){const i=F5(n);if(Array.isArray(i)&&i.length>0){const s=i.filter(o=>o!==e.asyncValidator);s.length!==i.length&&(t=!0,n.setAsyncValidators(s))}}}const r=()=>{};return QE(e._rawValidators,r),QE(e._rawAsyncValidators,r),t}function Y5(n,e){n._pendingDirty&&n.markAsDirty(),n.setValue(n._pendingValue,{emitModelToViewChange:!1}),e.viewToModelUpdate(n._pendingValue),n._pendingChange=!1}function Q5(n,e){const t=n.indexOf(e);t>-1&&n.splice(t,1)}function e6(n){return"object"==typeof n&&null!==n&&2===Object.keys(n).length&&"value"in n&&"disabled"in n}Promise.resolve();const QM=class extends XM{defaultValue=null;_onChange=[];_pendingValue;_pendingChange=!1;constructor(e=null,t,r){super($M(t),qM(r,t)),this._applyFormState(e),this._setUpdateStrategy(t),this._initObservables(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator}),XE(t)&&(t.nonNullable||t.initialValueIsDefault)&&(this.defaultValue=e6(e)?e.value:e)}setValue(e,t={}){this.value=this._pendingValue=e,this._onChange.length&&!1!==t.emitModelToViewChange&&this._onChange.forEach(r=>r(this.value,!1!==t.emitViewToModelChange)),this.updateValueAndValidity(t)}patchValue(e,t={}){this.setValue(e,t)}reset(e=this.defaultValue,t={}){this._applyFormState(e),this.markAsPristine(t),this.markAsUntouched(t),this.setValue(this.value,t),this._pendingChange=!1}_updateValue(){}_anyControls(e){return!1}_allControlsDisabled(){return this.disabled}registerOnChange(e){this._onChange.push(e)}_unregisterOnChange(e){Q5(this._onChange,e)}registerOnDisabledChange(e){this._onDisabledChange.push(e)}_unregisterOnDisabledChange(e){Q5(this._onDisabledChange,e)}_forEachChild(e){}_syncPendingControls(){return!("submit"!==this.updateOn||(this._pendingDirty&&this.markAsDirty(),this._pendingTouched&&this.markAsTouched(),!this._pendingChange)||(this.setValue(this._pendingValue,{onlySelf:!0,emitModelToViewChange:!1}),0))}_applyFormState(e){e6(e)?(this.value=this._pendingValue=e.value,e.disabled?this.disable({onlySelf:!0,emitEvent:!1}):this.enable({onlySelf:!0,emitEvent:!1})):this.value=this._pendingValue=e}};Promise.resolve();let r6=(()=>{class n{static \u0275fac=function(r){return new(r||n)};static \u0275dir=At({type:n,selectors:[["form",3,"ngNoForm","",3,"ngNativeValidate",""]],hostAttrs:["novalidate",""],standalone:!1})}return n})();const eC=new Ae(""),Sge={provide:Mi,useExisting:bn(()=>Qm)};let Qm=(()=>{class n extends Mi{callSetDisabledState;get submitted(){return br(this._submittedReactive)}set submitted(t){this._submittedReactive.set(t)}_submitted=Ws(()=>this._submittedReactive());_submittedReactive=Il(!1);_oldForm;_onCollectionChange=()=>this._updateDomValue();directives=[];form=null;ngSubmit=new Er;constructor(t,r,i){super(),this.callSetDisabledState=i,this._setValidators(t),this._setAsyncValidators(r)}ngOnChanges(t){t.hasOwnProperty("form")&&(this._updateValidators(),this._updateDomValue(),this._updateRegistrations(),this._oldForm=this.form)}ngOnDestroy(){this.form&&(e0(this.form,this),this.form._onCollectionChange===this._onCollectionChange&&this.form._registerOnCollectionChange(()=>{}))}get formDirective(){return this}get control(){return this.form}get path(){return[]}addControl(t){const r=this.form.get(t.path);return Jm(r,t,this.callSetDisabledState),r.updateValueAndValidity({emitEvent:!1}),this.directives.push(t),r}getControl(t){return this.form.get(t.path)}removeControl(t){ZE(t.control||null,t,!1),function fge(n,e){const t=n.indexOf(e);t>-1&&n.splice(t,1)}(this.directives,t)}addFormGroup(t){this._setUpFormContainer(t)}removeFormGroup(t){this._cleanUpFormContainer(t)}getFormGroup(t){return this.form.get(t.path)}addFormArray(t){this._setUpFormContainer(t)}removeFormArray(t){this._cleanUpFormContainer(t)}getFormArray(t){return this.form.get(t.path)}updateModel(t,r){this.form.get(t.path).setValue(r)}onSubmit(t){return this._submittedReactive.set(!0),function Z5(n,e){n._syncPendingControls(),e.forEach(t=>{const r=t.control;"submit"===r.updateOn&&r._pendingChange&&(t.viewToModelUpdate(r._pendingValue),r._pendingChange=!1)})}(this.form,this.directives),this.ngSubmit.emit(t),this.form._events.next(new $5(this.control)),"dialog"===t?.target?.method}onReset(){this.resetForm()}resetForm(t=void 0,r={}){this.form.reset(t,r),this._submittedReactive.set(!1),!1!==r?.emitEvent&&this.form._events.next(new q5(this.form))}_updateDomValue(){this.directives.forEach(t=>{const r=t.control,i=this.form.get(t.path);r!==i&&(ZE(r||null,t),(n=>n instanceof QM)(i)&&(Jm(i,t,this.callSetDisabledState),t.control=i))}),this.form._updateTreeValidity({emitEvent:!1})}_setUpFormContainer(t){const r=this.form.get(t.path);(function J5(n,e){KM(n,e)})(r,t),r.updateValueAndValidity({emitEvent:!1})}_cleanUpFormContainer(t){if(this.form){const r=this.form.get(t.path);r&&function uge(n,e){return e0(n,e)}(r,t)&&r.updateValueAndValidity({emitEvent:!1})}}_updateRegistrations(){this.form._registerOnCollectionChange(this._onCollectionChange),this._oldForm&&this._oldForm._registerOnCollectionChange(()=>{})}_updateValidators(){KM(this.form,this),this._oldForm&&e0(this._oldForm,this)}static \u0275fac=function(r){return new(r||n)(Me(fi,10),Me(fc,10),Me(Eh,8))};static \u0275dir=At({type:n,selectors:[["","formGroup",""]],hostBindings:function(r,i){1&r&&Gt("submit",function(o){return i.onSubmit(o)})("reset",function(){return i.onReset()})},inputs:{form:[0,"formGroup","form"]},outputs:{ngSubmit:"ngSubmit"},exportAs:["ngForm"],standalone:!1,features:[Un([Sge]),rn,Xa]})}return n})();const Mge={provide:pc,useExisting:bn(()=>tC)};let tC=(()=>{class n extends pc{_ngModelWarningConfig;_added=!1;viewModel;control;name=null;set isDisabled(t){}model;update=new Er;static _ngModelWarningSentOnce=!1;_ngModelWarningSent=!1;constructor(t,r,i,s,o){super(),this._ngModelWarningConfig=o,this._parent=t,this._setValidators(r),this._setAsyncValidators(i),this.valueAccessor=function ZM(n,e){if(!e)return null;let t,r,i;return Array.isArray(e),e.forEach(s=>{s.constructor===zE?t=s:function hge(n){return Object.getPrototypeOf(n.constructor)===Xl}(s)?r=s:i=s}),i||r||t||null}(0,s)}ngOnChanges(t){this._added||this._setUpControl(),function JM(n,e){if(!n.hasOwnProperty("model"))return!1;const t=n.model;return!!t.isFirstChange()||!Object.is(e,t.currentValue)}(t,this.viewModel)&&(this.viewModel=this.model,this.formDirective.updateModel(this,this.model))}ngOnDestroy(){this.formDirective&&this.formDirective.removeControl(this)}viewToModelUpdate(t){this.viewModel=t,this.update.emit(t)}get path(){return function JE(n,e){return[...e.path,n]}(null==this.name?this.name:this.name.toString(),this._parent)}get formDirective(){return this._parent?this._parent.formDirective:null}_setUpControl(){this.control=this.formDirective.addControl(this),this._added=!0}static \u0275fac=function(r){return new(r||n)(Me(Mi,13),Me(fi,10),Me(fc,10),Me(go,10),Me(eC,8))};static \u0275dir=At({type:n,selectors:[["","formControlName",""]],inputs:{name:[0,"formControlName","name"],isDisabled:[0,"disabled","isDisabled"],model:[0,"ngModel","model"]},outputs:{update:"ngModelChange"},standalone:!1,features:[Un([Mge]),rn,Xa]})}return n})(),Gge=(()=>{class n{static \u0275fac=function(r){return new(r||n)};static \u0275mod=nc({type:n});static \u0275inj=Vo({})}return n})(),E6=(()=>{class n{static withConfig(t){return{ngModule:n,providers:[{provide:eC,useValue:t.warnOnNgModelWithFormControl??"always"},{provide:Eh,useValue:t.callSetDisabledState??YE}]}}static \u0275fac=function(r){return new(r||n)};static \u0275mod=nc({type:n});static \u0275inj=Vo({imports:[Gge]})}return n})();function sC(n,e,t=1/0){return Zn(e)?sC((r,i)=>Hs((s,o)=>e(r,s,i,o))(dc(n(r,i))),t):("number"==typeof e&&(t=e),Ss((r,i)=>function jge(n,e,t,r,i,s,o,a){const c=[];let l=0,u=0,d=!1;const h=()=>{d&&!c.length&&!l&&e.complete()},f=y=>l<r?m(y):c.push(y),m=y=>{s&&e.next(y),l++;let _=!1;dc(t(y,u++)).subscribe(os(e,g=>{i?.(g),s?f(g):e.next(g)},()=>{_=!0},void 0,()=>{if(_)try{for(l--;c.length&&l<r;){const g=c.shift();o?hc(e,o,()=>m(g)):m(g)}h()}catch(g){e.error(g)}}))};return n.subscribe(os(e,f,()=>{d=!0,h()})),()=>{a?.()}}(r,i,n,t)))}function b6(n,e){return Ss((t,r)=>{let i=0;t.subscribe(os(r,s=>n.call(e,s,i++)&&r.next(s)))})}function T6(n){return Ss((e,t)=>{try{e.subscribe(t)}finally{t.add(n)}})}function qs(n,e){return Ss((t,r)=>{let i=null,s=0,o=!1;const a=()=>o&&!i&&r.complete();t.subscribe(os(r,c=>{i?.unsubscribe();let l=0;const u=s++;dc(n(c,u)).subscribe(i=os(r,d=>r.next(e?e(c,d,u,l++):d),()=>{i=null,a()}))},()=>{o=!0,a()}))})}function _o(...n){return kM(n,function Ume(n){return function Fme(n){return n&&Zn(n.schedule)}(LM(n))?n.pop():void 0}(n))}class o0{}class a0{}class Qr{headers;normalizedNames=new Map;lazyInit;lazyUpdate=null;constructor(e){e?"string"==typeof e?this.lazyInit=()=>{this.headers=new Map,e.split("\n").forEach(t=>{const r=t.indexOf(":");if(r>0){const i=t.slice(0,r),s=t.slice(r+1).trim();this.addHeaderEntry(i,s)}})}:typeof Headers<"u"&&e instanceof Headers?(this.headers=new Map,e.forEach((t,r)=>{this.addHeaderEntry(r,t)})):this.lazyInit=()=>{this.headers=new Map,Object.entries(e).forEach(([t,r])=>{this.setHeaderEntries(t,r)})}:this.headers=new Map}has(e){return this.init(),this.headers.has(e.toLowerCase())}get(e){this.init();const t=this.headers.get(e.toLowerCase());return t&&t.length>0?t[0]:null}keys(){return this.init(),Array.from(this.normalizedNames.values())}getAll(e){return this.init(),this.headers.get(e.toLowerCase())||null}append(e,t){return this.clone({name:e,value:t,op:"a"})}set(e,t){return this.clone({name:e,value:t,op:"s"})}delete(e,t){return this.clone({name:e,value:t,op:"d"})}maybeSetNormalizedName(e,t){this.normalizedNames.has(t)||this.normalizedNames.set(t,e)}init(){this.lazyInit&&(this.lazyInit instanceof Qr?this.copyFrom(this.lazyInit):this.lazyInit(),this.lazyInit=null,this.lazyUpdate&&(this.lazyUpdate.forEach(e=>this.applyUpdate(e)),this.lazyUpdate=null))}copyFrom(e){e.init(),Array.from(e.headers.keys()).forEach(t=>{this.headers.set(t,e.headers.get(t)),this.normalizedNames.set(t,e.normalizedNames.get(t))})}clone(e){const t=new Qr;return t.lazyInit=this.lazyInit&&this.lazyInit instanceof Qr?this.lazyInit:this,t.lazyUpdate=(this.lazyUpdate||[]).concat([e]),t}applyUpdate(e){const t=e.name.toLowerCase();switch(e.op){case"a":case"s":let r=e.value;if("string"==typeof r&&(r=[r]),0===r.length)return;this.maybeSetNormalizedName(e.name,t);const i=("a"===e.op?this.headers.get(t):void 0)||[];i.push(...r),this.headers.set(t,i);break;case"d":const s=e.value;if(s){let o=this.headers.get(t);if(!o)return;o=o.filter(a=>-1===s.indexOf(a)),0===o.length?(this.headers.delete(t),this.normalizedNames.delete(t)):this.headers.set(t,o)}else this.headers.delete(t),this.normalizedNames.delete(t)}}addHeaderEntry(e,t){const r=e.toLowerCase();this.maybeSetNormalizedName(e,r),this.headers.has(r)?this.headers.get(r).push(t):this.headers.set(r,[t])}setHeaderEntries(e,t){const r=(Array.isArray(t)?t:[t]).map(s=>s.toString()),i=e.toLowerCase();this.headers.set(i,r),this.maybeSetNormalizedName(e,i)}forEach(e){this.init(),Array.from(this.normalizedNames.keys()).forEach(t=>e(this.normalizedNames.get(t),this.headers.get(t)))}}class qge{encodeKey(e){return w6(e)}encodeValue(e){return w6(e)}decodeKey(e){return decodeURIComponent(e)}decodeValue(e){return decodeURIComponent(e)}}const Kge=/%(\d[a-f0-9])/gi,Yge={40:"@","3A":":",24:"$","2C":",","3B":";","3D":"=","3F":"?","2F":"/"};function w6(n){return encodeURIComponent(n).replace(Kge,(e,t)=>Yge[t]??e)}function c0(n){return`${n}`}class mc{map;encoder;updates=null;cloneFrom=null;constructor(e={}){if(this.encoder=e.encoder||new qge,e.fromString){if(e.fromObject)throw new ue(2805,!1);this.map=function Xge(n,e){const t=new Map;return n.length>0&&n.replace(/^\?/,"").split("&").forEach(i=>{const s=i.indexOf("="),[o,a]=-1==s?[e.decodeKey(i),""]:[e.decodeKey(i.slice(0,s)),e.decodeValue(i.slice(s+1))],c=t.get(o)||[];c.push(a),t.set(o,c)}),t}(e.fromString,this.encoder)}else e.fromObject?(this.map=new Map,Object.keys(e.fromObject).forEach(t=>{const r=e.fromObject[t],i=Array.isArray(r)?r.map(c0):[c0(r)];this.map.set(t,i)})):this.map=null}has(e){return this.init(),this.map.has(e)}get(e){this.init();const t=this.map.get(e);return t?t[0]:null}getAll(e){return this.init(),this.map.get(e)||null}keys(){return this.init(),Array.from(this.map.keys())}append(e,t){return this.clone({param:e,value:t,op:"a"})}appendAll(e){const t=[];return Object.keys(e).forEach(r=>{const i=e[r];Array.isArray(i)?i.forEach(s=>{t.push({param:r,value:s,op:"a"})}):t.push({param:r,value:i,op:"a"})}),this.clone(t)}set(e,t){return this.clone({param:e,value:t,op:"s"})}delete(e,t){return this.clone({param:e,value:t,op:"d"})}toString(){return this.init(),this.keys().map(e=>{const t=this.encoder.encodeKey(e);return this.map.get(e).map(r=>t+"="+this.encoder.encodeValue(r)).join("&")}).filter(e=>""!==e).join("&")}clone(e){const t=new mc({encoder:this.encoder});return t.cloneFrom=this.cloneFrom||this,t.updates=(this.updates||[]).concat(e),t}init(){null===this.map&&(this.map=new Map),null!==this.cloneFrom&&(this.cloneFrom.init(),this.cloneFrom.keys().forEach(e=>this.map.set(e,this.cloneFrom.map.get(e))),this.updates.forEach(e=>{switch(e.op){case"a":case"s":const t=("a"===e.op?this.map.get(e.param):void 0)||[];t.push(c0(e.value)),this.map.set(e.param,t);break;case"d":if(void 0===e.value){this.map.delete(e.param);break}{let r=this.map.get(e.param)||[];const i=r.indexOf(c0(e.value));-1!==i&&r.splice(i,1),r.length>0?this.map.set(e.param,r):this.map.delete(e.param)}}}),this.cloneFrom=this.updates=null)}}class Jge{map=new Map;set(e,t){return this.map.set(e,t),this}get(e){return this.map.has(e)||this.map.set(e,e.defaultValue()),this.map.get(e)}delete(e){return this.map.delete(e),this}has(e){return this.map.has(e)}keys(){return this.map.keys()}}function I6(n){return typeof ArrayBuffer<"u"&&n instanceof ArrayBuffer}function S6(n){return typeof Blob<"u"&&n instanceof Blob}function x6(n){return typeof FormData<"u"&&n instanceof FormData}const tg="Content-Type",oC="X-Request-URL",A6="text/plain",M6="application/json",C6=`${M6}, ${A6}, */*`;class ng{url;body=null;headers;context;reportProgress=!1;withCredentials=!1;credentials;keepalive=!1;cache;priority;mode;redirect;referrer;integrity;responseType="json";method;params;urlWithParams;transferCache;timeout;constructor(e,t,r,i){let s;if(this.url=t,this.method=e.toUpperCase(),function Zge(n){switch(n){case"DELETE":case"GET":case"HEAD":case"OPTIONS":case"JSONP":return!1;default:return!0}}(this.method)||i?(this.body=void 0!==r?r:null,s=i):s=r,s){if(this.reportProgress=!!s.reportProgress,this.withCredentials=!!s.withCredentials,this.keepalive=!!s.keepalive,s.responseType&&(this.responseType=s.responseType),s.headers&&(this.headers=s.headers),s.context&&(this.context=s.context),s.params&&(this.params=s.params),s.priority&&(this.priority=s.priority),s.cache&&(this.cache=s.cache),s.credentials&&(this.credentials=s.credentials),"number"==typeof s.timeout){if(s.timeout<1||!Number.isInteger(s.timeout))throw new ue(2822,"");this.timeout=s.timeout}s.mode&&(this.mode=s.mode),s.redirect&&(this.redirect=s.redirect),s.integrity&&(this.integrity=s.integrity),s.referrer&&(this.referrer=s.referrer),this.transferCache=s.transferCache}if(this.headers??=new Qr,this.context??=new Jge,this.params){const o=this.params.toString();if(0===o.length)this.urlWithParams=t;else{const a=t.indexOf("?");this.urlWithParams=t+(-1===a?"?":a<t.length-1?"&":"")+o}}else this.params=new mc,this.urlWithParams=t}serializeBody(){return null===this.body?null:"string"==typeof this.body||I6(this.body)||S6(this.body)||x6(this.body)||function Qge(n){return typeof URLSearchParams<"u"&&n instanceof URLSearchParams}(this.body)?this.body:this.body instanceof mc?this.body.toString():"object"==typeof this.body||"boolean"==typeof this.body||Array.isArray(this.body)?JSON.stringify(this.body):this.body.toString()}detectContentTypeHeader(){return null===this.body||x6(this.body)?null:S6(this.body)?this.body.type||null:I6(this.body)?null:"string"==typeof this.body?A6:this.body instanceof mc?"application/x-www-form-urlencoded;charset=UTF-8":"object"==typeof this.body||"number"==typeof this.body||"boolean"==typeof this.body?M6:null}clone(e={}){const t=e.method||this.method,r=e.url||this.url,i=e.responseType||this.responseType,s=e.keepalive??this.keepalive,o=e.priority||this.priority,a=e.cache||this.cache,c=e.mode||this.mode,l=e.redirect||this.redirect,u=e.credentials||this.credentials,d=e.referrer||this.referrer,h=e.integrity||this.integrity,f=e.transferCache??this.transferCache,m=e.timeout??this.timeout,y=void 0!==e.body?e.body:this.body,_=e.withCredentials??this.withCredentials,g=e.reportProgress??this.reportProgress;let b=e.headers||this.headers,E=e.params||this.params;const x=e.context??this.context;return void 0!==e.setHeaders&&(b=Object.keys(e.setHeaders).reduce((M,C)=>M.set(C,e.setHeaders[C]),b)),e.setParams&&(E=Object.keys(e.setParams).reduce((M,C)=>M.set(C,e.setParams[C]),E)),new ng(t,r,y,{params:E,headers:b,context:x,reportProgress:g,responseType:i,withCredentials:_,transferCache:f,keepalive:s,cache:a,priority:o,timeout:m,mode:c,redirect:l,credentials:u,referrer:d,integrity:h})}}var gc=function(n){return n[n.Sent=0]="Sent",n[n.UploadProgress=1]="UploadProgress",n[n.ResponseHeader=2]="ResponseHeader",n[n.DownloadProgress=3]="DownloadProgress",n[n.Response=4]="Response",n[n.User=5]="User",n}(gc||{});class aC{headers;status;statusText;url;ok;type;redirected;constructor(e,t=200,r="OK"){this.headers=e.headers||new Qr,this.status=void 0!==e.status?e.status:t,this.statusText=e.statusText||r,this.url=e.url||null,this.redirected=e.redirected,this.ok=this.status>=200&&this.status<300}}class u0 extends aC{constructor(e={}){super(e)}type=gc.ResponseHeader;clone(e={}){return new u0({headers:e.headers||this.headers,status:void 0!==e.status?e.status:this.status,statusText:e.statusText||this.statusText,url:e.url||this.url||void 0})}}class rg extends aC{body;constructor(e={}){super(e),this.body=void 0!==e.body?e.body:null}type=gc.Response;clone(e={}){return new rg({body:void 0!==e.body?e.body:this.body,headers:e.headers||this.headers,status:void 0!==e.status?e.status:this.status,statusText:e.statusText||this.statusText,url:e.url||this.url||void 0,redirected:e.redirected??this.redirected})}}class Yl extends aC{name="HttpErrorResponse";message;error;ok=!1;constructor(e){super(e,0,"Unknown Error"),this.message=this.status>=200&&this.status<300?`Http failure during parsing for ${e.url||"(unknown url)"}`:`Http failure response for ${e.url||"(unknown url)"}: ${e.status} ${e.statusText}`,this.error=e.error||null}}function cC(n,e){return{body:e,headers:n.headers,context:n.context,observe:n.observe,params:n.params,reportProgress:n.reportProgress,responseType:n.responseType,withCredentials:n.withCredentials,credentials:n.credentials,transferCache:n.transferCache,timeout:n.timeout,keepalive:n.keepalive,priority:n.priority,cache:n.cache,mode:n.mode,redirect:n.redirect,integrity:n.integrity,referrer:n.referrer}}let R6=(()=>{class n{handler;constructor(t){this.handler=t}request(t,r,i={}){let s;if(t instanceof ng)s=t;else{let c,l;c=i.headers instanceof Qr?i.headers:new Qr(i.headers),i.params&&(l=i.params instanceof mc?i.params:new mc({fromObject:i.params})),s=new ng(t,r,void 0!==i.body?i.body:null,{headers:c,context:i.context,params:l,reportProgress:i.reportProgress,responseType:i.responseType||"json",withCredentials:i.withCredentials,transferCache:i.transferCache,keepalive:i.keepalive,priority:i.priority,cache:i.cache,mode:i.mode,redirect:i.redirect,credentials:i.credentials,referrer:i.referrer,integrity:i.integrity,timeout:i.timeout})}const o=_o(s).pipe(function $ge(n,e){return Zn(e)?sC(n,e,1):sC(n,1)}(c=>this.handler.handle(c)));if(t instanceof ng||"events"===i.observe)return o;const a=o.pipe(b6(c=>c instanceof rg));switch(i.observe||"body"){case"body":switch(s.responseType){case"arraybuffer":return a.pipe(Hs(c=>{if(null!==c.body&&!(c.body instanceof ArrayBuffer))throw new ue(2806,!1);return c.body}));case"blob":return a.pipe(Hs(c=>{if(null!==c.body&&!(c.body instanceof Blob))throw new ue(2807,!1);return c.body}));case"text":return a.pipe(Hs(c=>{if(null!==c.body&&"string"!=typeof c.body)throw new ue(2808,!1);return c.body}));default:return a.pipe(Hs(c=>c.body))}case"response":return a;default:throw new ue(2809,!1)}}delete(t,r={}){return this.request("DELETE",t,r)}get(t,r={}){return this.request("GET",t,r)}head(t,r={}){return this.request("HEAD",t,r)}jsonp(t,r){return this.request("JSONP",t,{params:(new mc).append(r,"JSONP_CALLBACK"),observe:"body",responseType:"json"})}options(t,r={}){return this.request("OPTIONS",t,r)}patch(t,r,i={}){return this.request("PATCH",t,cC(i,r))}post(t,r,i={}){return this.request("POST",t,cC(i,r))}put(t,r,i={}){return this.request("PUT",t,cC(i,r))}static \u0275fac=function(r){return new(r||n)(Rt(o0))};static \u0275prov=Et({token:n,factory:n.\u0275fac})}return n})();const N6=new Ae("");function O6(n,e){return e(n)}function s_e(n,e){return(t,r)=>e.intercept(t,{handle:i=>n(i,r)})}const a_e=new Ae(""),ig=new Ae(""),c_e=new Ae(""),k6=new Ae("",{providedIn:"root",factory:()=>!0});function l_e(){let n=null;return(e,t)=>{null===n&&(n=(Ie(a_e,{optional:!0})??[]).reduceRight(s_e,O6));const r=Ie(Rd);if(Ie(k6)){const s=r.add();return n(e,t).pipe(T6(s))}return n(e,t)}}let L6=(()=>{class n extends o0{backend;injector;chain=null;pendingTasks=Ie(Rd);contributeToStability=Ie(k6);constructor(t,r){super(),this.backend=t,this.injector=r}handle(t){if(null===this.chain){const r=Array.from(new Set([...this.injector.get(ig),...this.injector.get(c_e,[])]));this.chain=r.reduceRight((i,s)=>function o_e(n,e,t){return(r,i)=>vd(t,()=>e(r,s=>n(s,i)))}(i,s,this.injector),O6)}if(this.contributeToStability){const r=this.pendingTasks.add();return this.chain(t,i=>this.backend.handle(i)).pipe(T6(r))}return this.chain(t,r=>this.backend.handle(r))}static \u0275fac=function(r){return new(r||n)(Rt(a0),Rt(Ui))};static \u0275prov=Et({token:n,factory:n.\u0275fac})}return n})();const f_e=/^\)\]\}',?\n/,p_e=RegExp(`^${oC}:`,"m");let V6=(()=>{class n{xhrFactory;constructor(t){this.xhrFactory=t}handle(t){if("JSONP"===t.method)throw new ue(-2800,!1);const r=this.xhrFactory;return _o(null).pipe(qs(()=>new jn(s=>{const o=r.build();if(o.open(t.method,t.urlWithParams),t.withCredentials&&(o.withCredentials=!0),t.headers.forEach((_,g)=>o.setRequestHeader(_,g.join(","))),t.headers.has("Accept")||o.setRequestHeader("Accept",C6),!t.headers.has(tg)){const _=t.detectContentTypeHeader();null!==_&&o.setRequestHeader(tg,_)}if(t.timeout&&(o.timeout=t.timeout),t.responseType){const _=t.responseType.toLowerCase();o.responseType="json"!==_?_:"text"}const a=t.serializeBody();let c=null;const l=()=>{if(null!==c)return c;const _=o.statusText||"OK",g=new Qr(o.getAllResponseHeaders()),b=function m_e(n){return"responseURL"in n&&n.responseURL?n.responseURL:p_e.test(n.getAllResponseHeaders())?n.getResponseHeader(oC):null}(o)||t.url;return c=new u0({headers:g,status:o.status,statusText:_,url:b}),c},u=()=>{let{headers:_,status:g,statusText:b,url:E}=l(),x=null;204!==g&&(x=typeof o.response>"u"?o.responseText:o.response),0===g&&(g=x?200:0);let M=g>=200&&g<300;if("json"===t.responseType&&"string"==typeof x){const C=x;x=x.replace(f_e,"");try{x=""!==x?JSON.parse(x):null}catch(w){x=C,M&&(M=!1,x={error:w,text:x})}}M?(s.next(new rg({body:x,headers:_,status:g,statusText:b,url:E||void 0})),s.complete()):s.error(new Yl({error:x,headers:_,status:g,statusText:b,url:E||void 0}))},d=_=>{const{url:g}=l(),b=new Yl({error:_,status:o.status||0,statusText:o.statusText||"Unknown Error",url:g||void 0});s.error(b)};let h=d;t.timeout&&(h=_=>{const{url:g}=l(),b=new Yl({error:new DOMException("Request timed out","TimeoutError"),status:o.status||0,statusText:o.statusText||"Request timeout",url:g||void 0});s.error(b)});let f=!1;const m=_=>{f||(s.next(l()),f=!0);let g={type:gc.DownloadProgress,loaded:_.loaded};_.lengthComputable&&(g.total=_.total),"text"===t.responseType&&o.responseText&&(g.partialText=o.responseText),s.next(g)},y=_=>{let g={type:gc.UploadProgress,loaded:_.loaded};_.lengthComputable&&(g.total=_.total),s.next(g)};return o.addEventListener("load",u),o.addEventListener("error",d),o.addEventListener("timeout",h),o.addEventListener("abort",d),t.reportProgress&&(o.addEventListener("progress",m),null!==a&&o.upload&&o.upload.addEventListener("progress",y)),o.send(a),s.next({type:gc.Sent}),()=>{o.removeEventListener("error",d),o.removeEventListener("abort",d),o.removeEventListener("load",u),o.removeEventListener("timeout",h),t.reportProgress&&(o.removeEventListener("progress",m),null!==a&&o.upload&&o.upload.removeEventListener("progress",y)),o.readyState!==o.DONE&&o.abort()}})))}static \u0275fac=function(r){return new(r||n)(Rt(j2))};static \u0275prov=Et({token:n,factory:n.\u0275fac})}return n})();const dC=new Ae(""),U6=new Ae("",{providedIn:"root",factory:()=>"XSRF-TOKEN"}),B6=new Ae("",{providedIn:"root",factory:()=>"X-XSRF-TOKEN"});class H6{}let y_e=(()=>{class n{doc;cookieName;lastCookieString="";lastToken=null;parseCount=0;constructor(t,r){this.doc=t,this.cookieName=r}getToken(){const t=this.doc.cookie||"";return t!==this.lastCookieString&&(this.parseCount++,this.lastToken=W2(t,this.cookieName),this.lastCookieString=t),this.lastToken}static \u0275fac=function(r){return new(r||n)(Rt(Xo),Rt(U6))};static \u0275prov=Et({token:n,factory:n.\u0275fac})}return n})();function v_e(n,e){const t=n.url.toLowerCase();if(!Ie(dC)||"GET"===n.method||"HEAD"===n.method||t.startsWith("http://")||t.startsWith("https://"))return e(n);const r=Ie(H6).getToken(),i=Ie(B6);return null!=r&&!n.headers.has(i)&&(n=n.clone({headers:n.headers.set(i,r)})),e(n)}var _c=function(n){return n[n.Interceptors=0]="Interceptors",n[n.LegacyInterceptors=1]="LegacyInterceptors",n[n.CustomXsrfConfiguration=2]="CustomXsrfConfiguration",n[n.NoXsrfProtection=3]="NoXsrfProtection",n[n.JsonpSupport=4]="JsonpSupport",n[n.RequestsMadeViaParent=5]="RequestsMadeViaParent",n[n.Fetch=6]="Fetch",n}(_c||{});function E_e(...n){const e=[R6,V6,L6,{provide:o0,useExisting:L6},{provide:a0,useFactory:()=>Ie(N6,{optional:!0})??Ie(V6)},{provide:ig,useValue:v_e,multi:!0},{provide:dC,useValue:!0},{provide:H6,useClass:y_e}];for(const t of n)e.push(...t.\u0275providers);return _l(e)}const z6=new Ae("");function b_e(){return function Jl(n,e){return{\u0275kind:n,\u0275providers:e}}(_c.LegacyInterceptors,[{provide:z6,useFactory:l_e},{provide:ig,useExisting:z6,multi:!0}])}let T_e=(()=>{class n{static \u0275fac=function(r){return new(r||n)};static \u0275mod=nc({type:n});static \u0275inj=Vo({providers:[E_e(b_e())]})}return n})();const G6=function(n){const e=[];let t=0;for(let r=0;r<n.length;r++){let i=n.charCodeAt(r);i<128?e[t++]=i:i<2048?(e[t++]=i>>6|192,e[t++]=63&i|128):55296==(64512&i)&&r+1<n.length&&56320==(64512&n.charCodeAt(r+1))?(i=65536+((1023&i)<<10)+(1023&n.charCodeAt(++r)),e[t++]=i>>18|240,e[t++]=i>>12&63|128,e[t++]=i>>6&63|128,e[t++]=63&i|128):(e[t++]=i>>12|224,e[t++]=i>>6&63|128,e[t++]=63&i|128)}return e},fC={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:"function"==typeof atob,encodeByteArray(n,e){if(!Array.isArray(n))throw Error("encodeByteArray takes an array as a parameter");this.init_();const t=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[];for(let i=0;i<n.length;i+=3){const s=n[i],o=i+1<n.length,a=o?n[i+1]:0,c=i+2<n.length,l=c?n[i+2]:0;let h=(15&a)<<2|l>>6,f=63&l;c||(f=64,o||(h=64)),r.push(t[s>>2],t[(3&s)<<4|a>>4],t[h],t[f])}return r.join("")},encodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(n):this.encodeByteArray(G6(n),e)},decodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(n):function(n){const e=[];let t=0,r=0;for(;t<n.length;){const i=n[t++];if(i<128)e[r++]=String.fromCharCode(i);else if(i>191&&i<224){const s=n[t++];e[r++]=String.fromCharCode((31&i)<<6|63&s)}else if(i>239&&i<365){const c=((7&i)<<18|(63&n[t++])<<12|(63&n[t++])<<6|63&n[t++])-65536;e[r++]=String.fromCharCode(55296+(c>>10)),e[r++]=String.fromCharCode(56320+(1023&c))}else{const s=n[t++],o=n[t++];e[r++]=String.fromCharCode((15&i)<<12|(63&s)<<6|63&o)}}return e.join("")}(this.decodeStringToByteArray(n,e))},decodeStringToByteArray(n,e){this.init_();const t=e?this.charToByteMapWebSafe_:this.charToByteMap_,r=[];for(let i=0;i<n.length;){const s=t[n.charAt(i++)],a=i<n.length?t[n.charAt(i)]:0;++i;const l=i<n.length?t[n.charAt(i)]:64;++i;const d=i<n.length?t[n.charAt(i)]:64;if(++i,null==s||null==a||null==l||null==d)throw new A_e;r.push(s<<2|a>>4),64!==l&&(r.push(a<<4&240|l>>2),64!==d&&r.push(l<<6&192|d))}return r},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let n=0;n<this.ENCODED_VALS.length;n++)this.byteToCharMap_[n]=this.ENCODED_VALS.charAt(n),this.charToByteMap_[this.byteToCharMap_[n]]=n,this.byteToCharMapWebSafe_[n]=this.ENCODED_VALS_WEBSAFE.charAt(n),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[n]]=n,n>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(n)]=n,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(n)]=n)}}};class A_e extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const d0=function(n){return function(n){const e=G6(n);return fC.encodeByteArray(e,!0)}(n).replace(/\./g,"")},sg=function(n){try{return fC.decodeString(n,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};const h0=()=>{try{return function j6(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}().__FIREBASE_DEFAULTS__||(()=>{if(typeof process>"u"||typeof process.env>"u")return;const n=process.env.__FIREBASE_DEFAULTS__;return n?JSON.parse(n):void 0})()||(()=>{if(typeof document>"u")return;let n;try{n=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const e=n&&sg(n[1]);return e&&JSON.parse(e)})()}catch(n){return void console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${n}`)}},$6=n=>{var e,t;return null===(t=null===(e=h0())||void 0===e?void 0:e.emulatorHosts)||void 0===t?void 0:t[n]},q6=n=>{const e=$6(n);if(!e)return;const t=e.lastIndexOf(":");if(t<=0||t+1===e.length)throw new Error(`Invalid host ${e} with no separate hostname and port!`);const r=parseInt(e.substring(t+1),10);return"["===e[0]?[e.substring(1,t-1),r]:[e.substring(0,t),r]},X6=()=>{var n;return null===(n=h0())||void 0===n?void 0:n.config},K6=n=>{var e;return null===(e=h0())||void 0===e?void 0:e[`_${n}`]};class f0{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}wrapCallback(e){return(t,r)=>{t?this.reject(t):this.resolve(r),"function"==typeof e&&(this.promise.catch(()=>{}),1===e.length?e(t):e(t,r))}}}function Zl(n){try{return(n.startsWith("http://")||n.startsWith("https://")?new URL(n).hostname:n).endsWith(".cloudworkstations.dev")}catch{return!1}}function pC(n){return mC.apply(this,arguments)}function mC(){return(mC=O(function*(n){return(yield fetch(n,{credentials:"include"})).ok})).apply(this,arguments)}const og={};let Y6=!1;function gC(n,e){if(typeof window>"u"||typeof document>"u"||!Zl(window.location.host)||og[n]===e||og[n]||Y6)return;function t(h){return`__firebase__banner__${h}`}og[n]=e;const r="__firebase__banner",s=function O_e(){const n={prod:[],emulator:[]};for(const e of Object.keys(og))og[e]?n.emulator.push(e):n.prod.push(e);return n}().prod.length>0;function d(){const h=function k_e(n){let e=document.getElementById(n),t=!1;return e||(e=document.createElement("div"),e.setAttribute("id",n),t=!0),{created:t,element:e}}(r),f=t("text"),m=document.getElementById(f)||document.createElement("span"),y=t("learnmore"),_=document.getElementById(y)||document.createElement("a"),g=t("preprendIcon"),b=document.getElementById(g)||document.createElementNS("http://www.w3.org/2000/svg","svg");if(h.created){const E=h.element;(function a(h){h.style.display="flex",h.style.background="#7faaf0",h.style.position="fixed",h.style.bottom="5px",h.style.left="5px",h.style.padding=".5em",h.style.borderRadius="5px",h.style.alignItems="center"})(E),function u(h,f){h.setAttribute("id",f),h.innerText="Learn more",h.href="https://firebase.google.com/docs/studio/preview-apps#preview-backend",h.setAttribute("target","__blank"),h.style.paddingLeft="5px",h.style.textDecoration="underline"}(_,y);const x=function l(){const h=document.createElement("span");return h.style.cursor="pointer",h.style.marginLeft="16px",h.style.fontSize="24px",h.innerHTML=" &times;",h.onclick=()=>{Y6=!0,function o(){const h=document.getElementById(r);h&&h.remove()}()},h}();(function c(h,f){h.setAttribute("width","24"),h.setAttribute("id",f),h.setAttribute("height","24"),h.setAttribute("viewBox","0 0 24 24"),h.setAttribute("fill","none"),h.style.marginLeft="-6px"})(b,g),E.append(b,m,_,x),document.body.appendChild(E)}s?(m.innerText="Preview backend disconnected.",b.innerHTML='<g clip-path="url(#clip0_6013_33858)">\n<path d="M4.8 17.6L12 5.6L19.2 17.6H4.8ZM6.91667 16.4H17.0833L12 7.93333L6.91667 16.4ZM12 15.6C12.1667 15.6 12.3056 15.5444 12.4167 15.4333C12.5389 15.3111 12.6 15.1667 12.6 15C12.6 14.8333 12.5389 14.6944 12.4167 14.5833C12.3056 14.4611 12.1667 14.4 12 14.4C11.8333 14.4 11.6889 14.4611 11.5667 14.5833C11.4556 14.6944 11.4 14.8333 11.4 15C11.4 15.1667 11.4556 15.3111 11.5667 15.4333C11.6889 15.5444 11.8333 15.6 12 15.6ZM11.4 13.6H12.6V10.4H11.4V13.6Z" fill="#212121"/>\n</g>\n<defs>\n<clipPath id="clip0_6013_33858">\n<rect width="24" height="24" fill="white"/>\n</clipPath>\n</defs>'):(b.innerHTML='<g clip-path="url(#clip0_6083_34804)">\n<path d="M11.4 15.2H12.6V11.2H11.4V15.2ZM12 10C12.1667 10 12.3056 9.94444 12.4167 9.83333C12.5389 9.71111 12.6 9.56667 12.6 9.4C12.6 9.23333 12.5389 9.09444 12.4167 8.98333C12.3056 8.86111 12.1667 8.8 12 8.8C11.8333 8.8 11.6889 8.86111 11.5667 8.98333C11.4556 9.09444 11.4 9.23333 11.4 9.4C11.4 9.56667 11.4556 9.71111 11.5667 9.83333C11.6889 9.94444 11.8333 10 12 10ZM12 18.4C11.1222 18.4 10.2944 18.2333 9.51667 17.9C8.73889 17.5667 8.05556 17.1111 7.46667 16.5333C6.88889 15.9444 6.43333 15.2611 6.1 14.4833C5.76667 13.7056 5.6 12.8778 5.6 12C5.6 11.1111 5.76667 10.2833 6.1 9.51667C6.43333 8.73889 6.88889 8.06111 7.46667 7.48333C8.05556 6.89444 8.73889 6.43333 9.51667 6.1C10.2944 5.76667 11.1222 5.6 12 5.6C12.8889 5.6 13.7167 5.76667 14.4833 6.1C15.2611 6.43333 15.9389 6.89444 16.5167 7.48333C17.1056 8.06111 17.5667 8.73889 17.9 9.51667C18.2333 10.2833 18.4 11.1111 18.4 12C18.4 12.8778 18.2333 13.7056 17.9 14.4833C17.5667 15.2611 17.1056 15.9444 16.5167 16.5333C15.9389 17.1111 15.2611 17.5667 14.4833 17.9C13.7167 18.2333 12.8889 18.4 12 18.4ZM12 17.2C13.4444 17.2 14.6722 16.6944 15.6833 15.6833C16.6944 14.6722 17.2 13.4444 17.2 12C17.2 10.5556 16.6944 9.32778 15.6833 8.31667C14.6722 7.30555 13.4444 6.8 12 6.8C10.5556 6.8 9.32778 7.30555 8.31667 8.31667C7.30556 9.32778 6.8 10.5556 6.8 12C6.8 13.4444 7.30556 14.6722 8.31667 15.6833C9.32778 16.6944 10.5556 17.2 12 17.2Z" fill="#212121"/>\n</g>\n<defs>\n<clipPath id="clip0_6083_34804">\n<rect width="24" height="24" fill="white"/>\n</clipPath>\n</defs>',m.innerText="Preview backend running in this workspace."),m.setAttribute("id",f)}"loading"===document.readyState?window.addEventListener("DOMContentLoaded",d):d()}function dr(){return typeof navigator<"u"&&"string"==typeof navigator.userAgent?navigator.userAgent:""}function Z6(){return!function J6(){var n;const e=null===(n=h0())||void 0===n?void 0:n.forceEnvironment;if("node"===e)return!0;if("browser"===e)return!1;try{return"[object process]"===Object.prototype.toString.call(global.process)}catch{return!1}}()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function _C(){try{return"object"==typeof indexedDB}catch{return!1}}class yo extends Error{constructor(e,t,r){super(t),this.code=e,this.customData=r,this.name="FirebaseError",Object.setPrototypeOf(this,yo.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,bh.prototype.create)}}class bh{constructor(e,t,r){this.service=e,this.serviceName=t,this.errors=r}create(e,...t){const r=t[0]||{},i=`${this.service}/${e}`,s=this.errors[e],o=s?function W_e(n,e){return n.replace(j_e,(t,r)=>{const i=e[r];return null!=i?String(i):`<${r}?>`})}(s,r):"Error";return new yo(i,`${this.serviceName}: ${o} (${i}).`,r)}}const j_e=/\{\$([^}]+)}/g;function ia(n,e){if(n===e)return!0;const t=Object.keys(n),r=Object.keys(e);for(const i of t){if(!r.includes(i))return!1;const s=n[i],o=e[i];if(tW(s)&&tW(o)){if(!ia(s,o))return!1}else if(s!==o)return!1}for(const i of r)if(!t.includes(i))return!1;return!0}function tW(n){return null!==n&&"object"==typeof n}function ag(n){const e=[];for(const[t,r]of Object.entries(n))Array.isArray(r)?r.forEach(i=>{e.push(encodeURIComponent(t)+"="+encodeURIComponent(i))}):e.push(encodeURIComponent(t)+"="+encodeURIComponent(r));return e.length?"&"+e.join("&"):""}class X_e{constructor(e,t){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=t,this.task.then(()=>{e(this)}).catch(r=>{this.error(r)})}next(e){this.forEachObserver(t=>{t.next(e)})}error(e){this.forEachObserver(t=>{t.error(e)}),this.close(e)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,t,r){let i;if(void 0===e&&void 0===t&&void 0===r)throw new Error("Missing Observer.");i=function K_e(n,e){if("object"!=typeof n||null===n)return!1;for(const t of e)if(t in n&&"function"==typeof n[t])return!0;return!1}(e,["next","error","complete"])?e:{next:e,error:t,complete:r},void 0===i.next&&(i.next=yC),void 0===i.error&&(i.error=yC),void 0===i.complete&&(i.complete=yC);const s=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?i.error(this.finalError):i.complete()}catch{}}),this.observers.push(i),s}unsubscribeOne(e){void 0===this.observers||void 0===this.observers[e]||(delete this.observers[e],this.observerCount-=1,0===this.observerCount&&void 0!==this.onNoObservers&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let t=0;t<this.observers.length;t++)this.sendOne(t,e)}sendOne(e,t){this.task.then(()=>{if(void 0!==this.observers&&void 0!==this.observers[e])try{t(this.observers[e])}catch(r){typeof console<"u"&&console.error&&console.error(r)}})}close(e){this.finalized||(this.finalized=!0,void 0!==e&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function yC(){}function Xn(n){return n&&n._delegate?n._delegate:n}class vo{constructor(e,t,r){this.name=e,this.instanceFactory=t,this.type=r,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}const Ql="[DEFAULT]";class tye{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){const r=new f0;if(this.instancesDeferred.set(t,r),this.isInitialized(t)||this.shouldAutoInitialize())try{const i=this.getOrInitializeService({instanceIdentifier:t});i&&r.resolve(i)}catch{}}return this.instancesDeferred.get(t).promise}getImmediate(e){var t;const r=this.normalizeInstanceIdentifier(e?.identifier),i=null!==(t=e?.optional)&&void 0!==t&&t;if(!this.isInitialized(r)&&!this.shouldAutoInitialize()){if(i)return null;throw Error(`Service ${this.name} is not available`)}try{return this.getOrInitializeService({instanceIdentifier:r})}catch(s){if(i)return null;throw s}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,this.shouldAutoInitialize()){if(function rye(n){return"EAGER"===n.instantiationMode}(e))try{this.getOrInitializeService({instanceIdentifier:Ql})}catch{}for(const[t,r]of this.instancesDeferred.entries()){const i=this.normalizeInstanceIdentifier(t);try{const s=this.getOrInitializeService({instanceIdentifier:i});r.resolve(s)}catch{}}}}clearInstance(e=Ql){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}delete(){var e=this;return O(function*(){const t=Array.from(e.instances.values());yield Promise.all([...t.filter(r=>"INTERNAL"in r).map(r=>r.INTERNAL.delete()),...t.filter(r=>"_delete"in r).map(r=>r._delete())])})()}isComponentSet(){return null!=this.component}isInitialized(e=Ql){return this.instances.has(e)}getOptions(e=Ql){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:t={}}=e,r=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(r))throw Error(`${this.name}(${r}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const i=this.getOrInitializeService({instanceIdentifier:r,options:t});for(const[s,o]of this.instancesDeferred.entries())r===this.normalizeInstanceIdentifier(s)&&o.resolve(i);return i}onInit(e,t){var r;const i=this.normalizeInstanceIdentifier(t),s=null!==(r=this.onInitCallbacks.get(i))&&void 0!==r?r:new Set;s.add(e),this.onInitCallbacks.set(i,s);const o=this.instances.get(i);return o&&e(o,i),()=>{s.delete(e)}}invokeOnInitCallbacks(e,t){const r=this.onInitCallbacks.get(t);if(r)for(const i of r)try{i(e,t)}catch{}}getOrInitializeService({instanceIdentifier:e,options:t={}}){let r=this.instances.get(e);if(!r&&this.component&&(r=this.component.instanceFactory(this.container,{instanceIdentifier:(n=e,n===Ql?void 0:n),options:t}),this.instances.set(e,r),this.instancesOptions.set(e,t),this.invokeOnInitCallbacks(r,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,r)}catch{}var n;return r||null}normalizeInstanceIdentifier(e=Ql){return this.component?this.component.multipleInstances?e:Ql:e}shouldAutoInitialize(){return!!this.component&&"EXPLICIT"!==this.component.instantiationMode}}class iye{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const t=this.getProvider(e.name);if(t.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);t.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const t=new tye(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}}const EC=[];var qt=function(n){return n[n.DEBUG=0]="DEBUG",n[n.VERBOSE=1]="VERBOSE",n[n.INFO=2]="INFO",n[n.WARN=3]="WARN",n[n.ERROR=4]="ERROR",n[n.SILENT=5]="SILENT",n}(qt||{});const nW={debug:qt.DEBUG,verbose:qt.VERBOSE,info:qt.INFO,warn:qt.WARN,error:qt.ERROR,silent:qt.SILENT},sye=qt.INFO,oye={[qt.DEBUG]:"log",[qt.VERBOSE]:"log",[qt.INFO]:"info",[qt.WARN]:"warn",[qt.ERROR]:"error"},aye=(n,e,...t)=>{if(e<n.logLevel)return;const r=(new Date).toISOString(),i=oye[e];if(!i)throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`);console[i](`[${r}]  ${n.name}:`,...t)};class m0{constructor(e){this.name=e,this._logLevel=sye,this._logHandler=aye,this._userLogHandler=null,EC.push(this)}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in qt))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel="string"==typeof e?nW[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if("function"!=typeof e)throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,qt.DEBUG,...e),this._logHandler(this,qt.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,qt.VERBOSE,...e),this._logHandler(this,qt.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,qt.INFO,...e),this._logHandler(this,qt.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,qt.WARN,...e),this._logHandler(this,qt.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,qt.ERROR,...e),this._logHandler(this,qt.ERROR,...e)}}let rW,iW;const sW=new WeakMap,bC=new WeakMap,oW=new WeakMap,TC=new WeakMap,wC=new WeakMap;let IC={get(n,e,t){if(n instanceof IDBTransaction){if("done"===e)return bC.get(n);if("objectStoreNames"===e)return n.objectStoreNames||oW.get(n);if("store"===e)return t.objectStoreNames[1]?void 0:t.objectStore(t.objectStoreNames[0])}return sa(n[e])},set:(n,e,t)=>(n[e]=t,!0),has:(n,e)=>n instanceof IDBTransaction&&("done"===e||"store"===e)||e in n};function mye(n){return"function"==typeof n?function pye(n){return n!==IDBDatabase.prototype.transaction||"objectStoreNames"in IDBTransaction.prototype?function uye(){return iW||(iW=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}().includes(n)?function(...e){return n.apply(SC(this),e),sa(sW.get(this))}:function(...e){return sa(n.apply(SC(this),e))}:function(e,...t){const r=n.call(SC(this),e,...t);return oW.set(r,e.sort?e.sort():[e]),sa(r)}}(n):(n instanceof IDBTransaction&&function hye(n){if(bC.has(n))return;const e=new Promise((t,r)=>{const i=()=>{n.removeEventListener("complete",s),n.removeEventListener("error",o),n.removeEventListener("abort",o)},s=()=>{t(),i()},o=()=>{r(n.error||new DOMException("AbortError","AbortError")),i()};n.addEventListener("complete",s),n.addEventListener("error",o),n.addEventListener("abort",o)});bC.set(n,e)}(n),((n,e)=>e.some(t=>n instanceof t))(n,function lye(){return rW||(rW=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}())?new Proxy(n,IC):n)}function sa(n){if(n instanceof IDBRequest)return function dye(n){const e=new Promise((t,r)=>{const i=()=>{n.removeEventListener("success",s),n.removeEventListener("error",o)},s=()=>{t(sa(n.result)),i()},o=()=>{r(n.error),i()};n.addEventListener("success",s),n.addEventListener("error",o)});return e.then(t=>{t instanceof IDBCursor&&sW.set(t,n)}).catch(()=>{}),wC.set(e,n),e}(n);if(TC.has(n))return TC.get(n);const e=mye(n);return e!==n&&(TC.set(n,e),wC.set(e,n)),e}const SC=n=>wC.get(n);function cg(n,e,{blocked:t,upgrade:r,blocking:i,terminated:s}={}){const o=indexedDB.open(n,e),a=sa(o);return r&&o.addEventListener("upgradeneeded",c=>{r(sa(o.result),c.oldVersion,c.newVersion,sa(o.transaction),c)}),t&&o.addEventListener("blocked",c=>t(c.oldVersion,c.newVersion,c)),a.then(c=>{s&&c.addEventListener("close",()=>s()),i&&c.addEventListener("versionchange",l=>i(l.oldVersion,l.newVersion,l))}).catch(()=>{}),a}function xC(n,{blocked:e}={}){const t=indexedDB.deleteDatabase(n);return e&&t.addEventListener("blocked",r=>e(r.oldVersion,r)),sa(t).then(()=>{})}const gye=["get","getKey","getAll","getAllKeys","count"],_ye=["put","add","delete","clear"],AC=new Map;function aW(n,e){if(!(n instanceof IDBDatabase)||e in n||"string"!=typeof e)return;if(AC.get(e))return AC.get(e);const t=e.replace(/FromIndex$/,""),r=e!==t,i=_ye.includes(t);if(!(t in(r?IDBIndex:IDBObjectStore).prototype)||!i&&!gye.includes(t))return;const s=function(){var o=O(function*(a,...c){const l=this.transaction(a,i?"readwrite":"readonly");let u=l.store;return r&&(u=u.index(c.shift())),(yield Promise.all([u[t](...c),i&&l.done]))[0]});return function(c){return o.apply(this,arguments)}}();return AC.set(e,s),s}!function fye(n){IC=n(IC)}(n=>({...n,get:(e,t,r)=>aW(e,t)||n.get(e,t,r),has:(e,t)=>!!aW(e,t)||n.has(e,t)}));class yye{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(t=>{if(function vye(n){const e=n.getComponent();return"VERSION"===e?.type}(t)){const r=t.getImmediate();return`${r.library}/${r.version}`}return null}).filter(t=>t).join(" ")}}const g0="@firebase/app",oa=new m0("@firebase/app"),Eye="@firebase/app-compat",bye="@firebase/analytics-compat",Tye="@firebase/analytics",wye="@firebase/app-check-compat",Iye="@firebase/app-check",Sye="@firebase/auth",xye="@firebase/auth-compat",Aye="@firebase/database",Mye="@firebase/data-connect",Cye="@firebase/database-compat",Dye="@firebase/functions",Rye="@firebase/functions-compat",Pye="@firebase/installations",Nye="@firebase/installations-compat",Oye="@firebase/messaging",kye="@firebase/messaging-compat",Lye="@firebase/performance",Fye="@firebase/performance-compat",Vye="@firebase/remote-config",Uye="@firebase/remote-config-compat",Bye="@firebase/storage",Hye="@firebase/storage-compat",zye="@firebase/firestore",Gye="@firebase/ai",Wye="@firebase/firestore-compat",jye="firebase",_0="[DEFAULT]",qye={[g0]:"fire-core",[Eye]:"fire-core-compat",[Tye]:"fire-analytics",[bye]:"fire-analytics-compat",[Iye]:"fire-app-check",[wye]:"fire-app-check-compat",[Sye]:"fire-auth",[xye]:"fire-auth-compat",[Aye]:"fire-rtdb",[Mye]:"fire-data-connect",[Cye]:"fire-rtdb-compat",[Dye]:"fire-fn",[Rye]:"fire-fn-compat",[Pye]:"fire-iid",[Nye]:"fire-iid-compat",[Oye]:"fire-fcm",[kye]:"fire-fcm-compat",[Lye]:"fire-perf",[Fye]:"fire-perf-compat",[Vye]:"fire-rc",[Uye]:"fire-rc-compat",[Bye]:"fire-gcs",[Hye]:"fire-gcs-compat",[zye]:"fire-fst",[Wye]:"fire-fst-compat",[Gye]:"fire-vertex","fire-js":"fire-js",[jye]:"fire-js-all"},eu=new Map,lg=new Map,ug=new Map;function cW(n,e){try{n.container.addComponent(e)}catch(t){oa.debug(`Component ${e.name} failed to register with FirebaseApp ${n.name}`,t)}}function aa(n){const e=n.name;if(ug.has(e))return oa.debug(`There were multiple attempts to register component ${e}.`),!1;ug.set(e,n);for(const t of eu.values())cW(t,n);for(const t of lg.values())cW(t,n);return!0}function dg(n,e){const t=n.container.getProvider("heartbeat").getImmediate({optional:!0});return t&&t.triggerHeartbeat(),n.container.getProvider(e)}function Rs(n){return null!=n&&void 0!==n.settings}const Ps=new bh("app","Firebase",{"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."});class lW{constructor(e,t,r){this._isDeleted=!1,this._options=Object.assign({},e),this._config=Object.assign({},t),this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=r,this.container.addComponent(new vo("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw Ps.create("app-deleted",{appName:this._name})}}const Th="11.10.0";function dW(n,e={}){let t=n;"object"!=typeof e&&(e={name:e});const r=Object.assign({name:_0,automaticDataCollectionEnabled:!0},e),i=r.name;if("string"!=typeof i||!i)throw Ps.create("bad-app-name",{appName:String(i)});if(t||(t=X6()),!t)throw Ps.create("no-options");const s=eu.get(i);if(s){if(ia(t,s.options)&&ia(r,s.config))return s;throw Ps.create("duplicate-app",{appName:i})}const o=new iye(i);for(const c of ug.values())o.addComponent(c);const a=new lW(t,r,o);return eu.set(i,a),a}function y0(n=_0){const e=eu.get(n);if(!e&&n===_0&&X6())return dW();if(!e)throw Ps.create("no-app",{appName:n});return e}function hW(){return Array.from(eu.values())}function Ur(n,e,t){var r;let i=null!==(r=qye[n])&&void 0!==r?r:n;t&&(i+=`-${t}`);const s=i.match(/\s|\//),o=e.match(/\s|\//);if(s||o){const a=[`Unable to register library "${i}" with version "${e}":`];return s&&a.push(`library name "${i}" contains illegal characters (whitespace or "/")`),s&&o&&a.push("and"),o&&a.push(`version name "${e}" contains illegal characters (whitespace or "/")`),void oa.warn(a.join(" "))}aa(new vo(`${i}-version`,()=>({library:i,version:e}),"VERSION"))}const hg="firebase-heartbeat-store";let DC=null;function fW(){return DC||(DC=cg("firebase-heartbeat-database",1,{upgrade:(n,e)=>{if(0===e)try{n.createObjectStore(hg)}catch(t){console.warn(t)}}}).catch(n=>{throw Ps.create("idb-open",{originalErrorMessage:n.message})})),DC}function RC(){return(RC=O(function*(n){try{const t=(yield fW()).transaction(hg),r=yield t.objectStore(hg).get(mW(n));return yield t.done,r}catch(e){if(e instanceof yo)oa.warn(e.message);else{const t=Ps.create("idb-get",{originalErrorMessage:e?.message});oa.warn(t.message)}}})).apply(this,arguments)}function pW(n,e){return PC.apply(this,arguments)}function PC(){return(PC=O(function*(n,e){try{const r=(yield fW()).transaction(hg,"readwrite");yield r.objectStore(hg).put(e,mW(n)),yield r.done}catch(t){if(t instanceof yo)oa.warn(t.message);else{const r=Ps.create("idb-set",{originalErrorMessage:t?.message});oa.warn(r.message)}}})).apply(this,arguments)}function mW(n){return`${n.name}!${n.options.appId}`}class rve{constructor(e){this.container=e,this._heartbeatsCache=null;const t=this.container.getProvider("app").getImmediate();this._storage=new sve(t),this._heartbeatsCachePromise=this._storage.read().then(r=>(this._heartbeatsCache=r,r))}triggerHeartbeat(){var e=this;return O(function*(){var t,r;try{const s=e.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),o=gW();if(null==(null===(t=e._heartbeatsCache)||void 0===t?void 0:t.heartbeats)&&(e._heartbeatsCache=yield e._heartbeatsCachePromise,null==(null===(r=e._heartbeatsCache)||void 0===r?void 0:r.heartbeats))||e._heartbeatsCache.lastSentHeartbeatDate===o||e._heartbeatsCache.heartbeats.some(a=>a.date===o))return;if(e._heartbeatsCache.heartbeats.push({date:o,agent:s}),e._heartbeatsCache.heartbeats.length>30){const a=function ove(n){if(0===n.length)return-1;let e=0,t=n[0].date;for(let r=1;r<n.length;r++)n[r].date<t&&(t=n[r].date,e=r);return e}(e._heartbeatsCache.heartbeats);e._heartbeatsCache.heartbeats.splice(a,1)}return e._storage.overwrite(e._heartbeatsCache)}catch(i){oa.warn(i)}})()}getHeartbeatsHeader(){var e=this;return O(function*(){var t;try{if(null===e._heartbeatsCache&&(yield e._heartbeatsCachePromise),null==(null===(t=e._heartbeatsCache)||void 0===t?void 0:t.heartbeats)||0===e._heartbeatsCache.heartbeats.length)return"";const r=gW(),{heartbeatsToSend:i,unsentEntries:s}=function ive(n,e=1024){const t=[];let r=n.slice();for(const i of n){const s=t.find(o=>o.agent===i.agent);if(s){if(s.dates.push(i.date),_W(t)>e){s.dates.pop();break}}else if(t.push({agent:i.agent,dates:[i.date]}),_W(t)>e){t.pop();break}r=r.slice(1)}return{heartbeatsToSend:t,unsentEntries:r}}(e._heartbeatsCache.heartbeats),o=d0(JSON.stringify({version:2,heartbeats:i}));return e._heartbeatsCache.lastSentHeartbeatDate=r,s.length>0?(e._heartbeatsCache.heartbeats=s,yield e._storage.overwrite(e._heartbeatsCache)):(e._heartbeatsCache.heartbeats=[],e._storage.overwrite(e._heartbeatsCache)),o}catch(r){return oa.warn(r),""}})()}}function gW(){return(new Date).toISOString().substring(0,10)}class sve{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}runIndexedDBEnvironmentCheck(){return O(function*(){return!!_C()&&function z_e(){return new Promise((n,e)=>{try{let t=!0;const r="validate-browser-context-for-indexeddb-analytics-module",i=self.indexedDB.open(r);i.onsuccess=()=>{i.result.close(),t||self.indexedDB.deleteDatabase(r),n(!0)},i.onupgradeneeded=()=>{t=!1},i.onerror=()=>{var s;e((null===(s=i.error)||void 0===s?void 0:s.message)||"")}}catch(t){e(t)}})}().then(()=>!0).catch(()=>!1)})()}read(){var e=this;return O(function*(){if(yield e._canUseIndexedDBPromise){const r=yield function eve(n){return RC.apply(this,arguments)}(e.app);return r?.heartbeats?r:{heartbeats:[]}}return{heartbeats:[]}})()}overwrite(e){var t=this;return O(function*(){var r;if(yield t._canUseIndexedDBPromise){const s=yield t.read();return pW(t.app,{lastSentHeartbeatDate:null!==(r=e.lastSentHeartbeatDate)&&void 0!==r?r:s.lastSentHeartbeatDate,heartbeats:e.heartbeats})}})()}add(e){var t=this;return O(function*(){var r;if(yield t._canUseIndexedDBPromise){const s=yield t.read();return pW(t.app,{lastSentHeartbeatDate:null!==(r=e.lastSentHeartbeatDate)&&void 0!==r?r:s.lastSentHeartbeatDate,heartbeats:[...s.heartbeats,...e.heartbeats]})}})()}}function _W(n){return d0(JSON.stringify({version:2,heartbeats:n})).length}!function ave(n){aa(new vo("platform-logger",e=>new yye(e),"PRIVATE")),aa(new vo("heartbeat",e=>new rve(e),"PRIVATE")),Ur(g0,"0.13.2",n),Ur(g0,"0.13.2","esm2017"),Ur("fire-js","")}(""),Ur("firebase","11.10.0","app");class pve extends ns{constructor(e,t){super()}schedule(e,t=0){return this}}const v0={setInterval(n,e,...t){const{delegate:r}=v0;return r?.setInterval?r.setInterval(n,e,...t):setInterval(n,e,...t)},clearInterval(n){const{delegate:e}=v0;return(e?.clearInterval||clearInterval)(n)},delegate:void 0};class yW extends pve{constructor(e,t){super(e,t),this.scheduler=e,this.work=t,this.pending=!1}schedule(e,t=0){var r;if(this.closed)return this;this.state=e;const i=this.id,s=this.scheduler;return null!=i&&(this.id=this.recycleAsyncId(s,i,t)),this.pending=!0,this.delay=t,this.id=null!==(r=this.id)&&void 0!==r?r:this.requestAsyncId(s,this.id,t),this}requestAsyncId(e,t,r=0){return v0.setInterval(e.flush.bind(e,this),r)}recycleAsyncId(e,t,r=0){if(null!=r&&this.delay===r&&!1===this.pending)return t;null!=t&&v0.clearInterval(t)}execute(e,t){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;const r=this._execute(e,t);if(r)return r;!1===this.pending&&null!=this.id&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))}_execute(e,t){let i,r=!1;try{this.work(e)}catch(s){r=!0,i=s||new Error("Scheduled action threw falsy error")}if(r)return this.unsubscribe(),i}unsubscribe(){if(!this.closed){const{id:e,scheduler:t}=this,{actions:r}=t;this.work=this.state=this.scheduler=null,this.pending=!1,_y(r,this),null!=e&&(this.id=this.recycleAsyncId(t,e,null)),this.delay=null,super.unsubscribe()}}}const vW={now:()=>(vW.delegate||Date).now(),delegate:void 0};class fg{constructor(e,t=fg.now){this.schedulerActionCtor=e,this.now=t}schedule(e,t=0,r){return new this.schedulerActionCtor(this,e).schedule(r,t)}}fg.now=vW.now;class EW extends fg{constructor(e,t=fg.now){super(e,t),this.actions=[],this._active=!1}flush(e){const{actions:t}=this;if(this._active)return void t.push(e);let r;this._active=!0;do{if(r=e.execute(e.state,e.delay))break}while(e=t.shift());if(this._active=!1,r){for(;e=t.shift();)e.unsubscribe();throw r}}}const _ve=new class gve extends EW{}(class mve extends yW{constructor(e,t){super(e,t),this.scheduler=e,this.work=t}schedule(e,t=0){return t>0?super.schedule(e,t):(this.delay=t,this.state=e,this.scheduler.flush(this),this)}execute(e,t){return t>0||this.closed?super.execute(e,t):this._execute(e,t)}requestAsyncId(e,t,r=0){return null!=r&&r>0||null==r&&this.delay>0?super.requestAsyncId(e,t,r):(e.flush(this),0)}}),yve=new EW(yW),pg=new _E("ANGULARFIRE2_VERSION");function E0(n,e,t){if(e){if(1===e.length)return e[0];const s=e.filter(o=>o.app===t);if(1===s.length)return s[0]}return t.container.getProvider(n).getImmediate({optional:!0})}const b0=(n,e)=>{const t=e?[e]:hW(),r=[];return t.forEach(i=>{i.container.getProvider(n).instances.forEach(o=>{r.includes(o)||r.push(o)})}),r};var wh=function(n){return n[n.SILENT=0]="SILENT",n[n.WARN=1]="WARN",n[n.VERBOSE=2]="VERBOSE",n}(wh||{}),NC=Uz()&&typeof Zone<"u"?wh.WARN:wh.SILENT;class bW{zone;delegate;constructor(e,t=_ve){this.zone=e,this.delegate=t}now(){return this.delegate.now()}schedule(e,t,r){const i=this.zone;return this.delegate.schedule(function(o){i?i.runGuarded(()=>{e.apply(this,[o])}):e.apply(this,[o])},t,r)}}let mg=(()=>{class n{outsideAngular;insideAngular;constructor(){const t=Ie(Vt);this.outsideAngular=t.runOutsideAngular(()=>new bW(typeof Zone>"u"?void 0:Zone.current)),this.insideAngular=t.run(()=>new bW(typeof Zone>"u"?void 0:Zone.current,yve))}static \u0275fac=function(r){return new(r||n)};static \u0275prov=Et({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();var TW=!1;function tu(n){const e=Ie(Vt,{optional:!0});return e?e.run(()=>n()):n()}const bve=(n,e,t)=>(...r)=>(e&&setTimeout(e,0),vd(t,()=>tu(()=>n.apply(void 0,r)))),Pr=(n,e,t)=>(t||=e?wh.WARN:wh.VERBOSE,function(){let r;const i=arguments;let s,o,a;try{s=Ie(mg),o=Ie(Rd),a=Ie(Ui)}catch{return function vve(n,e){!TW&&(NC>wh.SILENT||!1)&&(TW=!0,console.warn("Calling Firebase APIs outside of an Injection context may destabilize your application leading to subtle change-detection and hydration bugs. Find more at https://github.com/angular/angularfire/blob/main/docs/zones.md")),NC>=e&&console.warn(`Firebase API called outside injection context: ${n.name}`)}(n,t),n.apply(this,i)}for(let l=0;l<arguments.length;l++)"function"==typeof i[l]&&(e&&(r||=tu(()=>o.add())),i[l]=bve(i[l],r,a));const c=function Eve(n){const e=Ie(Vt,{optional:!0});return e?e.runOutsideAngular(()=>n()):n()}(()=>n.apply(this,i));return e?c instanceof jn?c.pipe(HE(s.outsideAngular),BE(s.insideAngular),function fve(n){void 0===n&&(n=Ie(Yr));const e=n.get(Rd);return t=>new jn(r=>{const i=e.add();let s=!1;function o(){s||(i(),s=!0)}const a=t.subscribe({next:c=>{r.next(c),o()},complete:()=>{r.complete(),o()},error:c=>{r.error(c),o()}});return a.add(()=>{r.unsubscribe(),o()}),a})}(a)):c instanceof Promise?tu(()=>{const l=o.add();return new Promise((u,d)=>{c.then(h=>vd(a,()=>tu(()=>u(h))),h=>vd(a,()=>tu(()=>d(h)))).finally(l)})}):"function"==typeof c&&r?function(){return setTimeout(r,0),c.apply(this,arguments)}:tu(()=>c):c instanceof jn?c.pipe(HE(s.outsideAngular),BE(s.insideAngular)):tu(()=>c)});class nu{constructor(e){return e}}class T0{constructor(){return hW()}}const OC=new Ae("angularfire2._apps"),wve={provide:nu,useFactory:function Tve(n){return n&&1===n.length?n[0]:new nu(y0())},deps:[[new ui,OC]]},Ive={provide:T0,deps:[[new ui,OC]]};function Sve(n){return(e,t)=>{const r=t.get(Zp);Ur("angularfire",pg.full,"core"),Ur("angularfire",pg.full,"app"),Ur("angular",Ide.full,r.toString());const i=e.runOutsideAngular(()=>n(t));return new nu(i)}}function xve(n,...e){return _l([wve,Ive,{provide:OC,useFactory:Sve(n),multi:!0,deps:[Vt,Yr,mg,...e]}])}const Ave=Pr(dW,!0),kC=new Map,wW={activated:!1,tokenObservers:[]},Mve={initialized:!1,enabled:!1};function rr(n){return kC.get(n)||Object.assign({},wW)}function w0(){return Mve}class Ove{constructor(e,t,r,i,s){if(this.operation=e,this.retryPolicy=t,this.getWaitDuration=r,this.lowerBound=i,this.upperBound=s,this.pending=null,this.nextErrorWaitInterval=i,i>s)throw new Error("Proactive refresh lower bound greater than upper bound!")}start(){this.nextErrorWaitInterval=this.lowerBound,this.process(!0).catch(()=>{})}stop(){this.pending&&(this.pending.reject("cancelled"),this.pending=null)}isRunning(){return!!this.pending}process(e){var t=this;return O(function*(){t.stop();try{t.pending=new f0,t.pending.promise.catch(r=>{}),yield function kve(n){return new Promise(e=>{setTimeout(e,n)})}(t.getNextRun(e)),t.pending.resolve(),yield t.pending.promise,t.pending=new f0,t.pending.promise.catch(r=>{}),yield t.operation(),t.pending.resolve(),yield t.pending.promise,t.process(!0).catch(()=>{})}catch(r){t.retryPolicy(r)?t.process(!1).catch(()=>{}):t.stop()}})()}getNextRun(e){if(e)return this.nextErrorWaitInterval=this.lowerBound,this.getWaitDuration();{const t=this.nextErrorWaitInterval;return this.nextErrorWaitInterval*=2,this.nextErrorWaitInterval>this.upperBound&&(this.nextErrorWaitInterval=this.upperBound),t}}}const ei=new bh("appCheck","AppCheck",{"already-initialized":"You have already called initializeAppCheck() for FirebaseApp {$appName} with different options. To avoid this error, call initializeAppCheck() with the same options as when it was originally called. This will return the already initialized instance.","use-before-activation":"App Check is being used before initializeAppCheck() is called for FirebaseApp {$appName}. Call initializeAppCheck() before instantiating other Firebase services.","fetch-network-error":"Fetch failed to connect to a network. Check Internet connection. Original error: {$originalErrorMessage}.","fetch-parse-error":"Fetch client could not parse response. Original error: {$originalErrorMessage}.","fetch-status-error":"Fetch server returned an HTTP error status. HTTP status: {$httpStatus}.","storage-open":"Error thrown when opening storage. Original error: {$originalErrorMessage}.","storage-get":"Error thrown when reading from storage. Original error: {$originalErrorMessage}.","storage-set":"Error thrown when writing to storage. Original error: {$originalErrorMessage}.","recaptcha-error":"ReCAPTCHA error.","initial-throttle":"{$httpStatus} error. Attempts allowed again after {$time}",throttled:"Requests throttled due to previous {$httpStatus} error. Attempts allowed again after {$time}"});function FC(n){if(!rr(n).activated)throw ei.create("use-before-activation",{appName:n.name})}function x0(n,e){return UC.apply(this,arguments)}function UC(){return(UC=O(function*({url:n,body:e},t){const r={"Content-Type":"application/json"},i=t.getImmediate({optional:!0});if(i){const d=yield i.getHeartbeatsHeader();d&&(r["X-Firebase-Client"]=d)}const s={method:"POST",body:JSON.stringify(e),headers:r};let o,a;try{o=yield fetch(n,s)}catch(d){throw ei.create("fetch-network-error",{originalErrorMessage:d?.message})}if(200!==o.status)throw ei.create("fetch-status-error",{httpStatus:o.status});try{a=yield o.json()}catch(d){throw ei.create("fetch-parse-error",{originalErrorMessage:d?.message})}const c=a.ttl.match(/^([\d.]+)(s)$/);if(!c||!c[2]||isNaN(Number(c[1])))throw ei.create("fetch-parse-error",{originalErrorMessage:`ttl field (timeToLive) is not in standard Protobuf Duration format: ${a.ttl}`});const l=1e3*Number(c[1]),u=Date.now();return{token:a.token,expireTimeMillis:u+l,issuedAtTimeMillis:u}})).apply(this,arguments)}function SW(n,e){const{projectId:t,appId:r,apiKey:i}=n.options;return{url:`https://content-firebaseappcheck.googleapis.com/v1/projects/${t}/apps/${r}:exchangeDebugToken?key=${i}`,body:{debug_token:e}}}const gg="firebase-app-check-store";let A0=null;function BC(){return(BC=O(function*(n,e){const r=(yield function AW(){return A0||(A0=new Promise((n,e)=>{try{const t=indexedDB.open("firebase-app-check-database",1);t.onsuccess=r=>{n(r.target.result)},t.onerror=r=>{var i;e(ei.create("storage-open",{originalErrorMessage:null===(i=r.target.error)||void 0===i?void 0:i.message}))},t.onupgradeneeded=r=>{0===r.oldVersion&&r.target.result.createObjectStore(gg,{keyPath:"compositeKey"})}}catch(t){e(ei.create("storage-open",{originalErrorMessage:t?.message}))}}),A0)}()).transaction(gg,"readwrite"),s=r.objectStore(gg).put({compositeKey:n,value:e});return new Promise((o,a)=>{s.onsuccess=c=>{o()},r.onerror=c=>{var l;a(ei.create("storage-set",{originalErrorMessage:null===(l=c.target.error)||void 0===l?void 0:l.message}))}})})).apply(this,arguments)}const yc=new m0("@firebase/app-check");function GC(n,e){return _C()?function zve(n,e){return function MW(n,e){return BC.apply(this,arguments)}(function DW(n){return`${n.options.appId}-${n.name}`}(n),e)}(n,e).catch(t=>{yc.warn(`Failed to write token to IndexedDB. Error: ${t}`)}):Promise.resolve()}function jC(){return w0().enabled}function $C(){return qC.apply(this,arguments)}function qC(){return(qC=O(function*(){const n=w0();if(n.enabled&&n.token)return n.token.promise;throw Error("\n            Can't get debug token in production mode.\n        ")})).apply(this,arguments)}const Xve={error:"UNKNOWN_ERROR"};function Kve(n){return fC.encodeString(JSON.stringify(n),!1)}function M0(n){return XC.apply(this,arguments)}function XC(){return(XC=O(function*(n,e=!1,t=!1){const r=n.app;FC(r);const i=rr(r);let o,s=i.token;if(s&&!Ih(s)&&(i.token=void 0,s=void 0),!s){const l=yield i.cachedTokenPromise;l&&(Ih(l)?s=l:yield GC(r,void 0))}if(!e&&s&&Ih(s))return{token:s.token};let c,a=!1;if(jC())try{i.exchangeTokenPromise||(i.exchangeTokenPromise=x0(SW(r,yield $C()),n.heartbeatServiceProvider).finally(()=>{i.exchangeTokenPromise=void 0}),a=!0);const l=yield i.exchangeTokenPromise;return yield GC(r,l),i.token=l,{token:l.token}}catch(l){return"appCheck/throttled"===l.code||"appCheck/initial-throttle"===l.code?yc.warn(l.message):t&&yc.error(l),ZC(l)}try{i.exchangeTokenPromise||(i.exchangeTokenPromise=i.provider.getToken().finally(()=>{i.exchangeTokenPromise=void 0}),a=!0),s=yield rr(r).exchangeTokenPromise}catch(l){"appCheck/throttled"===l.code||"appCheck/initial-throttle"===l.code?yc.warn(l.message):t&&yc.error(l),o=l}return s?o?c=Ih(s)?{token:s.token,internalError:o}:ZC(o):(c={token:s.token},i.token=s,yield GC(r,s)):c=ZC(o),a&&function NW(n,e){const t=rr(n).tokenObservers;for(const r of t)try{"EXTERNAL"===r.type&&null!=e.error?r.error(e.error):r.next(e)}catch{}}(r,c),c})).apply(this,arguments)}function KC(){return(KC=O(function*(n){const e=n.app;FC(e);const{provider:t}=rr(e);if(jC()){const r=yield $C(),{token:i}=yield x0(SW(e,r),n.heartbeatServiceProvider);return{token:i}}{const{token:r}=yield t.getToken();return{token:r}}})).apply(this,arguments)}function JC(n,e){const t=rr(n),r=t.tokenObservers.filter(i=>i.next!==e);0===r.length&&t.tokenRefresher&&t.tokenRefresher.isRunning()&&t.tokenRefresher.stop(),t.tokenObservers=r}function PW(n){const{app:e}=n,t=rr(e);let r=t.tokenRefresher;r||(r=function Yve(n){const{app:e}=n;return new Ove(O(function*(){let r;if(r=rr(e).token?yield M0(n,!0):yield M0(n),r.error)throw r.error;if(r.internalError)throw r.internalError}),()=>!0,()=>{const t=rr(e);if(t.token){let r=t.token.issuedAtTimeMillis+.5*(t.token.expireTimeMillis-t.token.issuedAtTimeMillis)+3e5;return r=Math.min(r,t.token.expireTimeMillis-3e5),Math.max(0,r-Date.now())}return 0},3e4,96e4)}(n),t.tokenRefresher=r),!r.isRunning()&&t.isTokenAutoRefreshEnabled&&r.start()}function Ih(n){return n.expireTimeMillis-Date.now()>0}function ZC(n){return{token:Kve(Xve),error:n}}class Jve{constructor(e,t){this.app=e,this.heartbeatServiceProvider=t}_delete(){const{tokenObservers:e}=rr(this.app);for(const t of e)JC(this.app,t.next);return Promise.resolve()}}const HW="app-check-internal";!function dEe(){aa(new vo("app-check",n=>function Zve(n,e){return new Jve(n,e)}(n.getProvider("app").getImmediate(),n.getProvider("heartbeat")),"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((n,e,t)=>{n.getProvider(HW).initialize()})),aa(new vo(HW,n=>function Qve(n){return{getToken:e=>M0(n,e),getLimitedUseToken:()=>function RW(n){return KC.apply(this,arguments)}(n),addTokenListener:e=>function YC(n,e,t,r){const{app:i}=n,s=rr(i);if(s.tokenObservers=[...s.tokenObservers,{next:t,error:r,type:e}],s.token&&Ih(s.token)){const a=s.token;Promise.resolve().then(()=>{t({token:a.token}),PW(n)}).catch(()=>{})}s.cachedTokenPromise.then(()=>PW(n))}(n,"INTERNAL",e),removeTokenListener:e=>JC(n.app,e)}}(n.getProvider("app-check").getImmediate()),"PUBLIC").setInstantiationMode("EXPLICIT")),Ur("@firebase/app-check","0.10.1")}();class D0{constructor(){return b0("app-check")}}typeof window<"u"&&window;const _Ee=function GW(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}},WW=new bh("auth","Firebase",{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}),R0=new m0("@firebase/auth");function P0(n,...e){R0.logLevel<=qt.ERROR&&R0.error(`Auth (${Th}): ${n}`,...e)}function Xi(n,...e){throw iD(n,...e)}function Ci(n,...e){return iD(n,...e)}function rD(n,e,t){const r=Object.assign(Object.assign({},_Ee()),{[e]:t});return new bh("auth","Firebase",r).create(e,{appName:n.name})}function Br(n){return rD(n,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function iD(n,...e){if("string"!=typeof n){const t=e[0],r=[...e.slice(1)];return r[0]&&(r[0].appName=n.name),n._errorFactory.create(t,...r)}return WW.create(n,...e)}function Se(n,e,...t){if(!n)throw iD(e,...t)}function Eo(n){const e="INTERNAL ASSERTION FAILED: "+n;throw P0(e),new Error(e)}function ca(n,e){n||Eo(e)}function _g(){var n;return typeof self<"u"&&(null===(n=self.location)||void 0===n?void 0:n.href)||""}function jW(){var n;return typeof self<"u"&&(null===(n=self.location)||void 0===n?void 0:n.protocol)||null}function vEe(){return!(typeof navigator<"u"&&navigator&&"onLine"in navigator&&"boolean"==typeof navigator.onLine&&(function sD(){return"http:"===jW()||"https:"===jW()}()||function U_e(){const n="object"==typeof chrome?chrome.runtime:"object"==typeof browser?browser.runtime:void 0;return"object"==typeof n&&void 0!==n.id}()||"connection"in navigator))||navigator.onLine}class yg{constructor(e,t){this.shortDelay=e,this.longDelay=t,ca(t>e,"Short delay should be less than long delay!"),this.isMobile=function L_e(){return typeof window<"u"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(dr())}()||function B_e(){return"object"==typeof navigator&&"ReactNative"===navigator.product}()}get(){return vEe()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}function oD(n,e){ca(n.emulator,"Emulator should always be set here");const{url:t}=n.emulator;return e?`${t}${e.startsWith("/")?e.slice(1):e}`:t}class $W{static initialize(e,t,r){this.fetchImpl=e,t&&(this.headersImpl=t),r&&(this.responseImpl=r)}static fetch(){return this.fetchImpl?this.fetchImpl:typeof self<"u"&&"fetch"in self?self.fetch:typeof globalThis<"u"&&globalThis.fetch?globalThis.fetch:typeof fetch<"u"?fetch:void Eo("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){return this.headersImpl?this.headersImpl:typeof self<"u"&&"Headers"in self?self.Headers:typeof globalThis<"u"&&globalThis.Headers?globalThis.Headers:typeof Headers<"u"?Headers:void Eo("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){return this.responseImpl?this.responseImpl:typeof self<"u"&&"Response"in self?self.Response:typeof globalThis<"u"&&globalThis.Response?globalThis.Response:typeof Response<"u"?Response:void Eo("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}const bEe={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"},TEe=["/v1/accounts:signInWithCustomToken","/v1/accounts:signInWithEmailLink","/v1/accounts:signInWithIdp","/v1/accounts:signInWithPassword","/v1/accounts:signInWithPhoneNumber","/v1/token"],wEe=new yg(3e4,6e4);function Rn(n,e){return n.tenantId&&!e.tenantId?Object.assign(Object.assign({},e),{tenantId:n.tenantId}):e}function Pn(n,e,t,r){return aD.apply(this,arguments)}function aD(){return(aD=O(function*(n,e,t,r,i={}){return qW(n,i,O(function*(){let s={},o={};r&&("GET"===e?o=r:s={body:JSON.stringify(r)});const a=ag(Object.assign({key:n.config.apiKey},o)).slice(1),c=yield n._getAdditionalHeaders();c["Content-Type"]="application/json",n.languageCode&&(c["X-Firebase-Locale"]=n.languageCode);const l=Object.assign({method:e,headers:c},s);return function V_e(){return typeof navigator<"u"&&"Cloudflare-Workers"===navigator.userAgent}()||(l.referrerPolicy="no-referrer"),n.emulatorConfig&&Zl(n.emulatorConfig.host)&&(l.credentials="include"),$W.fetch()(yield XW(n,n.config.apiHost,t,a),l)}))})).apply(this,arguments)}function qW(n,e,t){return cD.apply(this,arguments)}function cD(){return(cD=O(function*(n,e,t){n._canInitEmulator=!1;const r=Object.assign(Object.assign({},bEe),e);try{const i=new SEe(n),s=yield Promise.race([t(),i.promise]);i.clearNetworkTimeout();const o=yield s.json();if("needConfirmation"in o)throw vg(n,"account-exists-with-different-credential",o);if(s.ok&&!("errorMessage"in o))return o;{const a=s.ok?o.errorMessage:o.error.message,[c,l]=a.split(" : ");if("FEDERATED_USER_ID_ALREADY_LINKED"===c)throw vg(n,"credential-already-in-use",o);if("EMAIL_EXISTS"===c)throw vg(n,"email-already-in-use",o);if("USER_DISABLED"===c)throw vg(n,"user-disabled",o);const u=r[c]||c.toLowerCase().replace(/[_\s]+/g,"-");if(l)throw rD(n,u,l);Xi(n,u)}}catch(i){if(i instanceof yo)throw i;Xi(n,"network-request-failed",{message:String(i)})}})).apply(this,arguments)}function lD(){return(lD=O(function*(n,e,t,r,i={}){const s=yield Pn(n,e,t,r,i);return"mfaPendingCredential"in s&&Xi(n,"multi-factor-auth-required",{_serverResponse:s}),s})).apply(this,arguments)}function XW(n,e,t,r){return uD.apply(this,arguments)}function uD(){return(uD=O(function*(n,e,t,r){const i=`${e}${t}?${r}`,s=n,o=s.config.emulator?oD(n.config,i):`${n.config.apiScheme}://${i}`;return TEe.includes(t)&&(yield s._persistenceManagerAvailable,"COOKIE"===s._getPersistenceType())?s._getPersistence()._getFinalTarget(o).toString():o})).apply(this,arguments)}class SEe{clearNetworkTimeout(){clearTimeout(this.timer)}constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((t,r)=>{this.timer=setTimeout(()=>r(Ci(this.auth,"network-request-failed")),wEe.get())})}}function vg(n,e,t){const r={appName:n.name};t.email&&(r.email=t.email),t.phoneNumber&&(r.phoneNumber=t.phoneNumber);const i=Ci(n,e,r);return i.customData._tokenResponse=t,i}function fD(){return(fD=O(function*(n,e){return Pn(n,"POST","/v1/accounts:delete",e)})).apply(this,arguments)}function N0(n,e){return mD.apply(this,arguments)}function mD(){return(mD=O(function*(n,e){return Pn(n,"POST","/v1/accounts:lookup",e)})).apply(this,arguments)}function Eg(n){if(n)try{const e=new Date(Number(n));if(!isNaN(e.getTime()))return e.toUTCString()}catch{}}function gD(){return(gD=O(function*(n,e=!1){const t=Xn(n),r=yield t.getIdToken(e),i=O0(r);Se(i&&i.exp&&i.auth_time&&i.iat,t.auth,"internal-error");const s="object"==typeof i.firebase?i.firebase:void 0,o=s?.sign_in_provider;return{claims:i,token:r,authTime:Eg(_D(i.auth_time)),issuedAtTime:Eg(_D(i.iat)),expirationTime:Eg(_D(i.exp)),signInProvider:o||null,signInSecondFactor:s?.sign_in_second_factor||null}})).apply(this,arguments)}function _D(n){return 1e3*Number(n)}function O0(n){const[e,t,r]=n.split(".");if(void 0===e||void 0===t||void 0===r)return P0("JWT malformed, contained fewer than 3 sections"),null;try{const i=sg(t);return i?JSON.parse(i):(P0("Failed to decode base64 JWT payload"),null)}catch(i){return P0("Caught error parsing JWT payload as JSON",i?.toString()),null}}function QW(n){const e=O0(n);return Se(e,"internal-error"),Se(typeof e.exp<"u","internal-error"),Se(typeof e.iat<"u","internal-error"),Number(e.exp)-Number(e.iat)}function ua(n,e){return yD.apply(this,arguments)}function yD(){return(yD=O(function*(n,e,t=!1){if(t)return e;try{return yield e}catch(r){throw r instanceof yo&&function REe({code:n}){return"auth/user-disabled"===n||"auth/user-token-expired"===n}(r)&&n.auth.currentUser===n&&(yield n.auth.signOut()),r}})).apply(this,arguments)}class PEe{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,null!==this.timerId&&clearTimeout(this.timerId))}getInterval(e){var t;if(e){const r=this.errorBackoff;return this.errorBackoff=Math.min(2*this.errorBackoff,96e4),r}{this.errorBackoff=3e4;const i=(null!==(t=this.user.stsTokenManager.expirationTime)&&void 0!==t?t:0)-Date.now()-3e5;return Math.max(0,i)}}schedule(e=!1){var t=this;if(!this.isRunning)return;const r=this.getInterval(e);this.timerId=setTimeout(O(function*(){yield t.iteration()}),r)}iteration(){var e=this;return O(function*(){try{yield e.user.getIdToken(!0)}catch(t){return void("auth/network-request-failed"===t?.code&&e.schedule(!0))}e.schedule()})()}}class vD{constructor(e,t){this.createdAt=e,this.lastLoginAt=t,this._initializeTime()}_initializeTime(){this.lastSignInTime=Eg(this.lastLoginAt),this.creationTime=Eg(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}function bg(n){return ED.apply(this,arguments)}function ED(){return(ED=O(function*(n){var e;const t=n.auth,r=yield n.getIdToken(),i=yield ua(n,N0(t,{idToken:r}));Se(i?.users.length,t,"internal-error");const s=i.users[0];n._notifyReloadListener(s);const o=null!==(e=s.providerUserInfo)&&void 0!==e&&e.length?ej(s.providerUserInfo):[],a=function OEe(n,e){return[...n.filter(r=>!e.some(i=>i.providerId===r.providerId)),...e]}(n.providerData,o),u=!!n.isAnonymous&&!(n.email&&s.passwordHash||a?.length),d={uid:s.localId,displayName:s.displayName||null,photoURL:s.photoUrl||null,email:s.email||null,emailVerified:s.emailVerified||!1,phoneNumber:s.phoneNumber||null,tenantId:s.tenantId||null,providerData:a,metadata:new vD(s.createdAt,s.lastLoginAt),isAnonymous:u};Object.assign(n,d)})).apply(this,arguments)}function bD(){return(bD=O(function*(n){const e=Xn(n);yield bg(e),yield e.auth._persistUserIfCurrent(e),e.auth._notifyListenersIfCurrent(e)})).apply(this,arguments)}function ej(n){return n.map(e=>{var{providerId:t}=e,r=UE(e,["providerId"]);return{providerId:t,uid:r.rawId||"",displayName:r.displayName||null,email:r.email||null,phoneNumber:r.phoneNumber||null,photoURL:r.photoUrl||null}})}function TD(){return(TD=O(function*(n,e){const t=yield qW(n,{},O(function*(){const r=ag({grant_type:"refresh_token",refresh_token:e}).slice(1),{tokenApiHost:i,apiKey:s}=n.config,o=yield XW(n,i,"/v1/token",`key=${s}`),a=yield n._getAdditionalHeaders();a["Content-Type"]="application/x-www-form-urlencoded";const c={method:"POST",headers:a,body:r};return n.emulatorConfig&&Zl(n.emulatorConfig.host)&&(c.credentials="include"),$W.fetch()(o,c)}));return{accessToken:t.access_token,expiresIn:t.expires_in,refreshToken:t.refresh_token}})).apply(this,arguments)}function wD(){return(wD=O(function*(n,e){return Pn(n,"POST","/v2/accounts:revokeToken",Rn(n,e))})).apply(this,arguments)}class xh{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){Se(e.idToken,"internal-error"),Se(typeof e.idToken<"u","internal-error"),Se(typeof e.refreshToken<"u","internal-error");const t="expiresIn"in e&&typeof e.expiresIn<"u"?Number(e.expiresIn):QW(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,t)}updateFromIdToken(e){Se(0!==e.length,"internal-error");const t=QW(e);this.updateTokensAndExpiration(e,null,t)}getToken(e){var t=this;return O(function*(r,i=!1){return i||!t.accessToken||t.isExpired?(Se(t.refreshToken,r,"user-token-expired"),t.refreshToken?(yield t.refresh(r,t.refreshToken),t.accessToken):null):t.accessToken}).apply(this,arguments)}clearRefreshToken(){this.refreshToken=null}refresh(e,t){var r=this;return O(function*(){const{accessToken:i,refreshToken:s,expiresIn:o}=yield function kEe(n,e){return TD.apply(this,arguments)}(e,t);r.updateTokensAndExpiration(i,s,Number(o))})()}updateTokensAndExpiration(e,t,r){this.refreshToken=t||null,this.accessToken=e||null,this.expirationTime=Date.now()+1e3*r}static fromJSON(e,t){const{refreshToken:r,accessToken:i,expirationTime:s}=t,o=new xh;return r&&(Se("string"==typeof r,"internal-error",{appName:e}),o.refreshToken=r),i&&(Se("string"==typeof i,"internal-error",{appName:e}),o.accessToken=i),s&&(Se("number"==typeof s,"internal-error",{appName:e}),o.expirationTime=s),o}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new xh,this.toJSON())}_performRefresh(){return Eo("not implemented")}}function vc(n,e){Se("string"==typeof n||typeof n>"u","internal-error",{appName:e})}class Xs{constructor(e){var{uid:t,auth:r,stsTokenManager:i}=e,s=UE(e,["uid","auth","stsTokenManager"]);this.providerId="firebase",this.proactiveRefresh=new PEe(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=t,this.auth=r,this.stsTokenManager=i,this.accessToken=i.accessToken,this.displayName=s.displayName||null,this.email=s.email||null,this.emailVerified=s.emailVerified||!1,this.phoneNumber=s.phoneNumber||null,this.photoURL=s.photoURL||null,this.isAnonymous=s.isAnonymous||!1,this.tenantId=s.tenantId||null,this.providerData=s.providerData?[...s.providerData]:[],this.metadata=new vD(s.createdAt||void 0,s.lastLoginAt||void 0)}getIdToken(e){var t=this;return O(function*(){const r=yield ua(t,t.stsTokenManager.getToken(t.auth,e));return Se(r,t.auth,"internal-error"),t.accessToken!==r&&(t.accessToken=r,yield t.auth._persistUserIfCurrent(t),t.auth._notifyListenersIfCurrent(t)),r})()}getIdTokenResult(e){return function DEe(n){return gD.apply(this,arguments)}(this,e)}reload(){return function NEe(n){return bD.apply(this,arguments)}(this)}_assign(e){this!==e&&(Se(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(t=>Object.assign({},t)),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){const t=new Xs(Object.assign(Object.assign({},this),{auth:e,stsTokenManager:this.stsTokenManager._clone()}));return t.metadata._copy(this.metadata),t}_onReload(e){Se(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}_updateTokensIfNecessary(e){var t=this;return O(function*(r,i=!1){let s=!1;r.idToken&&r.idToken!==t.stsTokenManager.accessToken&&(t.stsTokenManager.updateFromServerResponse(r),s=!0),i&&(yield bg(t)),yield t.auth._persistUserIfCurrent(t),s&&t.auth._notifyListenersIfCurrent(t)}).apply(this,arguments)}delete(){var e=this;return O(function*(){if(Rs(e.auth.app))return Promise.reject(Br(e.auth));const t=yield e.getIdToken();return yield ua(e,function AEe(n,e){return fD.apply(this,arguments)}(e.auth,{idToken:t})),e.stsTokenManager.clearRefreshToken(),e.auth.signOut()})()}toJSON(){return Object.assign(Object.assign({uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>Object.assign({},e)),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId},this.metadata.toJSON()),{apiKey:this.auth.config.apiKey,appName:this.auth.name})}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,t){var r,i,s,o,a,c,l,u;const d=null!==(r=t.displayName)&&void 0!==r?r:void 0,h=null!==(i=t.email)&&void 0!==i?i:void 0,f=null!==(s=t.phoneNumber)&&void 0!==s?s:void 0,m=null!==(o=t.photoURL)&&void 0!==o?o:void 0,y=null!==(a=t.tenantId)&&void 0!==a?a:void 0,_=null!==(c=t._redirectEventId)&&void 0!==c?c:void 0,g=null!==(l=t.createdAt)&&void 0!==l?l:void 0,b=null!==(u=t.lastLoginAt)&&void 0!==u?u:void 0,{uid:E,emailVerified:x,isAnonymous:M,providerData:C,stsTokenManager:w}=t;Se(E&&w,e,"internal-error");const A=xh.fromJSON(this.name,w);Se("string"==typeof E,e,"internal-error"),vc(d,e.name),vc(h,e.name),Se("boolean"==typeof x,e,"internal-error"),Se("boolean"==typeof M,e,"internal-error"),vc(f,e.name),vc(m,e.name),vc(y,e.name),vc(_,e.name),vc(g,e.name),vc(b,e.name);const T=new Xs({uid:E,auth:e,email:h,emailVerified:x,displayName:d,isAnonymous:M,photoURL:m,phoneNumber:f,tenantId:y,stsTokenManager:A,createdAt:g,lastLoginAt:b});return C&&Array.isArray(C)&&(T.providerData=C.map(S=>Object.assign({},S))),_&&(T._redirectEventId=_),T}static _fromIdTokenResponse(e,t){return O(function*(r,i,s=!1){const o=new xh;o.updateFromServerResponse(i);const a=new Xs({uid:i.localId,auth:r,stsTokenManager:o,isAnonymous:s});return yield bg(a),a}).apply(this,arguments)}static _fromGetAccountInfoResponse(e,t,r){return O(function*(){const i=t.users[0];Se(void 0!==i.localId,"internal-error");const s=void 0!==i.providerUserInfo?ej(i.providerUserInfo):[],o=!(i.email&&i.passwordHash||s?.length),a=new xh;a.updateFromIdToken(r);const c=new Xs({uid:i.localId,auth:e,stsTokenManager:a,isAnonymous:o}),l={uid:i.localId,displayName:i.displayName||null,photoURL:i.photoUrl||null,email:i.email||null,emailVerified:i.emailVerified||!1,phoneNumber:i.phoneNumber||null,tenantId:i.tenantId||null,providerData:s,metadata:new vD(i.createdAt,i.lastLoginAt),isAnonymous:!(i.email&&i.passwordHash||s?.length)};return Object.assign(c,l),c})()}}const tj=new Map;function da(n){ca(n instanceof Function,"Expected a class definition");let e=tj.get(n);return e?(ca(e instanceof n,"Instance stored in cache mismatched with class"),e):(e=new n,tj.set(n,e),e)}const nj=(()=>{class n{constructor(){this.type="NONE",this.storage={}}_isAvailable(){return O(function*(){return!0})()}_set(t,r){var i=this;return O(function*(){i.storage[t]=r})()}_get(t){var r=this;return O(function*(){const i=r.storage[t];return void 0===i?null:i})()}_remove(t){var r=this;return O(function*(){delete r.storage[t]})()}_addListener(t,r){}_removeListener(t,r){}}return n.type="NONE",n})();function k0(n,e,t){return`firebase:${n}:${e}:${t}`}class Ah{constructor(e,t,r){this.persistence=e,this.auth=t,this.userKey=r;const{config:i,name:s}=this.auth;this.fullUserKey=k0(this.userKey,i.apiKey,s),this.fullPersistenceKey=k0("persistence",i.apiKey,s),this.boundEventHandler=t._onStorageEvent.bind(t),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}getCurrentUser(){var e=this;return O(function*(){const t=yield e.persistence._get(e.fullUserKey);if(!t)return null;if("string"==typeof t){const r=yield N0(e.auth,{idToken:t}).catch(()=>{});return r?Xs._fromGetAccountInfoResponse(e.auth,r,t):null}return Xs._fromJSON(e.auth,t)})()}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}setPersistence(e){var t=this;return O(function*(){if(t.persistence===e)return;const r=yield t.getCurrentUser();return yield t.removeCurrentUser(),t.persistence=e,r?t.setCurrentUser(r):void 0})()}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static create(e,t){return O(function*(r,i,s="authUser"){if(!i.length)return new Ah(da(nj),r,s);const o=(yield Promise.all(i.map(function(){var d=O(function*(h){if(yield h._isAvailable())return h});return function(h){return d.apply(this,arguments)}}()))).filter(d=>d);let a=o[0]||da(nj);const c=k0(s,r.config.apiKey,r.name);let l=null;for(const d of i)try{const h=yield d._get(c);if(h){let f;if("string"==typeof h){const m=yield N0(r,{idToken:h}).catch(()=>{});if(!m)break;f=yield Xs._fromGetAccountInfoResponse(r,m,h)}else f=Xs._fromJSON(r,h);d!==a&&(l=f),a=d;break}}catch{}const u=o.filter(d=>d._shouldAllowMigration);return a._shouldAllowMigration&&u.length?(a=u[0],l&&(yield a._set(c,l.toJSON())),yield Promise.all(i.map(function(){var d=O(function*(h){if(h!==a)try{yield h._remove(c)}catch{}});return function(h){return d.apply(this,arguments)}}())),new Ah(a,r,s)):new Ah(a,r,s)}).apply(this,arguments)}}function rj(n){const e=n.toLowerCase();if(e.includes("opera/")||e.includes("opr/")||e.includes("opios/"))return"Opera";if(aj(e))return"IEMobile";if(e.includes("msie")||e.includes("trident/"))return"IE";if(e.includes("edge/"))return"Edge";if(ij(e))return"Firefox";if(e.includes("silk/"))return"Silk";if(lj(e))return"Blackberry";if(uj(e))return"Webos";if(sj(e))return"Safari";if((e.includes("chrome/")||oj(e))&&!e.includes("edge/"))return"Chrome";if(cj(e))return"Android";{const r=n.match(/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/);if(2===r?.length)return r[1]}return"Other"}function ij(n=dr()){return/firefox\//i.test(n)}function sj(n=dr()){const e=n.toLowerCase();return e.includes("safari/")&&!e.includes("chrome/")&&!e.includes("crios/")&&!e.includes("android")}function oj(n=dr()){return/crios\//i.test(n)}function aj(n=dr()){return/iemobile/i.test(n)}function cj(n=dr()){return/android/i.test(n)}function lj(n=dr()){return/blackberry/i.test(n)}function uj(n=dr()){return/webos/i.test(n)}function ID(n=dr()){return/iphone|ipad|ipod/i.test(n)||/macintosh/i.test(n)&&/mobile/i.test(n)}function dj(n=dr()){return ID(n)||cj(n)||uj(n)||lj(n)||/windows phone/i.test(n)||aj(n)}function hj(n,e=[]){let t;switch(n){case"Browser":t=rj(dr());break;case"Worker":t=`${rj(dr())}-${n}`;break;default:t=n}const r=e.length?e.join(","):"FirebaseCore-web";return`${t}/JsCore/${Th}/${r}`}class UEe{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,t){const r=s=>new Promise((o,a)=>{try{o(e(s))}catch(c){a(c)}});r.onAbort=t,this.queue.push(r);const i=this.queue.length-1;return()=>{this.queue[i]=()=>Promise.resolve()}}runMiddleware(e){var t=this;return O(function*(){if(t.auth.currentUser===e)return;const r=[];try{for(const i of t.queue)yield i(e),i.onAbort&&r.push(i.onAbort)}catch(i){r.reverse();for(const s of r)try{s()}catch{}throw t.auth._errorFactory.create("login-blocked",{originalMessage:i?.message})}})()}}function SD(){return(SD=O(function*(n,e={}){return Pn(n,"GET","/v2/passwordPolicy",Rn(n,e))})).apply(this,arguments)}class zEe{constructor(e){var t,r,i,s;const o=e.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=null!==(t=o.minPasswordLength)&&void 0!==t?t:6,o.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=o.maxPasswordLength),void 0!==o.containsLowercaseCharacter&&(this.customStrengthOptions.containsLowercaseLetter=o.containsLowercaseCharacter),void 0!==o.containsUppercaseCharacter&&(this.customStrengthOptions.containsUppercaseLetter=o.containsUppercaseCharacter),void 0!==o.containsNumericCharacter&&(this.customStrengthOptions.containsNumericCharacter=o.containsNumericCharacter),void 0!==o.containsNonAlphanumericCharacter&&(this.customStrengthOptions.containsNonAlphanumericCharacter=o.containsNonAlphanumericCharacter),this.enforcementState=e.enforcementState,"ENFORCEMENT_STATE_UNSPECIFIED"===this.enforcementState&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=null!==(i=null===(r=e.allowedNonAlphanumericCharacters)||void 0===r?void 0:r.join(""))&&void 0!==i?i:"",this.forceUpgradeOnSignin=null!==(s=e.forceUpgradeOnSignin)&&void 0!==s&&s,this.schemaVersion=e.schemaVersion}validatePassword(e){var t,r,i,s,o,a;const c={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(e,c),this.validatePasswordCharacterOptions(e,c),c.isValid&&(c.isValid=null===(t=c.meetsMinPasswordLength)||void 0===t||t),c.isValid&&(c.isValid=null===(r=c.meetsMaxPasswordLength)||void 0===r||r),c.isValid&&(c.isValid=null===(i=c.containsLowercaseLetter)||void 0===i||i),c.isValid&&(c.isValid=null===(s=c.containsUppercaseLetter)||void 0===s||s),c.isValid&&(c.isValid=null===(o=c.containsNumericCharacter)||void 0===o||o),c.isValid&&(c.isValid=null===(a=c.containsNonAlphanumericCharacter)||void 0===a||a),c}validatePasswordLengthOptions(e,t){const r=this.customStrengthOptions.minPasswordLength,i=this.customStrengthOptions.maxPasswordLength;r&&(t.meetsMinPasswordLength=e.length>=r),i&&(t.meetsMaxPasswordLength=e.length<=i)}validatePasswordCharacterOptions(e,t){let r;this.updatePasswordCharacterOptionsStatuses(t,!1,!1,!1,!1);for(let i=0;i<e.length;i++)r=e.charAt(i),this.updatePasswordCharacterOptionsStatuses(t,r>="a"&&r<="z",r>="A"&&r<="Z",r>="0"&&r<="9",this.allowedNonAlphanumericCharacters.includes(r))}updatePasswordCharacterOptionsStatuses(e,t,r,i,s){this.customStrengthOptions.containsLowercaseLetter&&(e.containsLowercaseLetter||(e.containsLowercaseLetter=t)),this.customStrengthOptions.containsUppercaseLetter&&(e.containsUppercaseLetter||(e.containsUppercaseLetter=r)),this.customStrengthOptions.containsNumericCharacter&&(e.containsNumericCharacter||(e.containsNumericCharacter=i)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(e.containsNonAlphanumericCharacter||(e.containsNonAlphanumericCharacter=s))}}class GEe{constructor(e,t,r,i){this.app=e,this.heartbeatServiceProvider=t,this.appCheckServiceProvider=r,this.config=i,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new fj(this),this.idTokenSubscription=new fj(this),this.beforeStateQueue=new UEe(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=WW,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this._resolvePersistenceManagerAvailable=void 0,this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=i.sdkClientVersion,this._persistenceManagerAvailable=new Promise(s=>this._resolvePersistenceManagerAvailable=s)}_initializeWithPersistence(e,t){var r=this;return t&&(this._popupRedirectResolver=da(t)),this._initializationPromise=this.queue(O(function*(){var i,s,o;if(!r._deleted&&(r.persistenceManager=yield Ah.create(r,e),null===(i=r._resolvePersistenceManagerAvailable)||void 0===i||i.call(r),!r._deleted)){if(null!==(s=r._popupRedirectResolver)&&void 0!==s&&s._shouldInitProactively)try{yield r._popupRedirectResolver._initialize(r)}catch{}yield r.initializeCurrentUser(t),r.lastNotifiedUid=(null===(o=r.currentUser)||void 0===o?void 0:o.uid)||null,!r._deleted&&(r._isInitialized=!0)}})),this._initializationPromise}_onStorageEvent(){var e=this;return O(function*(){if(e._deleted)return;const t=yield e.assertedPersistence.getCurrentUser();if(e.currentUser||t){if(e.currentUser&&t&&e.currentUser.uid===t.uid)return e._currentUser._assign(t),void(yield e.currentUser.getIdToken());yield e._updateCurrentUser(t,!0)}})()}initializeCurrentUserFromIdToken(e){var t=this;return O(function*(){try{const r=yield N0(t,{idToken:e}),i=yield Xs._fromGetAccountInfoResponse(t,r,e);yield t.directlySetCurrentUser(i)}catch(r){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",r),yield t.directlySetCurrentUser(null)}})()}initializeCurrentUser(e){var t=this;return O(function*(){var r;if(Rs(t.app)){const a=t.app.settings.authIdToken;return a?new Promise(c=>{setTimeout(()=>t.initializeCurrentUserFromIdToken(a).then(c,c))}):t.directlySetCurrentUser(null)}const i=yield t.assertedPersistence.getCurrentUser();let s=i,o=!1;if(e&&t.config.authDomain){yield t.getOrInitRedirectPersistenceManager();const a=null===(r=t.redirectUser)||void 0===r?void 0:r._redirectEventId,c=s?._redirectEventId,l=yield t.tryRedirectSignIn(e);(!a||a===c)&&l?.user&&(s=l.user,o=!0)}if(!s)return t.directlySetCurrentUser(null);if(!s._redirectEventId){if(o)try{yield t.beforeStateQueue.runMiddleware(s)}catch(a){s=i,t._popupRedirectResolver._overrideRedirectResult(t,()=>Promise.reject(a))}return s?t.reloadAndSetCurrentUserOrClear(s):t.directlySetCurrentUser(null)}return Se(t._popupRedirectResolver,t,"argument-error"),yield t.getOrInitRedirectPersistenceManager(),t.redirectUser&&t.redirectUser._redirectEventId===s._redirectEventId?t.directlySetCurrentUser(s):t.reloadAndSetCurrentUserOrClear(s)})()}tryRedirectSignIn(e){var t=this;return O(function*(){let r=null;try{r=yield t._popupRedirectResolver._completeRedirectFn(t,e,!0)}catch{yield t._setRedirectUser(null)}return r})()}reloadAndSetCurrentUserOrClear(e){var t=this;return O(function*(){try{yield bg(e)}catch(r){if("auth/network-request-failed"!==r?.code)return t.directlySetCurrentUser(null)}return t.directlySetCurrentUser(e)})()}useDeviceLanguage(){this.languageCode=function EEe(){if(typeof navigator>"u")return null;const n=navigator;return n.languages&&n.languages[0]||n.language||null}()}_delete(){var e=this;return O(function*(){e._deleted=!0})()}updateCurrentUser(e){var t=this;return O(function*(){if(Rs(t.app))return Promise.reject(Br(t));const r=e?Xn(e):null;return r&&Se(r.auth.config.apiKey===t.config.apiKey,t,"invalid-user-token"),t._updateCurrentUser(r&&r._clone(t))})()}_updateCurrentUser(e){var t=this;return O(function*(r,i=!1){if(!t._deleted)return r&&Se(t.tenantId===r.tenantId,t,"tenant-id-mismatch"),i||(yield t.beforeStateQueue.runMiddleware(r)),t.queue(O(function*(){yield t.directlySetCurrentUser(r),t.notifyAuthListeners()}))}).apply(this,arguments)}signOut(){var e=this;return O(function*(){return Rs(e.app)?Promise.reject(Br(e)):(yield e.beforeStateQueue.runMiddleware(null),(e.redirectPersistenceManager||e._popupRedirectResolver)&&(yield e._setRedirectUser(null)),e._updateCurrentUser(null,!0))})()}setPersistence(e){var t=this;return Rs(this.app)?Promise.reject(Br(this)):this.queue(O(function*(){yield t.assertedPersistence.setPersistence(da(e))}))}_getRecaptchaConfig(){return null==this.tenantId?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}validatePassword(e){var t=this;return O(function*(){t._getPasswordPolicyInternal()||(yield t._updatePasswordPolicy());const r=t._getPasswordPolicyInternal();return r.schemaVersion!==t.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(t._errorFactory.create("unsupported-password-policy-schema-version",{})):r.validatePassword(e)})()}_getPasswordPolicyInternal(){return null===this.tenantId?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}_updatePasswordPolicy(){var e=this;return O(function*(){const t=yield function BEe(n){return SD.apply(this,arguments)}(e),r=new zEe(t);null===e.tenantId?e._projectPasswordPolicy=r:e._tenantPasswordPolicies[e.tenantId]=r})()}_getPersistenceType(){return this.assertedPersistence.persistence.type}_getPersistence(){return this.assertedPersistence.persistence}_updateErrorMap(e){this._errorFactory=new bh("auth","Firebase",e())}onAuthStateChanged(e,t,r){return this.registerStateListener(this.authStateSubscription,e,t,r)}beforeAuthStateChanged(e,t){return this.beforeStateQueue.pushCallback(e,t)}onIdTokenChanged(e,t,r){return this.registerStateListener(this.idTokenSubscription,e,t,r)}authStateReady(){return new Promise((e,t)=>{if(this.currentUser)e();else{const r=this.onAuthStateChanged(()=>{r(),e()},t)}})}revokeAccessToken(e){var t=this;return O(function*(){if(t.currentUser){const r=yield t.currentUser.getIdToken(),i={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:e,idToken:r};null!=t.tenantId&&(i.tenantId=t.tenantId),yield function LEe(n,e){return wD.apply(this,arguments)}(t,i)}})()}toJSON(){var e;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:null===(e=this._currentUser)||void 0===e?void 0:e.toJSON()}}_setRedirectUser(e,t){var r=this;return O(function*(){const i=yield r.getOrInitRedirectPersistenceManager(t);return null===e?i.removeCurrentUser():i.setCurrentUser(e)})()}getOrInitRedirectPersistenceManager(e){var t=this;return O(function*(){if(!t.redirectPersistenceManager){const r=e&&da(e)||t._popupRedirectResolver;Se(r,t,"argument-error"),t.redirectPersistenceManager=yield Ah.create(t,[da(r._redirectPersistence)],"redirectUser"),t.redirectUser=yield t.redirectPersistenceManager.getCurrentUser()}return t.redirectPersistenceManager})()}_redirectUserForId(e){var t=this;return O(function*(){var r,i;return t._isInitialized&&(yield t.queue(O(function*(){}))),(null===(r=t._currentUser)||void 0===r?void 0:r._redirectEventId)===e?t._currentUser:(null===(i=t.redirectUser)||void 0===i?void 0:i._redirectEventId)===e?t.redirectUser:null})()}_persistUserIfCurrent(e){var t=this;return O(function*(){if(e===t.currentUser)return t.queue(O(function*(){return t.directlySetCurrentUser(e)}))})()}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var e,t;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const r=null!==(t=null===(e=this.currentUser)||void 0===e?void 0:e.uid)&&void 0!==t?t:null;this.lastNotifiedUid!==r&&(this.lastNotifiedUid=r,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,t,r,i){if(this._deleted)return()=>{};const s="function"==typeof t?t:t.next.bind(t);let o=!1;const a=this._isInitialized?Promise.resolve():this._initializationPromise;if(Se(a,this,"internal-error"),a.then(()=>{o||s(this.currentUser)}),"function"==typeof t){const c=e.addObserver(t,r,i);return()=>{o=!0,c()}}{const c=e.addObserver(t);return()=>{o=!0,c()}}}directlySetCurrentUser(e){var t=this;return O(function*(){t.currentUser&&t.currentUser!==e&&t._currentUser._stopProactiveRefresh(),e&&t.isProactiveRefreshEnabled&&e._startProactiveRefresh(),t.currentUser=e,e?yield t.assertedPersistence.setCurrentUser(e):yield t.assertedPersistence.removeCurrentUser()})()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return Se(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){!e||this.frameworks.includes(e)||(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=hj(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}_getAdditionalHeaders(){var e=this;return O(function*(){var t;const r={"X-Client-Version":e.clientVersion};e.app.options.appId&&(r["X-Firebase-gmpid"]=e.app.options.appId);const i=yield null===(t=e.heartbeatServiceProvider.getImmediate({optional:!0}))||void 0===t?void 0:t.getHeartbeatsHeader();i&&(r["X-Firebase-Client"]=i);const s=yield e._getAppCheckToken();return s&&(r["X-Firebase-AppCheck"]=s),r})()}_getAppCheckToken(){var e=this;return O(function*(){var t;if(Rs(e.app)&&e.app.settings.appCheckToken)return e.app.settings.appCheckToken;const r=yield null===(t=e.appCheckServiceProvider.getImmediate({optional:!0}))||void 0===t?void 0:t.getToken();return r?.error&&function yEe(n,...e){R0.logLevel<=qt.WARN&&R0.warn(`Auth (${Th}): ${n}`,...e)}(`Error while retrieving App Check token: ${r.error}`),r?.token})()}}function hr(n){return Xn(n)}class fj{constructor(e){this.auth=e,this.observer=null,this.addObserver=function q_e(n,e){const t=new X_e(n,e);return t.subscribe.bind(t)}(t=>this.observer=t)}get next(){return Se(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}let Tg={loadJS:()=>O(function*(){throw new Error("Unable to load external scripts")})(),recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function pj(n){return`__${n}${Math.floor(1e6*Math.random())}`}function _j(n){const e=n.indexOf(":");return e<0?"":n.substr(0,e+1)}function yj(n){if(!n)return null;const e=Number(n);return isNaN(e)?null:e}class Sg{constructor(e,t){this.providerId=e,this.signInMethod=t}toJSON(){return Eo("not implemented")}_getIdTokenResponse(e){return Eo("not implemented")}_linkToIdToken(e,t){return Eo("not implemented")}_getReauthenticationResolver(e){return Eo("not implemented")}}function ha(n,e){return GD.apply(this,arguments)}function GD(){return(GD=O(function*(n,e){return function la(n,e,t,r){return lD.apply(this,arguments)}(n,"POST","/v1/accounts:signInWithIdp",Rn(n,e))})).apply(this,arguments)}class Mh extends Sg{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){const t=new Mh(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(t.idToken=e.idToken),e.accessToken&&(t.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(t.nonce=e.nonce),e.pendingToken&&(t.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(t.accessToken=e.oauthToken,t.secret=e.oauthTokenSecret):Xi("argument-error"),t}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){const t="string"==typeof e?JSON.parse(e):e,{providerId:r,signInMethod:i}=t,s=UE(t,["providerId","signInMethod"]);if(!r||!i)return null;const o=new Mh(r,i);return o.idToken=s.idToken||void 0,o.accessToken=s.accessToken||void 0,o.secret=s.secret,o.nonce=s.nonce,o.pendingToken=s.pendingToken||null,o}_getIdTokenResponse(e){return ha(e,this.buildRequest())}_linkToIdToken(e,t){const r=this.buildRequest();return r.idToken=t,ha(e,r)}_getReauthenticationResolver(e){const t=this.buildRequest();return t.autoCreate=!1,ha(e,t)}buildRequest(){const e={requestUri:"http://localhost",returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{const t={};this.idToken&&(t.id_token=this.idToken),this.accessToken&&(t.access_token=this.accessToken),this.secret&&(t.oauth_token_secret=this.secret),t.providerId=this.providerId,this.nonce&&!this.pendingToken&&(t.nonce=this.nonce),e.postBody=ag(t)}return e}}class fa{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}class Tj extends fa{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}let I0e=(()=>{class n extends Tj{constructor(){super("google.com"),this.addScope("profile")}static credential(t,r){return Mh._fromParams({providerId:n.PROVIDER_ID,signInMethod:n.GOOGLE_SIGN_IN_METHOD,idToken:t,accessToken:r})}static credentialFromResult(t){return n.credentialFromTaggedObject(t)}static credentialFromError(t){return n.credentialFromTaggedObject(t.customData||{})}static credentialFromTaggedObject({_tokenResponse:t}){if(!t)return null;const{oauthIdToken:r,oauthAccessToken:i}=t;if(!r&&!i)return null;try{return n.credential(r,i)}catch{return null}}}return n.GOOGLE_SIGN_IN_METHOD="google.com",n.PROVIDER_ID="google.com",n})();class Ns{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static _fromIdTokenResponse(e,t,r){return O(function*(i,s,o,a=!1){const c=yield Xs._fromIdTokenResponse(i,o,a),l=Ij(o);return new Ns({user:c,providerId:l,_tokenResponse:o,operationType:s})}).apply(this,arguments)}static _forOperation(e,t,r){return O(function*(){yield e._updateTokensIfNecessary(r,!0);const i=Ij(r);return new Ns({user:e,providerId:i,_tokenResponse:r,operationType:t})})()}}function Ij(n){return n.providerId?n.providerId:"phoneNumber"in n?"phone":null}class B0 extends yo{constructor(e,t,r,i){var s;super(t.code,t.message),this.operationType=r,this.user=i,Object.setPrototypeOf(this,B0.prototype),this.customData={appName:e.name,tenantId:null!==(s=e.tenantId)&&void 0!==s?s:void 0,_serverResponse:t.customData._serverResponse,operationType:r}}static _fromErrorAndOperation(e,t,r,i){return new B0(e,t,r,i)}}function Sj(n,e,t,r){return("reauthenticate"===e?t._getReauthenticationResolver(n):t._getIdTokenResponse(n)).catch(s=>{throw"auth/multi-factor-auth-required"===s.code?B0._fromErrorAndOperation(n,s,e,r):s})}function QD(){return(QD=O(function*(n,e,t=!1){const r=yield ua(n,e._linkToIdToken(n.auth,yield n.getIdToken()),t);return Ns._forOperation(n,"link",r)})).apply(this,arguments)}function tR(){return(tR=O(function*(n,e,t=!1){const{auth:r}=n;if(Rs(r.app))return Promise.reject(Br(r));const i="reauthenticate";try{const s=yield ua(n,Sj(r,i,e,n),t);Se(s.idToken,r,"internal-error");const o=O0(s.idToken);Se(o,r,"internal-error");const{sub:a}=o;return Se(n.uid===a,r,"user-mismatch"),Ns._forOperation(n,i,s)}catch(s){throw"auth/user-not-found"===s?.code&&Xi(r,"user-mismatch"),s}})).apply(this,arguments)}function nR(){return(nR=O(function*(n,e,t=!1){if(Rs(n.app))return Promise.reject(Br(n));const r="signIn",i=yield Sj(n,r,e),s=yield Ns._fromIdTokenResponse(n,r,i);return t||(yield n._updateCurrentUser(s.user)),s})).apply(this,arguments)}function Rj(n,e,t,r){return Xn(n).onIdTokenChanged(e,t,r)}function U0e(n){return Xn(n).signOut()}const G0="__sak";class Nj{constructor(e,t){this.storageRetriever=e,this.type=t}_isAvailable(){try{return this.storage?(this.storage.setItem(G0,"1"),this.storage.removeItem(G0),Promise.resolve(!0)):Promise.resolve(!1)}catch{return Promise.resolve(!1)}}_set(e,t){return this.storage.setItem(e,JSON.stringify(t)),Promise.resolve()}_get(e){const t=this.storage.getItem(e);return Promise.resolve(t?JSON.parse(t):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}}const j0e=(()=>{class n extends Nj{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(t,r)=>this.onStorageEvent(t,r),this.listeners={},this.localCache={},this.pollTimer=null,this.fallbackToPolling=dj(),this._shouldAllowMigration=!0}forAllChangedKeys(t){for(const r of Object.keys(this.listeners)){const i=this.storage.getItem(r),s=this.localCache[r];i!==s&&t(r,s,i)}}onStorageEvent(t,r=!1){if(!t.key)return void this.forAllChangedKeys((a,c,l)=>{this.notifyListeners(a,l)});const i=t.key;r?this.detachListener():this.stopPolling();const s=()=>{const a=this.storage.getItem(i);!r&&this.localCache[i]===a||this.notifyListeners(i,a)},o=this.storage.getItem(i);!function VEe(){return function H_e(){const n=dr();return n.indexOf("MSIE ")>=0||n.indexOf("Trident/")>=0}()&&10===document.documentMode}()||o===t.newValue||t.newValue===t.oldValue?s():setTimeout(s,10)}notifyListeners(t,r){this.localCache[t]=r;const i=this.listeners[t];if(i)for(const s of Array.from(i))s(r&&JSON.parse(r))}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((t,r,i)=>{this.onStorageEvent(new StorageEvent("storage",{key:t,oldValue:r,newValue:i}),!0)})},1e3)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(t,r){0===Object.keys(this.listeners).length&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[t]||(this.listeners[t]=new Set,this.localCache[t]=this.storage.getItem(t)),this.listeners[t].add(r)}_removeListener(t,r){this.listeners[t]&&(this.listeners[t].delete(r),0===this.listeners[t].size&&delete this.listeners[t]),0===Object.keys(this.listeners).length&&(this.detachListener(),this.stopPolling())}_set(t,r){var i=()=>super._set,s=this;return O(function*(){yield i().call(s,t,r),s.localCache[t]=JSON.stringify(r)})()}_get(t){var r=()=>super._get,i=this;return O(function*(){const s=yield r().call(i,t);return i.localCache[t]=JSON.stringify(s),s})()}_remove(t){var r=()=>super._remove,i=this;return O(function*(){yield r().call(i,t),delete i.localCache[t]})()}}return n.type="LOCAL",n})(),Oj=(()=>{class n extends Nj{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(t,r){}_removeListener(t,r){}}return n.type="SESSION",n})();let q0e=(()=>{class n{constructor(t){this.eventTarget=t,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(t){const r=this.receivers.find(s=>s.isListeningto(t));if(r)return r;const i=new n(t);return this.receivers.push(i),i}isListeningto(t){return this.eventTarget===t}handleEvent(t){var r=this;return O(function*(){const i=t,{eventId:s,eventType:o,data:a}=i.data,c=r.handlersMap[o];if(!c?.size)return;i.ports[0].postMessage({status:"ack",eventId:s,eventType:o});const l=Array.from(c).map(function(){var d=O(function*(h){return h(i.origin,a)});return function(h){return d.apply(this,arguments)}}()),u=yield function $0e(n){return Promise.all(n.map(function(){var e=O(function*(t){try{return{fulfilled:!0,value:yield t}}catch(r){return{fulfilled:!1,reason:r}}});return function(t){return e.apply(this,arguments)}}()))}(l);i.ports[0].postMessage({status:"done",eventId:s,eventType:o,response:u})})()}_subscribe(t,r){0===Object.keys(this.handlersMap).length&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[t]||(this.handlersMap[t]=new Set),this.handlersMap[t].add(r)}_unsubscribe(t,r){this.handlersMap[t]&&r&&this.handlersMap[t].delete(r),(!r||0===this.handlersMap[t].size)&&delete this.handlersMap[t],0===Object.keys(this.handlersMap).length&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}return n.receivers=[],n})();function W0(n="",e=10){let t="";for(let r=0;r<e;r++)t+=Math.floor(10*Math.random());return n+t}class X0e{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}_send(e,t){var r=this;return O(function*(i,s,o=50){const a=typeof MessageChannel<"u"?new MessageChannel:null;if(!a)throw new Error("connection_unavailable");let c,l;return new Promise((u,d)=>{const h=W0("",20);a.port1.start();const f=setTimeout(()=>{d(new Error("unsupported_event"))},o);l={messageChannel:a,onMessage(m){const y=m;if(y.data.eventId===h)switch(y.data.status){case"ack":clearTimeout(f),c=setTimeout(()=>{d(new Error("timeout"))},3e3);break;case"done":clearTimeout(c),u(y.data.response);break;default:clearTimeout(f),clearTimeout(c),d(new Error("invalid_response"))}}},r.handlers.add(l),a.port1.addEventListener("message",l.onMessage),r.target.postMessage({eventType:i,eventId:h,data:s},[a.port2])}).finally(()=>{l&&r.removeMessageHandler(l)})}).apply(this,arguments)}}function Ir(){return window}function NR(){return typeof Ir().WorkerGlobalScope<"u"&&"function"==typeof Ir().importScripts}function OR(){return(OR=O(function*(){if(!navigator?.serviceWorker)return null;try{return(yield navigator.serviceWorker.ready).active}catch{return null}})).apply(this,arguments)}const kj="firebaseLocalStorageDb",j0="firebaseLocalStorage",Lj="fbase_key";class Cg{constructor(e){this.request=e}toPromise(){return new Promise((e,t)=>{this.request.addEventListener("success",()=>{e(this.request.result)}),this.request.addEventListener("error",()=>{t(this.request.error)})})}}function $0(n,e){return n.transaction([j0],e?"readwrite":"readonly").objectStore(j0)}function kR(){const n=indexedDB.open(kj,1);return new Promise((e,t)=>{n.addEventListener("error",()=>{t(n.error)}),n.addEventListener("upgradeneeded",()=>{const r=n.result;try{r.createObjectStore(j0,{keyPath:Lj})}catch(i){t(i)}}),n.addEventListener("success",O(function*(){const r=n.result;r.objectStoreNames.contains(j0)?e(r):(r.close(),yield function ebe(){const n=indexedDB.deleteDatabase(kj);return new Cg(n).toPromise()}(),e(yield kR()))}))})}function Fj(n,e,t){return LR.apply(this,arguments)}function LR(){return(LR=O(function*(n,e,t){const r=$0(n,!0).put({[Lj]:e,value:t});return new Cg(r).toPromise()})).apply(this,arguments)}function FR(){return(FR=O(function*(n,e){const t=$0(n,!1).get(e),r=yield new Cg(t).toPromise();return void 0===r?null:r.value})).apply(this,arguments)}function Vj(n,e){const t=$0(n,!0).delete(e);return new Cg(t).toPromise()}const ibe=(()=>{class n{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}_openDb(){var t=this;return O(function*(){return t.db||(t.db=yield kR()),t.db})()}_withRetries(t){var r=this;return O(function*(){let i=0;for(;;)try{const s=yield r._openDb();return yield t(s)}catch(s){if(i++>3)throw s;r.db&&(r.db.close(),r.db=void 0)}})()}initializeServiceWorkerMessaging(){var t=this;return O(function*(){return NR()?t.initializeReceiver():t.initializeSender()})()}initializeReceiver(){var t=this;return O(function*(){t.receiver=q0e._getInstance(function Z0e(){return NR()?self:null}()),t.receiver._subscribe("keyChanged",function(){var r=O(function*(i,s){return{keyProcessed:(yield t._poll()).includes(s.key)}});return function(i,s){return r.apply(this,arguments)}}()),t.receiver._subscribe("ping",function(){var r=O(function*(i,s){return["keyChanged"]});return function(i,s){return r.apply(this,arguments)}}())})()}initializeSender(){var t=this;return O(function*(){var r,i;if(t.activeServiceWorker=yield function Y0e(){return OR.apply(this,arguments)}(),!t.activeServiceWorker)return;t.sender=new X0e(t.activeServiceWorker);const s=yield t.sender._send("ping",{},800);s&&null!==(r=s[0])&&void 0!==r&&r.fulfilled&&null!==(i=s[0])&&void 0!==i&&i.value.includes("keyChanged")&&(t.serviceWorkerReceiverAvailable=!0)})()}notifyServiceWorker(t){var r=this;return O(function*(){if(r.sender&&r.activeServiceWorker&&function J0e(){var n;return(null===(n=navigator?.serviceWorker)||void 0===n?void 0:n.controller)||null}()===r.activeServiceWorker)try{yield r.sender._send("keyChanged",{key:t},r.serviceWorkerReceiverAvailable?800:50)}catch{}})()}_isAvailable(){return O(function*(){try{if(!indexedDB)return!1;const t=yield kR();return yield Fj(t,G0,"1"),yield Vj(t,G0),!0}catch{}return!1})()}_withPendingWrite(t){var r=this;return O(function*(){r.pendingWrites++;try{yield t()}finally{r.pendingWrites--}})()}_set(t,r){var i=this;return O(function*(){return i._withPendingWrite(O(function*(){return yield i._withRetries(s=>Fj(s,t,r)),i.localCache[t]=r,i.notifyServiceWorker(t)}))})()}_get(t){var r=this;return O(function*(){const i=yield r._withRetries(s=>function tbe(n,e){return FR.apply(this,arguments)}(s,t));return r.localCache[t]=i,i})()}_remove(t){var r=this;return O(function*(){return r._withPendingWrite(O(function*(){return yield r._withRetries(i=>Vj(i,t)),delete r.localCache[t],r.notifyServiceWorker(t)}))})()}_poll(){var t=this;return O(function*(){const r=yield t._withRetries(o=>{const a=$0(o,!1).getAll();return new Cg(a).toPromise()});if(!r)return[];if(0!==t.pendingWrites)return[];const i=[],s=new Set;if(0!==r.length)for(const{fbase_key:o,value:a}of r)s.add(o),JSON.stringify(t.localCache[o])!==JSON.stringify(a)&&(t.notifyListeners(o,a),i.push(o));for(const o of Object.keys(t.localCache))t.localCache[o]&&!s.has(o)&&(t.notifyListeners(o,null),i.push(o));return i})()}notifyListeners(t,r){this.localCache[t]=r;const i=this.listeners[t];if(i)for(const s of Array.from(i))s(r)}startPolling(){var t=this;this.stopPolling(),this.pollTimer=setInterval(O(function*(){return t._poll()}),800)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(t,r){0===Object.keys(this.listeners).length&&this.startPolling(),this.listeners[t]||(this.listeners[t]=new Set,this._get(t)),this.listeners[t].add(r)}_removeListener(t,r){this.listeners[t]&&(this.listeners[t].delete(r),0===this.listeners[t].size&&delete this.listeners[t]),0===Object.keys(this.listeners).length&&this.stopPolling()}}return n.type="LOCAL",n})();function iu(n,e){return e?da(e):(Se(n._popupRedirectResolver,n,"argument-error"),n._popupRedirectResolver)}pj("rcb"),new yg(3e4,6e4);class XR extends Sg{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return ha(e,this._buildIdpRequest())}_linkToIdToken(e,t){return ha(e,this._buildIdpRequest(t))}_getReauthenticationResolver(e){return ha(e,this._buildIdpRequest())}_buildIdpRequest(e){const t={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(t.idToken=e),t}}function fbe(n){return function Mj(n,e){return nR.apply(this,arguments)}(n.auth,new XR(n),n.bypassAuthState)}function pbe(n){const{auth:e,user:t}=n;return Se(t,e,"internal-error"),function Aj(n,e){return tR.apply(this,arguments)}(t,new XR(n),n.bypassAuthState)}function mbe(n){return KR.apply(this,arguments)}function KR(){return(KR=O(function*(n){const{auth:e,user:t}=n;return Se(t,e,"internal-error"),function ZD(n,e){return QD.apply(this,arguments)}(t,new XR(n),n.bypassAuthState)})).apply(this,arguments)}class Bj{constructor(e,t,r,i,s=!1){this.auth=e,this.resolver=r,this.user=i,this.bypassAuthState=s,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(t)?t:[t]}execute(){var e=this;return new Promise(function(){var t=O(function*(r,i){e.pendingPromise={resolve:r,reject:i};try{e.eventManager=yield e.resolver._initialize(e.auth),yield e.onExecution(),e.eventManager.registerConsumer(e)}catch(s){e.reject(s)}});return function(r,i){return t.apply(this,arguments)}}())}onAuthEvent(e){var t=this;return O(function*(){const{urlResponse:r,sessionId:i,postBody:s,tenantId:o,error:a,type:c}=e;if(a)return void t.reject(a);const l={auth:t.auth,requestUri:r,sessionId:i,tenantId:o||void 0,postBody:s||void 0,user:t.user,bypassAuthState:t.bypassAuthState};try{t.resolve(yield t.getIdpTask(c)(l))}catch(u){t.reject(u)}})()}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return fbe;case"linkViaPopup":case"linkViaRedirect":return mbe;case"reauthViaPopup":case"reauthViaRedirect":return pbe;default:Xi(this.auth,"internal-error")}}resolve(e){ca(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){ca(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}const gbe=new yg(2e3,1e4);function _be(n,e,t){return YR.apply(this,arguments)}function YR(){return(YR=O(function*(n,e,t){if(Rs(n.app))return Promise.reject(Ci(n,"operation-not-supported-in-this-environment"));const r=hr(n);!function Sh(n,e,t){if(!(e instanceof t))throw t.name!==e.constructor.name&&Xi(n,"argument-error"),rD(n,"argument-error",`Type of ${e.constructor.name} does not match expected instance.Did you pass a reference from a different Auth SDK?`)}(n,e,fa);const i=iu(r,t);return new QR(r,"signInViaPopup",e,i).executeNotNull()})).apply(this,arguments)}let QR=(()=>{class n extends Bj{constructor(t,r,i,s,o){super(t,r,s,o),this.provider=i,this.authWindow=null,this.pollId=null,n.currentPopupAction&&n.currentPopupAction.cancel(),n.currentPopupAction=this}executeNotNull(){var t=this;return O(function*(){const r=yield t.execute();return Se(r,t.auth,"internal-error"),r})()}onExecution(){var t=this;return O(function*(){ca(1===t.filter.length,"Popup operations only handle one event");const r=W0();t.authWindow=yield t.resolver._openPopup(t.auth,t.provider,t.filter[0],r),t.authWindow.associatedEvent=r,t.resolver._originValidation(t.auth).catch(i=>{t.reject(i)}),t.resolver._isIframeWebStorageSupported(t.auth,i=>{i||t.reject(Ci(t.auth,"web-storage-unsupported"))}),t.pollUserCancellation()})()}get eventId(){var t;return(null===(t=this.authWindow)||void 0===t?void 0:t.associatedEvent)||null}cancel(){this.reject(Ci(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,n.currentPopupAction=null}pollUserCancellation(){const t=()=>{var r,i;this.pollId=null!==(i=null===(r=this.authWindow)||void 0===r?void 0:r.window)&&void 0!==i&&i.closed?window.setTimeout(()=>{this.pollId=null,this.reject(Ci(this.auth,"popup-closed-by-user"))},8e3):window.setTimeout(t,gbe.get())};t()}}return n.currentPopupAction=null,n})();const Rg=new Map;class vbe extends Bj{constructor(e,t,r=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],t,void 0,r),this.eventId=null}execute(){var e=()=>super.execute,t=this;return O(function*(){let r=Rg.get(t.auth._key());if(!r){try{const s=(yield function Ebe(n,e){return e1.apply(this,arguments)}(t.resolver,t.auth))?yield e().call(t):null;r=()=>Promise.resolve(s)}catch(i){r=()=>Promise.reject(i)}Rg.set(t.auth._key(),r)}return t.bypassAuthState||Rg.set(t.auth._key(),()=>Promise.resolve(null)),r()})()}onAuthEvent(e){var t=()=>super.onAuthEvent,r=this;return O(function*(){if("signInViaRedirect"===e.type)return t().call(r,e);if("unknown"!==e.type){if(e.eventId){const i=yield r.auth._redirectUserForId(e.eventId);if(i)return r.user=i,t().call(r,e);r.resolve(null)}}else r.resolve(null)})()}onExecution(){return O(function*(){})()}cleanUp(){}}function e1(){return(e1=O(function*(n,e){const t=function zj(n){return k0("pendingRedirect",n.config.apiKey,n.name)}(e),r=function Hj(n){return da(n._redirectPersistence)}(n);if(!(yield r._isAvailable()))return!1;const i="true"===(yield r._get(t));return yield r._remove(t),i})).apply(this,arguments)}function bbe(n,e){Rg.set(n._key(),e)}function Gj(n,e){return a1.apply(this,arguments)}function a1(){return(a1=O(function*(n,e,t=!1){if(Rs(n.app))return Promise.reject(Br(n));const r=hr(n),i=iu(r,e),o=yield new vbe(r,i,t).execute();return o&&!t&&(delete o.user._redirectEventId,yield r._persistUserIfCurrent(o.user),yield r._setRedirectUser(null,e)),o})).apply(this,arguments)}class xbe{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let t=!1;return this.consumers.forEach(r=>{this.isEventForConsumer(e,r)&&(t=!0,this.sendToConsumer(e,r),this.saveEventToCache(e))}),this.hasHandledPotentialRedirect||!function Abe(n){switch(n.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return $j(n);default:return!1}}(e)||(this.hasHandledPotentialRedirect=!0,t||(this.queuedRedirectEvent=e,t=!0)),t}sendToConsumer(e,t){var r;if(e.error&&!$j(e)){const i=(null===(r=e.error.code)||void 0===r?void 0:r.split("auth/")[1])||"internal-error";t.onError(Ci(this.auth,i))}else t.onAuthEvent(e)}isEventForConsumer(e,t){const r=null===t.eventId||!!e.eventId&&e.eventId===t.eventId;return t.filter.includes(e.type)&&r}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=6e5&&this.cachedEventUids.clear(),this.cachedEventUids.has(jj(e))}saveEventToCache(e){this.cachedEventUids.add(jj(e)),this.lastProcessedEventTime=Date.now()}}function jj(n){return[n.type,n.eventId,n.sessionId,n.tenantId].filter(e=>e).join("-")}function $j({type:n,error:e}){return"unknown"===n&&"auth/no-auth-event"===e?.code}function l1(){return(l1=O(function*(n,e={}){return Pn(n,"GET","/v1/projects",e)})).apply(this,arguments)}const Cbe=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,Dbe=/^https?/;function u1(){return u1=O(function*(n){if(n.config.emulator)return;const{authorizedDomains:e}=yield function Mbe(n){return l1.apply(this,arguments)}(n);for(const t of e)try{if(Pbe(t))return}catch{}Xi(n,"unauthorized-domain")}),u1.apply(this,arguments)}function Pbe(n){const e=_g(),{protocol:t,hostname:r}=new URL(e);if(n.startsWith("chrome-extension://")){const o=new URL(n);return""===o.hostname&&""===r?"chrome-extension:"===t&&n.replace("chrome-extension://","")===e.replace("chrome-extension://",""):"chrome-extension:"===t&&o.hostname===r}if(!Dbe.test(t))return!1;if(Cbe.test(n))return r===n;const i=n.replace(/\./g,"\\.");return new RegExp("^(.+\\."+i+"|"+i+")$","i").test(r)}const Nbe=new yg(3e4,6e4);function qj(){const n=Ir().___jsl;if(n?.H)for(const e of Object.keys(n.H))if(n.H[e].r=n.H[e].r||[],n.H[e].L=n.H[e].L||[],n.H[e].r=[...n.H[e].L],n.CP)for(let t=0;t<n.CP.length;t++)n.CP[t]=null}function Obe(n){return new Promise((e,t)=>{var r,i,s;function o(){qj(),gapi.load("gapi.iframes",{callback:()=>{e(gapi.iframes.getContext())},ontimeout:()=>{qj(),t(Ci(n,"network-request-failed"))},timeout:Nbe.get()})}if(null!==(i=null===(r=Ir().gapi)||void 0===r?void 0:r.iframes)&&void 0!==i&&i.Iframe)e(gapi.iframes.getContext());else{if(null===(s=Ir().gapi)||void 0===s||!s.load){const a=pj("iframefcb");return Ir()[a]=()=>{gapi.load?o():t(Ci(n,"network-request-failed"))},function xD(n){return Tg.loadJS(n)}(`${function qEe(){return Tg.gapiScript}()}?onload=${a}`).catch(c=>t(c))}o()}}).catch(e=>{throw q0=null,e})}let q0=null;const Lbe=new yg(5e3,15e3),Ube={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},Bbe=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function Hbe(n){const e=n.config;Se(e.authDomain,n,"auth-domain-config-required");const t=e.emulator?oD(e,"emulator/auth/iframe"):`https://${n.config.authDomain}/__/auth/iframe`,r={apiKey:e.apiKey,appName:n.name,v:Th},i=Bbe.get(n.config.apiHost);i&&(r.eid=i);const s=n._getFrameworks();return s.length&&(r.fw=s.join(",")),`${t}?${ag(r).slice(1)}`}function d1(){return d1=O(function*(n){const e=yield function kbe(n){return q0=q0||Obe(n),q0}(n),t=Ir().gapi;return Se(t,n,"internal-error"),e.open({where:document.body,url:Hbe(n),messageHandlersFilter:t.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:Ube,dontclear:!0},r=>new Promise(function(){var i=O(function*(s,o){yield r.restyle({setHideOnLeave:!1});const a=Ci(n,"network-request-failed"),c=Ir().setTimeout(()=>{o(a)},Lbe.get());function l(){Ir().clearTimeout(c),s(r)}r.ping(l).then(l,()=>{o(a)})});return function(s,o){return i.apply(this,arguments)}}()))}),d1.apply(this,arguments)}const Gbe={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"};class Xj{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch{}}}const Zbe=encodeURIComponent("fac");function Kj(n,e,t,r,i,s){return h1.apply(this,arguments)}function h1(){return(h1=O(function*(n,e,t,r,i,s){Se(n.config.authDomain,n,"auth-domain-config-required"),Se(n.config.apiKey,n,"invalid-api-key");const o={apiKey:n.config.apiKey,appName:n.name,authType:t,redirectUrl:r,v:Th,eventId:i};if(e instanceof fa){e.setDefaultLanguage(n.languageCode),o.providerId=e.providerId||"",function $_e(n){for(const e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}(e.getCustomParameters())||(o.customParameters=JSON.stringify(e.getCustomParameters()));for(const[u,d]of Object.entries(s||{}))o[u]=d}if(e instanceof Tj){const u=e.getScopes().filter(d=>""!==d);u.length>0&&(o.scopes=u.join(","))}n.tenantId&&(o.tid=n.tenantId);const a=o;for(const u of Object.keys(a))void 0===a[u]&&delete a[u];const c=yield n._getAppCheckToken(),l=c?`#${Zbe}=${encodeURIComponent(c)}`:"";return`${function Qbe({config:n}){return n.emulator?oD(n,"emulator/auth/handler"):`https://${n.authDomain}/__/auth/handler`}(n)}?${ag(a).slice(1)}${l}`})).apply(this,arguments)}const f1="webStorageSupport",tTe=class eTe{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=Oj,this._completeRedirectFn=Gj,this._overrideRedirectResult=bbe}_openPopup(e,t,r,i){var s=this;return O(function*(){var o;ca(null===(o=s.eventManagers[e._key()])||void 0===o?void 0:o.manager,"_initialize() not called before _openPopup()");const a=yield Kj(e,t,r,_g(),i);return function Xbe(n,e,t,r=500,i=600){const s=Math.max((window.screen.availHeight-i)/2,0).toString(),o=Math.max((window.screen.availWidth-r)/2,0).toString();let a="";const c=Object.assign(Object.assign({},Gbe),{width:r.toString(),height:i.toString(),top:s,left:o}),l=dr().toLowerCase();t&&(a=oj(l)?"_blank":t),ij(l)&&(e=e||"http://localhost",c.scrollbars="yes");const u=Object.entries(c).reduce((h,[f,m])=>`${h}${f}=${m},`,"");if(function FEe(n=dr()){var e;return ID(n)&&!(null===(e=window.navigator)||void 0===e||!e.standalone)}(l)&&"_self"!==a)return function Kbe(n,e){const t=document.createElement("a");t.href=n,t.target=e;const r=document.createEvent("MouseEvent");r.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),t.dispatchEvent(r)}(e||"",a),new Xj(null);const d=window.open(e||"",a,u);Se(d,n,"popup-blocked");try{d.focus()}catch{}return new Xj(d)}(e,a,W0())})()}_openRedirect(e,t,r,i){var s=this;return O(function*(){return yield s._originValidation(e),function K0e(n){Ir().location.href=n}(yield Kj(e,t,r,_g(),i)),new Promise(()=>{})})()}_initialize(e){const t=e._key();if(this.eventManagers[t]){const{manager:i,promise:s}=this.eventManagers[t];return i?Promise.resolve(i):(ca(s,"If manager is not set, promise should be"),s)}const r=this.initAndGetManager(e);return this.eventManagers[t]={promise:r},r.catch(()=>{delete this.eventManagers[t]}),r}initAndGetManager(e){var t=this;return O(function*(){const r=yield function zbe(n){return d1.apply(this,arguments)}(e),i=new xbe(e);return r.register("authEvent",s=>(Se(s?.authEvent,e,"invalid-auth-event"),{status:i.onEvent(s.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),t.eventManagers[e._key()]={manager:i},t.iframes[e._key()]=r,i})()}_isIframeWebStorageSupported(e,t){this.iframes[e._key()].send(f1,{type:f1},i=>{var s;const o=null===(s=i?.[0])||void 0===s?void 0:s[f1];void 0!==o&&t(!!o),Xi(e,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){const t=e._key();return this.originValidationPromises[t]||(this.originValidationPromises[t]=function Rbe(n){return u1.apply(this,arguments)}(e)),this.originValidationPromises[t]}get _shouldInitProactively(){return dj()||sj()||ID()}};var Qj="@firebase/auth";class nTe{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){var e;return this.assertAuthConfigured(),(null===(e=this.auth.currentUser)||void 0===e?void 0:e.uid)||null}getToken(e){var t=this;return O(function*(){return t.assertAuthConfigured(),yield t.auth._initializationPromise,t.auth.currentUser?{accessToken:yield t.auth.currentUser.getIdToken(e)}:null})()}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;const t=this.auth.onIdTokenChanged(r=>{e(r?.stsTokenManager.accessToken||null)});this.internalListeners.set(e,t),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();const t=this.internalListeners.get(e);t&&(this.internalListeners.delete(e),t(),this.updateProactiveRefresh())}assertAuthConfigured(){Se(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}const sTe=K6("authIdTokenMaxAge")||300;let t8=null;const oTe=n=>function(){var e=O(function*(t){const r=t&&(yield t.getIdTokenResult()),i=r&&((new Date).getTime()-Date.parse(r.issuedAtTime))/1e3;if(i&&i>sTe)return;const s=r?.token;t8!==s&&(t8=s,yield fetch(n,{method:s?"POST":"DELETE",headers:s?{Authorization:`Bearer ${s}`}:{}}))});return function(t){return e.apply(this,arguments)}}();function aTe(n=y0()){const e=dg(n,"auth");if(e.isInitialized())return e.getImmediate();const t=function n0e(n,e){const t=dg(n,"auth");if(t.isInitialized()){const i=t.getImmediate();if(ia(t.getOptions(),e??{}))return i;Xi(i,"already-initialized")}return t.initialize({options:e})}(n,{popupRedirectResolver:tTe,persistence:[ibe,j0e,Oj]}),r=K6("authTokenSyncURL");if(r&&"boolean"==typeof isSecureContext&&isSecureContext){const s=new URL(r,location.origin);if(location.origin===s.origin){const o=oTe(s.toString());(function V0e(n,e,t){Xn(n).beforeAuthStateChanged(e,t)})(t,o,()=>o(t.currentUser)),Rj(t,a=>o(a))}}const i=$6("auth");return i&&function i0e(n,e,t){const r=hr(n);Se(/^https?:\/\//.test(e),r,"invalid-emulator-scheme");const i=!!t?.disableWarnings,s=_j(e),{host:o,port:a}=function s0e(n){const e=_j(n),t=/(\/\/)?([^?#/]+)/.exec(n.substr(e.length));if(!t)return{host:"",port:null};const r=t[2].split("@").pop()||"",i=/^(\[[^\]]+\])(:|$)/.exec(r);if(i){const s=i[1];return{host:s,port:yj(r.substr(s.length+1))}}{const[s,o]=r.split(":");return{host:s,port:yj(o)}}}(e),c=null===a?"":`:${a}`,l={url:`${s}//${o}${c}/`},u=Object.freeze({host:o,port:a,protocol:s.replace(":",""),options:Object.freeze({disableWarnings:i})});if(!r._canInitEmulator)return Se(r.config.emulator&&r.emulatorConfig,r,"emulator-config-failed"),void Se(ia(l,r.config.emulator)&&ia(u,r.emulatorConfig),r,"emulator-config-failed");r.config.emulator=l,r.emulatorConfig=u,r.settings.appVerificationDisabledForTesting=!0,Zl(o)?(pC(`${s}//${o}${c}`),gC("Auth",!0)):i||function o0e(){function n(){const e=document.createElement("p"),t=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",t.position="fixed",t.width="100%",t.backgroundColor="#ffffff",t.border=".1em solid #000000",t.color="#b50000",t.bottom="0px",t.left="0px",t.margin="0px",t.zIndex="10000",t.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}typeof console<"u"&&"function"==typeof console.info&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),typeof window<"u"&&typeof document<"u"&&("loading"===document.readyState?window.addEventListener("DOMContentLoaded",n):n())}()}(t,`http://${i}`),t}function n8(n){return new jn(function(e){return{unsubscribe:Rj(n,e.next.bind(e),e.error.bind(e),e.complete.bind(e))}})}function lTe(n){return n8(n).pipe(qs(function(e){return e?kM(function CEe(n,e=!1){return Xn(n).getIdToken(e)}(e)):_o(null)}))}(function WEe(n){Tg=n})({loadJS:n=>new Promise((e,t)=>{const r=document.createElement("script");r.setAttribute("src",n),r.onload=e,r.onerror=i=>{const s=Ci("internal-error");s.customData=i,t(s)},r.type="text/javascript",r.charset="UTF-8",function cTe(){var n,e;return null!==(e=null===(n=document.getElementsByTagName("head"))||void 0===n?void 0:n[0])&&void 0!==e?e:document}().appendChild(r)}),gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="}),function iTe(n){aa(new vo("auth",(e,{options:t})=>{const r=e.getProvider("app").getImmediate(),i=e.getProvider("heartbeat"),s=e.getProvider("app-check-internal"),{apiKey:o,authDomain:a}=r.options;Se(o&&!o.includes(":"),"invalid-api-key",{appName:r.name});const c={apiKey:o,authDomain:a,clientPlatform:n,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:hj(n)},l=new GEe(r,i,s,c);return function r0e(n,e){const t=e?.persistence||[],r=(Array.isArray(t)?t:[t]).map(da);e?.errorMap&&n._updateErrorMap(e.errorMap),n._initializeWithPersistence(r,e?.popupRedirectResolver)}(l,t),l},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,t,r)=>{e.getProvider("auth-internal").initialize()})),aa(new vo("auth-internal",e=>{const t=hr(e.getProvider("auth").getImmediate());return new nTe(t)},"PRIVATE").setInstantiationMode("EXPLICIT")),Ur(Qj,"1.10.8",function rTe(n){switch(n){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}(n)),Ur(Qj,"1.10.8","esm2017")}("Browser");class Dh{constructor(e){return e}}class m1{constructor(){return b0("auth")}}const g1=new Ae("angularfire2.auth-instances");function dTe(n){return(e,t)=>{const r=e.runOutsideAngular(()=>n(t));return new Dh(r)}}const hTe={provide:m1,deps:[[new ui,g1]]},fTe={provide:Dh,useFactory:function uTe(n,e){const t=E0("auth",n,e);return t&&new Dh(t)},deps:[[new ui,g1],nu]};function pTe(n,...e){return Ur("angularfire",pg.full,"auth"),_l([fTe,hTe,{provide:g1,useFactory:dTe(n),multi:!0,deps:[Vt,Yr,mg,T0,[new ui,D0],...e]}])}const Rh=Pr(lTe,!0),i8=Pr(n8,!0),mTe=Pr(aTe,!0),gTe=Pr(_be,!0,2),_Te=Pr(U0e,!0,2);var bc,a8,s8=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},o8={};(function(){var n;function r(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.B=Array(this.blockSize),this.o=this.h=0,this.s()}function i(w,A,T){T||(T=0);var S=Array(16);if("string"==typeof A)for(var R=0;16>R;++R)S[R]=A.charCodeAt(T++)|A.charCodeAt(T++)<<8|A.charCodeAt(T++)<<16|A.charCodeAt(T++)<<24;else for(R=0;16>R;++R)S[R]=A[T++]|A[T++]<<8|A[T++]<<16|A[T++]<<24;var F=w.g[3],N=(A=w.g[0])+(F^(T=w.g[1])&((R=w.g[2])^F))+S[0]+3614090360&4294967295;N=(T=(R=(F=(A=(T=(R=(F=(A=(T=(R=(F=(A=(T=(R=(F=(A=(T=(R=(F=(A=(T=(R=(F=(A=(T=(R=(F=(A=(T=(R=(F=(A=(T=(R=(F=(A=(T=(R=(F=(A=(T=(R=(F=(A=(T=(R=(F=(A=(T=(R=(F=(A=(T=(R=(F=(A=(T=(R=(F=(A=T+(N<<7&4294967295|N>>>25))+((N=F+(R^A&(T^R))+S[1]+3905402710&4294967295)<<12&4294967295|N>>>20))+((N=R+(T^F&(A^T))+S[2]+606105819&4294967295)<<17&4294967295|N>>>15))+((N=T+(A^R&(F^A))+S[3]+3250441966&4294967295)<<22&4294967295|N>>>10))+((N=A+(F^T&(R^F))+S[4]+4118548399&4294967295)<<7&4294967295|N>>>25))+((N=F+(R^A&(T^R))+S[5]+1200080426&4294967295)<<12&4294967295|N>>>20))+((N=R+(T^F&(A^T))+S[6]+2821735955&4294967295)<<17&4294967295|N>>>15))+((N=T+(A^R&(F^A))+S[7]+4249261313&4294967295)<<22&4294967295|N>>>10))+((N=A+(F^T&(R^F))+S[8]+1770035416&4294967295)<<7&4294967295|N>>>25))+((N=F+(R^A&(T^R))+S[9]+2336552879&4294967295)<<12&4294967295|N>>>20))+((N=R+(T^F&(A^T))+S[10]+4294925233&4294967295)<<17&4294967295|N>>>15))+((N=T+(A^R&(F^A))+S[11]+2304563134&4294967295)<<22&4294967295|N>>>10))+((N=A+(F^T&(R^F))+S[12]+1804603682&4294967295)<<7&4294967295|N>>>25))+((N=F+(R^A&(T^R))+S[13]+4254626195&4294967295)<<12&4294967295|N>>>20))+((N=R+(T^F&(A^T))+S[14]+2792965006&4294967295)<<17&4294967295|N>>>15))+((N=T+(A^R&(F^A))+S[15]+1236535329&4294967295)<<22&4294967295|N>>>10))+((N=A+(R^F&(T^R))+S[1]+4129170786&4294967295)<<5&4294967295|N>>>27))+((N=F+(T^R&(A^T))+S[6]+3225465664&4294967295)<<9&4294967295|N>>>23))+((N=R+(A^T&(F^A))+S[11]+643717713&4294967295)<<14&4294967295|N>>>18))+((N=T+(F^A&(R^F))+S[0]+3921069994&4294967295)<<20&4294967295|N>>>12))+((N=A+(R^F&(T^R))+S[5]+3593408605&4294967295)<<5&4294967295|N>>>27))+((N=F+(T^R&(A^T))+S[10]+38016083&4294967295)<<9&4294967295|N>>>23))+((N=R+(A^T&(F^A))+S[15]+3634488961&4294967295)<<14&4294967295|N>>>18))+((N=T+(F^A&(R^F))+S[4]+3889429448&4294967295)<<20&4294967295|N>>>12))+((N=A+(R^F&(T^R))+S[9]+568446438&4294967295)<<5&4294967295|N>>>27))+((N=F+(T^R&(A^T))+S[14]+3275163606&4294967295)<<9&4294967295|N>>>23))+((N=R+(A^T&(F^A))+S[3]+4107603335&4294967295)<<14&4294967295|N>>>18))+((N=T+(F^A&(R^F))+S[8]+1163531501&4294967295)<<20&4294967295|N>>>12))+((N=A+(R^F&(T^R))+S[13]+2850285829&4294967295)<<5&4294967295|N>>>27))+((N=F+(T^R&(A^T))+S[2]+4243563512&4294967295)<<9&4294967295|N>>>23))+((N=R+(A^T&(F^A))+S[7]+1735328473&4294967295)<<14&4294967295|N>>>18))+((N=T+(F^A&(R^F))+S[12]+2368359562&4294967295)<<20&4294967295|N>>>12))+((N=A+(T^R^F)+S[5]+4294588738&4294967295)<<4&4294967295|N>>>28))+((N=F+(A^T^R)+S[8]+2272392833&4294967295)<<11&4294967295|N>>>21))+((N=R+(F^A^T)+S[11]+1839030562&4294967295)<<16&4294967295|N>>>16))+((N=T+(R^F^A)+S[14]+4259657740&4294967295)<<23&4294967295|N>>>9))+((N=A+(T^R^F)+S[1]+2763975236&4294967295)<<4&4294967295|N>>>28))+((N=F+(A^T^R)+S[4]+1272893353&4294967295)<<11&4294967295|N>>>21))+((N=R+(F^A^T)+S[7]+4139469664&4294967295)<<16&4294967295|N>>>16))+((N=T+(R^F^A)+S[10]+3200236656&4294967295)<<23&4294967295|N>>>9))+((N=A+(T^R^F)+S[13]+681279174&4294967295)<<4&4294967295|N>>>28))+((N=F+(A^T^R)+S[0]+3936430074&4294967295)<<11&4294967295|N>>>21))+((N=R+(F^A^T)+S[3]+3572445317&4294967295)<<16&4294967295|N>>>16))+((N=T+(R^F^A)+S[6]+76029189&4294967295)<<23&4294967295|N>>>9))+((N=A+(T^R^F)+S[9]+3654602809&4294967295)<<4&4294967295|N>>>28))+((N=F+(A^T^R)+S[12]+3873151461&4294967295)<<11&4294967295|N>>>21))+((N=R+(F^A^T)+S[15]+530742520&4294967295)<<16&4294967295|N>>>16))+((N=T+(R^F^A)+S[2]+3299628645&4294967295)<<23&4294967295|N>>>9))+((N=A+(R^(T|~F))+S[0]+4096336452&4294967295)<<6&4294967295|N>>>26))+((N=F+(T^(A|~R))+S[7]+1126891415&4294967295)<<10&4294967295|N>>>22))+((N=R+(A^(F|~T))+S[14]+2878612391&4294967295)<<15&4294967295|N>>>17))+((N=T+(F^(R|~A))+S[5]+4237533241&4294967295)<<21&4294967295|N>>>11))+((N=A+(R^(T|~F))+S[12]+1700485571&4294967295)<<6&4294967295|N>>>26))+((N=F+(T^(A|~R))+S[3]+2399980690&4294967295)<<10&4294967295|N>>>22))+((N=R+(A^(F|~T))+S[10]+4293915773&4294967295)<<15&4294967295|N>>>17))+((N=T+(F^(R|~A))+S[1]+2240044497&4294967295)<<21&4294967295|N>>>11))+((N=A+(R^(T|~F))+S[8]+1873313359&4294967295)<<6&4294967295|N>>>26))+((N=F+(T^(A|~R))+S[15]+4264355552&4294967295)<<10&4294967295|N>>>22))+((N=R+(A^(F|~T))+S[6]+2734768916&4294967295)<<15&4294967295|N>>>17))+((N=T+(F^(R|~A))+S[13]+1309151649&4294967295)<<21&4294967295|N>>>11))+((F=(A=T+((N=A+(R^(T|~F))+S[4]+4149444226&4294967295)<<6&4294967295|N>>>26))+((N=F+(T^(A|~R))+S[11]+3174756917&4294967295)<<10&4294967295|N>>>22))^((R=F+((N=R+(A^(F|~T))+S[2]+718787259&4294967295)<<15&4294967295|N>>>17))|~A))+S[9]+3951481745&4294967295,w.g[0]=w.g[0]+A&4294967295,w.g[1]=w.g[1]+(R+(N<<21&4294967295|N>>>11))&4294967295,w.g[2]=w.g[2]+R&4294967295,w.g[3]=w.g[3]+F&4294967295}function o(w,A){this.h=A;for(var T=[],S=!0,R=w.length-1;0<=R;R--){var F=0|w[R];S&&F==A||(T[R]=F,S=!1)}this.g=T}(function e(w,A){function T(){}T.prototype=A.prototype,w.D=A.prototype,w.prototype=new T,w.prototype.constructor=w,w.C=function(S,R,F){for(var N=Array(arguments.length-2),H=2;H<arguments.length;H++)N[H-2]=arguments[H];return A.prototype[R].apply(S,N)}})(r,function t(){this.blockSize=-1}),r.prototype.s=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0},r.prototype.u=function(w,A){void 0===A&&(A=w.length);for(var T=A-this.blockSize,S=this.B,R=this.h,F=0;F<A;){if(0==R)for(;F<=T;)i(this,w,F),F+=this.blockSize;if("string"==typeof w){for(;F<A;)if(S[R++]=w.charCodeAt(F++),R==this.blockSize){i(this,S),R=0;break}}else for(;F<A;)if(S[R++]=w[F++],R==this.blockSize){i(this,S),R=0;break}}this.h=R,this.o+=A},r.prototype.v=function(){var w=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);w[0]=128;for(var A=1;A<w.length-8;++A)w[A]=0;var T=8*this.o;for(A=w.length-8;A<w.length;++A)w[A]=255&T,T/=256;for(this.u(w),w=Array(16),A=T=0;4>A;++A)for(var S=0;32>S;S+=8)w[T++]=this.g[A]>>>S&255;return w};var a={};function c(w){return-128<=w&&128>w?function s(w,A){var T=a;return Object.prototype.hasOwnProperty.call(T,w)?T[w]:T[w]=A(w)}(w,function(A){return new o([0|A],0>A?-1:0)}):new o([0|w],0>w?-1:0)}function l(w){if(isNaN(w)||!isFinite(w))return d;if(0>w)return _(l(-w));for(var A=[],T=1,S=0;w>=T;S++)A[S]=w/T|0,T*=4294967296;return new o(A,0)}var d=c(0),h=c(1),f=c(16777216);function m(w){if(0!=w.h)return!1;for(var A=0;A<w.g.length;A++)if(0!=w.g[A])return!1;return!0}function y(w){return-1==w.h}function _(w){for(var A=w.g.length,T=[],S=0;S<A;S++)T[S]=~w.g[S];return new o(T,~w.h).add(h)}function g(w,A){return w.add(_(A))}function b(w,A){for(;(65535&w[A])!=w[A];)w[A+1]+=w[A]>>>16,w[A]&=65535,A++}function E(w,A){this.g=w,this.h=A}function x(w,A){if(m(A))throw Error("division by zero");if(m(w))return new E(d,d);if(y(w))return A=x(_(w),A),new E(_(A.g),_(A.h));if(y(A))return A=x(w,_(A)),new E(_(A.g),A.h);if(30<w.g.length){if(y(w)||y(A))throw Error("slowDivide_ only works with positive integers.");for(var T=h,S=A;0>=S.l(w);)T=M(T),S=M(S);var R=C(T,1),F=C(S,1);for(S=C(S,2),T=C(T,2);!m(S);){var N=F.add(S);0>=N.l(w)&&(R=R.add(T),F=N),S=C(S,1),T=C(T,1)}return A=g(w,R.j(A)),new E(R,A)}for(R=d;0<=w.l(A);){for(T=Math.max(1,Math.floor(w.m()/A.m())),S=48>=(S=Math.ceil(Math.log(T)/Math.LN2))?1:Math.pow(2,S-48),N=(F=l(T)).j(A);y(N)||0<N.l(w);)N=(F=l(T-=S)).j(A);m(F)&&(F=h),R=R.add(F),w=g(w,N)}return new E(R,w)}function M(w){for(var A=w.g.length+1,T=[],S=0;S<A;S++)T[S]=w.i(S)<<1|w.i(S-1)>>>31;return new o(T,w.h)}function C(w,A){var T=A>>5;A%=32;for(var S=w.g.length-T,R=[],F=0;F<S;F++)R[F]=0<A?w.i(F+T)>>>A|w.i(F+T+1)<<32-A:w.i(F+T);return new o(R,w.h)}(n=o.prototype).m=function(){if(y(this))return-_(this).m();for(var w=0,A=1,T=0;T<this.g.length;T++){var S=this.i(T);w+=(0<=S?S:4294967296+S)*A,A*=4294967296}return w},n.toString=function(w){if(2>(w=w||10)||36<w)throw Error("radix out of range: "+w);if(m(this))return"0";if(y(this))return"-"+_(this).toString(w);for(var A=l(Math.pow(w,6)),T=this,S="";;){var R=x(T,A).g,F=((0<(T=g(T,R.j(A))).g.length?T.g[0]:T.h)>>>0).toString(w);if(m(T=R))return F+S;for(;6>F.length;)F="0"+F;S=F+S}},n.i=function(w){return 0>w?0:w<this.g.length?this.g[w]:this.h},n.l=function(w){return y(w=g(this,w))?-1:m(w)?0:1},n.abs=function(){return y(this)?_(this):this},n.add=function(w){for(var A=Math.max(this.g.length,w.g.length),T=[],S=0,R=0;R<=A;R++){var F=S+(65535&this.i(R))+(65535&w.i(R)),N=(F>>>16)+(this.i(R)>>>16)+(w.i(R)>>>16);S=N>>>16,T[R]=(N&=65535)<<16|(F&=65535)}return new o(T,-2147483648&T[T.length-1]?-1:0)},n.j=function(w){if(m(this)||m(w))return d;if(y(this))return y(w)?_(this).j(_(w)):_(_(this).j(w));if(y(w))return _(this.j(_(w)));if(0>this.l(f)&&0>w.l(f))return l(this.m()*w.m());for(var A=this.g.length+w.g.length,T=[],S=0;S<2*A;S++)T[S]=0;for(S=0;S<this.g.length;S++)for(var R=0;R<w.g.length;R++){var F=this.i(S)>>>16,N=65535&this.i(S),H=w.i(R)>>>16,K=65535&w.i(R);T[2*S+2*R]+=N*K,b(T,2*S+2*R),T[2*S+2*R+1]+=F*K,b(T,2*S+2*R+1),T[2*S+2*R+1]+=N*H,b(T,2*S+2*R+1),T[2*S+2*R+2]+=F*H,b(T,2*S+2*R+2)}for(S=0;S<A;S++)T[S]=T[2*S+1]<<16|T[2*S];for(S=A;S<2*A;S++)T[S]=0;return new o(T,0)},n.A=function(w){return x(this,w).h},n.and=function(w){for(var A=Math.max(this.g.length,w.g.length),T=[],S=0;S<A;S++)T[S]=this.i(S)&w.i(S);return new o(T,this.h&w.h)},n.or=function(w){for(var A=Math.max(this.g.length,w.g.length),T=[],S=0;S<A;S++)T[S]=this.i(S)|w.i(S);return new o(T,this.h|w.h)},n.xor=function(w){for(var A=Math.max(this.g.length,w.g.length),T=[],S=0;S<A;S++)T[S]=this.i(S)^w.i(S);return new o(T,this.h^w.h)},r.prototype.digest=r.prototype.v,r.prototype.reset=r.prototype.s,r.prototype.update=r.prototype.u,a8=o8.Md5=r,o.prototype.add=o.prototype.add,o.prototype.multiply=o.prototype.j,o.prototype.modulo=o.prototype.A,o.prototype.compare=o.prototype.l,o.prototype.toNumber=o.prototype.m,o.prototype.toString=o.prototype.toString,o.prototype.getBits=o.prototype.i,o.fromNumber=l,o.fromString=function u(w,A){if(0==w.length)throw Error("number format error: empty string");if(2>(A=A||10)||36<A)throw Error("radix out of range: "+A);if("-"==w.charAt(0))return _(u(w.substring(1),A));if(0<=w.indexOf("-"))throw Error('number format error: interior "-" character');for(var T=l(Math.pow(A,8)),S=d,R=0;R<w.length;R+=8){var F=Math.min(8,w.length-R),N=parseInt(w.substring(R,R+F),A);8>F?(F=l(Math.pow(A,F)),S=S.j(F).add(l(N))):S=(S=S.j(T)).add(l(N))}return S},bc=o8.Integer=o}).apply(typeof s8<"u"?s8:typeof self<"u"?self:typeof window<"u"?window:{});var c8,Pg,l8,Y0,_1,u8,d8,h8,K0=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},pa={};(function(){var n,e="function"==typeof Object.defineProperties?Object.defineProperty:function(p,v,I){return p==Array.prototype||p==Object.prototype||(p[v]=I.value),p},r=function t(p){p=["object"==typeof globalThis&&globalThis,p,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof K0&&K0];for(var v=0;v<p.length;++v){var I=p[v];if(I&&I.Math==Math)return I}throw Error("Cannot find global object")}(this);!function i(p,v){if(v)e:{var I=r;p=p.split(".");for(var P=0;P<p.length-1;P++){var j=p[P];if(!(j in I))break e;I=I[j]}(v=v(P=I[p=p[p.length-1]]))!=P&&null!=v&&e(I,p,{configurable:!0,writable:!0,value:v})}}("Array.prototype.values",function(p){return p||function(){return function s(p,v){p instanceof String&&(p+="");var I=0,P=!1,j={next:function(){if(!P&&I<p.length){var J=I++;return{value:v(J,p[J]),done:!1}}return P=!0,{done:!0,value:void 0}}};return j[Symbol.iterator]=function(){return j},j}(this,function(v,I){return I})}});var o=o||{},a=this||self;function c(p){var v=typeof p;return"array"==(v="object"!=v?v:p?Array.isArray(p)?"array":v:"null")||"object"==v&&"number"==typeof p.length}function l(p){var v=typeof p;return"object"==v&&null!=p||"function"==v}function u(p,v,I){return p.call.apply(p.bind,arguments)}function d(p,v,I){if(!p)throw Error();if(2<arguments.length){var P=Array.prototype.slice.call(arguments,2);return function(){var j=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(j,P),p.apply(v,j)}}return function(){return p.apply(v,arguments)}}function h(p,v,I){return(h=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?u:d).apply(null,arguments)}function f(p,v){var I=Array.prototype.slice.call(arguments,1);return function(){var P=I.slice();return P.push.apply(P,arguments),p.apply(this,P)}}function m(p,v){function I(){}I.prototype=v.prototype,p.aa=v.prototype,p.prototype=new I,p.prototype.constructor=p,p.Qb=function(P,j,J){for(var Ne=Array(arguments.length-2),En=2;En<arguments.length;En++)Ne[En-2]=arguments[En];return v.prototype[j].apply(P,Ne)}}function y(p){const v=p.length;if(0<v){const I=Array(v);for(let P=0;P<v;P++)I[P]=p[P];return I}return[]}function _(p,v){for(let I=1;I<arguments.length;I++){const P=arguments[I];if(c(P)){const j=p.length||0,J=P.length||0;p.length=j+J;for(let Ne=0;Ne<J;Ne++)p[j+Ne]=P[Ne]}else p.push(P)}}function b(p){return/^[\s\xa0]*$/.test(p)}function E(){var p=a.navigator;return p&&(p=p.userAgent)?p:""}function x(p){return x[" "](p),p}x[" "]=function(){};var M=!(-1==E().indexOf("Gecko")||-1!=E().toLowerCase().indexOf("webkit")&&-1==E().indexOf("Edge")||-1!=E().indexOf("Trident")||-1!=E().indexOf("MSIE")||-1!=E().indexOf("Edge"));function C(p,v,I){for(const P in p)v.call(I,p[P],P,p)}function A(p){const v={};for(const I in p)v[I]=p[I];return v}const T="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function S(p,v){let I,P;for(let j=1;j<arguments.length;j++){for(I in P=arguments[j],P)p[I]=P[I];for(let J=0;J<T.length;J++)I=T[J],Object.prototype.hasOwnProperty.call(P,I)&&(p[I]=P[I])}}function R(p){var v=1;p=p.split(":");const I=[];for(;0<v&&p.length;)I.push(p.shift()),v--;return p.length&&I.push(p.join(":")),I}function F(p){a.setTimeout(()=>{throw p},0)}function N(){var p=ce;let v=null;return p.g&&(v=p.g,p.g=p.g.next,p.g||(p.h=null),v.next=null),v}var K=new class g{constructor(v,I){this.i=v,this.j=I,this.h=0,this.g=null}get(){let v;return 0<this.h?(this.h--,v=this.g,this.g=v.next,v.next=null):v=this.i(),v}}(()=>new se,p=>p.reset());class se{constructor(){this.next=this.g=this.h=null}set(v,I){this.h=v,this.g=I,this.next=null}reset(){this.next=this.g=this.h=null}}let ne,ye=!1,ce=new class H{constructor(){this.h=this.g=null}add(v,I){const P=K.get();P.set(v,I),this.h?this.h.next=P:this.g=P,this.h=P}},ge=()=>{const p=a.Promise.resolve(void 0);ne=()=>{p.then(G)}};var G=()=>{for(var p;p=N();){try{p.h.call(p.g)}catch(I){F(I)}var v=K;v.j(p),100>v.h&&(v.h++,p.next=v.g,v.g=p)}ye=!1};function ee(){this.s=this.s,this.C=this.C}function Te(p,v){this.type=p,this.g=this.target=v,this.defaultPrevented=!1}ee.prototype.s=!1,ee.prototype.ma=function(){this.s||(this.s=!0,this.N())},ee.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()},Te.prototype.h=function(){this.defaultPrevented=!0};var He=function(){if(!a.addEventListener||!Object.defineProperty)return!1;var p=!1,v=Object.defineProperty({},"passive",{get:function(){p=!0}});try{const I=()=>{};a.addEventListener("test",I,v),a.removeEventListener("test",I,v)}catch{}return p}();function Ue(p,v){if(Te.call(this,p?p.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,p){var I=this.type=p.type,P=p.changedTouches&&p.changedTouches.length?p.changedTouches[0]:null;if(this.target=p.target||p.srcElement,this.g=v,v=p.relatedTarget){if(M){e:{try{x(v.nodeName);var j=!0;break e}catch{}j=!1}j||(v=null)}}else"mouseover"==I?v=p.fromElement:"mouseout"==I&&(v=p.toElement);this.relatedTarget=v,P?(this.clientX=void 0!==P.clientX?P.clientX:P.pageX,this.clientY=void 0!==P.clientY?P.clientY:P.pageY,this.screenX=P.screenX||0,this.screenY=P.screenY||0):(this.clientX=void 0!==p.clientX?p.clientX:p.pageX,this.clientY=void 0!==p.clientY?p.clientY:p.pageY,this.screenX=p.screenX||0,this.screenY=p.screenY||0),this.button=p.button,this.key=p.key||"",this.ctrlKey=p.ctrlKey,this.altKey=p.altKey,this.shiftKey=p.shiftKey,this.metaKey=p.metaKey,this.pointerId=p.pointerId||0,this.pointerType="string"==typeof p.pointerType?p.pointerType:ut[p.pointerType]||"",this.state=p.state,this.i=p,p.defaultPrevented&&Ue.aa.h.call(this)}}m(Ue,Te);var ut={2:"touch",3:"pen",4:"mouse"};Ue.prototype.h=function(){Ue.aa.h.call(this);var p=this.i;p.preventDefault?p.preventDefault():p.returnValue=!1};var it="closure_listenable_"+(1e6*Math.random()|0),at=0;function yt(p,v,I,P,j){this.listener=p,this.proxy=null,this.src=v,this.type=I,this.capture=!!P,this.ha=j,this.key=++at,this.da=this.fa=!1}function Ft(p){p.da=!0,p.listener=null,p.proxy=null,p.src=null,p.ha=null}function st(p){this.src=p,this.g={},this.h=0}function U(p,v){var I=v.type;if(I in p.g){var J,P=p.g[I],j=Array.prototype.indexOf.call(P,v,void 0);(J=0<=j)&&Array.prototype.splice.call(P,j,1),J&&(Ft(v),0==p.g[I].length&&(delete p.g[I],p.h--))}}function De(p,v,I,P){for(var j=0;j<p.length;++j){var J=p[j];if(!J.da&&J.listener==v&&J.capture==!!I&&J.ha==P)return j}return-1}st.prototype.add=function(p,v,I,P,j){var J=p.toString();(p=this.g[J])||(p=this.g[J]=[],this.h++);var Ne=De(p,v,P,j);return-1<Ne?(v=p[Ne],I||(v.fa=!1)):((v=new yt(v,this.src,J,!!P,j)).fa=I,p.push(v)),v};var ie="closure_lm_"+(1e6*Math.random()|0),ve={};function he(p,v,I,P,j){if(P&&P.once)return je(p,v,I,P,j);if(Array.isArray(v)){for(var J=0;J<v.length;J++)he(p,v[J],I,P,j);return null}return I=be(I),p&&p[it]?p.K(v,I,l(P)?!!P.capture:!!P,j):Qe(p,v,I,!1,P,j)}function Qe(p,v,I,P,j,J){if(!v)throw Error("Invalid event type");var Ne=l(j)?!!j.capture:!!j,En=D(p);if(En||(p[ie]=En=new st(p)),(I=En.add(v,I,P,Ne,J)).proxy)return I;if(P=function Le(){const v=V;return function p(I){return v.call(p.src,p.listener,I)}}(),I.proxy=P,P.src=p,P.listener=I,p.addEventListener)He||(j=Ne),void 0===j&&(j=!1),p.addEventListener(v.toString(),P,j);else if(p.attachEvent)p.attachEvent(yn(v.toString()),P);else{if(!p.addListener||!p.removeListener)throw Error("addEventListener and attachEvent are unavailable.");p.addListener(P)}return I}function je(p,v,I,P,j){if(Array.isArray(v)){for(var J=0;J<v.length;J++)je(p,v[J],I,P,j);return null}return I=be(I),p&&p[it]?p.L(v,I,l(P)?!!P.capture:!!P,j):Qe(p,v,I,!0,P,j)}function dt(p,v,I,P,j){if(Array.isArray(v))for(var J=0;J<v.length;J++)dt(p,v[J],I,P,j);else P=l(P)?!!P.capture:!!P,I=be(I),p&&p[it]?(p=p.i,(v=String(v).toString())in p.g&&-1<(I=De(J=p.g[v],I,P,j))&&(Ft(J[I]),Array.prototype.splice.call(J,I,1),0==J.length&&(delete p.g[v],p.h--))):p&&(p=D(p))&&(v=p.g[v.toString()],p=-1,v&&(p=De(v,I,P,j)),(I=-1<p?v[p]:null)&&Nt(I))}function Nt(p){if("number"!=typeof p&&p&&!p.da){var v=p.src;if(v&&v[it])U(v.i,p);else{var I=p.type,P=p.proxy;v.removeEventListener?v.removeEventListener(I,P,p.capture):v.detachEvent?v.detachEvent(yn(I),P):v.addListener&&v.removeListener&&v.removeListener(P),(I=D(v))?(U(I,p),0==I.h&&(I.src=null,v[ie]=null)):Ft(p)}}}function yn(p){return p in ve?ve[p]:ve[p]="on"+p}function V(p,v){if(p.da)p=!0;else{v=new Ue(v,this);var I=p.listener,P=p.ha||p.src;p.fa&&Nt(p),p=I.call(P,v)}return p}function D(p){return(p=p[ie])instanceof st?p:null}var X="__closure_events_fn_"+(1e9*Math.random()>>>0);function be(p){return"function"==typeof p?p:(p[X]||(p[X]=function(v){return p.handleEvent(v)}),p[X])}function le(){ee.call(this),this.i=new st(this),this.M=this,this.F=null}function pe(p,v){var I,P=p.F;if(P)for(I=[];P;P=P.F)I.push(P);if(p=p.M,P=v.type||v,"string"==typeof v)v=new Te(v,p);else if(v instanceof Te)v.target=v.target||p;else{var j=v;S(v=new Te(P,p),j)}if(j=!0,I)for(var J=I.length-1;0<=J;J--){var Ne=v.g=I[J];j=qe(Ne,P,!0,v)&&j}if(j=qe(Ne=v.g=p,P,!0,v)&&j,j=qe(Ne,P,!1,v)&&j,I)for(J=0;J<I.length;J++)j=qe(Ne=v.g=I[J],P,!1,v)&&j}function qe(p,v,I,P){if(!(v=p.i.g[String(v)]))return!0;v=v.concat();for(var j=!0,J=0;J<v.length;++J){var Ne=v[J];if(Ne&&!Ne.da&&Ne.capture==I){var En=Ne.listener,si=Ne.ha||Ne.src;Ne.fa&&U(p.i,Ne),j=!1!==En.call(si,P)&&j}}return j&&!P.defaultPrevented}function xe(p,v,I){if("function"==typeof p)I&&(p=h(p,I));else{if(!p||"function"!=typeof p.handleEvent)throw Error("Invalid listener argument");p=h(p.handleEvent,p)}return 2147483647<Number(v)?-1:a.setTimeout(p,v||0)}function ke(p){p.g=xe(()=>{p.g=null,p.i&&(p.i=!1,ke(p))},p.l);const v=p.h;p.h=null,p.m.apply(null,v)}m(le,ee),le.prototype[it]=!0,le.prototype.removeEventListener=function(p,v,I,P){dt(this,p,v,I,P)},le.prototype.N=function(){if(le.aa.N.call(this),this.i){var v,p=this.i;for(v in p.g){for(var I=p.g[v],P=0;P<I.length;P++)Ft(I[P]);delete p.g[v],p.h--}}this.F=null},le.prototype.K=function(p,v,I,P){return this.i.add(String(p),v,!1,I,P)},le.prototype.L=function(p,v,I,P){return this.i.add(String(p),v,!0,I,P)};class B extends ee{constructor(v,I){super(),this.m=v,this.l=I,this.h=null,this.i=!1,this.g=null}j(v){this.h=arguments,this.g?this.i=!0:ke(this)}N(){super.N(),this.g&&(a.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function we(p){ee.call(this),this.h=p,this.g={}}m(we,ee);var de=[];function ht(p){C(p.g,function(v,I){this.g.hasOwnProperty(I)&&Nt(v)},p),p.g={}}we.prototype.N=function(){we.aa.N.call(this),ht(this)},we.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var Ke=a.JSON.stringify,ot=a.JSON.parse,Ye=class{stringify(p){return a.JSON.stringify(p,void 0)}parse(p){return a.JSON.parse(p,void 0)}};function We(){}function z(){}We.prototype.h=null;var Ce={OPEN:"a",kb:"b",Ja:"c",wb:"d"};function _e(){Te.call(this,"d")}function te(){Te.call(this,"c")}m(_e,Te),m(te,Te);var Ee={},nt=null;function kt(){return nt=nt||new le}function Jn(p){Te.call(this,Ee.La,p)}function qr(p){const v=kt();pe(v,new Jn(v))}function cn(p,v){Te.call(this,Ee.STAT_EVENT,p),this.stat=v}function en(p){const v=kt();pe(v,new cn(v,p))}function bs(p,v){Te.call(this,Ee.Ma,p),this.size=v}function sl(p,v){if("function"!=typeof p)throw Error("Fn must not be null and must be a function");return a.setTimeout(function(){p()},v)}function cd(){this.g=!0}function to(p,v,I,P){p.info(function(){return"XMLHTTP TEXT ("+v+"): "+function Jw(p,v){if(!p.g)return v;if(!v)return null;try{var I=JSON.parse(v);if(I)for(p=0;p<I.length;p++)if(Array.isArray(I[p])){var P=I[p];if(!(2>P.length)){var j=P[1];if(Array.isArray(j)&&!(1>j.length)){var J=j[0];if("noop"!=J&&"stop"!=J&&"close"!=J)for(var Ne=1;Ne<j.length;Ne++)j[Ne]=""}}}return Ke(I)}catch{return v}}(p,I)+(P?" "+P:"")})}Ee.La="serverreachability",m(Jn,Te),Ee.STAT_EVENT="statevent",m(cn,Te),Ee.Ma="timingevent",m(bs,Te),cd.prototype.xa=function(){this.g=!1},cd.prototype.info=function(){};var ny,yp={NO_ERROR:0,gb:1,tb:2,sb:3,nb:4,rb:5,ub:6,Ia:7,TIMEOUT:8,xb:9},Zw={lb:"complete",Hb:"success",Ja:"error",Ia:"abort",zb:"ready",Ab:"readystatechange",TIMEOUT:"timeout",vb:"incrementaldata",yb:"progress",ob:"downloadprogress",Pb:"uploadprogress"};function k(){}function W(p,v,I,P){this.j=p,this.i=v,this.l=I,this.R=P||1,this.U=new we(this),this.I=45e3,this.H=null,this.o=!1,this.m=this.A=this.v=this.L=this.F=this.S=this.B=null,this.D=[],this.g=null,this.C=0,this.s=this.u=null,this.X=-1,this.J=!1,this.O=0,this.M=null,this.W=this.K=this.T=this.P=!1,this.h=new Y}function Y(){this.i=null,this.g="",this.h=!1}m(k,We),k.prototype.g=function(){return new XMLHttpRequest},k.prototype.i=function(){return{}},ny=new k;var Z={},Q={};function ze(p,v,I){p.L=1,p.v=eI(so(v)),p.m=I,p.P=!0,et(p,null)}function et(p,v){p.F=Date.now(),Mt(p),p.A=so(p.v);var I=p.A,P=p.R;Array.isArray(P)||(P=[String(P)]),ZJ(I.i,"t",P),p.C=0,I=p.j.J,p.h=new Y,p.g=gZ(p.j,I?v:null,!p.m),0<p.O&&(p.M=new B(h(p.Y,p,p.g),p.O)),v=p.U,I=p.g,P=p.ca;var j="readystatechange";Array.isArray(j)||(j&&(de[0]=j.toString()),j=de);for(var J=0;J<j.length;J++){var Ne=he(I,j[J],P||v.handleEvent,!1,v.h||v);if(!Ne)break;v.g[Ne.key]=Ne}v=p.H?A(p.H):{},p.m?(p.u||(p.u="POST"),v["Content-Type"]="application/x-www-form-urlencoded",p.g.ea(p.A,p.u,p.m,v)):(p.u="GET",p.g.ea(p.A,p.u,null,v)),qr(),function _p(p,v,I,P,j,J){p.info(function(){if(p.g)if(J)for(var Ne="",En=J.split("&"),si=0;si<En.length;si++){var Zt=En[si].split("=");if(1<Zt.length){var Ei=Zt[0];Zt=Zt[1];var bi=Ei.split("_");Ne=2<=bi.length&&"type"==bi[1]?Ne+(Ei+"=")+Zt+"&":Ne+(Ei+"=redacted&")}}else Ne=null;else Ne=J;return"XMLHTTP REQ ("+P+") [attempt "+j+"]: "+v+"\n"+I+"\n"+Ne})}(p.i,p.u,p.A,p.l,p.R,p.m)}function ft(p){return!!p.g&&"GET"==p.u&&2!=p.L&&p.j.Ca}function vt(p,v){var I=p.C,P=v.indexOf("\n",I);return-1==P?Q:(I=Number(v.substring(I,P)),isNaN(I)?Z:(P+=1)+I>v.length?Q:(v=v.slice(P,P+I),p.C=P+I,v))}function Mt(p){p.S=Date.now()+p.I,It(p,p.I)}function It(p,v){if(null!=p.B)throw Error("WatchDog timer not null");p.B=sl(h(p.ba,p),v)}function St(p){p.B&&(a.clearTimeout(p.B),p.B=null)}function vn(p){0==p.j.G||p.J||hZ(p.j,p)}function _r(p){St(p);var v=p.M;v&&"function"==typeof v.ma&&v.ma(),p.M=null,ht(p.U),p.g&&(v=p.g,p.g=null,v.abort(),v.ma())}function ar(p,v){try{var I=p.j;if(0!=I.G&&(I.g==p||Wn(I.h,p)))if(!p.K&&Wn(I.h,p)&&3==I.G){try{var P=I.Da.g.parse(v)}catch{P=null}if(Array.isArray(P)&&3==P.length){var j=P;if(0==j[0]){e:if(!I.u){if(I.g){if(!(I.g.F+3e3<p.F))break e;sI(I),rI(I)}vF(I),en(18)}}else I.za=j[1],0<I.za-I.T&&37500>j[2]&&I.F&&0==I.v&&!I.C&&(I.C=sl(h(I.Za,I),6e3));if(1>=vp(I.h)&&I.ca){try{I.ca()}catch{}I.ca=void 0}}else ud(I,11)}else if((p.K||I.g==p)&&sI(I),!b(v))for(j=I.Da.g.parse(v),v=0;v<j.length;v++){let Zt=j[v];if(I.T=Zt[0],Zt=Zt[1],2==I.G)if("c"==Zt[0]){I.K=Zt[1],I.ia=Zt[2];const Ei=Zt[3];null!=Ei&&(I.la=Ei,I.j.info("VER="+I.la));const bi=Zt[4];null!=bi&&(I.Aa=bi,I.j.info("SVER="+I.Aa));const wp=Zt[5];null!=wp&&"number"==typeof wp&&0<wp&&(I.L=P=1.5*wp,I.j.info("backChannelRequestTimeoutMs_="+P)),P=I;const oo=p.g;if(oo){const aI=oo.g?oo.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(aI){var J=P.h;J.g||-1==aI.indexOf("spdy")&&-1==aI.indexOf("quic")&&-1==aI.indexOf("h2")||(J.j=J.l,J.g=new Set,J.h&&(ro(J,J.h),J.h=null))}if(P.D){const bF=oo.g?oo.g.getResponseHeader("X-HTTP-Session-Id"):null;bF&&(P.ya=bF,Vn(P.I,P.D,bF))}}I.G=3,I.l&&I.l.ua(),I.ba&&(I.R=Date.now()-p.F,I.j.info("Handshake RTT: "+I.R+"ms"));var Ne=p;if((P=I).qa=mZ(P,P.J?P.ia:null,P.W),Ne.K){ry(P.h,Ne);var En=Ne,si=P.L;si&&(En.I=si),En.B&&(St(En),Mt(En)),P.g=Ne}else uZ(P);0<I.i.length&&iI(I)}else"stop"!=Zt[0]&&"close"!=Zt[0]||ud(I,7);else 3==I.G&&("stop"==Zt[0]||"close"==Zt[0]?"stop"==Zt[0]?ud(I,7):yF(I):"noop"!=Zt[0]&&I.l&&I.l.ta(Zt),I.v=0)}qr()}catch{}}W.prototype.ca=function(p){p=p.target;const v=this.M;v&&3==Ha(p)?v.j():this.Y(p)},W.prototype.Y=function(p){try{if(p==this.g)e:{const bi=Ha(this.g);var v=this.g.Ba();if(this.g.Z(),!(3>bi)&&(3!=bi||this.g&&(this.h.h||this.g.oa()||sZ(this.g)))){this.J||4!=bi||7==v||qr(),St(this);var I=this.g.Z();this.X=I;t:if(ft(this)){var P=sZ(this.g);p="";var j=P.length,J=4==Ha(this.g);if(!this.h.i){if(typeof TextDecoder>"u"){_r(this),vn(this);var Ne="";break t}this.h.i=new a.TextDecoder}for(v=0;v<j;v++)this.h.h=!0,p+=this.h.i.decode(P[v],{stream:!(J&&v==j-1)});P.length=0,this.h.g+=p,this.C=0,Ne=this.h.g}else Ne=this.g.oa();if(this.o=200==I,function Kw(p,v,I,P,j,J,Ne){p.info(function(){return"XMLHTTP RESP ("+P+") [ attempt "+j+"]: "+v+"\n"+I+"\n"+J+" "+Ne})}(this.i,this.u,this.A,this.l,this.R,bi,I),this.o){if(this.T&&!this.K){t:{if(this.g){var En,si=this.g;if((En=si.g?si.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!b(En)){var Zt=En;break t}}Zt=null}if(!(I=Zt)){this.o=!1,this.s=3,en(12),_r(this),vn(this);break e}to(this.i,this.l,I,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,ar(this,I)}if(this.P){let oo;for(I=!0;!this.J&&this.C<Ne.length;){if(oo=vt(this,Ne),oo==Q){4==bi&&(this.s=4,en(14),I=!1),to(this.i,this.l,null,"[Incomplete Response]");break}if(oo==Z){this.s=4,en(15),to(this.i,this.l,Ne,"[Invalid Chunk]"),I=!1;break}to(this.i,this.l,oo,null),ar(this,oo)}if(ft(this)&&0!=this.C&&(this.h.g=this.h.g.slice(this.C),this.C=0),4!=bi||0!=Ne.length||this.h.h||(this.s=1,en(16),I=!1),this.o=this.o&&I,I){if(0<Ne.length&&!this.W){this.W=!0;var Ei=this.j;Ei.g==this&&Ei.ba&&!Ei.M&&(Ei.j.info("Great, no buffering proxy detected. Bytes received: "+Ne.length),EF(Ei),Ei.M=!0,en(11))}}else to(this.i,this.l,Ne,"[Invalid Chunked Response]"),_r(this),vn(this)}else to(this.i,this.l,Ne,null),ar(this,Ne);4==bi&&_r(this),this.o&&!this.J&&(4==bi?hZ(this.j,this):(this.o=!1,Mt(this)))}else(function BFe(p){const v={};p=(p.g&&2<=Ha(p)&&p.g.getAllResponseHeaders()||"").split("\r\n");for(let P=0;P<p.length;P++){if(b(p[P]))continue;var I=R(p[P]);const j=I[0];if("string"!=typeof(I=I[1]))continue;I=I.trim();const J=v[j]||[];v[j]=J,J.push(I)}!function w(p,v){for(const I in p)v.call(void 0,p[I],I,p)}(v,function(P){return P.join(", ")})})(this.g),400==I&&0<Ne.indexOf("Unknown SID")?(this.s=3,en(12)):(this.s=0,en(13)),_r(this),vn(this)}}}catch{}},W.prototype.cancel=function(){this.J=!0,_r(this)},W.prototype.ba=function(){this.B=null;const p=Date.now();0<=p-this.S?(function Yw(p,v){p.info(function(){return"TIMEOUT: "+v})}(this.i,this.A),2!=this.L&&(qr(),en(17)),_r(this),this.s=2,vn(this)):It(this,this.S-p)};var no=class{constructor(p,v){this.g=p,this.map=v}};function Fn(p){this.l=p||10,p=a.PerformanceNavigationTiming?0<(p=a.performance.getEntriesByType("navigation")).length&&("hq"==p[0].nextHopProtocol||"h2"==p[0].nextHopProtocol):!!(a.chrome&&a.chrome.loadTimes&&a.chrome.loadTimes()&&a.chrome.loadTimes().wasFetchedViaSpdy),this.j=p?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}function zt(p){return!!p.h||!!p.g&&p.g.size>=p.j}function vp(p){return p.h?1:p.g?p.g.size:0}function Wn(p,v){return p.h?p.h==v:!!p.g&&p.g.has(v)}function ro(p,v){p.g?p.g.add(v):p.h=v}function ry(p,v){p.h&&p.h==v?p.h=null:p.g&&p.g.has(v)&&p.g.delete(v)}function ol(p){if(null!=p.h)return p.i.concat(p.h.D);if(null!=p.g&&0!==p.g.size){let v=p.i;for(const I of p.g.values())v=v.concat(I.D);return v}return y(p.i)}function Lo(p,v){if(p.forEach&&"function"==typeof p.forEach)p.forEach(v,void 0);else if(c(p)||"string"==typeof p)Array.prototype.forEach.call(p,v,void 0);else for(var I=function ii(p){if(p.na&&"function"==typeof p.na)return p.na();if(!p.V||"function"!=typeof p.V){if(typeof Map<"u"&&p instanceof Map)return Array.from(p.keys());if(!(typeof Set<"u"&&p instanceof Set)){if(c(p)||"string"==typeof p){var v=[];p=p.length;for(var I=0;I<p;I++)v.push(I);return v}v=[],I=0;for(const P in p)v[I++]=P;return v}}}(p),P=function iy(p){if(p.V&&"function"==typeof p.V)return p.V();if(typeof Map<"u"&&p instanceof Map||typeof Set<"u"&&p instanceof Set)return Array.from(p.values());if("string"==typeof p)return p.split("");if(c(p)){for(var v=[],I=p.length,P=0;P<I;P++)v.push(p[P]);return v}for(P in v=[],I=0,p)v[I++]=p[P];return v}(p),j=P.length,J=0;J<j;J++)v.call(void 0,P[J],I&&I[J],p)}Fn.prototype.cancel=function(){if(this.i=ol(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&0!==this.g.size){for(const p of this.g.values())p.cancel();this.g.clear()}};var Ep=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function io(p){if(this.g=this.o=this.j="",this.s=null,this.m=this.l="",this.h=!1,p instanceof io){this.h=p.h,ld(this,p.j),this.o=p.o,this.g=p.g,Qw(this,p.s),this.l=p.l;var v=p.i,I=new ay;I.i=v.i,v.g&&(I.g=new Map(v.g),I.h=v.h),XJ(this,I),this.m=p.m}else p&&(v=String(p).match(Ep))?(this.h=!1,ld(this,v[1]||"",!0),this.o=sy(v[2]||""),this.g=sy(v[3]||"",!0),Qw(this,v[4]),this.l=sy(v[5]||"",!0),XJ(this,v[6]||"",!0),this.m=sy(v[7]||"")):(this.h=!1,this.i=new ay(null,this.h))}function so(p){return new io(p)}function ld(p,v,I){p.j=I?sy(v,!0):v,p.j&&(p.j=p.j.replace(/:$/,""))}function Qw(p,v){if(v){if(v=Number(v),isNaN(v)||0>v)throw Error("Bad port number "+v);p.s=v}else p.s=null}function XJ(p,v,I){v instanceof ay?(p.i=v,function NFe(p,v){v&&!p.j&&(al(p),p.i=null,p.g.forEach(function(I,P){var j=P.toLowerCase();P!=j&&(YJ(this,P),ZJ(this,j,I))},p)),p.j=v}(p.i,p.h)):(I||(v=oy(v,RFe)),p.i=new ay(v,p.h))}function Vn(p,v,I){p.i.set(v,I)}function eI(p){return Vn(p,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),p}function sy(p,v){return p?v?decodeURI(p.replace(/%25/g,"%2525")):decodeURIComponent(p):""}function oy(p,v,I){return"string"==typeof p?(p=encodeURI(p).replace(v,MFe),I&&(p=p.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),p):null}function MFe(p){return"%"+((p=p.charCodeAt(0))>>4&15).toString(16)+(15&p).toString(16)}io.prototype.toString=function(){var p=[],v=this.j;v&&p.push(oy(v,KJ,!0),":");var I=this.g;return(I||"file"==v)&&(p.push("//"),(v=this.o)&&p.push(oy(v,KJ,!0),"@"),p.push(encodeURIComponent(String(I)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(I=this.s)&&p.push(":",String(I))),(I=this.l)&&(this.g&&"/"!=I.charAt(0)&&p.push("/"),p.push(oy(I,"/"==I.charAt(0)?DFe:CFe,!0))),(I=this.i.toString())&&p.push("?",I),(I=this.m)&&p.push("#",oy(I,PFe)),p.join("")};var KJ=/[#\/\?@]/g,CFe=/[#\?:]/g,DFe=/[#\?]/g,RFe=/[#\?@]/g,PFe=/#/g;function ay(p,v){this.h=this.g=null,this.i=p||null,this.j=!!v}function al(p){p.g||(p.g=new Map,p.h=0,p.i&&function Li(p,v){if(p){p=p.split("&");for(var I=0;I<p.length;I++){var P=p[I].indexOf("="),j=null;if(0<=P){var J=p[I].substring(0,P);j=p[I].substring(P+1)}else J=p[I];v(J,j?decodeURIComponent(j.replace(/\+/g," ")):"")}}}(p.i,function(v,I){p.add(decodeURIComponent(v.replace(/\+/g," ")),I)}))}function YJ(p,v){al(p),v=bp(p,v),p.g.has(v)&&(p.i=null,p.h-=p.g.get(v).length,p.g.delete(v))}function JJ(p,v){return al(p),v=bp(p,v),p.g.has(v)}function ZJ(p,v,I){YJ(p,v),0<I.length&&(p.i=null,p.g.set(bp(p,v),y(I)),p.h+=I.length)}function bp(p,v){return v=String(v),p.j&&(v=v.toLowerCase()),v}function cl(p,v,I,P,j){try{j&&(j.onload=null,j.onerror=null,j.onabort=null,j.ontimeout=null),P(I)}catch{}}function LFe(){this.g=new Ye}function FFe(p,v,I){const P=I||"";try{Lo(p,function(j,J){let Ne=j;l(j)&&(Ne=Ke(j)),v.push(P+J+"="+encodeURIComponent(Ne))})}catch(j){throw v.push(P+"type="+encodeURIComponent("_badmap")),j}}function cy(p){this.l=p.Ub||null,this.j=p.eb||!1}function tI(p,v){le.call(this),this.D=p,this.o=v,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.u=new Headers,this.h=null,this.B="GET",this.A="",this.g=!1,this.v=this.j=this.l=null}function QJ(p){p.j.read().then(p.Pa.bind(p)).catch(p.ga.bind(p))}function ly(p){p.readyState=4,p.l=null,p.j=null,p.v=null,uy(p)}function uy(p){p.onreadystatechange&&p.onreadystatechange.call(p)}function eZ(p){let v="";return C(p,function(I,P){v+=P,v+=":",v+=I,v+="\r\n"}),v}function _F(p,v,I){e:{for(P in I){var P=!1;break e}P=!0}P||(I=eZ(I),"string"==typeof p?null!=I&&encodeURIComponent(String(I)):Vn(p,v,I))}function cr(p){le.call(this),this.headers=new Map,this.o=p||null,this.h=!1,this.v=this.g=null,this.D="",this.m=0,this.l="",this.j=this.B=this.u=this.A=!1,this.I=null,this.H="",this.J=!1}(n=ay.prototype).add=function(p,v){al(this),this.i=null,p=bp(this,p);var I=this.g.get(p);return I||this.g.set(p,I=[]),I.push(v),this.h+=1,this},n.forEach=function(p,v){al(this),this.g.forEach(function(I,P){I.forEach(function(j){p.call(v,j,P,this)},this)},this)},n.na=function(){al(this);const p=Array.from(this.g.values()),v=Array.from(this.g.keys()),I=[];for(let P=0;P<v.length;P++){const j=p[P];for(let J=0;J<j.length;J++)I.push(v[P])}return I},n.V=function(p){al(this);let v=[];if("string"==typeof p)JJ(this,p)&&(v=v.concat(this.g.get(bp(this,p))));else{p=Array.from(this.g.values());for(let I=0;I<p.length;I++)v=v.concat(p[I])}return v},n.set=function(p,v){return al(this),this.i=null,JJ(this,p=bp(this,p))&&(this.h-=this.g.get(p).length),this.g.set(p,[v]),this.h+=1,this},n.get=function(p,v){return p&&0<(p=this.V(p)).length?String(p[0]):v},n.toString=function(){if(this.i)return this.i;if(!this.g)return"";const p=[],v=Array.from(this.g.keys());for(var I=0;I<v.length;I++){var P=v[I];const J=encodeURIComponent(String(P)),Ne=this.V(P);for(P=0;P<Ne.length;P++){var j=J;""!==Ne[P]&&(j+="="+encodeURIComponent(String(Ne[P]))),p.push(j)}}return this.i=p.join("&")},m(cy,We),cy.prototype.g=function(){return new tI(this.l,this.j)},cy.prototype.i=function(p){return function(){return p}}({}),m(tI,le),(n=tI.prototype).open=function(p,v){if(0!=this.readyState)throw this.abort(),Error("Error reopening a connection");this.B=p,this.A=v,this.readyState=1,uy(this)},n.send=function(p){if(1!=this.readyState)throw this.abort(),Error("need to call open() first. ");this.g=!0;const v={headers:this.u,method:this.B,credentials:this.m,cache:void 0};p&&(v.body=p),(this.D||a).fetch(new Request(this.A,v)).then(this.Sa.bind(this),this.ga.bind(this))},n.abort=function(){this.response=this.responseText="",this.u=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&4!=this.readyState&&(this.g=!1,ly(this)),this.readyState=0},n.Sa=function(p){if(this.g&&(this.l=p,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=p.headers,this.readyState=2,uy(this)),this.g&&(this.readyState=3,uy(this),this.g)))if("arraybuffer"===this.responseType)p.arrayBuffer().then(this.Qa.bind(this),this.ga.bind(this));else if(typeof a.ReadableStream<"u"&&"body"in p){if(this.j=p.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.v=new TextDecoder;QJ(this)}else p.text().then(this.Ra.bind(this),this.ga.bind(this))},n.Pa=function(p){if(this.g){if(this.o&&p.value)this.response.push(p.value);else if(!this.o){var v=p.value?p.value:new Uint8Array(0);(v=this.v.decode(v,{stream:!p.done}))&&(this.response=this.responseText+=v)}p.done?ly(this):uy(this),3==this.readyState&&QJ(this)}},n.Ra=function(p){this.g&&(this.response=this.responseText=p,ly(this))},n.Qa=function(p){this.g&&(this.response=p,ly(this))},n.ga=function(){this.g&&ly(this)},n.setRequestHeader=function(p,v){this.u.append(p,v)},n.getResponseHeader=function(p){return this.h&&this.h.get(p.toLowerCase())||""},n.getAllResponseHeaders=function(){if(!this.h)return"";const p=[],v=this.h.entries();for(var I=v.next();!I.done;)p.push((I=I.value)[0]+": "+I[1]),I=v.next();return p.join("\r\n")},Object.defineProperty(tI.prototype,"withCredentials",{get:function(){return"include"===this.m},set:function(p){this.m=p?"include":"same-origin"}}),m(cr,le);var VFe=/^https?$/i,UFe=["POST","PUT"];function tZ(p,v){p.h=!1,p.g&&(p.j=!0,p.g.abort(),p.j=!1),p.l=v,p.m=5,nZ(p),nI(p)}function nZ(p){p.A||(p.A=!0,pe(p,"complete"),pe(p,"error"))}function rZ(p){if(p.h&&typeof o<"u"&&(!p.v[1]||4!=Ha(p)||2!=p.Z()))if(p.u&&4==Ha(p))xe(p.Ea,0,p);else if(pe(p,"readystatechange"),4==Ha(p)){p.h=!1;try{const Ne=p.Z();e:switch(Ne){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var v=!0;break e;default:v=!1}var I;if(!(I=v)){var P;if(P=0===Ne){var j=String(p.D).match(Ep)[1]||null;!j&&a.self&&a.self.location&&(j=a.self.location.protocol.slice(0,-1)),P=!VFe.test(j?j.toLowerCase():"")}I=P}if(I)pe(p,"complete"),pe(p,"success");else{p.m=6;try{var J=2<Ha(p)?p.g.statusText:""}catch{J=""}p.l=J+" ["+p.Z()+"]",nZ(p)}}finally{nI(p)}}}function nI(p,v){if(p.g){iZ(p);const I=p.g,P=p.v[0]?()=>{}:null;p.g=null,p.v=null,v||pe(p,"ready");try{I.onreadystatechange=P}catch{}}}function iZ(p){p.I&&(a.clearTimeout(p.I),p.I=null)}function Ha(p){return p.g?p.g.readyState:0}function sZ(p){try{if(!p.g)return null;if("response"in p.g)return p.g.response;switch(p.H){case"":case"text":return p.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in p.g)return p.g.mozResponseArrayBuffer}return null}catch{return null}}function dy(p,v,I){return I&&I.internalChannelParams&&I.internalChannelParams[p]||v}function oZ(p){this.Aa=0,this.i=[],this.j=new cd,this.ia=this.qa=this.I=this.W=this.g=this.ya=this.D=this.H=this.m=this.S=this.o=null,this.Ya=this.U=0,this.Va=dy("failFast",!1,p),this.F=this.C=this.u=this.s=this.l=null,this.X=!0,this.za=this.T=-1,this.Y=this.v=this.B=0,this.Ta=dy("baseRetryDelayMs",5e3,p),this.cb=dy("retryDelaySeedMs",1e4,p),this.Wa=dy("forwardChannelMaxRetries",2,p),this.wa=dy("forwardChannelRequestTimeoutMs",2e4,p),this.pa=p&&p.xmlHttpFactory||void 0,this.Xa=p&&p.Tb||void 0,this.Ca=p&&p.useFetchStreams||!1,this.L=void 0,this.J=p&&p.supportsCrossDomainXhr||!1,this.K="",this.h=new Fn(p&&p.concurrentRequestLimit),this.Da=new LFe,this.P=p&&p.fastHandshake||!1,this.O=p&&p.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.Ua=p&&p.Rb||!1,p&&p.xa&&this.j.xa(),p&&p.forceLongPolling&&(this.X=!1),this.ba=!this.P&&this.X&&p&&p.detectBufferingProxy||!1,this.ja=void 0,p&&p.longPollingTimeout&&0<p.longPollingTimeout&&(this.ja=p.longPollingTimeout),this.ca=void 0,this.R=0,this.M=!1,this.ka=this.A=null}function yF(p){if(aZ(p),3==p.G){var v=p.U++,I=so(p.I);if(Vn(I,"SID",p.K),Vn(I,"RID",v),Vn(I,"TYPE","terminate"),hy(p,I),(v=new W(p,p.j,v)).L=2,v.v=eI(so(I)),I=!1,a.navigator&&a.navigator.sendBeacon)try{I=a.navigator.sendBeacon(v.v.toString(),"")}catch{}!I&&a.Image&&((new Image).src=v.v,I=!0),I||(v.g=gZ(v.j,null),v.g.ea(v.v)),v.F=Date.now(),Mt(v)}pZ(p)}function rI(p){p.g&&(EF(p),p.g.cancel(),p.g=null)}function aZ(p){rI(p),p.u&&(a.clearTimeout(p.u),p.u=null),sI(p),p.h.cancel(),p.s&&("number"==typeof p.s&&a.clearTimeout(p.s),p.s=null)}function iI(p){if(!zt(p.h)&&!p.s){p.s=!0;var v=p.Ga;ne||ge(),ye||(ne(),ye=!0),ce.add(v,p),p.B=0}}function cZ(p,v){var I;I=v?v.l:p.U++;const P=so(p.I);Vn(P,"SID",p.K),Vn(P,"RID",I),Vn(P,"AID",p.T),hy(p,P),p.m&&p.o&&_F(P,p.m,p.o),I=new W(p,p.j,I,p.B+1),null===p.m&&(I.H=p.o),v&&(p.i=v.D.concat(p.i)),v=lZ(p,I,1e3),I.I=Math.round(.5*p.wa)+Math.round(.5*p.wa*Math.random()),ro(p.h,I),ze(I,P,v)}function hy(p,v){p.H&&C(p.H,function(I,P){Vn(v,P,I)}),p.l&&Lo({},function(I,P){Vn(v,P,I)})}function lZ(p,v,I){I=Math.min(p.i.length,I);var P=p.l?h(p.l.Na,p.l,p):null;e:{var j=p.i;let J=-1;for(;;){const Ne=["count="+I];-1==J?0<I?(J=j[0].g,Ne.push("ofs="+J)):J=0:Ne.push("ofs="+J);let En=!0;for(let si=0;si<I;si++){let Zt=j[si].g;const Ei=j[si].map;if(Zt-=J,0>Zt)J=Math.max(0,j[si].g-100),En=!1;else try{FFe(Ei,Ne,"req"+Zt+"_")}catch{P&&P(Ei)}}if(En){P=Ne.join("&");break e}}}return p=p.i.splice(0,I),v.D=p,P}function uZ(p){if(!p.g&&!p.u){p.Y=1;var v=p.Fa;ne||ge(),ye||(ne(),ye=!0),ce.add(v,p),p.v=0}}function vF(p){return!(p.g||p.u||3<=p.v||(p.Y++,p.u=sl(h(p.Fa,p),fZ(p,p.v)),p.v++,0))}function EF(p){null!=p.A&&(a.clearTimeout(p.A),p.A=null)}function dZ(p){p.g=new W(p,p.j,"rpc",p.Y),null===p.m&&(p.g.H=p.o),p.g.O=0;var v=so(p.qa);Vn(v,"RID","rpc"),Vn(v,"SID",p.K),Vn(v,"AID",p.T),Vn(v,"CI",p.F?"0":"1"),!p.F&&p.ja&&Vn(v,"TO",p.ja),Vn(v,"TYPE","xmlhttp"),hy(p,v),p.m&&p.o&&_F(v,p.m,p.o),p.L&&(p.g.I=p.L);var I=p.g;p=p.ia,I.L=1,I.v=eI(so(v)),I.m=null,I.P=!0,et(I,p)}function sI(p){null!=p.C&&(a.clearTimeout(p.C),p.C=null)}function hZ(p,v){var I=null;if(p.g==v){sI(p),EF(p),p.g=null;var P=2}else{if(!Wn(p.h,v))return;I=v.D,ry(p.h,v),P=1}if(0!=p.G)if(v.o)if(1==P){I=v.m?v.m.length:0,v=Date.now()-v.F;var j=p.B;pe(P=kt(),new bs(P,I)),iI(p)}else uZ(p);else if(3==(j=v.s)||0==j&&0<v.X||!(1==P&&function HFe(p,v){return!(vp(p.h)>=p.h.j-(p.s?1:0)||(p.s?(p.i=v.D.concat(p.i),0):1==p.G||2==p.G||p.B>=(p.Va?0:p.Wa)||(p.s=sl(h(p.Ga,p,v),fZ(p,p.B)),p.B++,0)))}(p,v)||2==P&&vF(p)))switch(I&&0<I.length&&(v=p.h,v.i=v.i.concat(I)),j){case 1:ud(p,5);break;case 4:ud(p,10);break;case 3:ud(p,6);break;default:ud(p,2)}}function fZ(p,v){let I=p.Ta+Math.floor(Math.random()*p.cb);return p.isActive()||(I*=2),I*v}function ud(p,v){if(p.j.info("Error code "+v),2==v){var I=h(p.fb,p),P=p.Xa;const j=!P;P=new io(P||"//www.google.com/images/cleardot.gif"),a.location&&"http"==a.location.protocol||ld(P,"https"),eI(P),j?function OFe(p,v){const I=new cd;if(a.Image){const P=new Image;P.onload=f(cl,I,"TestLoadImage: loaded",!0,v,P),P.onerror=f(cl,I,"TestLoadImage: error",!1,v,P),P.onabort=f(cl,I,"TestLoadImage: abort",!1,v,P),P.ontimeout=f(cl,I,"TestLoadImage: timeout",!1,v,P),a.setTimeout(function(){P.ontimeout&&P.ontimeout()},1e4),P.src=p}else v(!1)}(P.toString(),I):function kFe(p,v){new cd;const P=new AbortController,j=setTimeout(()=>{P.abort(),cl(0,0,!1,v)},1e4);fetch(p,{signal:P.signal}).then(J=>{clearTimeout(j),cl(0,0,!!J.ok,v)}).catch(()=>{clearTimeout(j),cl(0,0,!1,v)})}(P.toString(),I)}else en(2);p.G=0,p.l&&p.l.sa(v),pZ(p),aZ(p)}function pZ(p){if(p.G=0,p.ka=[],p.l){const v=ol(p.h);(0!=v.length||0!=p.i.length)&&(_(p.ka,v),_(p.ka,p.i),p.h.i.length=0,y(p.i),p.i.length=0),p.l.ra()}}function mZ(p,v,I){var P=I instanceof io?so(I):new io(I);if(""!=P.g)v&&(P.g=v+"."+P.g),Qw(P,P.s);else{var j=a.location;P=j.protocol,v=v?v+"."+j.hostname:j.hostname,j=+j.port;var J=new io(null);P&&ld(J,P),v&&(J.g=v),j&&Qw(J,j),I&&(J.l=I),P=J}return v=p.ya,(I=p.D)&&v&&Vn(P,I,v),Vn(P,"VER",p.la),hy(p,P),P}function gZ(p,v,I){if(v&&!p.J)throw Error("Can't create secondary domain capable XhrIo object.");return(v=new cr(p.Ca&&!p.pa?new cy({eb:I}):p.pa)).Ha(p.J),v}function _Z(){}function oI(){}function Ts(p,v){le.call(this),this.g=new oZ(v),this.l=p,this.h=v&&v.messageUrlParams||null,p=v&&v.messageHeaders||null,v&&v.clientProtocolHeaderRequired&&(p?p["X-Client-Protocol"]="webchannel":p={"X-Client-Protocol":"webchannel"}),this.g.o=p,p=v&&v.initMessageHeaders||null,v&&v.messageContentType&&(p?p["X-WebChannel-Content-Type"]=v.messageContentType:p={"X-WebChannel-Content-Type":v.messageContentType}),v&&v.va&&(p?p["X-WebChannel-Client-Profile"]=v.va:p={"X-WebChannel-Client-Profile":v.va}),this.g.S=p,(p=v&&v.Sb)&&!b(p)&&(this.g.m=p),this.v=v&&v.supportsCrossDomainXhr||!1,this.u=v&&v.sendRawJson||!1,(v=v&&v.httpSessionIdParam)&&!b(v)&&(this.g.D=v,null!==(p=this.h)&&v in p&&v in(p=this.h)&&delete p[v]),this.j=new Tp(this)}function yZ(p){_e.call(this),p.__headers__&&(this.headers=p.__headers__,this.statusCode=p.__status__,delete p.__headers__,delete p.__status__);var v=p.__sm__;if(v){e:{for(const I in v){p=I;break e}p=void 0}(this.i=p)&&(p=this.i,v=null!==v&&p in v?v[p]:void 0),this.data=v}else this.data=p}function vZ(){te.call(this),this.status=1}function Tp(p){this.g=p}(n=cr.prototype).Ha=function(p){this.J=p},n.ea=function(p,v,I,P){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+p);v=v?v.toUpperCase():"GET",this.D=p,this.l="",this.m=0,this.A=!1,this.h=!0,this.g=this.o?this.o.g():ny.g(),this.v=function Ht(p){return p.h||(p.h=p.i())}(this.o?this.o:ny),this.g.onreadystatechange=h(this.Ea,this);try{this.B=!0,this.g.open(v,String(p),!0),this.B=!1}catch(J){return void tZ(this,J)}if(p=I||"",I=new Map(this.headers),P)if(Object.getPrototypeOf(P)===Object.prototype)for(var j in P)I.set(j,P[j]);else{if("function"!=typeof P.keys||"function"!=typeof P.get)throw Error("Unknown input type for opt_headers: "+String(P));for(const J of P.keys())I.set(J,P.get(J))}P=Array.from(I.keys()).find(J=>"content-type"==J.toLowerCase()),j=a.FormData&&p instanceof a.FormData,!(0<=Array.prototype.indexOf.call(UFe,v,void 0))||P||j||I.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[J,Ne]of I)this.g.setRequestHeader(J,Ne);this.H&&(this.g.responseType=this.H),"withCredentials"in this.g&&this.g.withCredentials!==this.J&&(this.g.withCredentials=this.J);try{iZ(this),this.u=!0,this.g.send(p),this.u=!1}catch(J){tZ(this,J)}},n.abort=function(p){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.m=p||7,pe(this,"complete"),pe(this,"abort"),nI(this))},n.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),nI(this,!0)),cr.aa.N.call(this)},n.Ea=function(){this.s||(this.B||this.u||this.j?rZ(this):this.bb())},n.bb=function(){rZ(this)},n.isActive=function(){return!!this.g},n.Z=function(){try{return 2<Ha(this)?this.g.status:-1}catch{return-1}},n.oa=function(){try{return this.g?this.g.responseText:""}catch{return""}},n.Oa=function(p){if(this.g){var v=this.g.responseText;return p&&0==v.indexOf(p)&&(v=v.substring(p.length)),ot(v)}},n.Ba=function(){return this.m},n.Ka=function(){return"string"==typeof this.l?this.l:String(this.l)},(n=oZ.prototype).la=8,n.G=1,n.connect=function(p,v,I,P){en(0),this.W=p,this.H=v||{},I&&void 0!==P&&(this.H.OSID=I,this.H.OAID=P),this.F=this.X,this.I=mZ(this,null,this.W),iI(this)},n.Ga=function(p){if(this.s)if(this.s=null,1==this.G){if(!p){this.U=Math.floor(1e5*Math.random()),p=this.U++;const j=new W(this,this.j,p);let J=this.o;if(this.S&&(J?(J=A(J),S(J,this.S)):J=this.S),null!==this.m||this.O||(j.H=J,J=null),this.P)e:{for(var v=0,I=0;I<this.i.length;I++){var P=this.i[I];if(void 0===(P="__data__"in P.map&&"string"==typeof(P=P.map.__data__)?P.length:void 0))break;if(4096<(v+=P)){v=I;break e}if(4096===v||I===this.i.length-1){v=I+1;break e}}v=1e3}else v=1e3;v=lZ(this,j,v),Vn(I=so(this.I),"RID",p),Vn(I,"CVER",22),this.D&&Vn(I,"X-HTTP-Session-Id",this.D),hy(this,I),J&&(this.O?v="headers="+encodeURIComponent(String(eZ(J)))+"&"+v:this.m&&_F(I,this.m,J)),ro(this.h,j),this.Ua&&Vn(I,"TYPE","init"),this.P?(Vn(I,"$req",v),Vn(I,"SID","null"),j.T=!0,ze(j,I,null)):ze(j,I,v),this.G=2}}else 3==this.G&&(p?cZ(this,p):0==this.i.length||zt(this.h)||cZ(this))},n.Fa=function(){if(this.u=null,dZ(this),this.ba&&!(this.M||null==this.g||0>=this.R)){var p=2*this.R;this.j.info("BP detection timer enabled: "+p),this.A=sl(h(this.ab,this),p)}},n.ab=function(){this.A&&(this.A=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.M=!0,en(10),rI(this),dZ(this))},n.Za=function(){null!=this.C&&(this.C=null,rI(this),vF(this),en(19))},n.fb=function(p){p?(this.j.info("Successfully pinged google.com"),en(2)):(this.j.info("Failed to ping google.com"),en(1))},n.isActive=function(){return!!this.l&&this.l.isActive(this)},(n=_Z.prototype).ua=function(){},n.ta=function(){},n.sa=function(){},n.ra=function(){},n.isActive=function(){return!0},n.Na=function(){},oI.prototype.g=function(p,v){return new Ts(p,v)},m(Ts,le),Ts.prototype.m=function(){this.g.l=this.j,this.v&&(this.g.J=!0),this.g.connect(this.l,this.h||void 0)},Ts.prototype.close=function(){yF(this.g)},Ts.prototype.o=function(p){var v=this.g;if("string"==typeof p){var I={};I.__data__=p,p=I}else this.u&&((I={}).__data__=Ke(p),p=I);v.i.push(new no(v.Ya++,p)),3==v.G&&iI(v)},Ts.prototype.N=function(){this.g.l=null,delete this.j,yF(this.g),delete this.g,Ts.aa.N.call(this)},m(yZ,_e),m(vZ,te),m(Tp,_Z),Tp.prototype.ua=function(){pe(this.g,"a")},Tp.prototype.ta=function(p){pe(this.g,new yZ(p))},Tp.prototype.sa=function(p){pe(this.g,new vZ)},Tp.prototype.ra=function(){pe(this.g,"b")},oI.prototype.createWebChannel=oI.prototype.g,Ts.prototype.send=Ts.prototype.o,Ts.prototype.open=Ts.prototype.m,Ts.prototype.close=Ts.prototype.close,h8=pa.createWebChannelTransport=function(){return new oI},d8=pa.getStatEventTarget=function(){return kt()},u8=pa.Event=Ee,_1=pa.Stat={mb:0,pb:1,qb:2,Jb:3,Ob:4,Lb:5,Mb:6,Kb:7,Ib:8,Nb:9,PROXY:10,NOPROXY:11,Gb:12,Cb:13,Db:14,Bb:15,Eb:16,Fb:17,ib:18,hb:19,jb:20},yp.NO_ERROR=0,yp.TIMEOUT=8,yp.HTTP_ERROR=6,Y0=pa.ErrorCode=yp,Zw.COMPLETE="complete",l8=pa.EventType=Zw,z.EventType=Ce,Ce.OPEN="a",Ce.CLOSE="b",Ce.ERROR="c",Ce.MESSAGE="d",le.prototype.listen=le.prototype.K,Pg=pa.WebChannel=z,pa.FetchXmlHttpFactory=cy,cr.prototype.listenOnce=cr.prototype.L,cr.prototype.getLastError=cr.prototype.Ka,cr.prototype.getLastErrorCode=cr.prototype.Ba,cr.prototype.getStatus=cr.prototype.Z,cr.prototype.getResponseJson=cr.prototype.Oa,cr.prototype.getResponseText=cr.prototype.oa,cr.prototype.send=cr.prototype.ea,cr.prototype.setWithCredentials=cr.prototype.Ha,c8=pa.XhrIo=cr}).apply(typeof K0<"u"?K0:typeof self<"u"?self:typeof window<"u"?window:{});const f8="@firebase/firestore";class Hr{constructor(e){this.uid=e}isAuthenticated(){return null!=this.uid}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}Hr.UNAUTHENTICATED=new Hr(null),Hr.GOOGLE_CREDENTIALS=new Hr("google-credentials-uid"),Hr.FIRST_PARTY=new Hr("first-party-uid"),Hr.MOCK_USER=new Hr("mock-user");let Ph="11.10.0";const Tc=new m0("@firebase/firestore");function Nh(){return Tc.logLevel}function fe(n,...e){if(Tc.logLevel<=qt.DEBUG){const t=e.map(y1);Tc.debug(`Firestore (${Ph}): ${n}`,...t)}}function fr(n,...e){if(Tc.logLevel<=qt.ERROR){const t=e.map(y1);Tc.error(`Firestore (${Ph}): ${n}`,...t)}}function Di(n,...e){if(Tc.logLevel<=qt.WARN){const t=e.map(y1);Tc.warn(`Firestore (${Ph}): ${n}`,...t)}}function y1(n){if("string"==typeof n)return n;try{return JSON.stringify(n)}catch{return n}}function Be(n,e,t){let r="Unexpected state";"string"==typeof e?r=e:t=e,m8(n,r,t)}function m8(n,e,t){let r=`FIRESTORE (${Ph}) INTERNAL ASSERTION FAILED: ${e} (ID: ${n.toString(16)})`;if(void 0!==t)try{r+=" CONTEXT: "+JSON.stringify(t)}catch{r+=" CONTEXT: "+t}throw fr(r),new Error(r)}function $e(n,e,t,r){let i="Unexpected state";"string"==typeof t?i=t:r=t,n||m8(e,i,r)}function Pe(n,e){return n}const q={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class ae extends yo{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}class zr{constructor(){this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}}class g8{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class vTe{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable(()=>t(Hr.UNAUTHENTICATED))}shutdown(){}}class ETe{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable(()=>t(this.token.user))}shutdown(){this.changeListener=null}}class bTe{constructor(e){this.t=e,this.currentUser=Hr.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){var r=this;$e(void 0===this.o,42304);let i=this.i;const s=l=>this.i!==i?(i=this.i,t(l)):Promise.resolve();let o=new zr;this.o=()=>{this.i++,this.currentUser=this.u(),o.resolve(),o=new zr,e.enqueueRetryable(()=>s(this.currentUser))};const a=()=>{const l=o;e.enqueueRetryable(O(function*(){yield l.promise,yield s(r.currentUser)}))},c=l=>{fe("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=l,this.o&&(this.auth.addAuthTokenListener(this.o),a())};this.t.onInit(l=>c(l)),setTimeout(()=>{if(!this.auth){const l=this.t.getImmediate({optional:!0});l?c(l):(fe("FirebaseAuthCredentialsProvider","Auth not yet detected"),o.resolve(),o=new zr)}},0),a()}getToken(){const e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then(r=>this.i!==e?(fe("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):r?($e("string"==typeof r.accessToken,31837,{l:r}),new g8(r.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){const e=this.auth&&this.auth.getUid();return $e(null===e||"string"==typeof e,2055,{h:e}),new Hr(e)}}class TTe{constructor(e,t,r){this.P=e,this.T=t,this.I=r,this.type="FirstParty",this.user=Hr.FIRST_PARTY,this.A=new Map}R(){return this.I?this.I():null}get headers(){this.A.set("X-Goog-AuthUser",this.P);const e=this.R();return e&&this.A.set("Authorization",e),this.T&&this.A.set("X-Goog-Iam-Authorization-Token",this.T),this.A}}class wTe{constructor(e,t,r){this.P=e,this.T=t,this.I=r}getToken(){return Promise.resolve(new TTe(this.P,this.T,this.I))}start(e,t){e.enqueueRetryable(()=>t(Hr.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class v1{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class ITe{constructor(e,t){this.V=t,this.forceRefresh=!1,this.appCheck=null,this.m=null,this.p=null,Rs(e)&&e.settings.appCheckToken&&(this.p=e.settings.appCheckToken)}start(e,t){$e(void 0===this.o,3512);const r=s=>{null!=s.error&&fe("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${s.error.message}`);const o=s.token!==this.m;return this.m=s.token,fe("FirebaseAppCheckTokenProvider",`Received ${o?"new":"existing"} token.`),o?t(s.token):Promise.resolve()};this.o=s=>{e.enqueueRetryable(()=>r(s))};const i=s=>{fe("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=s,this.o&&this.appCheck.addTokenListener(this.o)};this.V.onInit(s=>i(s)),setTimeout(()=>{if(!this.appCheck){const s=this.V.getImmediate({optional:!0});s?i(s):fe("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){if(this.p)return Promise.resolve(new v1(this.p));const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(t=>t?($e("string"==typeof t.token,44558,{tokenResult:t}),this.m=t.token,new v1(t.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}function STe(n){const e=typeof self<"u"&&(self.crypto||self.msCrypto),t=new Uint8Array(n);if(e&&"function"==typeof e.getRandomValues)e.getRandomValues(t);else for(let r=0;r<n;r++)t[r]=Math.floor(256*Math.random());return t}function E1(){return new TextEncoder}class b1{static newId(){const t=62*Math.floor(4.129032258064516);let r="";for(;r.length<20;){const i=STe(40);for(let s=0;s<i.length;++s)r.length<20&&i[s]<t&&(r+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789".charAt(i[s]%62))}return r}}function lt(n,e){return n<e?-1:n>e?1:0}function T1(n,e){let t=0;for(;t<n.length&&t<e.length;){const r=n.codePointAt(t),i=e.codePointAt(t);if(r!==i){if(r<128&&i<128)return lt(r,i);{const s=E1(),o=xTe(s.encode(_8(n,t)),s.encode(_8(e,t)));return 0!==o?o:lt(r,i)}}t+=r>65535?2:1}return lt(n.length,e.length)}function _8(n,e){return n.codePointAt(e)>65535?n.substring(e,e+2):n.substring(e,e+1)}function xTe(n,e){for(let t=0;t<n.length&&t<e.length;++t)if(n[t]!==e[t])return lt(n[t],e[t]);return lt(n.length,e.length)}function Oh(n,e,t){return n.length===e.length&&n.every((r,i)=>t(r,e[i]))}const w1="__name__";class bo{constructor(e,t,r){void 0===t?t=0:t>e.length&&Be(637,{offset:t,range:e.length}),void 0===r?r=e.length-t:r>e.length-t&&Be(1746,{length:r,range:e.length-t}),this.segments=e,this.offset=t,this.len=r}get length(){return this.len}isEqual(e){return 0===bo.comparator(this,e)}child(e){const t=this.segments.slice(this.offset,this.limit());return e instanceof bo?e.forEach(r=>{t.push(r)}):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return this.construct(this.segments,this.offset+(e=void 0===e?1:e),this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return 0===this.length}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,r=this.limit();t<r;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){const r=Math.min(e.length,t.length);for(let i=0;i<r;i++){const s=bo.compareSegments(e.get(i),t.get(i));if(0!==s)return s}return lt(e.length,t.length)}static compareSegments(e,t){const r=bo.isNumericId(e),i=bo.isNumericId(t);return r&&!i?-1:!r&&i?1:r&&i?bo.extractNumericId(e).compare(bo.extractNumericId(t)):T1(e,t)}static isNumericId(e){return e.startsWith("__id")&&e.endsWith("__")}static extractNumericId(e){return bc.fromString(e.substring(4,e.length-2))}}class jt extends bo{construct(e,t,r){return new jt(e,t,r)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){const t=[];for(const r of e){if(r.indexOf("//")>=0)throw new ae(q.INVALID_ARGUMENT,`Invalid segment (${r}). Paths must not contain // in them.`);t.push(...r.split("/").filter(i=>i.length>0))}return new jt(t)}static emptyPath(){return new jt([])}}const ATe=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class Bn extends bo{construct(e,t,r){return new Bn(e,t,r)}static isValidIdentifier(e){return ATe.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),Bn.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return 1===this.length&&this.get(0)===w1}static keyField(){return new Bn([w1])}static fromServerFormat(e){const t=[];let r="",i=0;const s=()=>{if(0===r.length)throw new ae(q.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(r),r=""};let o=!1;for(;i<e.length;){const a=e[i];if("\\"===a){if(i+1===e.length)throw new ae(q.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const c=e[i+1];if("\\"!==c&&"."!==c&&"`"!==c)throw new ae(q.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);r+=c,i+=2}else"`"===a?(o=!o,i++):"."!==a||o?(r+=a,i++):(s(),i++)}if(s(),o)throw new ae(q.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new Bn(t)}static emptyPath(){return new Bn([])}}class Re{constructor(e){this.path=e}static fromPath(e){return new Re(jt.fromString(e))}static fromName(e){return new Re(jt.fromString(e).popFirst(5))}static empty(){return new Re(jt.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return null!==e&&0===jt.comparator(this.path,e.path)}toString(){return this.path.toString()}static comparator(e,t){return jt.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new Re(new jt(e.slice()))}}function I1(n,e,t){if(!t)throw new ae(q.INVALID_ARGUMENT,`Function ${n}() cannot be called with an empty ${e}.`)}function v8(n){if(!Re.isDocumentKey(n))throw new ae(q.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${n} has ${n.length}.`)}function E8(n){if(Re.isDocumentKey(n))throw new ae(q.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${n} has ${n.length}.`)}function b8(n){return"object"==typeof n&&null!==n&&(Object.getPrototypeOf(n)===Object.prototype||null===Object.getPrototypeOf(n))}function J0(n){if(void 0===n)return"undefined";if(null===n)return"null";if("string"==typeof n)return n.length>20&&(n=`${n.substring(0,20)}...`),JSON.stringify(n);if("number"==typeof n||"boolean"==typeof n)return""+n;if("object"==typeof n){if(n instanceof Array)return"an array";{const e=(r=n).constructor?r.constructor.name:null;return e?`a custom ${e} object`:"an object"}}var r;return"function"==typeof n?"a function":Be(12329,{type:typeof n})}function $t(n,e){if("_delegate"in n&&(n=n._delegate),!(n instanceof e)){if(e.name===n.constructor.name)throw new ae(q.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const t=J0(n);throw new ae(q.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${t}`)}}return n}function Sr(n,e){const t={typeString:n};return e&&(t.value=e),t}function su(n,e){if(!b8(n))throw new ae(q.INVALID_ARGUMENT,"JSON must be an object");let t;for(const r in e)if(e[r]){const i=e[r].typeString,s="value"in e[r]?{value:e[r].value}:void 0;if(!(r in n)){t=`JSON missing required field: '${r}'`;break}const o=n[r];if(i&&typeof o!==i){t=`JSON field '${r}' must be a ${i}.`;break}if(void 0!==s&&o!==s.value){t=`Expected '${r}' field to equal '${s.value}'`;break}}if(t)throw new ae(q.INVALID_ARGUMENT,t);return!0}const w8=-62135596800;class sn{static now(){return sn.fromMillis(Date.now())}static fromDate(e){return sn.fromMillis(e.getTime())}static fromMillis(e){const t=Math.floor(e/1e3),r=Math.floor(1e6*(e-1e3*t));return new sn(t,r)}constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new ae(q.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new ae(q.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<w8)throw new ae(q.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new ae(q.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(e){return this.seconds===e.seconds?lt(this.nanoseconds,e.nanoseconds):lt(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{type:sn._jsonSchemaVersion,seconds:this.seconds,nanoseconds:this.nanoseconds}}static fromJSON(e){if(su(e,sn._jsonSchema))return new sn(e.seconds,e.nanoseconds)}valueOf(){return String(this.seconds-w8).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}sn._jsonSchemaVersion="firestore/timestamp/1.0",sn._jsonSchema={type:Sr("string",sn._jsonSchemaVersion),seconds:Sr("number"),nanoseconds:Sr("number")};class Ze{static fromTimestamp(e){return new Ze(e)}static min(){return new Ze(new sn(0,0))}static max(){return new Ze(new sn(253402300799,999999999))}constructor(e){this.timestamp=e}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}function x8(n){return new ls(n.readTime,n.key,-1)}class ls{constructor(e,t,r){this.readTime=e,this.documentKey=t,this.largestBatchId=r}static min(){return new ls(Ze.min(),Re.empty(),-1)}static max(){return new ls(Ze.max(),Re.empty(),-1)}}function x1(n,e){let t=n.readTime.compareTo(e.readTime);return 0!==t?t:(t=Re.comparator(n.documentKey,e.documentKey),0!==t?t:lt(n.largestBatchId,e.largestBatchId))}class M8{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}}function wc(n){return A1.apply(this,arguments)}function A1(){return(A1=O(function*(n){if(n.code!==q.FAILED_PRECONDITION||"The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab."!==n.message)throw n;fe("LocalStore","Unexpectedly lost primary lease")})).apply(this,arguments)}class ${constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(t=>{this.isDone=!0,this.result=t,this.nextCallback&&this.nextCallback(t)},t=>{this.isDone=!0,this.error=t,this.catchCallback&&this.catchCallback(t)})}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&Be(59440),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new $((r,i)=>{this.nextCallback=s=>{this.wrapSuccess(e,s).next(r,i)},this.catchCallback=s=>{this.wrapFailure(t,s).next(r,i)}})}toPromise(){return new Promise((e,t)=>{this.next(e,t)})}wrapUserFunction(e){try{const t=e();return t instanceof $?t:$.resolve(t)}catch(t){return $.reject(t)}}wrapSuccess(e,t){return e?this.wrapUserFunction(()=>e(t)):$.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction(()=>e(t)):$.reject(t)}static resolve(e){return new $((t,r)=>{t(e)})}static reject(e){return new $((t,r)=>{r(e)})}static waitFor(e){return new $((t,r)=>{let i=0,s=0,o=!1;e.forEach(a=>{++i,a.next(()=>{++s,o&&s===i&&t()},c=>r(c))}),o=!0,s===i&&t()})}static or(e){let t=$.resolve(!1);for(const r of e)t=t.next(i=>i?$.resolve(i):r());return t}static forEach(e,t){const r=[];return e.forEach((i,s)=>{r.push(t.call(this,i,s))}),this.waitFor(r)}static mapArray(e,t){return new $((r,i)=>{const s=e.length,o=new Array(s);let a=0;for(let c=0;c<s;c++){const l=c;t(e[l]).next(u=>{o[l]=u,++a,a===s&&r(o)},u=>i(u))}})}static doWhile(e,t){return new $((r,i)=>{const s=()=>{!0===e()?t().next(()=>{s()},i):r()};s()})}}function Ic(n){return"IndexedDbTransactionError"===n.name}let ds=(()=>{class n{constructor(t,r){this.previousValue=t,r&&(r.sequenceNumberHandler=i=>this._e(i),this.ae=i=>r.writeSequenceNumber(i))}_e(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue}next(){const t=++this.previousValue;return this.ae&&this.ae(t),t}}return n.ue=-1,n})();function kg(n){return null==n}function Lg(n){return 0===n&&1/n==-1/0}function kTe(n,e){let t=e;const r=n.length;for(let i=0;i<r;i++){const s=n.charAt(i);switch(s){case"\0":t+="\x01\x10";break;case"\x01":t+="\x01\x11";break;default:t+=s}}return t}function P8(n){return n+"\x01\x01"}const Vg="mutationQueues",Ks="mutations",Uh="documentMutations",Ug="remoteDocumentGlobal",Bh="targets",Hh="targetDocuments",du="targetGlobal",Bg="collectionParents",zh="clientMetadata",ib="bundles",sb="namedQueries";function j8(n){let e=0;for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&e++;return e}function xc(n,e){for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&e(t,n[t])}function q8(n){for(const e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}class Sn{constructor(e,t){this.comparator=e,this.root=t||ti.EMPTY}insert(e,t){return new Sn(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,ti.BLACK,null,null))}remove(e){return new Sn(this.comparator,this.root.remove(e,this.comparator).copy(null,null,ti.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){const r=this.comparator(e,t.key);if(0===r)return t.value;r<0?t=t.left:r>0&&(t=t.right)}return null}indexOf(e){let t=0,r=this.root;for(;!r.isEmpty();){const i=this.comparator(e,r.key);if(0===i)return t+r.left.size;i<0?r=r.left:(t+=r.left.size+1,r=r.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((t,r)=>(e(t,r),!1))}toString(){const e=[];return this.inorderTraversal((t,r)=>(e.push(`${t}:${r}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new ab(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new ab(this.root,e,this.comparator,!1)}getReverseIterator(){return new ab(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new ab(this.root,e,this.comparator,!0)}}class ab{constructor(e,t,r,i){this.isReverse=i,this.nodeStack=[];let s=1;for(;!e.isEmpty();)if(s=t?r(e.key,t):1,t&&i&&(s*=-1),s<0)e=this.isReverse?e.left:e.right;else{if(0===s){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(0===this.nodeStack.length)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class ti{constructor(e,t,r,i,s){this.key=e,this.value=t,this.color=r??ti.RED,this.left=i??ti.EMPTY,this.right=s??ti.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,r,i,s){return new ti(e??this.key,t??this.value,r??this.color,i??this.left,s??this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,r){let i=this;const s=r(e,i.key);return i=s<0?i.copy(null,null,null,i.left.insert(e,t,r),null):0===s?i.copy(null,t,null,null,null):i.copy(null,null,null,null,i.right.insert(e,t,r)),i.fixUp()}removeMin(){if(this.left.isEmpty())return ti.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let r,i=this;if(t(e,i.key)<0)i.left.isEmpty()||i.left.isRed()||i.left.left.isRed()||(i=i.moveRedLeft()),i=i.copy(null,null,null,i.left.remove(e,t),null);else{if(i.left.isRed()&&(i=i.rotateRight()),i.right.isEmpty()||i.right.isRed()||i.right.left.isRed()||(i=i.moveRedRight()),0===t(e,i.key)){if(i.right.isEmpty())return ti.EMPTY;r=i.right.min(),i=i.copy(r.key,r.value,null,null,i.right.removeMin())}i=i.copy(null,null,null,null,i.right.remove(e,t))}return i.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,ti.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,ti.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw Be(43730,{key:this.key,value:this.value});if(this.right.isRed())throw Be(14113,{key:this.key,value:this.value});const e=this.left.check();if(e!==this.right.check())throw Be(27949);return e+(this.isRed()?0:1)}}ti.EMPTY=null,ti.RED=!0,ti.BLACK=!1,ti.EMPTY=new class{constructor(){this.size=0}get key(){throw Be(57766)}get value(){throw Be(16141)}get color(){throw Be(16727)}get left(){throw Be(29726)}get right(){throw Be(36894)}copy(e,t,r,i,s){return this}insert(e,t,r){return new ti(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};class on{constructor(e){this.comparator=e,this.data=new Sn(this.comparator)}has(e){return null!==this.data.get(e)}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((t,r)=>(e(t),!1))}forEachInRange(e,t){const r=this.data.getIteratorFrom(e[0]);for(;r.hasNext();){const i=r.getNext();if(this.comparator(i.key,e[1])>=0)return;t(i.key)}}forEachWhile(e,t){let r;for(r=void 0!==t?this.data.getIteratorFrom(t):this.data.getIterator();r.hasNext();)if(!e(r.getNext().key))return}firstAfterOrEqual(e){const t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new X8(this.data.getIterator())}getIteratorFrom(e){return new X8(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach(r=>{t=t.add(r)}),t}isEqual(e){if(!(e instanceof on)||this.size!==e.size)return!1;const t=this.data.getIterator(),r=e.data.getIterator();for(;t.hasNext();){const i=t.getNext().key,s=r.getNext().key;if(0!==this.comparator(i,s))return!1}return!0}toArray(){const e=[];return this.forEach(t=>{e.push(t)}),e}toString(){const e=[];return this.forEach(t=>e.push(t)),"SortedSet("+e.toString()+")"}copy(e){const t=new on(this.comparator);return t.data=e,t}}class X8{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}class Ki{constructor(e){this.fields=e,e.sort(Bn.comparator)}static empty(){return new Ki([])}unionWith(e){let t=new on(Bn.comparator);for(const r of this.fields)t=t.add(r);for(const r of e)t=t.add(r);return new Ki(t.toArray())}covers(e){for(const t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return Oh(this.fields,e.fields,(t,r)=>t.isEqual(r))}}class K8 extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}class ir{constructor(e){this.binaryString=e}static fromBase64String(e){const t=function(i){try{return atob(i)}catch(s){throw typeof DOMException<"u"&&s instanceof DOMException?new K8("Invalid base64 string: "+s):s}}(e);return new ir(t)}static fromUint8Array(e){const t=function(i){let s="";for(let o=0;o<i.length;++o)s+=String.fromCharCode(i[o]);return s}(e);return new ir(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return btoa(this.binaryString)}toUint8Array(){return function(t){const r=new Uint8Array(t.length);for(let i=0;i<t.length;i++)r[i]=t.charCodeAt(i);return r}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return lt(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}ir.EMPTY_BYTE_STRING=new ir("");const awe=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function ma(n){if($e(!!n,39018),"string"==typeof n){let e=0;const t=awe.exec(n);if($e(!!t,46558,{timestamp:n}),t[1]){let i=t[1];i=(i+"000000000").substr(0,9),e=Number(i)}const r=new Date(n);return{seconds:Math.floor(r.getTime()/1e3),nanos:e}}return{seconds:Hn(n.seconds),nanos:Hn(n.nanos)}}function Hn(n){return"number"==typeof n?n:"string"==typeof n?Number(n):0}function ga(n){return"string"==typeof n?ir.fromBase64String(n):ir.fromUint8Array(n)}const Y8="server_timestamp",J8="__type__",Z8="__previous_value__",Q8="__local_write_time__";function cb(n){var e,t;return(null===(t=((null===(e=n?.mapValue)||void 0===e?void 0:e.fields)||{})[J8])||void 0===t?void 0:t.stringValue)===Y8}function lb(n){const e=n.mapValue.fields[Z8];return cb(e)?lb(e):e}function Gg(n){const e=ma(n.mapValue.fields[Q8].timestampValue);return new sn(e.seconds,e.nanos)}class cwe{constructor(e,t,r,i,s,o,a,c,l,u){this.databaseId=e,this.appId=t,this.persistenceKey=r,this.host=i,this.ssl=s,this.forceLongPolling=o,this.autoDetectLongPolling=a,this.longPollingOptions=c,this.useFetchStreams=l,this.isUsingEmulator=u}}const Wg="(default)";class hu{constructor(e,t){this.projectId=e,this.database=t||Wg}static empty(){return new hu("","")}get isDefaultDatabase(){return this.database===Wg}isEqual(e){return e instanceof hu&&e.projectId===this.projectId&&e.database===this.database}}const F1="__type__",e$="__max__",Ac_mapValue={fields:{__type__:{stringValue:e$}}},V1="__vector__",Wh="value";function Mc(n){return"nullValue"in n?0:"booleanValue"in n?1:"integerValue"in n||"doubleValue"in n?2:"timestampValue"in n?3:"stringValue"in n?5:"bytesValue"in n?6:"referenceValue"in n?7:"geoPointValue"in n?8:"arrayValue"in n?9:"mapValue"in n?cb(n)?4:s$(n)?9007199254740991:fb(n)?10:11:Be(28295,{value:n})}function Io(n,e){if(n===e)return!0;const t=Mc(n);if(t!==Mc(e))return!1;switch(t){case 0:case 9007199254740991:return!0;case 1:return n.booleanValue===e.booleanValue;case 4:return Gg(n).isEqual(Gg(e));case 3:return function(i,s){if("string"==typeof i.timestampValue&&"string"==typeof s.timestampValue&&i.timestampValue.length===s.timestampValue.length)return i.timestampValue===s.timestampValue;const o=ma(i.timestampValue),a=ma(s.timestampValue);return o.seconds===a.seconds&&o.nanos===a.nanos}(n,e);case 5:return n.stringValue===e.stringValue;case 6:return s=e,ga(n.bytesValue).isEqual(ga(s.bytesValue));case 7:return n.referenceValue===e.referenceValue;case 8:return function(i,s){return Hn(i.geoPointValue.latitude)===Hn(s.geoPointValue.latitude)&&Hn(i.geoPointValue.longitude)===Hn(s.geoPointValue.longitude)}(n,e);case 2:return function(i,s){if("integerValue"in i&&"integerValue"in s)return Hn(i.integerValue)===Hn(s.integerValue);if("doubleValue"in i&&"doubleValue"in s){const o=Hn(i.doubleValue),a=Hn(s.doubleValue);return o===a?Lg(o)===Lg(a):isNaN(o)&&isNaN(a)}return!1}(n,e);case 9:return Oh(n.arrayValue.values||[],e.arrayValue.values||[],Io);case 10:case 11:return function(i,s){const o=i.mapValue.fields||{},a=s.mapValue.fields||{};if(j8(o)!==j8(a))return!1;for(const c in o)if(o.hasOwnProperty(c)&&(void 0===a[c]||!Io(o[c],a[c])))return!1;return!0}(n,e);default:return Be(52216,{left:n})}var s}function jg(n,e){return void 0!==(n.values||[]).find(t=>Io(t,e))}function Cc(n,e){if(n===e)return 0;const t=Mc(n),r=Mc(e);if(t!==r)return lt(t,r);switch(t){case 0:case 9007199254740991:return 0;case 1:return lt(n.booleanValue,e.booleanValue);case 2:return function(s,o){const a=Hn(s.integerValue||s.doubleValue),c=Hn(o.integerValue||o.doubleValue);return a<c?-1:a>c?1:a===c?0:isNaN(a)?isNaN(c)?0:-1:1}(n,e);case 3:return t$(n.timestampValue,e.timestampValue);case 4:return t$(Gg(n),Gg(e));case 5:return T1(n.stringValue,e.stringValue);case 6:return function(s,o){const a=ga(s),c=ga(o);return a.compareTo(c)}(n.bytesValue,e.bytesValue);case 7:return function(s,o){const a=s.split("/"),c=o.split("/");for(let l=0;l<a.length&&l<c.length;l++){const u=lt(a[l],c[l]);if(0!==u)return u}return lt(a.length,c.length)}(n.referenceValue,e.referenceValue);case 8:return function(s,o){const a=lt(Hn(s.latitude),Hn(o.latitude));return 0!==a?a:lt(Hn(s.longitude),Hn(o.longitude))}(n.geoPointValue,e.geoPointValue);case 9:return n$(n.arrayValue,e.arrayValue);case 10:return function(s,o){var a,c,l,u;const f=null===(a=(s.fields||{})[Wh])||void 0===a?void 0:a.arrayValue,m=null===(c=(o.fields||{})[Wh])||void 0===c?void 0:c.arrayValue,y=lt((null===(l=f?.values)||void 0===l?void 0:l.length)||0,(null===(u=m?.values)||void 0===u?void 0:u.length)||0);return 0!==y?y:n$(f,m)}(n.mapValue,e.mapValue);case 11:return function(s,o){if(s===Ac_mapValue&&o===Ac_mapValue)return 0;if(s===Ac_mapValue)return 1;if(o===Ac_mapValue)return-1;const a=s.fields||{},c=Object.keys(a),l=o.fields||{},u=Object.keys(l);c.sort(),u.sort();for(let d=0;d<c.length&&d<u.length;++d){const h=T1(c[d],u[d]);if(0!==h)return h;const f=Cc(a[c[d]],l[u[d]]);if(0!==f)return f}return lt(c.length,u.length)}(n.mapValue,e.mapValue);default:throw Be(23264,{le:t})}}function t$(n,e){if("string"==typeof n&&"string"==typeof e&&n.length===e.length)return lt(n,e);const t=ma(n),r=ma(e),i=lt(t.seconds,r.seconds);return 0!==i?i:lt(t.nanos,r.nanos)}function n$(n,e){const t=n.values||[],r=e.values||[];for(let i=0;i<t.length&&i<r.length;++i){const s=Cc(t[i],r[i]);if(s)return s}return lt(t.length,r.length)}function jh(n){return U1(n)}function U1(n){return"nullValue"in n?"null":"booleanValue"in n?""+n.booleanValue:"integerValue"in n?""+n.integerValue:"doubleValue"in n?""+n.doubleValue:"timestampValue"in n?function(t){const r=ma(t);return`time(${r.seconds},${r.nanos})`}(n.timestampValue):"stringValue"in n?n.stringValue:"bytesValue"in n?ga(n.bytesValue).toBase64():"referenceValue"in n?Re.fromName(n.referenceValue).toString():"geoPointValue"in n?function(t){return`geo(${t.latitude},${t.longitude})`}(n.geoPointValue):"arrayValue"in n?function(t){let r="[",i=!0;for(const s of t.values||[])i?i=!1:r+=",",r+=U1(s);return r+"]"}(n.arrayValue):"mapValue"in n?function(t){const r=Object.keys(t.fields||{}).sort();let i="{",s=!0;for(const o of r)s?s=!1:i+=",",i+=`${o}:${U1(t.fields[o])}`;return i+"}"}(n.mapValue):Be(61005,{value:n})}function db(n){switch(Mc(n)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:const e=lb(n);return e?16+db(e):16;case 5:return 2*n.stringValue.length;case 6:return ga(n.bytesValue).approximateByteSize();case 7:return n.referenceValue.length;case 9:return(n.arrayValue.values||[]).reduce((i,s)=>i+db(s),0);case 10:case 11:return function(r){let i=0;return xc(r.fields,(s,o)=>{i+=s.length+db(o)}),i}(n.mapValue);default:throw Be(13486,{value:n})}}function fu(n,e){return{referenceValue:`projects/${n.projectId}/databases/${n.database}/documents/${e.path.canonicalString()}`}}function B1(n){return!!n&&"integerValue"in n}function $g(n){return!!n&&"arrayValue"in n}function r$(n){return!!n&&"nullValue"in n}function i$(n){return!!n&&"doubleValue"in n&&isNaN(Number(n.doubleValue))}function hb(n){return!!n&&"mapValue"in n}function fb(n){var e,t;return(null===(t=((null===(e=n?.mapValue)||void 0===e?void 0:e.fields)||{})[F1])||void 0===t?void 0:t.stringValue)===V1}function qg(n){if(n.geoPointValue)return{geoPointValue:Object.assign({},n.geoPointValue)};if(n.timestampValue&&"object"==typeof n.timestampValue)return{timestampValue:Object.assign({},n.timestampValue)};if(n.mapValue){const e={mapValue:{fields:{}}};return xc(n.mapValue.fields,(t,r)=>e.mapValue.fields[t]=qg(r)),e}if(n.arrayValue){const e={arrayValue:{values:[]}};for(let t=0;t<(n.arrayValue.values||[]).length;++t)e.arrayValue.values[t]=qg(n.arrayValue.values[t]);return e}return Object.assign({},n)}function s$(n){return(((n.mapValue||{}).fields||{}).__type__||{}).stringValue===e$}class ni{constructor(e){this.value=e}static empty(){return new ni({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let r=0;r<e.length-1;++r)if(t=(t.mapValue.fields||{})[e.get(r)],!hb(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=qg(t)}setAll(e){let t=Bn.emptyPath(),r={},i=[];e.forEach((o,a)=>{if(!t.isImmediateParentOf(a)){const c=this.getFieldsMap(t);this.applyChanges(c,r,i),r={},i=[],t=a.popLast()}o?r[a.lastSegment()]=qg(o):i.push(a.lastSegment())});const s=this.getFieldsMap(t);this.applyChanges(s,r,i)}delete(e){const t=this.field(e.popLast());hb(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return Io(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let r=0;r<e.length;++r){let i=t.mapValue.fields[e.get(r)];hb(i)&&i.mapValue.fields||(i={mapValue:{fields:{}}},t.mapValue.fields[e.get(r)]=i),t=i}return t.mapValue.fields}applyChanges(e,t,r){xc(t,(i,s)=>e[i]=s);for(const i of r)delete e[i]}clone(){return new ni(qg(this.value))}}function l$(n){const e=[];return xc(n.fields,(t,r)=>{const i=new Bn([t]);if(hb(r)){const s=l$(r.mapValue).fields;if(0===s.length)e.push(i);else for(const o of s)e.push(i.child(o))}else e.push(i)}),new Ki(e)}class Nn{constructor(e,t,r,i,s,o,a){this.key=e,this.documentType=t,this.version=r,this.readTime=i,this.createTime=s,this.data=o,this.documentState=a}static newInvalidDocument(e){return new Nn(e,0,Ze.min(),Ze.min(),Ze.min(),ni.empty(),0)}static newFoundDocument(e,t,r,i){return new Nn(e,1,t,Ze.min(),r,i,0)}static newNoDocument(e,t){return new Nn(e,2,t,Ze.min(),Ze.min(),ni.empty(),0)}static newUnknownDocument(e,t){return new Nn(e,3,t,Ze.min(),Ze.min(),ni.empty(),2)}convertToFoundDocument(e,t){return!this.createTime.isEqual(Ze.min())||2!==this.documentType&&0!==this.documentType||(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=ni.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=ni.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=Ze.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return 1===this.documentState}get hasCommittedMutations(){return 2===this.documentState}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return 0!==this.documentType}isFoundDocument(){return 1===this.documentType}isNoDocument(){return 2===this.documentType}isUnknownDocument(){return 3===this.documentType}isEqual(e){return e instanceof Nn&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new Nn(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}class Dc{constructor(e,t){this.position=e,this.inclusive=t}}function u$(n,e,t){let r=0;for(let i=0;i<n.position.length;i++){const s=e[i],o=n.position[i];if(r=s.field.isKeyField()?Re.comparator(Re.fromName(o.referenceValue),t.key):Cc(o,t.data.field(s.field)),"desc"===s.dir&&(r*=-1),0!==r)break}return r}function d$(n,e){if(null===n)return null===e;if(null===e||n.inclusive!==e.inclusive||n.position.length!==e.position.length)return!1;for(let t=0;t<n.position.length;t++)if(!Io(n.position[t],e.position[t]))return!1;return!0}class Xg{constructor(e,t="asc"){this.field=e,this.dir=t}}function dwe(n,e){return n.dir===e.dir&&n.field.isEqual(e.field)}class h${}class Xt extends h${constructor(e,t,r){super(),this.field=e,this.op=t,this.value=r}static create(e,t,r){return e.isKeyField()?"in"===t||"not-in"===t?this.createKeyFieldInFilter(e,t,r):new hwe(e,t,r):"array-contains"===t?new mwe(e,r):"in"===t?new y$(e,r):"not-in"===t?new gwe(e,r):"array-contains-any"===t?new _we(e,r):new Xt(e,t,r)}static createKeyFieldInFilter(e,t,r){return"in"===t?new fwe(e,r):new pwe(e,r)}matches(e){const t=e.data.field(this.field);return"!="===this.op?null!==t&&void 0===t.nullValue&&this.matchesComparison(Cc(t,this.value)):null!==t&&Mc(this.value)===Mc(t)&&this.matchesComparison(Cc(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return 0===e;case"!=":return 0!==e;case">":return e>0;case">=":return e>=0;default:return Be(47266,{operator:this.op})}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class an extends h${constructor(e,t){super(),this.filters=e,this.op=t,this.he=null}static create(e,t){return new an(e,t)}matches(e){return $h(this)?void 0===this.filters.find(t=>!t.matches(e)):void 0!==this.filters.find(t=>t.matches(e))}getFlattenedFilters(){return null!==this.he||(this.he=this.filters.reduce((e,t)=>e.concat(t.getFlattenedFilters()),[])),this.he}getFilters(){return Object.assign([],this.filters)}}function $h(n){return"and"===n.op}function z1(n){return function f$(n){for(const e of n.filters)if(e instanceof an)return!1;return!0}(n)&&$h(n)}function G1(n){if(n instanceof Xt)return n.field.canonicalString()+n.op.toString()+jh(n.value);if(z1(n))return n.filters.map(e=>G1(e)).join(",");{const e=n.filters.map(t=>G1(t)).join(",");return`${n.op}(${e})`}}function p$(n,e){return n instanceof Xt?(r=n,(i=e)instanceof Xt&&r.op===i.op&&r.field.isEqual(i.field)&&Io(r.value,i.value)):n instanceof an?function(r,i){return i instanceof an&&r.op===i.op&&r.filters.length===i.filters.length&&r.filters.reduce((s,o,a)=>s&&p$(o,i.filters[a]),!0)}(n,e):void Be(19439);var r,i}function g$(n){return n instanceof Xt?`${(t=n).field.canonicalString()} ${t.op} ${jh(t.value)}`:n instanceof an?function(t){return t.op.toString()+" {"+t.getFilters().map(g$).join(" ,")+"}"}(n):"Filter";var t}class hwe extends Xt{constructor(e,t,r){super(e,t,r),this.key=Re.fromName(r.referenceValue)}matches(e){const t=Re.comparator(e.key,this.key);return this.matchesComparison(t)}}class fwe extends Xt{constructor(e,t){super(e,"in",t),this.keys=_$(0,t)}matches(e){return this.keys.some(t=>t.isEqual(e.key))}}class pwe extends Xt{constructor(e,t){super(e,"not-in",t),this.keys=_$(0,t)}matches(e){return!this.keys.some(t=>t.isEqual(e.key))}}function _$(n,e){var t;return((null===(t=e.arrayValue)||void 0===t?void 0:t.values)||[]).map(r=>Re.fromName(r.referenceValue))}class mwe extends Xt{constructor(e,t){super(e,"array-contains",t)}matches(e){const t=e.data.field(this.field);return $g(t)&&jg(t.arrayValue,this.value)}}class y$ extends Xt{constructor(e,t){super(e,"in",t)}matches(e){const t=e.data.field(this.field);return null!==t&&jg(this.value.arrayValue,t)}}class gwe extends Xt{constructor(e,t){super(e,"not-in",t)}matches(e){if(jg(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const t=e.data.field(this.field);return null!==t&&void 0===t.nullValue&&!jg(this.value.arrayValue,t)}}class _we extends Xt{constructor(e,t){super(e,"array-contains-any",t)}matches(e){const t=e.data.field(this.field);return!(!$g(t)||!t.arrayValue.values)&&t.arrayValue.values.some(r=>jg(this.value.arrayValue,r))}}class ywe{constructor(e,t=null,r=[],i=[],s=null,o=null,a=null){this.path=e,this.collectionGroup=t,this.orderBy=r,this.filters=i,this.limit=s,this.startAt=o,this.endAt=a,this.Pe=null}}function W1(n,e=null,t=[],r=[],i=null,s=null,o=null){return new ywe(n,e,t,r,i,s,o)}function pu(n){const e=Pe(n);if(null===e.Pe){let t=e.path.canonicalString();null!==e.collectionGroup&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map(r=>G1(r)).join(","),t+="|ob:",t+=e.orderBy.map(r=>{return(s=r).field.canonicalString()+s.dir;var s}).join(","),kg(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map(r=>jh(r)).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map(r=>jh(r)).join(",")),e.Pe=t}return e.Pe}function Kg(n,e){if(n.limit!==e.limit||n.orderBy.length!==e.orderBy.length)return!1;for(let t=0;t<n.orderBy.length;t++)if(!dwe(n.orderBy[t],e.orderBy[t]))return!1;if(n.filters.length!==e.filters.length)return!1;for(let t=0;t<n.filters.length;t++)if(!p$(n.filters[t],e.filters[t]))return!1;return n.collectionGroup===e.collectionGroup&&!!n.path.isEqual(e.path)&&!!d$(n.startAt,e.startAt)&&d$(n.endAt,e.endAt)}function pb(n){return Re.isDocumentKey(n.path)&&null===n.collectionGroup&&0===n.filters.length}class _a{constructor(e,t=null,r=[],i=[],s=null,o="F",a=null,c=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=r,this.filters=i,this.limit=s,this.limitType=o,this.startAt=a,this.endAt=c,this.Te=null,this.Ie=null,this.de=null}}function qh(n){return new _a(n)}function T$(n){return 0===n.filters.length&&null===n.limit&&null==n.startAt&&null==n.endAt&&(0===n.explicitOrderBy.length||1===n.explicitOrderBy.length&&n.explicitOrderBy[0].field.isKeyField())}function j1(n){return null!==n.collectionGroup}function Xh(n){const e=Pe(n);if(null===e.Te){e.Te=[];const t=new Set;for(const s of e.explicitOrderBy)e.Te.push(s),t.add(s.field.canonicalString());const r=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(function(o){let a=new on(Bn.comparator);return o.filters.forEach(c=>{c.getFlattenedFilters().forEach(l=>{l.isInequality()&&(a=a.add(l.field))})}),a})(e).forEach(s=>{t.has(s.canonicalString())||s.isKeyField()||e.Te.push(new Xg(s,r))}),t.has(Bn.keyField().canonicalString())||e.Te.push(new Xg(Bn.keyField(),r))}return e.Te}function mi(n){const e=Pe(n);return e.Ie||(e.Ie=function I$(n,e){if("F"===n.limitType)return W1(n.path,n.collectionGroup,e,n.filters,n.limit,n.startAt,n.endAt);{e=e.map(i=>new Xg(i.field,"desc"===i.dir?"asc":"desc"));const t=n.endAt?new Dc(n.endAt.position,n.endAt.inclusive):null,r=n.startAt?new Dc(n.startAt.position,n.startAt.inclusive):null;return W1(n.path,n.collectionGroup,e,n.filters,n.limit,t,r)}}(e,Xh(n))),e.Ie}function $1(n,e){const t=n.filters.concat([e]);return new _a(n.path,n.collectionGroup,n.explicitOrderBy.slice(),t,n.limit,n.limitType,n.startAt,n.endAt)}function gb(n,e,t){return new _a(n.path,n.collectionGroup,n.explicitOrderBy.slice(),n.filters.slice(),e,t,n.startAt,n.endAt)}function Yg(n,e){return Kg(mi(n),mi(e))&&n.limitType===e.limitType}function S$(n){return`${pu(mi(n))}|lt:${n.limitType}`}function Kh(n){return`Query(target=${function(t){let r=t.path.canonicalString();return null!==t.collectionGroup&&(r+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(r+=`, filters: [${t.filters.map(i=>g$(i)).join(", ")}]`),kg(t.limit)||(r+=", limit: "+t.limit),t.orderBy.length>0&&(r+=`, orderBy: [${t.orderBy.map(i=>{return`${(o=i).field.canonicalString()} (${o.dir})`;var o}).join(", ")}]`),t.startAt&&(r+=", startAt: ",r+=t.startAt.inclusive?"b:":"a:",r+=t.startAt.position.map(i=>jh(i)).join(",")),t.endAt&&(r+=", endAt: ",r+=t.endAt.inclusive?"a:":"b:",r+=t.endAt.position.map(i=>jh(i)).join(",")),`Target(${r})`}(mi(n))}; limitType=${n.limitType})`}function Jg(n,e){return e.isFoundDocument()&&function(r,i){const s=i.key.path;return null!==r.collectionGroup?i.key.hasCollectionId(r.collectionGroup)&&r.path.isPrefixOf(s):Re.isDocumentKey(r.path)?r.path.isEqual(s):r.path.isImmediateParentOf(s)}(n,e)&&function(r,i){for(const s of Xh(r))if(!s.field.isKeyField()&&null===i.data.field(s.field))return!1;return!0}(n,e)&&function(r,i){for(const s of r.filters)if(!s.matches(i))return!1;return!0}(n,e)&&(i=e,!((r=n).startAt&&!function(o,a,c){const l=u$(o,a,c);return o.inclusive?l<=0:l<0}(r.startAt,Xh(r),i)||r.endAt&&!function(o,a,c){const l=u$(o,a,c);return o.inclusive?l>=0:l>0}(r.endAt,Xh(r),i)));var r,i}function A$(n){return(e,t)=>{let r=!1;for(const i of Xh(n)){const s=vwe(i,e,t);if(0!==s)return s;r=r||i.field.isKeyField()}return 0}}function vwe(n,e,t){const r=n.field.isKeyField()?Re.comparator(e.key,t.key):function(s,o,a){const c=o.data.field(s),l=a.data.field(s);return null!==c&&null!==l?Cc(c,l):Be(42886)}(n.field,e,t);switch(n.dir){case"asc":return r;case"desc":return-1*r;default:return Be(19790,{direction:n.dir})}}class ya{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){const t=this.mapKeyFn(e),r=this.inner[t];if(void 0!==r)for(const[i,s]of r)if(this.equalsFn(i,e))return s}has(e){return void 0!==this.get(e)}set(e,t){const r=this.mapKeyFn(e),i=this.inner[r];if(void 0===i)return this.inner[r]=[[e,t]],void this.innerSize++;for(let s=0;s<i.length;s++)if(this.equalsFn(i[s][0],e))return void(i[s]=[e,t]);i.push([e,t]),this.innerSize++}delete(e){const t=this.mapKeyFn(e),r=this.inner[t];if(void 0===r)return!1;for(let i=0;i<r.length;i++)if(this.equalsFn(r[i][0],e))return 1===r.length?delete this.inner[t]:r.splice(i,1),this.innerSize--,!0;return!1}forEach(e){xc(this.inner,(t,r)=>{for(const[i,s]of r)e(i,s)})}isEmpty(){return q8(this.inner)}size(){return this.innerSize}}const Ewe=new Sn(Re.comparator);function Yi(){return Ewe}const M$=new Sn(Re.comparator);function Zg(...n){let e=M$;for(const t of n)e=e.insert(t.key,t);return e}function C$(n){let e=M$;return n.forEach((t,r)=>e=e.insert(t,r.overlayedDocument)),e}function So(){return Qg()}function D$(){return Qg()}function Qg(){return new ya(n=>n.toString(),(n,e)=>n.isEqual(e))}const bwe=new Sn(Re.comparator),Twe=new on(Re.comparator);function Dt(...n){let e=Twe;for(const t of n)e=e.add(t);return e}const wwe=new on(lt);function X1(n,e){if(n.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:Lg(e)?"-0":e}}function R$(n){return{integerValue:""+n}}function P$(n,e){return function R8(n){return"number"==typeof n&&Number.isInteger(n)&&!Lg(n)&&n<=Number.MAX_SAFE_INTEGER&&n>=Number.MIN_SAFE_INTEGER}(e)?R$(e):X1(n,e)}class _b{constructor(){this._=void 0}}function Iwe(n,e,t){return n instanceof Yh?function(i,s){const o={fields:{[J8]:{stringValue:Y8},[Q8]:{timestampValue:{seconds:i.seconds,nanos:i.nanoseconds}}}};return s&&cb(s)&&(s=lb(s)),s&&(o.fields[Z8]=s),{mapValue:o}}(t,e):n instanceof mu?O$(n,e):n instanceof gu?k$(n,e):function(i,s){const o=N$(i,s),a=L$(o)+L$(i.Ee);return B1(o)&&B1(i.Ee)?R$(a):X1(i.serializer,a)}(n,e)}function Swe(n,e,t){return n instanceof mu?O$(n,e):n instanceof gu?k$(n,e):t}function N$(n,e){return n instanceof Jh?B1(r=e)||(s=r)&&"doubleValue"in s?e:{integerValue:0}:null;var r,s}class Yh extends _b{}class mu extends _b{constructor(e){super(),this.elements=e}}function O$(n,e){const t=F$(e);for(const r of n.elements)t.some(i=>Io(i,r))||t.push(r);return{arrayValue:{values:t}}}class gu extends _b{constructor(e){super(),this.elements=e}}function k$(n,e){let t=F$(e);for(const r of n.elements)t=t.filter(i=>!Io(i,r));return{arrayValue:{values:t}}}class Jh extends _b{constructor(e,t){super(),this.serializer=e,this.Ee=t}}function L$(n){return Hn(n.integerValue||n.doubleValue)}function F$(n){return $g(n)&&n.arrayValue.values?n.arrayValue.values.slice():[]}class Awe{constructor(e,t){this.version=e,this.transformResults=t}}class zn{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new zn}static exists(e){return new zn(void 0,e)}static updateTime(e){return new zn(e)}get isNone(){return void 0===this.updateTime&&void 0===this.exists}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function yb(n,e){return void 0!==n.updateTime?e.isFoundDocument()&&e.version.isEqual(n.updateTime):void 0===n.exists||n.exists===e.isFoundDocument()}class vb{}function V$(n,e){if(!n.hasLocalMutations||e&&0===e.fields.length)return null;if(null===e)return n.isNoDocument()?new Qh(n.key,zn.none()):new Zh(n.key,n.data,zn.none());{const t=n.data,r=ni.empty();let i=new on(Bn.comparator);for(let s of e.fields)if(!i.has(s)){let o=t.field(s);null===o&&s.length>1&&(s=s.popLast(),o=t.field(s)),null===o?r.delete(s):r.set(s,o),i=i.add(s)}return new va(n.key,r,new Ki(i.toArray()),zn.none())}}function Mwe(n,e,t){n instanceof Zh?function(i,s,o){const a=i.value.clone(),c=H$(i.fieldTransforms,s,o.transformResults);a.setAll(c),s.convertToFoundDocument(o.version,a).setHasCommittedMutations()}(n,e,t):n instanceof va?function(i,s,o){if(!yb(i.precondition,s))return void s.convertToUnknownDocument(o.version);const a=H$(i.fieldTransforms,s,o.transformResults),c=s.data;c.setAll(B$(i)),c.setAll(a),s.convertToFoundDocument(o.version,c).setHasCommittedMutations()}(n,e,t):e.convertToNoDocument(t.version).setHasCommittedMutations()}function t_(n,e,t,r){return n instanceof Zh?function(s,o,a,c){if(!yb(s.precondition,o))return a;const l=s.value.clone(),u=z$(s.fieldTransforms,c,o);return l.setAll(u),o.convertToFoundDocument(o.version,l).setHasLocalMutations(),null}(n,e,t,r):n instanceof va?function(s,o,a,c){if(!yb(s.precondition,o))return a;const l=z$(s.fieldTransforms,c,o),u=o.data;return u.setAll(B$(s)),u.setAll(l),o.convertToFoundDocument(o.version,u).setHasLocalMutations(),null===a?null:a.unionWith(s.fieldMask.fields).unionWith(s.fieldTransforms.map(d=>d.field))}(n,e,t,r):(a=t,yb(n.precondition,o=e)?(o.convertToNoDocument(o.version).setHasLocalMutations(),null):a);var o,a}function Cwe(n,e){let t=null;for(const r of n.fieldTransforms){const i=e.data.field(r.field),s=N$(r.transform,i||null);null!=s&&(null===t&&(t=ni.empty()),t.set(r.field,s))}return t||null}function U$(n,e){return n.type===e.type&&!!n.key.isEqual(e.key)&&!!n.precondition.isEqual(e.precondition)&&(i=e.fieldTransforms,!!(void 0===(r=n.fieldTransforms)&&void 0===i||r&&i&&Oh(r,i,(s,o)=>function xwe(n,e){return n.field.isEqual(e.field)&&(i=e.transform,(r=n.transform)instanceof mu&&i instanceof mu||r instanceof gu&&i instanceof gu?Oh(r.elements,i.elements,Io):r instanceof Jh&&i instanceof Jh?Io(r.Ee,i.Ee):r instanceof Yh&&i instanceof Yh);var r,i}(s,o))))&&(0===n.type?n.value.isEqual(e.value):1!==n.type||n.data.isEqual(e.data)&&n.fieldMask.isEqual(e.fieldMask));var r,i}class Zh extends vb{constructor(e,t,r,i=[]){super(),this.key=e,this.value=t,this.precondition=r,this.fieldTransforms=i,this.type=0}getFieldMask(){return null}}class va extends vb{constructor(e,t,r,i,s=[]){super(),this.key=e,this.data=t,this.fieldMask=r,this.precondition=i,this.fieldTransforms=s,this.type=1}getFieldMask(){return this.fieldMask}}function B$(n){const e=new Map;return n.fieldMask.fields.forEach(t=>{if(!t.isEmpty()){const r=n.data.field(t);e.set(t,r)}}),e}function H$(n,e,t){const r=new Map;$e(n.length===t.length,32656,{Ae:t.length,Re:n.length});for(let i=0;i<t.length;i++){const s=n[i],o=s.transform,a=e.data.field(s.field);r.set(s.field,Swe(o,a,t[i]))}return r}function z$(n,e,t){const r=new Map;for(const i of n){const s=i.transform,o=t.data.field(i.field);r.set(i.field,Iwe(s,o,e))}return r}class Qh extends vb{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class K1 extends vb{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}class Y1{constructor(e,t,r,i){this.batchId=e,this.localWriteTime=t,this.baseMutations=r,this.mutations=i}applyToRemoteDocument(e,t){const r=t.mutationResults;for(let i=0;i<this.mutations.length;i++){const s=this.mutations[i];s.key.isEqual(e.key)&&Mwe(s,e,r[i])}}applyToLocalView(e,t){for(const r of this.baseMutations)r.key.isEqual(e.key)&&(t=t_(r,e,t,this.localWriteTime));for(const r of this.mutations)r.key.isEqual(e.key)&&(t=t_(r,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){const r=D$();return this.mutations.forEach(i=>{const s=e.get(i.key),o=s.overlayedDocument;let a=this.applyToLocalView(o,s.mutatedFields);a=t.has(i.key)?null:a;const c=V$(o,a);null!==c&&r.set(i.key,c),o.isValidDocument()||o.convertToNoDocument(Ze.min())}),r}keys(){return this.mutations.reduce((e,t)=>e.add(t.key),Dt())}isEqual(e){return this.batchId===e.batchId&&Oh(this.mutations,e.mutations,(t,r)=>U$(t,r))&&Oh(this.baseMutations,e.baseMutations,(t,r)=>U$(t,r))}}class J1{constructor(e,t,r,i){this.batch=e,this.commitVersion=t,this.mutationResults=r,this.docVersions=i}static from(e,t,r){$e(e.mutations.length===r.length,58842,{Ve:e.mutations.length,me:r.length});let i=function(){return bwe}();const s=e.mutations;for(let o=0;o<s.length;o++)i=i.insert(s[o].key,r[o].version);return new J1(e,t,r,i)}}class Z1{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return null!==e&&this.mutation===e.mutation}toString(){return`Overlay{\n      largestBatchId: ${this.largestBatchId},\n      mutation: ${this.mutation.toString()}\n    }`}}class Dwe{constructor(e,t){this.count=e,this.unchangedNames=t}}var xr,Kt;function j$(n){if(void 0===n)return fr("GRPC error has no .code"),q.UNKNOWN;switch(n){case xr.OK:return q.OK;case xr.CANCELLED:return q.CANCELLED;case xr.UNKNOWN:return q.UNKNOWN;case xr.DEADLINE_EXCEEDED:return q.DEADLINE_EXCEEDED;case xr.RESOURCE_EXHAUSTED:return q.RESOURCE_EXHAUSTED;case xr.INTERNAL:return q.INTERNAL;case xr.UNAVAILABLE:return q.UNAVAILABLE;case xr.UNAUTHENTICATED:return q.UNAUTHENTICATED;case xr.INVALID_ARGUMENT:return q.INVALID_ARGUMENT;case xr.NOT_FOUND:return q.NOT_FOUND;case xr.ALREADY_EXISTS:return q.ALREADY_EXISTS;case xr.PERMISSION_DENIED:return q.PERMISSION_DENIED;case xr.FAILED_PRECONDITION:return q.FAILED_PRECONDITION;case xr.ABORTED:return q.ABORTED;case xr.OUT_OF_RANGE:return q.OUT_OF_RANGE;case xr.UNIMPLEMENTED:return q.UNIMPLEMENTED;case xr.DATA_LOSS:return q.DATA_LOSS;default:return Be(39323,{code:n})}}(Kt=xr||(xr={}))[Kt.OK=0]="OK",Kt[Kt.CANCELLED=1]="CANCELLED",Kt[Kt.UNKNOWN=2]="UNKNOWN",Kt[Kt.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",Kt[Kt.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",Kt[Kt.NOT_FOUND=5]="NOT_FOUND",Kt[Kt.ALREADY_EXISTS=6]="ALREADY_EXISTS",Kt[Kt.PERMISSION_DENIED=7]="PERMISSION_DENIED",Kt[Kt.UNAUTHENTICATED=16]="UNAUTHENTICATED",Kt[Kt.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",Kt[Kt.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",Kt[Kt.ABORTED=10]="ABORTED",Kt[Kt.OUT_OF_RANGE=11]="OUT_OF_RANGE",Kt[Kt.UNIMPLEMENTED=12]="UNIMPLEMENTED",Kt[Kt.INTERNAL=13]="INTERNAL",Kt[Kt.UNAVAILABLE=14]="UNAVAILABLE",Kt[Kt.DATA_LOSS=15]="DATA_LOSS";const Rwe=new bc([4294967295,4294967295],0);function $$(n){const e=E1().encode(n),t=new a8;return t.update(e),new Uint8Array(t.digest())}function q$(n){const e=new DataView(n.buffer),t=e.getUint32(0,!0),r=e.getUint32(4,!0),i=e.getUint32(8,!0),s=e.getUint32(12,!0);return[new bc([t,r],0),new bc([i,s],0)]}class Q1{constructor(e,t,r){if(this.bitmap=e,this.padding=t,this.hashCount=r,t<0||t>=8)throw new n_(`Invalid padding: ${t}`);if(r<0)throw new n_(`Invalid hash count: ${r}`);if(e.length>0&&0===this.hashCount)throw new n_(`Invalid hash count: ${r}`);if(0===e.length&&0!==t)throw new n_(`Invalid padding when bitmap length is 0: ${t}`);this.fe=8*e.length-t,this.ge=bc.fromNumber(this.fe)}pe(e,t,r){let i=e.add(t.multiply(bc.fromNumber(r)));return 1===i.compare(Rwe)&&(i=new bc([i.getBits(0),i.getBits(1)],0)),i.modulo(this.ge).toNumber()}ye(e){return!!(this.bitmap[Math.floor(e/8)]&1<<e%8)}mightContain(e){if(0===this.fe)return!1;const t=$$(e),[r,i]=q$(t);for(let s=0;s<this.hashCount;s++){const o=this.pe(r,i,s);if(!this.ye(o))return!1}return!0}static create(e,t,r){const i=e%8==0?0:8-e%8,s=new Uint8Array(Math.ceil(e/8)),o=new Q1(s,i,t);return r.forEach(a=>o.insert(a)),o}insert(e){if(0===this.fe)return;const t=$$(e),[r,i]=q$(t);for(let s=0;s<this.hashCount;s++){const o=this.pe(r,i,s);this.we(o)}}we(e){const t=Math.floor(e/8);this.bitmap[t]|=1<<e%8}}class n_ extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}class r_{constructor(e,t,r,i,s){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=r,this.documentUpdates=i,this.resolvedLimboDocuments=s}static createSynthesizedRemoteEventForCurrentChange(e,t,r){const i=new Map;return i.set(e,i_.createSynthesizedTargetChangeForCurrentChange(e,t,r)),new r_(Ze.min(),i,new Sn(lt),Yi(),Dt())}}class i_{constructor(e,t,r,i,s){this.resumeToken=e,this.current=t,this.addedDocuments=r,this.modifiedDocuments=i,this.removedDocuments=s}static createSynthesizedTargetChangeForCurrentChange(e,t,r){return new i_(r,t,Dt(),Dt(),Dt())}}class bb{constructor(e,t,r,i){this.Se=e,this.removedTargetIds=t,this.key=r,this.be=i}}class X${constructor(e,t){this.targetId=e,this.De=t}}class K${constructor(e,t,r=ir.EMPTY_BYTE_STRING,i=null){this.state=e,this.targetIds=t,this.resumeToken=r,this.cause=i}}class Y${constructor(){this.ve=0,this.Ce=J$(),this.Fe=ir.EMPTY_BYTE_STRING,this.Me=!1,this.xe=!0}get current(){return this.Me}get resumeToken(){return this.Fe}get Oe(){return 0!==this.ve}get Ne(){return this.xe}Be(e){e.approximateByteSize()>0&&(this.xe=!0,this.Fe=e)}Le(){let e=Dt(),t=Dt(),r=Dt();return this.Ce.forEach((i,s)=>{switch(s){case 0:e=e.add(i);break;case 2:t=t.add(i);break;case 1:r=r.add(i);break;default:Be(38017,{changeType:s})}}),new i_(this.Fe,this.Me,e,t,r)}ke(){this.xe=!1,this.Ce=J$()}qe(e,t){this.xe=!0,this.Ce=this.Ce.insert(e,t)}Qe(e){this.xe=!0,this.Ce=this.Ce.remove(e)}$e(){this.ve+=1}Ue(){this.ve-=1,$e(this.ve>=0,3241,{ve:this.ve})}Ke(){this.xe=!0,this.Me=!0}}class Pwe{constructor(e){this.We=e,this.Ge=new Map,this.ze=Yi(),this.je=Tb(),this.Je=Tb(),this.He=new Sn(lt)}Ye(e){for(const t of e.Se)e.be&&e.be.isFoundDocument()?this.Ze(t,e.be):this.Xe(t,e.key,e.be);for(const t of e.removedTargetIds)this.Xe(t,e.key,e.be)}et(e){this.forEachTarget(e,t=>{const r=this.tt(t);switch(e.state){case 0:this.nt(t)&&r.Be(e.resumeToken);break;case 1:r.Ue(),r.Oe||r.ke(),r.Be(e.resumeToken);break;case 2:r.Ue(),r.Oe||this.removeTarget(t);break;case 3:this.nt(t)&&(r.Ke(),r.Be(e.resumeToken));break;case 4:this.nt(t)&&(this.rt(t),r.Be(e.resumeToken));break;default:Be(56790,{state:e.state})}})}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.Ge.forEach((r,i)=>{this.nt(i)&&t(i)})}it(e){const t=e.targetId,r=e.De.count,i=this.st(t);if(i){const s=i.target;if(pb(s))if(0===r){const o=new Re(s.path);this.Xe(t,o,Nn.newNoDocument(o,Ze.min()))}else $e(1===r,20013,{expectedCount:r});else{const o=this.ot(t);if(o!==r){const a=this._t(e),c=a?this.ut(a,e,o):1;0!==c&&(this.rt(t),this.He=this.He.insert(t,2===c?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch"))}}}}_t(e){const t=e.De.unchangedNames;if(!t||!t.bits)return null;const{bits:{bitmap:r="",padding:i=0},hashCount:s=0}=t;let o,a;try{o=ga(r).toUint8Array()}catch(c){if(c instanceof K8)return Di("Decoding the base64 bloom filter in existence filter failed ("+c.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw c}try{a=new Q1(o,i,s)}catch(c){return Di(c instanceof n_?"BloomFilter error: ":"Applying bloom filter failed: ",c),null}return 0===a.fe?null:a}ut(e,t,r){return t.De.count===r-this.ht(e,t.targetId)?0:2}ht(e,t){const r=this.We.getRemoteKeysForTarget(t);let i=0;return r.forEach(s=>{const o=this.We.lt(),a=`projects/${o.projectId}/databases/${o.database}/documents/${s.path.canonicalString()}`;e.mightContain(a)||(this.Xe(t,s,null),i++)}),i}Pt(e){const t=new Map;this.Ge.forEach((s,o)=>{const a=this.st(o);if(a){if(s.current&&pb(a.target)){const c=new Re(a.target.path);this.Tt(c).has(o)||this.It(o,c)||this.Xe(o,c,Nn.newNoDocument(c,e))}s.Ne&&(t.set(o,s.Le()),s.ke())}});let r=Dt();this.Je.forEach((s,o)=>{let a=!0;o.forEachWhile(c=>{const l=this.st(c);return!l||"TargetPurposeLimboResolution"===l.purpose||(a=!1,!1)}),a&&(r=r.add(s))}),this.ze.forEach((s,o)=>o.setReadTime(e));const i=new r_(e,t,this.He,this.ze,r);return this.ze=Yi(),this.je=Tb(),this.Je=Tb(),this.He=new Sn(lt),i}Ze(e,t){if(!this.nt(e))return;const r=this.It(e,t.key)?2:0;this.tt(e).qe(t.key,r),this.ze=this.ze.insert(t.key,t),this.je=this.je.insert(t.key,this.Tt(t.key).add(e)),this.Je=this.Je.insert(t.key,this.dt(t.key).add(e))}Xe(e,t,r){if(!this.nt(e))return;const i=this.tt(e);this.It(e,t)?i.qe(t,1):i.Qe(t),this.Je=this.Je.insert(t,this.dt(t).delete(e)),this.Je=this.Je.insert(t,this.dt(t).add(e)),r&&(this.ze=this.ze.insert(t,r))}removeTarget(e){this.Ge.delete(e)}ot(e){const t=this.tt(e).Le();return this.We.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}$e(e){this.tt(e).$e()}tt(e){let t=this.Ge.get(e);return t||(t=new Y$,this.Ge.set(e,t)),t}dt(e){let t=this.Je.get(e);return t||(t=new on(lt),this.Je=this.Je.insert(e,t)),t}Tt(e){let t=this.je.get(e);return t||(t=new on(lt),this.je=this.je.insert(e,t)),t}nt(e){const t=null!==this.st(e);return t||fe("WatchChangeAggregator","Detected inactive target",e),t}st(e){const t=this.Ge.get(e);return t&&t.Oe?null:this.We.Et(e)}rt(e){this.Ge.set(e,new Y$),this.We.getRemoteKeysForTarget(e).forEach(t=>{this.Xe(e,t,null)})}It(e,t){return this.We.getRemoteKeysForTarget(e).has(t)}}function Tb(){return new Sn(Re.comparator)}function J$(){return new Sn(Re.comparator)}const Nwe={asc:"ASCENDING",desc:"DESCENDING"},Owe={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},kwe={and:"AND",or:"OR"};class Lwe{constructor(e,t){this.databaseId=e,this.useProto3Json=t}}function eP(n,e){return n.useProto3Json||kg(e)?e:{value:e}}function ef(n,e){return n.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function Z$(n,e){return n.useProto3Json?e.toBase64():e.toUint8Array()}function Fwe(n,e){return ef(n,e.toTimestamp())}function pr(n){return $e(!!n,49232),Ze.fromTimestamp(function(t){const r=ma(t);return new sn(r.seconds,r.nanos)}(n))}function tP(n,e){return nP(n,e).canonicalString()}function nP(n,e){const t=(i=n,new jt(["projects",i.projectId,"databases",i.database])).child("documents");var i;return void 0===e?t:t.child(e)}function Q$(n){const e=jt.fromString(n);return $e(l9(e),10190,{key:e.toString()}),e}function s_(n,e){return tP(n.databaseId,e.path)}function xo(n,e){const t=Q$(e);if(t.get(1)!==n.databaseId.projectId)throw new ae(q.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+t.get(1)+" vs "+n.databaseId.projectId);if(t.get(3)!==n.databaseId.database)throw new ae(q.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+t.get(3)+" vs "+n.databaseId.database);return new Re(n9(t))}function e9(n,e){return tP(n.databaseId,e)}function rP(n){return new jt(["projects",n.databaseId.projectId,"databases",n.databaseId.database]).canonicalString()}function n9(n){return $e(n.length>4&&"documents"===n.get(4),29091,{key:n.toString()}),n.popFirst(5)}function r9(n,e,t){return{name:s_(n,e),fields:t.value.mapValue.fields}}function i9(n,e){return{documents:[e9(n,e.path)]}}function Ib(n,e){const t={structuredQuery:{}},r=e.path;let i;null!==e.collectionGroup?(i=r,t.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(i=r.popLast(),t.structuredQuery.from=[{collectionId:r.lastSegment()}]),t.parent=e9(n,i);const s=function(l){if(0!==l.length)return c9(an.create(l,"and"))}(e.filters);s&&(t.structuredQuery.where=s);const o=function(l){if(0!==l.length)return l.map(u=>{return{field:Rc((h=u).field),direction:zwe(h.dir)};var h})}(e.orderBy);o&&(t.structuredQuery.orderBy=o);const a=eP(n,e.limit);return null!==a&&(t.structuredQuery.limit=a),e.startAt&&(t.structuredQuery.startAt={before:(l=e.startAt).inclusive,values:l.position}),e.endAt&&(t.structuredQuery.endAt=function(l){return{before:!l.inclusive,values:l.position}}(e.endAt)),{Vt:t,parent:i};var l}function o9(n){let e=function t9(n){const e=Q$(n);return 4===e.length?jt.emptyPath():n9(e)}(n.parent);const t=n.structuredQuery,r=t.from?t.from.length:0;let i=null;if(r>0){$e(1===r,65062);const u=t.from[0];u.allDescendants?i=u.collectionId:e=e.child(u.collectionId)}let s=[];t.where&&(s=function(d){const h=a9(d);return h instanceof an&&z1(h)?h.getFilters():[h]}(t.where));let o=[];t.orderBy&&(o=t.orderBy.map(h=>{return new Xg(tf((m=h).field),function(_){switch(_){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(m.direction));var m}));let a=null;t.limit&&(a=function(d){let h;return h="object"==typeof d?d.value:d,kg(h)?null:h}(t.limit));let c=null;var d;t.startAt&&(c=new Dc((d=t.startAt).values||[],!!d.before));let l=null;return t.endAt&&(l=function(d){return new Dc(d.values||[],!d.before)}(t.endAt)),function b$(n,e,t,r,i,s,o,a){return new _a(n,e,t,r,i,s,o,a)}(e,i,o,s,a,"F",c,l)}function a9(n){return void 0!==n.unaryFilter?function(t){switch(t.unaryFilter.op){case"IS_NAN":const r=tf(t.unaryFilter.field);return Xt.create(r,"==",{doubleValue:NaN});case"IS_NULL":const i=tf(t.unaryFilter.field);return Xt.create(i,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const s=tf(t.unaryFilter.field);return Xt.create(s,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const o=tf(t.unaryFilter.field);return Xt.create(o,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":return Be(61313);default:return Be(60726)}}(n):void 0!==n.fieldFilter?Xt.create(tf((t=n).fieldFilter.field),function(i){switch(i){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":return Be(58110);default:return Be(50506)}}(t.fieldFilter.op),t.fieldFilter.value):void 0!==n.compositeFilter?function(t){return an.create(t.compositeFilter.filters.map(r=>a9(r)),function(i){switch(i){case"AND":return"and";case"OR":return"or";default:return Be(1026)}}(t.compositeFilter.op))}(n):Be(30097,{filter:n});var t}function zwe(n){return Nwe[n]}function Gwe(n){return Owe[n]}function Wwe(n){return kwe[n]}function Rc(n){return{fieldPath:n.canonicalString()}}function tf(n){return Bn.fromServerFormat(n.fieldPath)}function c9(n){return n instanceof Xt?function(t){if("=="===t.op){if(i$(t.value))return{unaryFilter:{field:Rc(t.field),op:"IS_NAN"}};if(r$(t.value))return{unaryFilter:{field:Rc(t.field),op:"IS_NULL"}}}else if("!="===t.op){if(i$(t.value))return{unaryFilter:{field:Rc(t.field),op:"IS_NOT_NAN"}};if(r$(t.value))return{unaryFilter:{field:Rc(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:Rc(t.field),op:Gwe(t.op),value:t.value}}}(n):n instanceof an?function(t){const r=t.getFilters().map(i=>c9(i));return 1===r.length?r[0]:{compositeFilter:{op:Wwe(t.op),filters:r}}}(n):Be(54877,{filter:n})}function jwe(n){const e=[];return n.fields.forEach(t=>e.push(t.canonicalString())),{fieldPaths:e}}function l9(n){return n.length>=4&&"projects"===n.get(0)&&"databases"===n.get(2)}class Ea{constructor(e,t,r,i,s=Ze.min(),o=Ze.min(),a=ir.EMPTY_BYTE_STRING,c=null){this.target=e,this.targetId=t,this.purpose=r,this.sequenceNumber=i,this.snapshotVersion=s,this.lastLimboFreeSnapshotVersion=o,this.resumeToken=a,this.expectedCount=c}withSequenceNumber(e){return new Ea(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new Ea(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new Ea(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new Ea(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}class u9{constructor(e){this.gt=e}}function xb(n){const e=o9({parent:n.parent,structuredQuery:n.structuredQuery});return"LAST"===n.limitType?gb(e,e.limit,"L"):e}class Eu{constructor(){}bt(e,t){this.Dt(e,t),t.vt()}Dt(e,t){if("nullValue"in e)this.Ct(t,5);else if("booleanValue"in e)this.Ct(t,10),t.Ft(e.booleanValue?1:0);else if("integerValue"in e)this.Ct(t,15),t.Ft(Hn(e.integerValue));else if("doubleValue"in e){const r=Hn(e.doubleValue);isNaN(r)?this.Ct(t,13):(this.Ct(t,15),Lg(r)?t.Ft(0):t.Ft(r))}else if("timestampValue"in e){let r=e.timestampValue;this.Ct(t,20),"string"==typeof r&&(r=ma(r)),t.Mt(`${r.seconds||""}`),t.Ft(r.nanos||0)}else if("stringValue"in e)this.xt(e.stringValue,t),this.Ot(t);else if("bytesValue"in e)this.Ct(t,30),t.Nt(ga(e.bytesValue)),this.Ot(t);else if("referenceValue"in e)this.Bt(e.referenceValue,t);else if("geoPointValue"in e){const r=e.geoPointValue;this.Ct(t,45),t.Ft(r.latitude||0),t.Ft(r.longitude||0)}else"mapValue"in e?s$(e)?this.Ct(t,Number.MAX_SAFE_INTEGER):fb(e)?this.Lt(e.mapValue,t):(this.kt(e.mapValue,t),this.Ot(t)):"arrayValue"in e?(this.qt(e.arrayValue,t),this.Ot(t)):Be(19022,{Qt:e})}xt(e,t){this.Ct(t,25),this.$t(e,t)}$t(e,t){t.Mt(e)}kt(e,t){const r=e.fields||{};this.Ct(t,55);for(const i of Object.keys(r))this.xt(i,t),this.Dt(r[i],t)}Lt(e,t){var r,i;const s=e.fields||{};this.Ct(t,53);const o=Wh,a=(null===(i=null===(r=s[o].arrayValue)||void 0===r?void 0:r.values)||void 0===i?void 0:i.length)||0;this.Ct(t,15),t.Ft(Hn(a)),this.xt(o,t),this.Dt(s[o],t)}qt(e,t){const r=e.values||[];this.Ct(t,50);for(const i of r)this.Dt(i,t)}Bt(e,t){this.Ct(t,37),Re.fromName(e).path.forEach(r=>{this.Ct(t,60),this.$t(r,t)})}Ct(e,t){e.Ft(t)}Ot(e){e.Ft(2)}}Eu.Ut=new Eu;class eIe{constructor(){this.Dn=new uP}addToCollectionParentIndex(e,t){return this.Dn.add(t),$.resolve()}getCollectionParents(e,t){return $.resolve(this.Dn.getEntries(t))}addFieldIndex(e,t){return $.resolve()}deleteFieldIndex(e,t){return $.resolve()}deleteAllFieldIndexes(e){return $.resolve()}createTargetIndexes(e,t){return $.resolve()}getDocumentsMatchingTarget(e,t){return $.resolve(null)}getIndexType(e,t){return $.resolve(0)}getFieldIndexes(e,t){return $.resolve([])}getNextCollectionGroupToUpdate(e){return $.resolve(null)}getMinOffset(e,t){return $.resolve(ls.min())}getMinOffsetFromCollectionGroup(e,t){return $.resolve(ls.min())}updateCollectionGroup(e,t,r){return $.resolve()}updateIndexEntries(e,t){return $.resolve()}}class uP{constructor(){this.index={}}add(e){const t=e.lastSegment(),r=e.popLast(),i=this.index[t]||new on(jt.comparator),s=!i.has(r);return this.index[t]=i.add(r),s}has(e){const t=e.lastSegment(),r=e.popLast(),i=this.index[t];return i&&i.has(r)}getEntries(e){return(this.index[e]||new on(jt.comparator)).toArray()}}new Uint8Array(0);const A9={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0};class gi{static withCacheSize(e){return new gi(e,gi.DEFAULT_COLLECTION_PERCENTILE,gi.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}constructor(e,t,r){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=r}}gi.DEFAULT_COLLECTION_PERCENTILE=10,gi.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,gi.DEFAULT=new gi(41943040,gi.DEFAULT_COLLECTION_PERCENTILE,gi.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),gi.DISABLED=new gi(-1,0,0);class Tu{constructor(e){this._r=e}next(){return this._r+=2,this._r}static ar(){return new Tu(0)}static ur(){return new Tu(-1)}}const N9="LruGarbageCollector";function k9([n,e],[t,r]){const i=lt(n,t);return 0===i?lt(e,r):i}class rIe{constructor(e){this.Tr=e,this.buffer=new on(k9),this.Ir=0}dr(){return++this.Ir}Er(e){const t=[e,this.dr()];if(this.buffer.size<this.Tr)this.buffer=this.buffer.add(t);else{const r=this.buffer.last();k9(t,r)<0&&(this.buffer=this.buffer.delete(r).add(t))}}get maxValue(){return this.buffer.last()[0]}}class L9{constructor(e,t,r){this.garbageCollector=e,this.asyncQueue=t,this.localStore=r,this.Ar=null}start(){-1!==this.garbageCollector.params.cacheSizeCollectionThreshold&&this.Rr(6e4)}stop(){this.Ar&&(this.Ar.cancel(),this.Ar=null)}get started(){return null!==this.Ar}Rr(e){var t=this;fe(N9,`Garbage collection scheduled in ${e}ms`),this.Ar=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,O(function*(){t.Ar=null;try{yield t.localStore.collectGarbage(t.garbageCollector)}catch(r){Ic(r)?fe(N9,"Ignoring IndexedDB error during garbage collection: ",r):yield wc(r)}yield t.Rr(3e5)}))}}class iIe{constructor(e,t){this.Vr=e,this.params=t}calculateTargetCount(e,t){return this.Vr.mr(e).next(r=>Math.floor(t/100*r))}nthSequenceNumber(e,t){if(0===t)return $.resolve(ds.ue);const r=new rIe(t);return this.Vr.forEachTarget(e,i=>r.Er(i.sequenceNumber)).next(()=>this.Vr.gr(e,i=>r.Er(i))).next(()=>r.maxValue)}removeTargets(e,t,r){return this.Vr.removeTargets(e,t,r)}removeOrphanedDocuments(e,t){return this.Vr.removeOrphanedDocuments(e,t)}collect(e,t){return-1===this.params.cacheSizeCollectionThreshold?(fe("LruGarbageCollector","Garbage collection skipped; disabled"),$.resolve(A9)):this.getCacheSize(e).next(r=>r<this.params.cacheSizeCollectionThreshold?(fe("LruGarbageCollector",`Garbage collection skipped; Cache size ${r} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),A9):this.pr(e,t))}getCacheSize(e){return this.Vr.getCacheSize(e)}pr(e,t){let r,i,s,o,a,c,l;const u=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next(d=>(d>this.params.maximumSequenceNumbersToCollect?(fe("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${d}`),i=this.params.maximumSequenceNumbersToCollect):i=d,o=Date.now(),this.nthSequenceNumber(e,i))).next(d=>(r=d,a=Date.now(),this.removeTargets(e,r,t))).next(d=>(s=d,c=Date.now(),this.removeOrphanedDocuments(e,r))).next(d=>(l=Date.now(),Nh()<=qt.DEBUG&&fe("LruGarbageCollector",`LRU Garbage Collection\n\tCounted targets in ${o-u}ms\n\tDetermined least recently used ${i} in `+(a-o)+`ms\n\tRemoved ${s} targets in `+(c-a)+`ms\n\tRemoved ${d} documents in `+(l-c)+`ms\nTotal Duration: ${l-u}ms`),$.resolve({didRun:!0,sequenceNumbersCollected:i,targetsRemoved:s,documentsRemoved:d})))}}class V9{constructor(){this.changes=new ya(e=>e.toString(),(e,t)=>e.isEqual(t)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,Nn.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();const r=this.changes.get(t);return void 0!==r?$.resolve(r):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}class cIe{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}}class G9{constructor(e,t,r,i){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=r,this.indexManager=i}getDocument(e,t){let r=null;return this.documentOverlayCache.getOverlay(e,t).next(i=>(r=i,this.remoteDocumentCache.getEntry(e,t))).next(i=>(null!==r&&t_(r.mutation,i,Ki.empty(),sn.now()),i))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next(r=>this.getLocalViewOfDocuments(e,r,Dt()).next(()=>r))}getLocalViewOfDocuments(e,t,r=Dt()){const i=So();return this.populateOverlays(e,i,t).next(()=>this.computeViews(e,t,i,r).next(s=>{let o=Zg();return s.forEach((a,c)=>{o=o.insert(a,c.overlayedDocument)}),o}))}getOverlayedDocuments(e,t){const r=So();return this.populateOverlays(e,r,t).next(()=>this.computeViews(e,t,r,Dt()))}populateOverlays(e,t,r){const i=[];return r.forEach(s=>{t.has(s)||i.push(s)}),this.documentOverlayCache.getOverlays(e,i).next(s=>{s.forEach((o,a)=>{t.set(o,a)})})}computeViews(e,t,r,i){let s=Yi();const o=Qg(),a=Qg();return t.forEach((c,l)=>{const u=r.get(l.key);i.has(l.key)&&(void 0===u||u.mutation instanceof va)?s=s.insert(l.key,l):void 0!==u?(o.set(l.key,u.mutation.getFieldMask()),t_(u.mutation,l,u.mutation.getFieldMask(),sn.now())):o.set(l.key,Ki.empty())}),this.recalculateAndSaveOverlays(e,s).next(c=>(c.forEach((l,u)=>o.set(l,u)),t.forEach((l,u)=>{var d;return a.set(l,new cIe(u,null!==(d=o.get(l))&&void 0!==d?d:null))}),a))}recalculateAndSaveOverlays(e,t){const r=Qg();let i=new Sn((o,a)=>o-a),s=Dt();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next(o=>{for(const a of o)a.keys().forEach(c=>{const l=t.get(c);if(null===l)return;let u=r.get(c)||Ki.empty();u=a.applyToLocalView(l,u),r.set(c,u);const d=(i.get(a.batchId)||Dt()).add(c);i=i.insert(a.batchId,d)})}).next(()=>{const o=[],a=i.getReverseIterator();for(;a.hasNext();){const c=a.getNext(),l=c.key,u=c.value,d=D$();u.forEach(h=>{if(!s.has(h)){const f=V$(t.get(h),r.get(h));null!==f&&d.set(h,f),s=s.add(h)}}),o.push(this.documentOverlayCache.saveOverlays(e,l,d))}return $.waitFor(o)}).next(()=>r)}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next(r=>this.recalculateAndSaveOverlays(e,r))}getDocumentsMatchingQuery(e,t,r,i){return Re.isDocumentKey((o=t).path)&&null===o.collectionGroup&&0===o.filters.length?this.getDocumentsMatchingDocumentQuery(e,t.path):j1(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,r,i):this.getDocumentsMatchingCollectionQuery(e,t,r,i);var o}getNextDocuments(e,t,r,i){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,r,i).next(s=>{const o=i-s.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,r.largestBatchId,i-s.size):$.resolve(So());let a=-1,c=s;return o.next(l=>$.forEach(l,(u,d)=>(a<d.largestBatchId&&(a=d.largestBatchId),s.get(u)?$.resolve():this.remoteDocumentCache.getEntry(e,u).next(h=>{c=c.insert(u,h)}))).next(()=>this.populateOverlays(e,l,s)).next(()=>this.computeViews(e,c,l,Dt())).next(u=>({batchId:a,changes:C$(u)})))})}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new Re(t)).next(r=>{let i=Zg();return r.isFoundDocument()&&(i=i.insert(r.key,r)),i})}getDocumentsMatchingCollectionGroupQuery(e,t,r,i){const s=t.collectionGroup;let o=Zg();return this.indexManager.getCollectionParents(e,s).next(a=>$.forEach(a,c=>{const l=(d=t,h=c.child(s),new _a(h,null,d.explicitOrderBy.slice(),d.filters.slice(),d.limit,d.limitType,d.startAt,d.endAt));var d,h;return this.getDocumentsMatchingCollectionQuery(e,l,r,i).next(u=>{u.forEach((d,h)=>{o=o.insert(d,h)})})}).next(()=>o))}getDocumentsMatchingCollectionQuery(e,t,r,i){let s;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,r.largestBatchId).next(o=>(s=o,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,r,s,i))).next(o=>{s.forEach((c,l)=>{const u=l.getKey();null===o.get(u)&&(o=o.insert(u,Nn.newInvalidDocument(u)))});let a=Zg();return o.forEach((c,l)=>{const u=s.get(c);void 0!==u&&t_(u.mutation,l,Ki.empty(),sn.now()),Jg(t,l)&&(a=a.insert(c,l))}),a})}}class lIe{constructor(e){this.serializer=e,this.Br=new Map,this.Lr=new Map}getBundleMetadata(e,t){return $.resolve(this.Br.get(t))}saveBundleMetadata(e,t){return this.Br.set(t.id,{id:(i=t).id,version:i.version,createTime:pr(i.createTime)}),$.resolve();var i}getNamedQuery(e,t){return $.resolve(this.Lr.get(t))}saveNamedQuery(e,t){return this.Lr.set(t.name,{name:(i=t).name,query:xb(i.bundledQuery),readTime:pr(i.readTime)}),$.resolve();var i}}class uIe{constructor(){this.overlays=new Sn(Re.comparator),this.kr=new Map}getOverlay(e,t){return $.resolve(this.overlays.get(t))}getOverlays(e,t){const r=So();return $.forEach(t,i=>this.getOverlay(e,i).next(s=>{null!==s&&r.set(i,s)})).next(()=>r)}saveOverlays(e,t,r){return r.forEach((i,s)=>{this.wt(e,t,s)}),$.resolve()}removeOverlaysForBatchId(e,t,r){const i=this.kr.get(r);return void 0!==i&&(i.forEach(s=>this.overlays=this.overlays.remove(s)),this.kr.delete(r)),$.resolve()}getOverlaysForCollection(e,t,r){const i=So(),s=t.length+1,o=new Re(t.child("")),a=this.overlays.getIteratorFrom(o);for(;a.hasNext();){const c=a.getNext().value,l=c.getKey();if(!t.isPrefixOf(l.path))break;l.path.length===s&&c.largestBatchId>r&&i.set(c.getKey(),c)}return $.resolve(i)}getOverlaysForCollectionGroup(e,t,r,i){let s=new Sn((l,u)=>l-u);const o=this.overlays.getIterator();for(;o.hasNext();){const l=o.getNext().value;if(l.getKey().getCollectionGroup()===t&&l.largestBatchId>r){let u=s.get(l.largestBatchId);null===u&&(u=So(),s=s.insert(l.largestBatchId,u)),u.set(l.getKey(),l)}}const a=So(),c=s.getIterator();for(;c.hasNext()&&(c.getNext().value.forEach((l,u)=>a.set(l,u)),!(a.size()>=i)););return $.resolve(a)}wt(e,t,r){const i=this.overlays.get(r.key);if(null!==i){const o=this.kr.get(i.largestBatchId).delete(r.key);this.kr.set(i.largestBatchId,o)}this.overlays=this.overlays.insert(r.key,new Z1(t,r));let s=this.kr.get(t);void 0===s&&(s=Dt(),this.kr.set(t,s)),this.kr.set(t,s.add(r.key))}}class dIe{constructor(){this.sessionToken=ir.EMPTY_BYTE_STRING}getSessionToken(e){return $.resolve(this.sessionToken)}setSessionToken(e,t){return this.sessionToken=t,$.resolve()}}class dP{constructor(){this.qr=new on(Gr.Qr),this.$r=new on(Gr.Ur)}isEmpty(){return this.qr.isEmpty()}addReference(e,t){const r=new Gr(e,t);this.qr=this.qr.add(r),this.$r=this.$r.add(r)}Kr(e,t){e.forEach(r=>this.addReference(r,t))}removeReference(e,t){this.Wr(new Gr(e,t))}Gr(e,t){e.forEach(r=>this.removeReference(r,t))}zr(e){const t=new Re(new jt([])),r=new Gr(t,e),i=new Gr(t,e+1),s=[];return this.$r.forEachInRange([r,i],o=>{this.Wr(o),s.push(o.key)}),s}jr(){this.qr.forEach(e=>this.Wr(e))}Wr(e){this.qr=this.qr.delete(e),this.$r=this.$r.delete(e)}Jr(e){const t=new Re(new jt([])),r=new Gr(t,e),i=new Gr(t,e+1);let s=Dt();return this.$r.forEachInRange([r,i],o=>{s=s.add(o.key)}),s}containsKey(e){const t=new Gr(e,0),r=this.qr.firstAfterOrEqual(t);return null!==r&&e.isEqual(r.key)}}class Gr{constructor(e,t){this.key=e,this.Hr=t}static Qr(e,t){return Re.comparator(e.key,t.key)||lt(e.Hr,t.Hr)}static Ur(e,t){return lt(e.Hr,t.Hr)||Re.comparator(e.key,t.key)}}class hIe{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.er=1,this.Yr=new on(Gr.Qr)}checkEmpty(e){return $.resolve(0===this.mutationQueue.length)}addMutationBatch(e,t,r,i){const s=this.er;this.er++;const o=new Y1(s,t,r,i);this.mutationQueue.push(o);for(const a of i)this.Yr=this.Yr.add(new Gr(a.key,s)),this.indexManager.addToCollectionParentIndex(e,a.key.path.popLast());return $.resolve(o)}lookupMutationBatch(e,t){return $.resolve(this.Zr(t))}getNextMutationBatchAfterBatchId(e,t){const i=this.Xr(t+1),s=i<0?0:i;return $.resolve(this.mutationQueue.length>s?this.mutationQueue[s]:null)}getHighestUnacknowledgedBatchId(){return $.resolve(0===this.mutationQueue.length?-1:this.er-1)}getAllMutationBatches(e){return $.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){const r=new Gr(t,0),i=new Gr(t,Number.POSITIVE_INFINITY),s=[];return this.Yr.forEachInRange([r,i],o=>{const a=this.Zr(o.Hr);s.push(a)}),$.resolve(s)}getAllMutationBatchesAffectingDocumentKeys(e,t){let r=new on(lt);return t.forEach(i=>{const s=new Gr(i,0),o=new Gr(i,Number.POSITIVE_INFINITY);this.Yr.forEachInRange([s,o],a=>{r=r.add(a.Hr)})}),$.resolve(this.ei(r))}getAllMutationBatchesAffectingQuery(e,t){const r=t.path,i=r.length+1;let s=r;Re.isDocumentKey(s)||(s=s.child(""));const o=new Gr(new Re(s),0);let a=new on(lt);return this.Yr.forEachWhile(c=>{const l=c.key.path;return!!r.isPrefixOf(l)&&(l.length===i&&(a=a.add(c.Hr)),!0)},o),$.resolve(this.ei(a))}ei(e){const t=[];return e.forEach(r=>{const i=this.Zr(r);null!==i&&t.push(i)}),t}removeMutationBatch(e,t){$e(0===this.ti(t.batchId,"removed"),55003),this.mutationQueue.shift();let r=this.Yr;return $.forEach(t.mutations,i=>{const s=new Gr(i.key,t.batchId);return r=r.delete(s),this.referenceDelegate.markPotentiallyOrphaned(e,i.key)}).next(()=>{this.Yr=r})}rr(e){}containsKey(e,t){const r=new Gr(t,0),i=this.Yr.firstAfterOrEqual(r);return $.resolve(t.isEqual(i&&i.key))}performConsistencyCheck(e){return $.resolve()}ti(e,t){return this.Xr(e)}Xr(e){return 0===this.mutationQueue.length?0:e-this.mutationQueue[0].batchId}Zr(e){const t=this.Xr(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}}class fIe{constructor(e){this.ni=e,this.docs=new Sn(Re.comparator),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){const r=t.key,i=this.docs.get(r),s=i?i.size:0,o=this.ni(t);return this.docs=this.docs.insert(r,{document:t.mutableCopy(),size:o}),this.size+=o-s,this.indexManager.addToCollectionParentIndex(e,r.path.popLast())}removeEntry(e){const t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){const r=this.docs.get(t);return $.resolve(r?r.document.mutableCopy():Nn.newInvalidDocument(t))}getEntries(e,t){let r=Yi();return t.forEach(i=>{const s=this.docs.get(i);r=r.insert(i,s?s.document.mutableCopy():Nn.newInvalidDocument(i))}),$.resolve(r)}getDocumentsMatchingQuery(e,t,r,i){let s=Yi();const o=t.path,a=new Re(o.child("__id-9223372036854775808__")),c=this.docs.getIteratorFrom(a);for(;c.hasNext();){const{key:l,value:{document:u}}=c.getNext();if(!o.isPrefixOf(l.path))break;l.path.length>o.length+1||x1(x8(u),r)<=0||(i.has(u.key)||Jg(t,u))&&(s=s.insert(u.key,u.mutableCopy()))}return $.resolve(s)}getAllFromCollectionGroup(e,t,r,i){Be(9500)}ri(e,t){return $.forEach(this.docs,r=>t(r))}newChangeBuffer(e){return new pIe(this)}getSize(e){return $.resolve(this.size)}}class pIe extends V9{constructor(e){super(),this.Or=e}applyChanges(e){const t=[];return this.changes.forEach((r,i)=>{i.isValidDocument()?t.push(this.Or.addEntry(e,i)):this.Or.removeEntry(r)}),$.waitFor(t)}getFromCache(e,t){return this.Or.getEntry(e,t)}getAllFromCache(e,t){return this.Or.getEntries(e,t)}}class mIe{constructor(e){this.persistence=e,this.ii=new ya(t=>pu(t),Kg),this.lastRemoteSnapshotVersion=Ze.min(),this.highestTargetId=0,this.si=0,this.oi=new dP,this.targetCount=0,this._i=Tu.ar()}forEachTarget(e,t){return this.ii.forEach((r,i)=>t(i)),$.resolve()}getLastRemoteSnapshotVersion(e){return $.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return $.resolve(this.si)}allocateTargetId(e){return this.highestTargetId=this._i.next(),$.resolve(this.highestTargetId)}setTargetsMetadata(e,t,r){return r&&(this.lastRemoteSnapshotVersion=r),t>this.si&&(this.si=t),$.resolve()}hr(e){this.ii.set(e.target,e);const t=e.targetId;t>this.highestTargetId&&(this._i=new Tu(t),this.highestTargetId=t),e.sequenceNumber>this.si&&(this.si=e.sequenceNumber)}addTargetData(e,t){return this.hr(t),this.targetCount+=1,$.resolve()}updateTargetData(e,t){return this.hr(t),$.resolve()}removeTargetData(e,t){return this.ii.delete(t.target),this.oi.zr(t.targetId),this.targetCount-=1,$.resolve()}removeTargets(e,t,r){let i=0;const s=[];return this.ii.forEach((o,a)=>{a.sequenceNumber<=t&&null===r.get(a.targetId)&&(this.ii.delete(o),s.push(this.removeMatchingKeysForTargetId(e,a.targetId)),i++)}),$.waitFor(s).next(()=>i)}getTargetCount(e){return $.resolve(this.targetCount)}getTargetData(e,t){const r=this.ii.get(t)||null;return $.resolve(r)}addMatchingKeys(e,t,r){return this.oi.Kr(t,r),$.resolve()}removeMatchingKeys(e,t,r){this.oi.Gr(t,r);const i=this.persistence.referenceDelegate,s=[];return i&&t.forEach(o=>{s.push(i.markPotentiallyOrphaned(e,o))}),$.waitFor(s)}removeMatchingKeysForTargetId(e,t){return this.oi.zr(t),$.resolve()}getMatchingKeysForTargetId(e,t){const r=this.oi.Jr(t);return $.resolve(r)}containsKey(e,t){return $.resolve(this.oi.containsKey(t))}}class hP{constructor(e,t){this.ai={},this.overlays={},this.ui=new ds(0),this.ci=!1,this.ci=!0,this.li=new dIe,this.referenceDelegate=e(this),this.hi=new mIe(this),this.indexManager=new eIe,this.remoteDocumentCache=new fIe(r=>this.referenceDelegate.Pi(r)),this.serializer=new u9(t),this.Ti=new lIe(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.ci=!1,Promise.resolve()}get started(){return this.ci}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new uIe,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let r=this.ai[e.toKey()];return r||(r=new hIe(t,this.referenceDelegate),this.ai[e.toKey()]=r),r}getGlobalsCache(){return this.li}getTargetCache(){return this.hi}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Ti}runTransaction(e,t,r){fe("MemoryPersistence","Starting transaction:",e);const i=new gIe(this.ui.next());return this.referenceDelegate.Ii(),r(i).next(s=>this.referenceDelegate.di(i).next(()=>s)).toPromise().then(s=>(i.raiseOnCommittedEvent(),s))}Ei(e,t){return $.or(Object.values(this.ai).map(r=>()=>r.containsKey(e,t)))}}class gIe extends M8{constructor(e){super(),this.currentSequenceNumber=e}}class Ob{constructor(e){this.persistence=e,this.Ai=new dP,this.Ri=null}static Vi(e){return new Ob(e)}get mi(){if(this.Ri)return this.Ri;throw Be(60996)}addReference(e,t,r){return this.Ai.addReference(r,t),this.mi.delete(r.toString()),$.resolve()}removeReference(e,t,r){return this.Ai.removeReference(r,t),this.mi.add(r.toString()),$.resolve()}markPotentiallyOrphaned(e,t){return this.mi.add(t.toString()),$.resolve()}removeTarget(e,t){this.Ai.zr(t.targetId).forEach(i=>this.mi.add(i.toString()));const r=this.persistence.getTargetCache();return r.getMatchingKeysForTargetId(e,t.targetId).next(i=>{i.forEach(s=>this.mi.add(s.toString()))}).next(()=>r.removeTargetData(e,t))}Ii(){this.Ri=new Set}di(e){const t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return $.forEach(this.mi,r=>{const i=Re.fromPath(r);return this.fi(e,i).next(s=>{s||t.removeEntry(i,Ze.min())})}).next(()=>(this.Ri=null,t.apply(e)))}updateLimboDocument(e,t){return this.fi(e,t).next(r=>{r?this.mi.delete(t.toString()):this.mi.add(t.toString())})}Pi(e){return 0}fi(e,t){return $.or([()=>$.resolve(this.Ai.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Ei(e,t)])}}class kb{constructor(e,t){this.persistence=e,this.gi=new ya(r=>function pi(n){let e="";for(let t=0;t<n.length;t++)e.length>0&&(e=P8(e)),e=kTe(n.get(t),e);return P8(e)}(r.path),(r,i)=>r.isEqual(i)),this.garbageCollector=function F9(n,e){return new iIe(n,e)}(this,t)}static Vi(e,t){return new kb(e,t)}Ii(){}di(e){return $.resolve()}forEachTarget(e,t){return this.persistence.getTargetCache().forEachTarget(e,t)}mr(e){const t=this.yr(e);return this.persistence.getTargetCache().getTargetCount(e).next(r=>t.next(i=>r+i))}yr(e){let t=0;return this.gr(e,r=>{t++}).next(()=>t)}gr(e,t){return $.forEach(this.gi,(r,i)=>this.Sr(e,r,i).next(s=>s?$.resolve():t(i)))}removeTargets(e,t,r){return this.persistence.getTargetCache().removeTargets(e,t,r)}removeOrphanedDocuments(e,t){let r=0;const i=this.persistence.getRemoteDocumentCache(),s=i.newChangeBuffer();return i.ri(e,o=>this.Sr(e,o,t).next(a=>{a||(r++,s.removeEntry(o,Ze.min()))})).next(()=>s.apply(e)).next(()=>r)}markPotentiallyOrphaned(e,t){return this.gi.set(t,e.currentSequenceNumber),$.resolve()}removeTarget(e,t){const r=t.withSequenceNumber(e.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(e,r)}addReference(e,t,r){return this.gi.set(r,e.currentSequenceNumber),$.resolve()}removeReference(e,t,r){return this.gi.set(r,e.currentSequenceNumber),$.resolve()}updateLimboDocument(e,t){return this.gi.set(t,e.currentSequenceNumber),$.resolve()}Pi(e){let t=e.key.toString().length;return e.isFoundDocument()&&(t+=db(e.data.value)),t}Sr(e,t,r){return $.or([()=>this.persistence.Ei(e,t),()=>this.persistence.getTargetCache().containsKey(e,t),()=>{const i=this.gi.get(t);return $.resolve(void 0!==i&&i>r)}])}getCacheSize(e){return this.persistence.getRemoteDocumentCache().getSize(e)}}class yP{constructor(e,t,r,i){this.targetId=e,this.fromCache=t,this.Is=r,this.ds=i}static Es(e,t){let r=Dt(),i=Dt();for(const s of t.docChanges)switch(s.type){case 0:r=r.add(s.doc.key);break;case 1:i=i.add(s.doc.key)}return new yP(e,t.fromCache,r,i)}}class yIe{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}class $9{constructor(){this.As=!1,this.Rs=!1,this.Vs=100,this.fs=Z6()?8:function C8(n){const e=n.match(/Android ([\d.]+)/i),t=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(t)}(dr())>0?6:4}initialize(e,t){this.gs=e,this.indexManager=t,this.As=!0}getDocumentsMatchingQuery(e,t,r,i){const s={result:null};return this.ps(e,t).next(o=>{s.result=o}).next(()=>{if(!s.result)return this.ys(e,t,i,r).next(o=>{s.result=o})}).next(()=>{if(s.result)return;const o=new yIe;return this.ws(e,t,o).next(a=>{if(s.result=a,this.Rs)return this.Ss(e,t,o,a.size)})}).next(()=>s.result)}Ss(e,t,r,i){return r.documentReadCount<this.Vs?(Nh()<=qt.DEBUG&&fe("QueryEngine","SDK will not create cache indexes for query:",Kh(t),"since it only creates cache indexes for collection contains","more than or equal to",this.Vs,"documents"),$.resolve()):(Nh()<=qt.DEBUG&&fe("QueryEngine","Query:",Kh(t),"scans",r.documentReadCount,"local documents and returns",i,"documents as results."),r.documentReadCount>this.fs*i?(Nh()<=qt.DEBUG&&fe("QueryEngine","The SDK decides to create cache indexes for query:",Kh(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,mi(t))):$.resolve())}ps(e,t){if(T$(t))return $.resolve(null);let r=mi(t);return this.indexManager.getIndexType(e,r).next(i=>0===i?null:(null!==t.limit&&1===i&&(t=gb(t,null,"F"),r=mi(t)),this.indexManager.getDocumentsMatchingTarget(e,r).next(s=>{const o=Dt(...s);return this.gs.getDocuments(e,o).next(a=>this.indexManager.getMinOffset(e,r).next(c=>{const l=this.bs(t,a);return this.Ds(t,l,o,c.readTime)?this.ps(e,gb(t,null,"F")):this.vs(e,l,t,c)}))})))}ys(e,t,r,i){return T$(t)||i.isEqual(Ze.min())?$.resolve(null):this.gs.getDocuments(e,r).next(s=>{const o=this.bs(t,s);return this.Ds(t,o,r,i)?$.resolve(null):(Nh()<=qt.DEBUG&&fe("QueryEngine","Re-using previous result from %s to execute query: %s",i.toString(),Kh(t)),this.vs(e,o,t,function S8(n,e){const t=n.toTimestamp().seconds,r=n.toTimestamp().nanoseconds+1,i=Ze.fromTimestamp(1e9===r?new sn(t+1,0):new sn(t,r));return new ls(i,Re.empty(),e)}(i,-1)).next(a=>a))})}bs(e,t){let r=new on(A$(e));return t.forEach((i,s)=>{Jg(e,s)&&(r=r.add(s))}),r}Ds(e,t,r,i){if(null===e.limit)return!1;if(r.size!==t.size)return!0;const s="F"===e.limitType?t.last():t.first();return!!s&&(s.hasPendingWrites||s.version.compareTo(i)>0)}ws(e,t,r){return Nh()<=qt.DEBUG&&fe("QueryEngine","Using full collection scan to execute query:",Kh(t)),this.gs.getDocumentsMatchingQuery(e,t,ls.min(),r)}vs(e,t,r,i){return this.gs.getDocumentsMatchingQuery(e,r,i).next(s=>(t.forEach(o=>{s=s.insert(o.key,o)}),s))}}const vP="LocalStore";class EIe{constructor(e,t,r,i){this.persistence=e,this.Cs=t,this.serializer=i,this.Fs=new Sn(lt),this.Ms=new ya(s=>pu(s),Kg),this.xs=new Map,this.Os=e.getRemoteDocumentCache(),this.hi=e.getTargetCache(),this.Ti=e.getBundleCache(),this.Ns(r)}Ns(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new G9(this.Os,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.Os.setIndexManager(this.indexManager),this.Cs.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",t=>e.collect(t,this.Fs))}}function X9(n,e){return EP.apply(this,arguments)}function EP(){return(EP=O(function*(n,e){const t=Pe(n);return yield t.persistence.runTransaction("Handle user change","readonly",r=>{let i;return t.mutationQueue.getAllMutationBatches(r).next(s=>(i=s,t.Ns(e),t.mutationQueue.getAllMutationBatches(r))).next(s=>{const o=[],a=[];let c=Dt();for(const l of i){o.push(l.batchId);for(const u of l.mutations)c=c.add(u.key)}for(const l of s){a.push(l.batchId);for(const u of l.mutations)c=c.add(u.key)}return t.localDocuments.getDocuments(r,c).next(l=>({Bs:l,removedBatchIds:o,addedBatchIds:a}))})})})).apply(this,arguments)}function K9(n){const e=Pe(n);return e.persistence.runTransaction("Get last remote snapshot version","readonly",t=>e.hi.getLastRemoteSnapshotVersion(t))}function wIe(n,e){const t=Pe(n);return t.persistence.runTransaction("Get next mutation batch","readonly",r=>(void 0===e&&(e=-1),t.mutationQueue.getNextMutationBatchAfterBatchId(r,e)))}function lf(n,e,t){return bP.apply(this,arguments)}function bP(){return(bP=O(function*(n,e,t){const r=Pe(n),i=r.Fs.get(e),s=t?"readwrite":"readwrite-primary";try{t||(yield r.persistence.runTransaction("Release target",s,o=>r.persistence.referenceDelegate.removeTarget(o,i)))}catch(o){if(!Ic(o))throw o;fe(vP,`Failed to update sequence numbers for target ${e}: ${o}`)}r.Fs=r.Fs.remove(e),r.Ms.delete(i.target)})).apply(this,arguments)}function Fb(n,e,t){const r=Pe(n);let i=Ze.min(),s=Dt();return r.persistence.runTransaction("Execute query","readwrite",o=>function(c,l,u){const d=Pe(c),h=d.Ms.get(u);return void 0!==h?$.resolve(d.Fs.get(h)):d.hi.getTargetData(l,u)}(r,o,mi(e)).next(a=>{if(a)return i=a.lastLimboFreeSnapshotVersion,r.hi.getMatchingKeysForTargetId(o,a.targetId).next(c=>{s=c})}).next(()=>r.Cs.getDocumentsMatchingQuery(o,e,t?i:Ze.min(),t?s:Dt())).next(a=>(function Q9(n,e,t){let r=n.xs.get(e)||Ze.min();t.forEach((i,s)=>{s.readTime.compareTo(r)>0&&(r=s.readTime)}),n.xs.set(e,r)}(r,function x$(n){return n.collectionGroup||(n.path.length%2==1?n.path.lastSegment():n.path.get(n.path.length-2))}(e),a),{documents:a,qs:s})))}class xP{constructor(){this.activeTargetIds=function q1(){return wwe}()}Gs(e){this.activeTargetIds=this.activeTargetIds.add(e)}zs(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Ws(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class sq{constructor(){this.Fo=new xP,this.Mo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,r){}addLocalQueryTarget(e,t=!0){return t&&this.Fo.Gs(e),this.Mo[e]||"not-current"}updateQueryState(e,t,r){this.Mo[e]=t}removeLocalQueryTarget(e){this.Fo.zs(e)}isLocalQueryTarget(e){return this.Fo.activeTargetIds.has(e)}clearQueryState(e){delete this.Mo[e]}getAllActiveQueryTargets(){return this.Fo.activeTargetIds}isActiveQueryTarget(e){return this.Fo.activeTargetIds.has(e)}start(){return this.Fo=new xP,Promise.resolve()}handleUserChange(e,t,r){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}class xIe{xo(e){}shutdown(){}}const oq="ConnectivityMonitor";class aq{constructor(){this.Oo=()=>this.No(),this.Bo=()=>this.Lo(),this.ko=[],this.qo()}xo(e){this.ko.push(e)}shutdown(){window.removeEventListener("online",this.Oo),window.removeEventListener("offline",this.Bo)}qo(){window.addEventListener("online",this.Oo),window.addEventListener("offline",this.Bo)}No(){fe(oq,"Network connectivity changed: AVAILABLE");for(const e of this.ko)e(0)}Lo(){fe(oq,"Network connectivity changed: UNAVAILABLE");for(const e of this.ko)e(1)}static C(){return typeof window<"u"&&void 0!==window.addEventListener&&void 0!==window.removeEventListener}}let Bb=null;function MP(){return null===Bb?Bb=268435456+Math.round(2147483648*Math.random()):Bb++,"0x"+Bb.toString(16)}const CP="RestConnection",AIe={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class MIe{get Qo(){return!1}constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId;const t=e.ssl?"https":"http",r=encodeURIComponent(this.databaseId.projectId),i=encodeURIComponent(this.databaseId.database);this.$o=t+"://"+e.host,this.Uo=`projects/${r}/databases/${i}`,this.Ko=this.databaseId.database===Wg?`project_id=${r}`:`project_id=${r}&database_id=${i}`}Wo(e,t,r,i,s){const o=MP(),a=this.Go(e,t.toUriEncodedString());fe(CP,`Sending RPC '${e}' ${o}:`,a,r);const c={"google-cloud-resource-prefix":this.Uo,"x-goog-request-params":this.Ko};this.zo(c,i,s);const{host:l}=new URL(a),u=Zl(l);return this.jo(e,a,c,r,u).then(d=>(fe(CP,`Received RPC '${e}' ${o}: `,d),d),d=>{throw Di(CP,`RPC '${e}' ${o} failed with error: `,d,"url: ",a,"request:",r),d})}Jo(e,t,r,i,s,o){return this.Wo(e,t,r,i,s)}zo(e,t,r){e["X-Goog-Api-Client"]="gl-js/ fire/"+Ph,e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),t&&t.headers.forEach((i,s)=>e[s]=i),r&&r.headers.forEach((i,s)=>e[s]=i)}Go(e,t){return`${this.$o}/v1/${t}:${AIe[e]}`}terminate(){}}class CIe{constructor(e){this.Ho=e.Ho,this.Yo=e.Yo}Zo(e){this.Xo=e}e_(e){this.t_=e}n_(e){this.r_=e}onMessage(e){this.i_=e}close(){this.Yo()}send(e){this.Ho(e)}s_(){this.Xo()}o_(){this.t_()}__(e){this.r_(e)}a_(e){this.i_(e)}}const _i="WebChannelConnection";class DIe extends MIe{constructor(e){super(e),this.u_=[],this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}jo(e,t,r,i,s){const o=MP();return new Promise((a,c)=>{const l=new c8;l.setWithCredentials(!0),l.listenOnce(l8.COMPLETE,()=>{try{switch(l.getLastErrorCode()){case Y0.NO_ERROR:const d=l.getResponseJson();fe(_i,`XHR for RPC '${e}' ${o} received:`,JSON.stringify(d)),a(d);break;case Y0.TIMEOUT:fe(_i,`RPC '${e}' ${o} timed out`),c(new ae(q.DEADLINE_EXCEEDED,"Request time out"));break;case Y0.HTTP_ERROR:const h=l.getStatus();if(fe(_i,`RPC '${e}' ${o} failed with status:`,h,"response text:",l.getResponseText()),h>0){let f=l.getResponseJson();Array.isArray(f)&&(f=f[0]);const m=f?.error;if(m&&m.status&&m.message){const y=function(g){const b=g.toLowerCase().replace(/_/g,"-");return Object.values(q).indexOf(b)>=0?b:q.UNKNOWN}(m.status);c(new ae(y,m.message))}else c(new ae(q.UNKNOWN,"Server responded with status "+l.getStatus()))}else c(new ae(q.UNAVAILABLE,"Connection failed."));break;default:Be(9055,{c_:e,streamId:o,l_:l.getLastErrorCode(),h_:l.getLastError()})}}finally{fe(_i,`RPC '${e}' ${o} completed.`)}});const u=JSON.stringify(i);fe(_i,`RPC '${e}' ${o} sending request:`,i),l.send(t,"POST",u,r,15)})}P_(e,t,r){const i=MP(),s=[this.$o,"/","google.firestore.v1.Firestore","/",e,"/channel"],o=h8(),a=d8(),c={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},l=this.longPollingOptions.timeoutSeconds;void 0!==l&&(c.longPollingTimeout=Math.round(1e3*l)),this.useFetchStreams&&(c.useFetchStreams=!0),this.zo(c.initMessageHeaders,t,r),c.encodeInitMessageHeaders=!0;const u=s.join("");fe(_i,`Creating RPC '${e}' stream ${i}: ${u}`,c);const d=o.createWebChannel(u,c);this.T_(d);let h=!1,f=!1;const m=new CIe({Ho:_=>{f?fe(_i,`Not sending because RPC '${e}' stream ${i} is closed:`,_):(h||(fe(_i,`Opening RPC '${e}' stream ${i} transport.`),d.open(),h=!0),fe(_i,`RPC '${e}' stream ${i} sending:`,_),d.send(_))},Yo:()=>d.close()}),y=(_,g,b)=>{_.listen(g,E=>{try{b(E)}catch(x){setTimeout(()=>{throw x},0)}})};return y(d,Pg.EventType.OPEN,()=>{f||(fe(_i,`RPC '${e}' stream ${i} transport opened.`),m.s_())}),y(d,Pg.EventType.CLOSE,()=>{f||(f=!0,fe(_i,`RPC '${e}' stream ${i} transport closed`),m.__(),this.I_(d))}),y(d,Pg.EventType.ERROR,_=>{f||(f=!0,Di(_i,`RPC '${e}' stream ${i} transport errored. Name:`,_.name,"Message:",_.message),m.__(new ae(q.UNAVAILABLE,"The operation could not be completed")))}),y(d,Pg.EventType.MESSAGE,_=>{var g;if(!f){const b=_.data[0];$e(!!b,16349);const E=b,x=E?.error||(null===(g=E[0])||void 0===g?void 0:g.error);if(x){fe(_i,`RPC '${e}' stream ${i} received error:`,x);const M=x.status;let C=function(T){const S=xr[T];if(void 0!==S)return j$(S)}(M),w=x.message;void 0===C&&(C=q.INTERNAL,w="Unknown error status: "+M+" with message "+x.message),f=!0,m.__(new ae(C,w)),d.close()}else fe(_i,`RPC '${e}' stream ${i} received:`,b),m.a_(b)}}),y(a,u8.STAT_EVENT,_=>{_.stat===_1.PROXY?fe(_i,`RPC '${e}' stream ${i} detected buffering proxy`):_.stat===_1.NOPROXY&&fe(_i,`RPC '${e}' stream ${i} detected no buffering proxy`)}),setTimeout(()=>{m.o_()},0),m}terminate(){this.u_.forEach(e=>e.close()),this.u_=[]}T_(e){this.u_.push(e)}I_(e){this.u_=this.u_.filter(t=>t===e)}}function Hb(){return typeof document<"u"?document:null}function Iu(n){return new Lwe(n,!0)}class DP{constructor(e,t,r=1e3,i=1.5,s=6e4){this.Fi=e,this.timerId=t,this.d_=r,this.E_=i,this.A_=s,this.R_=0,this.V_=null,this.m_=Date.now(),this.reset()}reset(){this.R_=0}f_(){this.R_=this.A_}g_(e){this.cancel();const t=Math.floor(this.R_+this.p_()),r=Math.max(0,Date.now()-this.m_),i=Math.max(0,t-r);i>0&&fe("ExponentialBackoff",`Backing off for ${i} ms (base delay: ${this.R_} ms, delay with jitter: ${t} ms, last attempt: ${r} ms ago)`),this.V_=this.Fi.enqueueAfterDelay(this.timerId,i,()=>(this.m_=Date.now(),e())),this.R_*=this.E_,this.R_<this.d_&&(this.R_=this.d_),this.R_>this.A_&&(this.R_=this.A_)}y_(){null!==this.V_&&(this.V_.skipDelay(),this.V_=null)}cancel(){null!==this.V_&&(this.V_.cancel(),this.V_=null)}p_(){return(Math.random()-.5)*this.R_}}const lq="PersistentStream";class uq{constructor(e,t,r,i,s,o,a,c){this.Fi=e,this.w_=r,this.S_=i,this.connection=s,this.authCredentialsProvider=o,this.appCheckCredentialsProvider=a,this.listener=c,this.state=0,this.b_=0,this.D_=null,this.v_=null,this.stream=null,this.C_=0,this.F_=new DP(e,t)}M_(){return 1===this.state||5===this.state||this.x_()}x_(){return 2===this.state||3===this.state}start(){this.C_=0,4!==this.state?this.auth():this.O_()}stop(){var e=this;return O(function*(){e.M_()&&(yield e.close(0))})()}N_(){this.state=0,this.F_.reset()}B_(){this.x_()&&null===this.D_&&(this.D_=this.Fi.enqueueAfterDelay(this.w_,6e4,()=>this.L_()))}k_(e){this.q_(),this.stream.send(e)}L_(){var e=this;return O(function*(){if(e.x_())return e.close(0)})()}q_(){this.D_&&(this.D_.cancel(),this.D_=null)}Q_(){this.v_&&(this.v_.cancel(),this.v_=null)}close(e,t){var r=this;return O(function*(){r.q_(),r.Q_(),r.F_.cancel(),r.b_++,4!==e?r.F_.reset():t&&t.code===q.RESOURCE_EXHAUSTED?(fr(t.toString()),fr("Using maximum backoff delay to prevent overloading the backend."),r.F_.f_()):t&&t.code===q.UNAUTHENTICATED&&3!==r.state&&(r.authCredentialsProvider.invalidateToken(),r.appCheckCredentialsProvider.invalidateToken()),null!==r.stream&&(r.U_(),r.stream.close(),r.stream=null),r.state=e,yield r.listener.n_(t)})()}U_(){}auth(){this.state=1;const e=this.K_(this.b_),t=this.b_;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([r,i])=>{this.b_===t&&this.W_(r,i)},r=>{e(()=>{const i=new ae(q.UNKNOWN,"Fetching auth token failed: "+r.message);return this.G_(i)})})}W_(e,t){const r=this.K_(this.b_);this.stream=this.z_(e,t),this.stream.Zo(()=>{r(()=>this.listener.Zo())}),this.stream.e_(()=>{r(()=>(this.state=2,this.v_=this.Fi.enqueueAfterDelay(this.S_,1e4,()=>(this.x_()&&(this.state=3),Promise.resolve())),this.listener.e_()))}),this.stream.n_(i=>{r(()=>this.G_(i))}),this.stream.onMessage(i=>{r(()=>1==++this.C_?this.j_(i):this.onNext(i))})}O_(){var e=this;this.state=5,this.F_.g_(O(function*(){e.state=0,e.start()}))}G_(e){return fe(lq,`close with error: ${e}`),this.stream=null,this.close(4,e)}K_(e){return t=>{this.Fi.enqueueAndForget(()=>this.b_===e?t():(fe(lq,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class RIe extends uq{constructor(e,t,r,i,s,o){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,r,i,o),this.serializer=s}z_(e,t){return this.connection.P_("Listen",e,t)}j_(e){return this.onNext(e)}onNext(e){this.F_.reset();const t=function Uwe(n,e){let t;if("targetChange"in e){const r="NO_CHANGE"===(l=e.targetChange.targetChangeType||"NO_CHANGE")?0:"ADD"===l?1:"REMOVE"===l?2:"CURRENT"===l?3:"RESET"===l?4:Be(39313,{state:l}),i=e.targetChange.targetIds||[],s=function(l,u){return l.useProto3Json?($e(void 0===u||"string"==typeof u,58123),ir.fromBase64String(u||"")):($e(void 0===u||u instanceof Buffer||u instanceof Uint8Array,16193),ir.fromUint8Array(u||new Uint8Array))}(n,e.targetChange.resumeToken),o=e.targetChange.cause,a=o&&function(l){const u=void 0===l.code?q.UNKNOWN:j$(l.code);return new ae(u,l.message||"")}(o);t=new K$(r,i,s,a||null)}else if("documentChange"in e){const r=e.documentChange,i=xo(n,r.document.name),s=pr(r.document.updateTime),o=r.document.createTime?pr(r.document.createTime):Ze.min(),a=new ni({mapValue:{fields:r.document.fields}}),c=Nn.newFoundDocument(i,s,o,a);t=new bb(r.targetIds||[],r.removedTargetIds||[],c.key,c)}else if("documentDelete"in e){const r=e.documentDelete,i=xo(n,r.document),s=r.readTime?pr(r.readTime):Ze.min(),o=Nn.newNoDocument(i,s);t=new bb([],r.removedTargetIds||[],o.key,o)}else if("documentRemove"in e){const r=e.documentRemove,i=xo(n,r.document);t=new bb([],r.removedTargetIds||[],i,null)}else{if(!("filter"in e))return Be(11601,{At:e});{const r=e.filter,{count:i=0,unchangedNames:s}=r,o=new Dwe(i,s);t=new X$(r.targetId,o)}}var l;return t}(this.serializer,e),r=function(s){if(!("targetChange"in s))return Ze.min();const o=s.targetChange;return o.targetIds&&o.targetIds.length?Ze.min():o.readTime?pr(o.readTime):Ze.min()}(e);return this.listener.J_(t,r)}H_(e){const t={};t.database=rP(this.serializer),t.addTarget=function(s,o){let a;const c=o.target;if(a=pb(c)?{documents:i9(s,c)}:{query:Ib(s,c).Vt},a.targetId=o.targetId,o.resumeToken.approximateByteSize()>0){a.resumeToken=Z$(s,o.resumeToken);const l=eP(s,o.expectedCount);null!==l&&(a.expectedCount=l)}else if(o.snapshotVersion.compareTo(Ze.min())>0){a.readTime=ef(s,o.snapshotVersion.toTimestamp());const l=eP(s,o.expectedCount);null!==l&&(a.expectedCount=l)}return a}(this.serializer,e);const r=function Hwe(n,e){const t=function(i){switch(i){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return Be(28987,{purpose:i})}}(e.purpose);return null==t?null:{"goog-listen-tags":t}}(0,e);r&&(t.labels=r),this.k_(t)}Y_(e){const t={};t.database=rP(this.serializer),t.removeTarget=e,this.k_(t)}}class PIe extends uq{constructor(e,t,r,i,s,o){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,r,i,o),this.serializer=s}get Z_(){return this.C_>0}start(){this.lastStreamToken=void 0,super.start()}U_(){this.Z_&&this.X_([])}z_(e,t){return this.connection.P_("Write",e,t)}j_(e){return $e(!!e.streamToken,31322),this.lastStreamToken=e.streamToken,$e(!e.writeResults||0===e.writeResults.length,55816),this.listener.ea()}onNext(e){$e(!!e.streamToken,12678),this.lastStreamToken=e.streamToken,this.F_.reset();const t=function Bwe(n,e){return n&&n.length>0?($e(void 0!==e,14353),n.map(t=>function(i,s){let o=pr(i.updateTime?i.updateTime:s);return o.isEqual(Ze.min())&&(o=pr(s)),new Awe(o,i.transformResults||[])}(t,e))):[]}(e.writeResults,e.commitTime),r=pr(e.commitTime);return this.listener.ta(r,t)}na(){const e={};e.database=rP(this.serializer),this.k_(e)}X_(e){const t={streamToken:this.lastStreamToken,writes:e.map(r=>function o_(n,e){let t;if(e instanceof Zh)t={update:r9(n,e.key,e.value)};else if(e instanceof Qh)t={delete:s_(n,e.key)};else if(e instanceof va)t={update:r9(n,e.key,e.data),updateMask:jwe(e.fieldMask)};else{if(!(e instanceof K1))return Be(16599,{Rt:e.type});t={verify:s_(n,e.key)}}return e.fieldTransforms.length>0&&(t.updateTransforms=e.fieldTransforms.map(r=>function(s,o){const a=o.transform;if(a instanceof Yh)return{fieldPath:o.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(a instanceof mu)return{fieldPath:o.field.canonicalString(),appendMissingElements:{values:a.elements}};if(a instanceof gu)return{fieldPath:o.field.canonicalString(),removeAllFromArray:{values:a.elements}};if(a instanceof Jh)return{fieldPath:o.field.canonicalString(),increment:a.Ee};throw Be(20930,{transform:o.transform})}(0,r))),e.precondition.isNone||(t.currentDocument=void 0!==(s=e.precondition).updateTime?{updateTime:Fwe(n,s.updateTime)}:void 0!==s.exists?{exists:s.exists}:Be(27497)),t;var s}(this.serializer,r))};this.k_(t)}}class NIe{}class OIe extends NIe{constructor(e,t,r,i){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=r,this.serializer=i,this.ra=!1}ia(){if(this.ra)throw new ae(q.FAILED_PRECONDITION,"The client has already been terminated.")}Wo(e,t,r,i){return this.ia(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([s,o])=>this.connection.Wo(e,nP(t,r),i,s,o)).catch(s=>{throw"FirebaseError"===s.name?(s.code===q.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),s):new ae(q.UNKNOWN,s.toString())})}Jo(e,t,r,i,s){return this.ia(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([o,a])=>this.connection.Jo(e,nP(t,r),i,o,a,s)).catch(o=>{throw"FirebaseError"===o.name?(o.code===q.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),o):new ae(q.UNKNOWN,o.toString())})}terminate(){this.ra=!0,this.connection.terminate()}}class kIe{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.sa=0,this.oa=null,this._a=!0}aa(){0===this.sa&&(this.ua("Unknown"),this.oa=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this.oa=null,this.ca("Backend didn't respond within 10 seconds."),this.ua("Offline"),Promise.resolve())))}la(e){"Online"===this.state?this.ua("Unknown"):(this.sa++,this.sa>=1&&(this.ha(),this.ca(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.ua("Offline")))}set(e){this.ha(),this.sa=0,"Online"===e&&(this._a=!1),this.ua(e)}ua(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}ca(e){const t=`Could not reach Cloud Firestore backend. ${e}\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this._a?(fr(t),this._a=!1):fe("OnlineStateTracker",t)}ha(){null!==this.oa&&(this.oa.cancel(),this.oa=null)}}const Su="RemoteStore";class LIe{constructor(e,t,r,i,s){var o=this;this.localStore=e,this.datastore=t,this.asyncQueue=r,this.remoteSyncer={},this.Pa=[],this.Ta=new Map,this.Ia=new Set,this.da=[],this.Ea=s,this.Ea.xo(a=>{r.enqueueAndForget(O(function*(){var c;Lc(o)&&(fe(Su,"Restarting streams for network reachability change."),yield(c=O(function*(u){const d=Pe(u);d.Ia.add(4),yield uf(d),d.Aa.set("Unknown"),d.Ia.delete(4),yield p_(d)}),function l(u){return c.apply(this,arguments)})(o))}))}),this.Aa=new kIe(r,i)}}function p_(n){return RP.apply(this,arguments)}function RP(){return(RP=O(function*(n){if(Lc(n))for(const e of n.da)yield e(!0)})).apply(this,arguments)}function uf(n){return PP.apply(this,arguments)}function PP(){return(PP=O(function*(n){for(const e of n.da)yield e(!1)})).apply(this,arguments)}function zb(n,e){const t=Pe(n);t.Ta.has(e.targetId)||(t.Ta.set(e.targetId,e),kP(t)?OP(t):ff(t).x_()&&NP(t,e))}function df(n,e){const t=Pe(n),r=ff(t);t.Ta.delete(e),r.x_()&&dq(t,e),0===t.Ta.size&&(r.x_()?r.B_():Lc(t)&&t.Aa.set("Unknown"))}function NP(n,e){if(n.Ra.$e(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(Ze.min())>0){const t=n.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(t)}ff(n).H_(e)}function dq(n,e){n.Ra.$e(e),ff(n).Y_(e)}function OP(n){n.Ra=new Pwe({getRemoteKeysForTarget:e=>n.remoteSyncer.getRemoteKeysForTarget(e),Et:e=>n.Ta.get(e)||null,lt:()=>n.datastore.serializer.databaseId}),ff(n).start(),n.Aa.aa()}function kP(n){return Lc(n)&&!ff(n).M_()&&n.Ta.size>0}function Lc(n){return 0===Pe(n).Ia.size}function hq(n){n.Ra=void 0}function FIe(n){return LP.apply(this,arguments)}function LP(){return(LP=O(function*(n){n.Aa.set("Online")})).apply(this,arguments)}function VIe(n){return FP.apply(this,arguments)}function FP(){return(FP=O(function*(n){n.Ta.forEach((e,t)=>{NP(n,e)})})).apply(this,arguments)}function UIe(n,e){return VP.apply(this,arguments)}function VP(){return(VP=O(function*(n,e){hq(n),kP(n)?(n.Aa.la(e),OP(n)):n.Aa.set("Unknown")})).apply(this,arguments)}function BIe(n,e,t){return UP.apply(this,arguments)}function UP(){return UP=O(function*(n,e,t){if(n.Aa.set("Online"),e instanceof K$&&2===e.state&&e.cause)try{yield(r=O(function*(s,o){const a=o.cause;for(const c of o.targetIds)s.Ta.has(c)&&(yield s.remoteSyncer.rejectListen(c,a),s.Ta.delete(c),s.Ra.removeTarget(c))}),function i(s,o){return r.apply(this,arguments)})(n,e)}catch(r){fe(Su,"Failed to remove targets %s: %s ",e.targetIds.join(","),r),yield Gb(n,r)}else if(e instanceof bb?n.Ra.Ye(e):e instanceof X$?n.Ra.it(e):n.Ra.et(e),!t.isEqual(Ze.min()))try{const r=yield K9(n.localStore);t.compareTo(r)>=0&&(yield function(s,o){const a=s.Ra.Pt(o);return a.targetChanges.forEach((c,l)=>{if(c.resumeToken.approximateByteSize()>0){const u=s.Ta.get(l);u&&s.Ta.set(l,u.withResumeToken(c.resumeToken,o))}}),a.targetMismatches.forEach((c,l)=>{const u=s.Ta.get(c);if(!u)return;s.Ta.set(c,u.withResumeToken(ir.EMPTY_BYTE_STRING,u.snapshotVersion)),dq(s,c);const d=new Ea(u.target,c,l,u.sequenceNumber);NP(s,d)}),s.remoteSyncer.applyRemoteEvent(a)}(n,t))}catch(r){fe(Su,"Failed to raise snapshot:",r),yield Gb(n,r)}var r}),UP.apply(this,arguments)}function Gb(n,e,t){return BP.apply(this,arguments)}function BP(){return(BP=O(function*(n,e,t){if(!Ic(e))throw e;n.Ia.add(1),yield uf(n),n.Aa.set("Offline"),t||(t=()=>K9(n.localStore)),n.asyncQueue.enqueueRetryable(O(function*(){fe(Su,"Retrying IndexedDB access"),yield t(),n.Ia.delete(1),yield p_(n)}))})).apply(this,arguments)}function fq(n,e){return e().catch(t=>Gb(n,t,e))}function hf(n){return HP.apply(this,arguments)}function HP(){return(HP=O(function*(n){const e=Pe(n),t=Fc(e);let r=e.Pa.length>0?e.Pa[e.Pa.length-1].batchId:-1;for(;HIe(e);)try{const i=yield wIe(e.localStore,r);if(null===i){0===e.Pa.length&&t.B_();break}r=i.batchId,zIe(e,i)}catch(i){yield Gb(e,i)}pq(e)&&mq(e)})).apply(this,arguments)}function HIe(n){return Lc(n)&&n.Pa.length<10}function zIe(n,e){n.Pa.push(e);const t=Fc(n);t.x_()&&t.Z_&&t.X_(e.mutations)}function pq(n){return Lc(n)&&!Fc(n).M_()&&n.Pa.length>0}function mq(n){Fc(n).start()}function GIe(n){return zP.apply(this,arguments)}function zP(){return(zP=O(function*(n){Fc(n).na()})).apply(this,arguments)}function WIe(n){return GP.apply(this,arguments)}function GP(){return(GP=O(function*(n){const e=Fc(n);for(const t of n.Pa)e.X_(t.mutations)})).apply(this,arguments)}function jIe(n,e,t){return WP.apply(this,arguments)}function WP(){return(WP=O(function*(n,e,t){const r=n.Pa.shift(),i=J1.from(r,e,t);yield fq(n,()=>n.remoteSyncer.applySuccessfulWrite(i)),yield hf(n)})).apply(this,arguments)}function $Ie(n,e){return jP.apply(this,arguments)}function jP(){return jP=O(function*(n,e){var t;e&&Fc(n).Z_&&(yield(t=O(function*(i,s){if(function W$(n){switch(n){case q.OK:return Be(64938);case q.CANCELLED:case q.UNKNOWN:case q.DEADLINE_EXCEEDED:case q.RESOURCE_EXHAUSTED:case q.INTERNAL:case q.UNAVAILABLE:case q.UNAUTHENTICATED:return!1;case q.INVALID_ARGUMENT:case q.NOT_FOUND:case q.ALREADY_EXISTS:case q.PERMISSION_DENIED:case q.FAILED_PRECONDITION:case q.ABORTED:case q.OUT_OF_RANGE:case q.UNIMPLEMENTED:case q.DATA_LOSS:return!0;default:return Be(15467,{code:n})}}(a=s.code)&&a!==q.ABORTED){const o=i.Pa.shift();Fc(i).N_(),yield fq(i,()=>i.remoteSyncer.rejectFailedWrite(o.batchId,s)),yield hf(i)}var a}),function r(i,s){return t.apply(this,arguments)})(n,e)),pq(n)&&mq(n)}),jP.apply(this,arguments)}function gq(n,e){return $P.apply(this,arguments)}function $P(){return($P=O(function*(n,e){const t=Pe(n);t.asyncQueue.verifyOperationInProgress(),fe(Su,"RemoteStore received new credentials");const r=Lc(t);t.Ia.add(3),yield uf(t),r&&t.Aa.set("Unknown"),yield t.remoteSyncer.handleCredentialChange(e),t.Ia.delete(3),yield p_(t)})).apply(this,arguments)}function XP(){return(XP=O(function*(n,e){const t=Pe(n);e?(t.Ia.delete(2),yield p_(t)):e||(t.Ia.add(2),yield uf(t),t.Aa.set("Unknown"))})).apply(this,arguments)}function ff(n){return n.Va||(n.Va=function(t,r,i){const s=Pe(t);return s.ia(),new RIe(r,s.connection,s.authCredentials,s.appCheckCredentials,s.serializer,i)}(n.datastore,n.asyncQueue,{Zo:FIe.bind(null,n),e_:VIe.bind(null,n),n_:UIe.bind(null,n),J_:BIe.bind(null,n)}),n.da.push(function(){var e=O(function*(t){t?(n.Va.N_(),kP(n)?OP(n):n.Aa.set("Unknown")):(yield n.Va.stop(),hq(n))});return function(t){return e.apply(this,arguments)}}())),n.Va}function Fc(n){return n.ma||(n.ma=function(t,r,i){const s=Pe(t);return s.ia(),new PIe(r,s.connection,s.authCredentials,s.appCheckCredentials,s.serializer,i)}(n.datastore,n.asyncQueue,{Zo:()=>Promise.resolve(),e_:GIe.bind(null,n),n_:$Ie.bind(null,n),ea:WIe.bind(null,n),ta:jIe.bind(null,n)}),n.da.push(function(){var e=O(function*(t){t?(n.ma.N_(),yield hf(n)):(yield n.ma.stop(),n.Pa.length>0&&(fe(Su,`Stopping write stream with ${n.Pa.length} pending writes`),n.Pa=[]))});return function(t){return e.apply(this,arguments)}}())),n.ma}class KP{constructor(e,t,r,i,s){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=r,this.op=i,this.removalCallback=s,this.deferred=new zr,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(o=>{})}get promise(){return this.deferred.promise}static createAndSchedule(e,t,r,i,s){const o=Date.now()+r,a=new KP(e,t,o,i,s);return a.start(r),a}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new ae(q.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>null!==this.timerHandle?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function pf(n,e){if(fr("AsyncQueue",`${e}: ${n}`),Ic(n))return new ae(q.UNAVAILABLE,`${e}: ${n}`);throw n}class xu{static emptySet(e){return new xu(e.comparator)}constructor(e){this.comparator=e?(t,r)=>e(t,r)||Re.comparator(t.key,r.key):(t,r)=>Re.comparator(t.key,r.key),this.keyedMap=Zg(),this.sortedSet=new Sn(this.comparator)}has(e){return null!=this.keyedMap.get(e)}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((t,r)=>(e(t),!1))}add(e){const t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){const t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof xu)||this.size!==e.size)return!1;const t=this.sortedSet.getIterator(),r=e.sortedSet.getIterator();for(;t.hasNext();){const i=t.getNext().key,s=r.getNext().key;if(!i.isEqual(s))return!1}return!0}toString(){const e=[];return this.forEach(t=>{e.push(t.toString())}),0===e.length?"DocumentSet ()":"DocumentSet (\n  "+e.join("  \n")+"\n)"}copy(e,t){const r=new xu;return r.comparator=this.comparator,r.keyedMap=e,r.sortedSet=t,r}}class _q{constructor(){this.fa=new Sn(Re.comparator)}track(e){const t=e.doc.key,r=this.fa.get(t);r?0!==e.type&&3===r.type?this.fa=this.fa.insert(t,e):3===e.type&&1!==r.type?this.fa=this.fa.insert(t,{type:r.type,doc:e.doc}):2===e.type&&2===r.type?this.fa=this.fa.insert(t,{type:2,doc:e.doc}):2===e.type&&0===r.type?this.fa=this.fa.insert(t,{type:0,doc:e.doc}):1===e.type&&0===r.type?this.fa=this.fa.remove(t):1===e.type&&2===r.type?this.fa=this.fa.insert(t,{type:1,doc:r.doc}):0===e.type&&1===r.type?this.fa=this.fa.insert(t,{type:2,doc:e.doc}):Be(63341,{At:e,ga:r}):this.fa=this.fa.insert(t,e)}pa(){const e=[];return this.fa.inorderTraversal((t,r)=>{e.push(r)}),e}}class Au{constructor(e,t,r,i,s,o,a,c,l){this.query=e,this.docs=t,this.oldDocs=r,this.docChanges=i,this.mutatedKeys=s,this.fromCache=o,this.syncStateChanged=a,this.excludesMetadataChanges=c,this.hasCachedResults=l}static fromInitialDocuments(e,t,r,i,s){const o=[];return t.forEach(a=>{o.push({type:0,doc:a})}),new Au(e,t,xu.emptySet(t),o,r,i,!0,!1,s)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&Yg(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const t=this.docChanges,r=e.docChanges;if(t.length!==r.length)return!1;for(let i=0;i<t.length;i++)if(t[i].type!==r[i].type||!t[i].doc.isEqual(r[i].doc))return!1;return!0}}class qIe{constructor(){this.ya=void 0,this.wa=[]}Sa(){return this.wa.some(e=>e.ba())}}class XIe{constructor(){this.queries=yq(),this.onlineState="Unknown",this.Da=new Set}terminate(){!function(t,r){const i=Pe(t),s=i.queries;i.queries=yq(),s.forEach((o,a)=>{for(const c of a.wa)c.onError(r)})}(this,new ae(q.ABORTED,"Firestore shutting down"))}}function yq(){return new ya(n=>S$(n),Yg)}function JP(){return(JP=O(function*(n,e){const t=Pe(n);let r=3;const i=e.query;let s=t.queries.get(i);s?!s.Sa()&&e.ba()&&(r=2):(s=new qIe,r=e.ba()?0:1);try{switch(r){case 0:s.ya=yield t.onListen(i,!0);break;case 1:s.ya=yield t.onListen(i,!1);break;case 2:yield t.onFirstRemoteStoreListen(i)}}catch(o){const a=pf(o,`Initialization of query '${Kh(e.query)}' failed`);return void e.onError(a)}t.queries.set(i,s),s.wa.push(e),e.va(t.onlineState),s.ya&&e.Ca(s.ya)&&eN(t)})).apply(this,arguments)}function QP(){return(QP=O(function*(n,e){const t=Pe(n),r=e.query;let i=3;const s=t.queries.get(r);if(s){const o=s.wa.indexOf(e);o>=0&&(s.wa.splice(o,1),0===s.wa.length?i=e.ba()?0:1:!s.Sa()&&e.ba()&&(i=2))}switch(i){case 0:return t.queries.delete(r),t.onUnlisten(r,!0);case 1:return t.queries.delete(r),t.onUnlisten(r,!1);case 2:return t.onLastRemoteStoreUnlisten(r);default:return}})).apply(this,arguments)}function KIe(n,e){const t=Pe(n);let r=!1;for(const i of e){const o=t.queries.get(i.query);if(o){for(const a of o.wa)a.Ca(i)&&(r=!0);o.ya=i}}r&&eN(t)}function YIe(n,e,t){const r=Pe(n),i=r.queries.get(e);if(i)for(const s of i.wa)s.onError(t);r.queries.delete(e)}function eN(n){n.Da.forEach(e=>{e.next()})}var tN,vq;(vq=tN||(tN={})).Fa="default",vq.Cache="cache";class nN{constructor(e,t,r){this.query=e,this.Ma=t,this.xa=!1,this.Oa=null,this.onlineState="Unknown",this.options=r||{}}Ca(e){if(!this.options.includeMetadataChanges){const r=[];for(const i of e.docChanges)3!==i.type&&r.push(i);e=new Au(e.query,e.docs,e.oldDocs,r,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.xa?this.Na(e)&&(this.Ma.next(e),t=!0):this.Ba(e,this.onlineState)&&(this.La(e),t=!0),this.Oa=e,t}onError(e){this.Ma.error(e)}va(e){this.onlineState=e;let t=!1;return this.Oa&&!this.xa&&this.Ba(this.Oa,e)&&(this.La(this.Oa),t=!0),t}Ba(e,t){return!e.fromCache||!this.ba()||(!this.options.ka||!("Offline"!==t))&&(!e.docs.isEmpty()||e.hasCachedResults||"Offline"===t)}Na(e){return e.docChanges.length>0||!!(e.syncStateChanged||this.Oa&&this.Oa.hasPendingWrites!==e.hasPendingWrites)&&!0===this.options.includeMetadataChanges}La(e){e=Au.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.xa=!0,this.Ma.next(e)}ba(){return this.options.source!==tN.Cache}}class wq{constructor(e){this.key=e}}class Iq{constructor(e){this.key=e}}class Sq{constructor(e,t){this.query=e,this.Ha=t,this.Ya=null,this.hasCachedResults=!1,this.current=!1,this.Za=Dt(),this.mutatedKeys=Dt(),this.Xa=A$(e),this.eu=new xu(this.Xa)}get tu(){return this.Ha}nu(e,t){const r=t?t.ru:new _q,i=t?t.eu:this.eu;let s=t?t.mutatedKeys:this.mutatedKeys,o=i,a=!1;const c="F"===this.query.limitType&&i.size===this.query.limit?i.last():null,l="L"===this.query.limitType&&i.size===this.query.limit?i.first():null;if(e.inorderTraversal((u,d)=>{const h=i.get(u),f=Jg(this.query,d)?d:null,m=!!h&&this.mutatedKeys.has(h.key),y=!!f&&(f.hasLocalMutations||this.mutatedKeys.has(f.key)&&f.hasCommittedMutations);let _=!1;h&&f?h.data.isEqual(f.data)?m!==y&&(r.track({type:3,doc:f}),_=!0):this.iu(h,f)||(r.track({type:2,doc:f}),_=!0,(c&&this.Xa(f,c)>0||l&&this.Xa(f,l)<0)&&(a=!0)):!h&&f?(r.track({type:0,doc:f}),_=!0):h&&!f&&(r.track({type:1,doc:h}),_=!0,(c||l)&&(a=!0)),_&&(f?(o=o.add(f),s=y?s.add(u):s.delete(u)):(o=o.delete(u),s=s.delete(u)))}),null!==this.query.limit)for(;o.size>this.query.limit;){const u="F"===this.query.limitType?o.last():o.first();o=o.delete(u.key),s=s.delete(u.key),r.track({type:1,doc:u})}return{eu:o,ru:r,Ds:a,mutatedKeys:s}}iu(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,r,i){const s=this.eu;this.eu=e.eu,this.mutatedKeys=e.mutatedKeys;const o=e.ru.pa();o.sort((u,d)=>function(f,m){const y=_=>{switch(_){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return Be(20277,{At:_})}};return y(f)-y(m)}(u.type,d.type)||this.Xa(u.doc,d.doc)),this.su(r),i=null!=i&&i;const a=t&&!i?this.ou():[],c=0===this.Za.size&&this.current&&!i?1:0,l=c!==this.Ya;return this.Ya=c,0!==o.length||l?{snapshot:new Au(this.query,e.eu,s,o,e.mutatedKeys,0===c,l,!1,!!r&&r.resumeToken.approximateByteSize()>0),_u:a}:{_u:a}}va(e){return this.current&&"Offline"===e?(this.current=!1,this.applyChanges({eu:this.eu,ru:new _q,mutatedKeys:this.mutatedKeys,Ds:!1},!1)):{_u:[]}}au(e){return!this.Ha.has(e)&&!!this.eu.has(e)&&!this.eu.get(e).hasLocalMutations}su(e){e&&(e.addedDocuments.forEach(t=>this.Ha=this.Ha.add(t)),e.modifiedDocuments.forEach(t=>{}),e.removedDocuments.forEach(t=>this.Ha=this.Ha.delete(t)),this.current=e.current)}ou(){if(!this.current)return[];const e=this.Za;this.Za=Dt(),this.eu.forEach(r=>{this.au(r.key)&&(this.Za=this.Za.add(r.key))});const t=[];return e.forEach(r=>{this.Za.has(r)||t.push(new Iq(r))}),this.Za.forEach(r=>{e.has(r)||t.push(new wq(r))}),t}uu(e){this.Ha=e.qs,this.Za=Dt();const t=this.nu(e.documents);return this.applyChanges(t,!0)}cu(){return Au.fromInitialDocuments(this.query,this.eu,this.mutatedKeys,0===this.Ya,this.hasCachedResults)}}const Vc="SyncEngine";class JIe{constructor(e,t,r){this.query=e,this.targetId=t,this.view=r}}class ZIe{constructor(e){this.key=e,this.lu=!1}}class QIe{constructor(e,t,r,i,s,o){this.localStore=e,this.remoteStore=t,this.eventManager=r,this.sharedClientState=i,this.currentUser=s,this.maxConcurrentLimboResolutions=o,this.hu={},this.Pu=new ya(a=>S$(a),Yg),this.Tu=new Map,this.Iu=new Set,this.du=new Sn(Re.comparator),this.Eu=new Map,this.Au=new dP,this.Ru={},this.Vu=new Map,this.mu=Tu.ur(),this.onlineState="Unknown",this.fu=void 0}get isPrimaryClient(){return!0===this.fu}}function eSe(n,e){return iN.apply(this,arguments)}function iN(){return(iN=O(function*(n,e,t=!0){const r=Wb(n);let i;const s=r.Pu.get(e);return s?(r.sharedClientState.addLocalQueryTarget(s.targetId),i=s.view.cu()):i=yield xq(r,e,t,!0),i})).apply(this,arguments)}function tSe(n,e){return sN.apply(this,arguments)}function sN(){return(sN=O(function*(n,e){const t=Wb(n);yield xq(t,e,!0,!1)})).apply(this,arguments)}function xq(n,e,t,r){return oN.apply(this,arguments)}function oN(){return(oN=O(function*(n,e,t,r){const i=yield function cf(n,e){const t=Pe(n);return t.persistence.runTransaction("Allocate target","readwrite",r=>{let i;return t.hi.getTargetData(r,e).next(s=>s?(i=s,$.resolve(i)):t.hi.allocateTargetId(r).next(o=>(i=new Ea(e,o,"TargetPurposeListen",r.currentSequenceNumber),t.hi.addTargetData(r,i).next(()=>i))))}).then(r=>{const i=t.Fs.get(r.targetId);return(null===i||r.snapshotVersion.compareTo(i.snapshotVersion)>0)&&(t.Fs=t.Fs.insert(r.targetId,r),t.Ms.set(e,r.targetId)),r})}(n.localStore,mi(e)),s=i.targetId,o=n.sharedClientState.addLocalQueryTarget(s,t);let a;return r&&(a=yield function aN(n,e,t,r,i){return cN.apply(this,arguments)}(n,e,s,"current"===o,i.resumeToken)),n.isPrimaryClient&&t&&zb(n.remoteStore,i),a})).apply(this,arguments)}function cN(){return cN=O(function*(n,e,t,r,i){n.gu=(d,h,f)=>{return(m=O(function*(_,g,b,E){let x=g.view.nu(b);x.Ds&&(x=yield Fb(_.localStore,g.query,!1).then(({documents:A})=>g.view.nu(A,x)));const M=E&&E.targetChanges.get(g.targetId),C=E&&null!=E.targetMismatches.get(g.targetId),w=g.view.applyChanges(x,_.isPrimaryClient,M,C);return vN(_,g.targetId,w._u),w.snapshot}),function y(_,g,b,E){return m.apply(this,arguments)})(n,d,h,f);var m};const s=yield Fb(n.localStore,e,!0),o=new Sq(e,s.qs),a=o.nu(s.documents),c=i_.createSynthesizedTargetChangeForCurrentChange(t,r&&"Offline"!==n.onlineState,i),l=o.applyChanges(a,n.isPrimaryClient,c);vN(n,t,l._u);const u=new JIe(e,t,o);return n.Pu.set(e,u),n.Tu.has(t)?n.Tu.get(t).push(e):n.Tu.set(t,[e]),l.snapshot}),cN.apply(this,arguments)}function nSe(n,e,t){return lN.apply(this,arguments)}function lN(){return(lN=O(function*(n,e,t){const r=Pe(n),i=r.Pu.get(e),s=r.Tu.get(i.targetId);if(s.length>1)return r.Tu.set(i.targetId,s.filter(o=>!Yg(o,e))),void r.Pu.delete(e);r.isPrimaryClient?(r.sharedClientState.removeLocalQueryTarget(i.targetId),r.sharedClientState.isActiveQueryTarget(i.targetId)||(yield lf(r.localStore,i.targetId,!1).then(()=>{r.sharedClientState.clearQueryState(i.targetId),t&&df(r.remoteStore,i.targetId),mf(r,i.targetId)}).catch(wc))):(mf(r,i.targetId),yield lf(r.localStore,i.targetId,!0))})).apply(this,arguments)}function rSe(n,e){return uN.apply(this,arguments)}function uN(){return(uN=O(function*(n,e){const t=Pe(n),r=t.Pu.get(e),i=t.Tu.get(r.targetId);t.isPrimaryClient&&1===i.length&&(t.sharedClientState.removeLocalQueryTarget(r.targetId),df(t.remoteStore,r.targetId))})).apply(this,arguments)}function dN(){return(dN=O(function*(n,e,t){const r=function DN(n){const e=Pe(n);return e.remoteStore.remoteSyncer.applySuccessfulWrite=oSe.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=aSe.bind(null,e),e}(n);try{const i=yield function(o,a){const c=Pe(o),l=sn.now(),u=a.reduce((f,m)=>f.add(m.key),Dt());let d,h;return c.persistence.runTransaction("Locally write mutations","readwrite",f=>{let m=Yi(),y=Dt();return c.Os.getEntries(f,u).next(_=>{m=_,m.forEach((g,b)=>{b.isValidDocument()||(y=y.add(g))})}).next(()=>c.localDocuments.getOverlayedDocuments(f,m)).next(_=>{d=_;const g=[];for(const b of a){const E=Cwe(b,d.get(b.key).overlayedDocument);null!=E&&g.push(new va(b.key,E,l$(E.value.mapValue),zn.exists(!0)))}return c.mutationQueue.addMutationBatch(f,l,g,a)}).next(_=>{h=_;const g=_.applyToLocalDocumentSet(d,y);return c.documentOverlayCache.saveOverlays(f,_.batchId,g)})}).then(()=>({batchId:h.batchId,changes:C$(d)}))}(r.localStore,e);r.sharedClientState.addPendingMutation(i.batchId),function(o,a,c){let l=o.Ru[o.currentUser.toKey()];l||(l=new Sn(lt)),l=l.insert(a,c),o.Ru[o.currentUser.toKey()]=l}(r,i.batchId,t),yield ba(r,i.changes),yield hf(r.remoteStore)}catch(i){const s=pf(i,"Failed to persist write");t.reject(s)}})).apply(this,arguments)}function Aq(n,e){return hN.apply(this,arguments)}function hN(){return(hN=O(function*(n,e){const t=Pe(n);try{const r=yield function TIe(n,e){const t=Pe(n),r=e.snapshotVersion;let i=t.Fs;return t.persistence.runTransaction("Apply remote event","readwrite-primary",s=>{const o=t.Os.newChangeBuffer({trackRemovals:!0});i=t.Fs;const a=[];e.targetChanges.forEach((u,d)=>{const h=i.get(d);if(!h)return;a.push(t.hi.removeMatchingKeys(s,u.removedDocuments,d).next(()=>t.hi.addMatchingKeys(s,u.addedDocuments,d)));let f=h.withSequenceNumber(s.currentSequenceNumber);var y,_,g;null!==e.targetMismatches.get(d)?f=f.withResumeToken(ir.EMPTY_BYTE_STRING,Ze.min()).withLastLimboFreeSnapshotVersion(Ze.min()):u.resumeToken.approximateByteSize()>0&&(f=f.withResumeToken(u.resumeToken,r)),i=i.insert(d,f),_=f,g=u,(0===(y=h).resumeToken.approximateByteSize()||_.snapshotVersion.toMicroseconds()-y.snapshotVersion.toMicroseconds()>=3e8||g.addedDocuments.size+g.modifiedDocuments.size+g.removedDocuments.size>0)&&a.push(t.hi.updateTargetData(s,f))});let c=Yi(),l=Dt();if(e.documentUpdates.forEach(u=>{e.resolvedLimboDocuments.has(u)&&a.push(t.persistence.referenceDelegate.updateLimboDocument(s,u))}),a.push(function Y9(n,e,t){let r=Dt(),i=Dt();return t.forEach(s=>r=r.add(s)),e.getEntries(n,r).next(s=>{let o=Yi();return t.forEach((a,c)=>{const l=s.get(a);c.isFoundDocument()!==l.isFoundDocument()&&(i=i.add(a)),c.isNoDocument()&&c.version.isEqual(Ze.min())?(e.removeEntry(a,c.readTime),o=o.insert(a,c)):!l.isValidDocument()||c.version.compareTo(l.version)>0||0===c.version.compareTo(l.version)&&l.hasPendingWrites?(e.addEntry(c),o=o.insert(a,c)):fe(vP,"Ignoring outdated watch update for ",a,". Current version:",l.version," Watch version:",c.version)}),{Ls:o,ks:i}})}(s,o,e.documentUpdates).next(u=>{c=u.Ls,l=u.ks})),!r.isEqual(Ze.min())){const u=t.hi.getLastRemoteSnapshotVersion(s).next(d=>t.hi.setTargetsMetadata(s,s.currentSequenceNumber,r));a.push(u)}return $.waitFor(a).next(()=>o.apply(s)).next(()=>t.localDocuments.getLocalViewOfDocuments(s,c,l)).next(()=>c)}).then(s=>(t.Fs=i,s))}(t.localStore,e);e.targetChanges.forEach((i,s)=>{const o=t.Eu.get(s);o&&($e(i.addedDocuments.size+i.modifiedDocuments.size+i.removedDocuments.size<=1,22616),i.addedDocuments.size>0?o.lu=!0:i.modifiedDocuments.size>0?$e(o.lu,14607):i.removedDocuments.size>0&&($e(o.lu,42227),o.lu=!1))}),yield ba(t,r,e)}catch(r){yield wc(r)}})).apply(this,arguments)}function Mq(n,e,t){const r=Pe(n);if(r.isPrimaryClient&&0===t||!r.isPrimaryClient&&1===t){const i=[];r.Pu.forEach((s,o)=>{const a=o.view.va(e);a.snapshot&&i.push(a.snapshot)}),function(o,a){const c=Pe(o);c.onlineState=a;let l=!1;c.queries.forEach((u,d)=>{for(const h of d.wa)h.va(a)&&(l=!0)}),l&&eN(c)}(r.eventManager,e),i.length&&r.hu.J_(i),r.onlineState=e,r.isPrimaryClient&&r.sharedClientState.setOnlineState(e)}}function sSe(n,e,t){return fN.apply(this,arguments)}function fN(){return(fN=O(function*(n,e,t){const r=Pe(n);r.sharedClientState.updateQueryState(e,"rejected",t);const i=r.Eu.get(e),s=i&&i.key;if(s){let o=new Sn(Re.comparator);o=o.insert(s,Nn.newNoDocument(s,Ze.min()));const a=Dt().add(s),c=new r_(Ze.min(),new Map,new Sn(lt),o,a);yield Aq(r,c),r.du=r.du.remove(s),r.Eu.delete(e),EN(r)}else yield lf(r.localStore,e,!1).then(()=>mf(r,e,t)).catch(wc)})).apply(this,arguments)}function oSe(n,e){return pN.apply(this,arguments)}function pN(){return(pN=O(function*(n,e){const t=Pe(n),r=e.batch.batchId;try{const i=yield function bIe(n,e){const t=Pe(n);return t.persistence.runTransaction("Acknowledge batch","readwrite-primary",r=>{const i=e.batch.keys(),s=t.Os.newChangeBuffer({trackRemovals:!0});return function(a,c,l,u){const d=l.batch,h=d.keys();let f=$.resolve();return h.forEach(m=>{f=f.next(()=>u.getEntry(c,m)).next(y=>{const _=l.docVersions.get(m);$e(null!==_,48541),y.version.compareTo(_)<0&&(d.applyToRemoteDocument(y,l),y.isValidDocument()&&(y.setReadTime(l.commitVersion),u.addEntry(y)))})}),f.next(()=>a.mutationQueue.removeMutationBatch(c,d))}(t,r,e,s).next(()=>s.apply(r)).next(()=>t.mutationQueue.performConsistencyCheck(r)).next(()=>t.documentOverlayCache.removeOverlaysForBatchId(r,i,e.batch.batchId)).next(()=>t.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(r,function(a){let c=Dt();for(let l=0;l<a.mutationResults.length;++l)a.mutationResults[l].transformResults.length>0&&(c=c.add(a.batch.mutations[l].key));return c}(e))).next(()=>t.localDocuments.getDocuments(r,i))})}(t.localStore,e);yN(t,r,null),_N(t,r),t.sharedClientState.updateMutationState(r,"acknowledged"),yield ba(t,i)}catch(i){yield wc(i)}})).apply(this,arguments)}function aSe(n,e,t){return mN.apply(this,arguments)}function mN(){return(mN=O(function*(n,e,t){const r=Pe(n);try{const i=yield function(o,a){const c=Pe(o);return c.persistence.runTransaction("Reject batch","readwrite-primary",l=>{let u;return c.mutationQueue.lookupMutationBatch(l,a).next(d=>($e(null!==d,37113),u=d.keys(),c.mutationQueue.removeMutationBatch(l,d))).next(()=>c.mutationQueue.performConsistencyCheck(l)).next(()=>c.documentOverlayCache.removeOverlaysForBatchId(l,u,a)).next(()=>c.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(l,u)).next(()=>c.localDocuments.getDocuments(l,u))})}(r.localStore,e);yN(r,e,t),_N(r,e),r.sharedClientState.updateMutationState(e,"rejected",t),yield ba(r,i)}catch(i){yield wc(i)}})).apply(this,arguments)}function _N(n,e){(n.Vu.get(e)||[]).forEach(t=>{t.resolve()}),n.Vu.delete(e)}function yN(n,e,t){const r=Pe(n);let i=r.Ru[r.currentUser.toKey()];if(i){const s=i.get(e);s&&(t?s.reject(t):s.resolve(),i=i.remove(e)),r.Ru[r.currentUser.toKey()]=i}}function mf(n,e,t=null){n.sharedClientState.removeLocalQueryTarget(e);for(const r of n.Tu.get(e))n.Pu.delete(r),t&&n.hu.pu(r,t);n.Tu.delete(e),n.isPrimaryClient&&n.Au.zr(e).forEach(r=>{n.Au.containsKey(r)||Cq(n,r)})}function Cq(n,e){n.Iu.delete(e.path.canonicalString());const t=n.du.get(e);null!==t&&(df(n.remoteStore,t),n.du=n.du.remove(e),n.Eu.delete(t),EN(n))}function vN(n,e,t){for(const r of t)r instanceof wq?(n.Au.addReference(r.key,e),lSe(n,r)):r instanceof Iq?(fe(Vc,"Document no longer in limbo: "+r.key),n.Au.removeReference(r.key,e),n.Au.containsKey(r.key)||Cq(n,r.key)):Be(19791,{yu:r})}function lSe(n,e){const t=e.key,r=t.path.canonicalString();n.du.get(t)||n.Iu.has(r)||(fe(Vc,"New document in limbo: "+t),n.Iu.add(r),EN(n))}function EN(n){for(;n.Iu.size>0&&n.du.size<n.maxConcurrentLimboResolutions;){const e=n.Iu.values().next().value;n.Iu.delete(e);const t=new Re(jt.fromString(e)),r=n.mu.next();n.Eu.set(r,new ZIe(t)),n.du=n.du.insert(t,r),zb(n.remoteStore,new Ea(mi(qh(t.path)),r,"TargetPurposeLimboResolution",ds.ue))}}function ba(n,e,t){return bN.apply(this,arguments)}function bN(){return bN=O(function*(n,e,t){const r=Pe(n),i=[],s=[],o=[];var a;r.Pu.isEmpty()||(r.Pu.forEach((a,c)=>{o.push(r.gu(c,e,t).then(l=>{var u;if((l||t)&&r.isPrimaryClient){const d=l?!l.fromCache:null===(u=t?.targetChanges.get(c.targetId))||void 0===u?void 0:u.current;r.sharedClientState.updateQueryState(c.targetId,d?"current":"not-current")}if(l){i.push(l);const d=yP.Es(c.targetId,l);s.push(d)}}))}),yield Promise.all(o),r.hu.J_(i),yield(a=O(function*(l,u){const d=Pe(l);try{yield d.persistence.runTransaction("notifyLocalViewChanges","readwrite",h=>$.forEach(u,f=>$.forEach(f.Is,m=>d.persistence.referenceDelegate.addReference(h,f.targetId,m)).next(()=>$.forEach(f.ds,m=>d.persistence.referenceDelegate.removeReference(h,f.targetId,m)))))}catch(h){if(!Ic(h))throw h;fe(vP,"Failed to update sequence numbers: "+h)}for(const h of u){const f=h.targetId;if(!h.fromCache){const m=d.Fs.get(f),_=m.withLastLimboFreeSnapshotVersion(m.snapshotVersion);d.Fs=d.Fs.insert(f,_)}}}),function c(l,u){return a.apply(this,arguments)})(r.localStore,s))}),bN.apply(this,arguments)}function uSe(n,e){return TN.apply(this,arguments)}function TN(){return(TN=O(function*(n,e){const t=Pe(n);if(!t.currentUser.isEqual(e)){fe(Vc,"User change. New user:",e.toKey());const r=yield X9(t.localStore,e);t.currentUser=e,(s=t).Vu.forEach(a=>{a.forEach(c=>{c.reject(new ae(q.CANCELLED,"'waitForPendingWrites' promise is rejected due to a user change."))})}),s.Vu.clear(),t.sharedClientState.handleUserChange(e,r.removedBatchIds,r.addedBatchIds),yield ba(t,r.Bs)}var s})).apply(this,arguments)}function dSe(n,e){const t=Pe(n),r=t.Eu.get(e);if(r&&r.lu)return Dt().add(r.key);{let i=Dt();const s=t.Tu.get(e);if(!s)return i;for(const o of s){const a=t.Pu.get(o);i=i.unionWith(a.view.tu)}return i}}function Wb(n){const e=Pe(n);return e.remoteStore.remoteSyncer.applyRemoteEvent=Aq.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=dSe.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=sSe.bind(null,e),e.hu.J_=KIe.bind(null,e.eventManager),e.hu.pu=YIe.bind(null,e.eventManager),e}let jb=(()=>{class n{constructor(){this.kind="memory",this.synchronizeTabs=!1}initialize(t){var r=this;return O(function*(){r.serializer=Iu(t.databaseInfo.databaseId),r.sharedClientState=r.bu(t),r.persistence=r.Du(t),yield r.persistence.start(),r.localStore=r.vu(t),r.gcScheduler=r.Cu(t,r.localStore),r.indexBackfillerScheduler=r.Fu(t,r.localStore)})()}Cu(t,r){return null}Fu(t,r){return null}vu(t){return function q9(n,e,t,r){return new EIe(n,e,t,r)}(this.persistence,new $9,t.initialUser,this.serializer)}Du(t){return new hP(Ob.Vi,this.serializer)}bu(t){return new sq}terminate(){var t=this;return O(function*(){var r,i;null===(r=t.gcScheduler)||void 0===r||r.stop(),null===(i=t.indexBackfillerScheduler)||void 0===i||i.stop(),t.sharedClientState.shutdown(),yield t.persistence.shutdown()})()}}return n.provider={build:()=>new n},n})();class RN extends jb{constructor(e){super(),this.cacheSizeBytes=e}Cu(e,t){return $e(this.persistence.referenceDelegate instanceof kb,46915),new L9(this.persistence.referenceDelegate.garbageCollector,e.asyncQueue,t)}Du(e){const t=void 0!==this.cacheSizeBytes?gi.withCacheSize(this.cacheSizeBytes):gi.DEFAULT;return new hP(r=>kb.Vi(r,t),this.serializer)}}let gf=(()=>{class n{initialize(t,r){var i=this;return O(function*(){i.localStore||(i.localStore=t.localStore,i.sharedClientState=t.sharedClientState,i.datastore=i.createDatastore(r),i.remoteStore=i.createRemoteStore(r),i.eventManager=i.createEventManager(r),i.syncEngine=i.createSyncEngine(r,!t.synchronizeTabs),i.sharedClientState.onlineStateHandler=s=>Mq(i.syncEngine,s,1),i.remoteStore.remoteSyncer.handleCredentialChange=uSe.bind(null,i.syncEngine),yield function qP(n,e){return XP.apply(this,arguments)}(i.remoteStore,i.syncEngine.isPrimaryClient))})()}createEventManager(t){return new XIe}createDatastore(t){const r=Iu(t.databaseInfo.databaseId),i=new DIe(t.databaseInfo);return new OIe(t.authCredentials,t.appCheckCredentials,i,r)}createRemoteStore(t){return i=this.localStore,s=this.datastore,o=t.asyncQueue,a=r=>Mq(this.syncEngine,r,0),c=aq.C()?new aq:new xIe,new LIe(i,s,o,a,c);var i,s,o,a,c}createSyncEngine(t,r){return function(s,o,a,c,l,u,d){const h=new QIe(s,o,a,c,l,u);return d&&(h.fu=!0),h}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,t.initialUser,t.maxConcurrentLimboResolutions,r)}terminate(){var t=this;return O(function*(){var r,i,s;yield(s=O(function*(a){const c=Pe(a);fe(Su,"RemoteStore shutting down."),c.Ia.add(5),yield uf(c),c.Ea.shutdown(),c.Aa.set("Unknown")}),function o(a){return s.apply(this,arguments)})(t.remoteStore),null===(r=t.datastore)||void 0===r||r.terminate(),null===(i=t.eventManager)||void 0===i||i.terminate()})()}}return n.provider={build:()=>new n},n})();class $b{constructor(e){this.observer=e,this.muted=!1}next(e){this.muted||this.observer.next&&this.xu(this.observer.next,e)}error(e){this.muted||(this.observer.error?this.xu(this.observer.error,e):fr("Uncaught Error in snapshot listener:",e.toString()))}Ou(){this.muted=!0}xu(e,t){setTimeout(()=>{this.muted||e(t)},0)}}const Uc="FirestoreClient";class ISe{constructor(e,t,r,i,s){var o=this;this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=r,this.databaseInfo=i,this.user=Hr.UNAUTHENTICATED,this.clientId=b1.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=s,this.authCredentials.start(r,function(){var a=O(function*(c){fe(Uc,"Received user=",c.uid),yield o.authCredentialListener(c),o.user=c});return function(c){return a.apply(this,arguments)}}()),this.appCheckCredentials.start(r,a=>(fe(Uc,"Received new app check token=",a),this.appCheckCredentialListener(a,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){var e=this;this.asyncQueue.enterRestrictedMode();const t=new zr;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(O(function*(){try{e._onlineComponents&&(yield e._onlineComponents.terminate()),e._offlineComponents&&(yield e._offlineComponents.terminate()),e.authCredentials.shutdown(),e.appCheckCredentials.shutdown(),t.resolve()}catch(r){const i=pf(r,"Failed to shutdown persistence");t.reject(i)}})),t.promise}}function NN(n,e){return ON.apply(this,arguments)}function ON(){return ON=O(function*(n,e){n.asyncQueue.verifyOperationInProgress(),fe(Uc,"Initializing OfflineComponentProvider");const t=n.configuration;yield e.initialize(t);let r=t.initialUser;n.setCredentialChangeListener(function(){var i=O(function*(s){r.isEqual(s)||(yield X9(e.localStore,s),r=s)});return function(s){return i.apply(this,arguments)}}()),e.persistence.setDatabaseDeletedListener(()=>{Di("Terminating Firestore due to IndexedDb database deletion"),n.terminate().then(()=>{fe("Terminating Firestore due to IndexedDb database deletion completed successfully")}).catch(i=>{Di("Terminating Firestore due to IndexedDb database deletion failed",i)})}),n._offlineComponents=e}),ON.apply(this,arguments)}function Oq(n,e){return kN.apply(this,arguments)}function kN(){return(kN=O(function*(n,e){n.asyncQueue.verifyOperationInProgress();const t=yield function LN(n){return FN.apply(this,arguments)}(n);fe(Uc,"Initializing OnlineComponentProvider"),yield e.initialize(t,n.configuration),n.setCredentialChangeListener(r=>gq(e.remoteStore,r)),n.setAppCheckTokenChangeListener((r,i)=>gq(e.remoteStore,i)),n._onlineComponents=e})).apply(this,arguments)}function FN(){return(FN=O(function*(n){if(!n._offlineComponents)if(n._uninitializedComponentsProvider){fe(Uc,"Using user provided OfflineComponentProvider");try{yield NN(n,n._uninitializedComponentsProvider._offline)}catch(e){if(!("FirebaseError"===(i=e).name?i.code===q.FAILED_PRECONDITION||i.code===q.UNIMPLEMENTED:!(typeof DOMException<"u"&&i instanceof DOMException)||22===i.code||20===i.code||11===i.code))throw e;Di("Error using user provided cache. Falling back to memory cache: "+e),yield NN(n,new jb)}}else fe(Uc,"Using default OfflineComponentProvider"),yield NN(n,new RN(void 0));var i;return n._offlineComponents})).apply(this,arguments)}function qb(n){return VN.apply(this,arguments)}function VN(){return(VN=O(function*(n){return n._onlineComponents||(n._uninitializedComponentsProvider?(fe(Uc,"Using user provided OnlineComponentProvider"),yield Oq(n,n._uninitializedComponentsProvider._online)):(fe(Uc,"Using default OnlineComponentProvider"),yield Oq(n,new gf))),n._onlineComponents})).apply(this,arguments)}function yf(n){return BN.apply(this,arguments)}function BN(){return(BN=O(function*(n){const e=yield qb(n),t=e.eventManager;return t.onListen=eSe.bind(null,e.syncEngine),t.onUnlisten=nSe.bind(null,e.syncEngine),t.onFirstRemoteStoreListen=tSe.bind(null,e.syncEngine),t.onLastRemoteStoreUnlisten=rSe.bind(null,e.syncEngine),t})).apply(this,arguments)}function Hq(n){const e={};return void 0!==n.timeoutSeconds&&(e.timeoutSeconds=n.timeoutSeconds),e}const zq=new Map,Gq="firestore.googleapis.com";class jq{constructor(e){var t,r;if(void 0===e.host){if(void 0!==e.ssl)throw new ae(q.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host=Gq,this.ssl=!0}else this.host=e.host,this.ssl=null===(t=e.ssl)||void 0===t||t;if(this.isUsingEmulator=void 0!==e.emulatorOptions,this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,void 0===e.cacheSizeBytes)this.cacheSizeBytes=41943040;else{if(-1!==e.cacheSizeBytes&&e.cacheSizeBytes<1048576)throw new ae(q.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}(function MTe(n,e,t,r){if(!0===e&&!0===r)throw new ae(q.INVALID_ARGUMENT,`${n} and ${t} cannot be used together.`)})("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalAutoDetectLongPolling=!(this.experimentalForceLongPolling||void 0!==e.experimentalAutoDetectLongPolling&&!e.experimentalAutoDetectLongPolling),this.experimentalLongPollingOptions=Hq(null!==(r=e.experimentalLongPollingOptions)&&void 0!==r?r:{}),function(s){if(void 0!==s.timeoutSeconds){if(isNaN(s.timeoutSeconds))throw new ae(q.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (must not be NaN)`);if(s.timeoutSeconds<5)throw new ae(q.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (minimum allowed value is 5)`);if(s.timeoutSeconds>30)throw new ae(q.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&this.experimentalLongPollingOptions.timeoutSeconds===e.experimentalLongPollingOptions.timeoutSeconds&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class m_{constructor(e,t,r,i){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=r,this._app=i,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new jq({}),this._settingsFrozen=!1,this._emulatorOptions={},this._terminateTask="notTerminated"}get app(){if(!this._app)throw new ae(q.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return"notTerminated"!==this._terminateTask}_setSettings(e){if(this._settingsFrozen)throw new ae(q.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new jq(e),this._emulatorOptions=e.emulatorOptions||{},void 0!==e.credentials&&(this._authCredentials=function(r){if(!r)return new vTe;switch(r.type){case"firstParty":return new wTe(r.sessionIndex||"0",r.iamToken||null,r.authTokenFactory||null);case"provider":return r.client;default:throw new ae(q.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_getEmulatorOptions(){return this._emulatorOptions}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return"notTerminated"===this._terminateTask&&(this._terminateTask=this._terminate()),this._terminateTask}_restart(){var e=this;return O(function*(){"notTerminated"===e._terminateTask?yield e._terminate():e._terminateTask="notTerminated"})()}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(t){const r=zq.get(t);r&&(fe("ComponentProvider","Removing Datastore"),zq.delete(t),r.terminate())}(this),Promise.resolve()}}class Wr{constructor(e,t,r){this.converter=t,this._query=r,this.type="query",this.firestore=e}withConverter(e){return new Wr(this.firestore,e,this._query)}}class fn{constructor(e,t,r){this.converter=t,this._key=r,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new Mo(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new fn(this.firestore,e,this._key)}toJSON(){return{type:fn._jsonSchemaVersion,referencePath:this._key.toString()}}static fromJSON(e,t,r){if(su(t,fn._jsonSchema))return new fn(e,r||null,new Re(jt.fromString(t.referencePath)))}}fn._jsonSchemaVersion="firestore/documentReference/1.0",fn._jsonSchema={type:Sr("string",fn._jsonSchemaVersion),referencePath:Sr("string")};class Mo extends Wr{constructor(e,t,r){super(e,t,qh(r)),this._path=r,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new fn(this.firestore,null,new Re(e))}withConverter(e){return new Mo(this.firestore,e,this._path)}}function FSe(n,e,...t){if(n=Xn(n),I1("collection","path",e),n instanceof m_){const r=jt.fromString(e,...t);return E8(r),new Mo(n,null,r)}{if(!(n instanceof fn||n instanceof Mo))throw new ae(q.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=n._path.child(jt.fromString(e,...t));return E8(r),new Mo(n.firestore,null,r)}}function $q(n,e,...t){if(n=Xn(n),1===arguments.length&&(e=b1.newId()),I1("doc","path",e),n instanceof m_){const r=jt.fromString(e,...t);return v8(r),new fn(n,null,new Re(r))}{if(!(n instanceof fn||n instanceof Mo))throw new ae(q.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=n._path.child(jt.fromString(e,...t));return v8(r),new fn(n.firestore,n instanceof Mo?n.converter:null,new Re(r))}}const Xq="AsyncQueue";class Kq{constructor(e=Promise.resolve()){this.Zu=[],this.Xu=!1,this.ec=[],this.tc=null,this.nc=!1,this.rc=!1,this.sc=[],this.F_=new DP(this,"async_queue_retry"),this.oc=()=>{const r=Hb();r&&fe(Xq,"Visibility state changed to "+r.visibilityState),this.F_.y_()},this._c=e;const t=Hb();t&&"function"==typeof t.addEventListener&&t.addEventListener("visibilitychange",this.oc)}get isShuttingDown(){return this.Xu}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.ac(),this.uc(e)}enterRestrictedMode(e){if(!this.Xu){this.Xu=!0,this.rc=e||!1;const t=Hb();t&&"function"==typeof t.removeEventListener&&t.removeEventListener("visibilitychange",this.oc)}}enqueue(e){if(this.ac(),this.Xu)return new Promise(()=>{});const t=new zr;return this.uc(()=>this.Xu&&this.rc?Promise.resolve():(e().then(t.resolve,t.reject),t.promise)).then(()=>t.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.Zu.push(e),this.cc()))}cc(){var e=this;return O(function*(){if(0!==e.Zu.length){try{yield e.Zu[0](),e.Zu.shift(),e.F_.reset()}catch(t){if(!Ic(t))throw t;fe(Xq,"Operation failed with retryable error: "+t)}e.Zu.length>0&&e.F_.g_(()=>e.cc())}})()}uc(e){const t=this._c.then(()=>(this.nc=!0,e().catch(r=>{throw this.tc=r,this.nc=!1,fr("INTERNAL UNHANDLED ERROR: ",Yq(r)),r}).then(r=>(this.nc=!1,r))));return this._c=t,t}enqueueAfterDelay(e,t,r){this.ac(),this.sc.indexOf(e)>-1&&(t=0);const i=KP.createAndSchedule(this,e,t,r,s=>this.lc(s));return this.ec.push(i),i}ac(){this.tc&&Be(47125,{hc:Yq(this.tc)})}verifyOperationInProgress(){}Pc(){var e=this;return O(function*(){let t;do{t=e._c,yield t}while(t!==e._c)})()}Tc(e){for(const t of this.ec)if(t.timerId===e)return!0;return!1}Ic(e){return this.Pc().then(()=>{this.ec.sort((t,r)=>t.targetTimeMs-r.targetTimeMs);for(const t of this.ec)if(t.skipDelay(),"all"!==e&&t.timerId===e)break;return this.Pc()})}dc(e){this.sc.push(e)}lc(e){const t=this.ec.indexOf(e);this.ec.splice(t,1)}}function Yq(n){let e=n.message||"";return n.stack&&(e=n.stack.includes(n.message)?n.stack:n.message+"\n"+n.stack),e}function vf(n){return function(t){if("object"!=typeof t||null===t)return!1;const i=t;for(const s of["next","error","complete"])if(s in i&&"function"==typeof i[s])return!0;return!1}(n)}class _n extends m_{constructor(e,t,r,i){super(e,t,r,i),this.type="firestore",this._queue=new Kq,this._persistenceKey=i?.name||"[DEFAULT]"}_terminate(){var e=this;return O(function*(){if(e._firestoreClient){const t=e._firestoreClient.terminate();e._queue=new Kq(t),e._firestoreClient=void 0,yield t}})()}}function USe(n,e){const t="object"==typeof n?n:y0(),r="string"==typeof n?n:e||Wg,i=dg(t,"firestore").getImmediate({identifier:r});if(!i._initialized){const s=q6("firestore");s&&function LSe(n,e,t,r={}){var i;n=$t(n,m_);const s=Zl(e),o=n._getSettings(),a=Object.assign(Object.assign({},o),{emulatorOptions:n._getEmulatorOptions()}),c=`${e}:${t}`;s&&(pC(`https://${c}`),gC("Firestore",!0)),o.host!==Gq&&o.host!==c&&Di("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used.");const l=Object.assign(Object.assign({},o),{host:c,ssl:s,emulatorOptions:r});if(!ia(l,a)&&(n._setSettings(l),r.mockUserToken)){let u,d;if("string"==typeof r.mockUserToken)u=r.mockUserToken,d=Hr.MOCK_USER;else{u=function N_e(n,e){if(n.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const r=e||"demo-project",i=n.iat||0,s=n.sub||n.user_id;if(!s)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const o=Object.assign({iss:`https://securetoken.google.com/${r}`,aud:r,iat:i,exp:i+3600,auth_time:i,sub:s,user_id:s,firebase:{sign_in_provider:"custom",identities:{}}},n);return[d0(JSON.stringify({alg:"none",type:"JWT"})),d0(JSON.stringify(o)),""].join(".")}(r.mockUserToken,null===(i=n._app)||void 0===i?void 0:i.options.projectId);const h=r.mockUserToken.sub||r.mockUserToken.user_id;if(!h)throw new ae(q.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");d=new Hr(h)}n._authCredentials=new ETe(new g8(u,d))}}(i,...s)}return i}function Kn(n){if(n._terminated)throw new ae(q.FAILED_PRECONDITION,"The client has already been terminated.");return n._firestoreClient||function Jq(n){var e,t,r;const i=n._freezeSettings(),s=(c=(null===(e=n._app)||void 0===e?void 0:e.options.appId)||"",new cwe(n._databaseId,c,n._persistenceKey,(u=i).host,u.ssl,u.experimentalForceLongPolling,u.experimentalAutoDetectLongPolling,Hq(u.experimentalLongPollingOptions),u.useFetchStreams,u.isUsingEmulator));var c,u;n._componentsProvider||!(null===(t=i.localCache)||void 0===t)&&t._offlineComponentProvider&&!(null===(r=i.localCache)||void 0===r)&&r._onlineComponentProvider&&(n._componentsProvider={_offline:i.localCache._offlineComponentProvider,_online:i.localCache._onlineComponentProvider}),n._firestoreClient=new ISe(n._authCredentials,n._appCheckCredentials,n._queue,s,n._componentsProvider&&function(a){const c=a?._online.build();return{_offline:a?._offline.build(c),_online:c}}(n._componentsProvider))}(n),n._firestoreClient}class hs{constructor(e){this._byteString=e}static fromBase64String(e){try{return new hs(ir.fromBase64String(e))}catch(t){throw new ae(q.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(e){return new hs(ir.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}toJSON(){return{type:hs._jsonSchemaVersion,bytes:this.toBase64()}}static fromJSON(e){if(su(e,hs._jsonSchema))return hs.fromBase64String(e.bytes)}}hs._jsonSchemaVersion="firestore/bytes/1.0",hs._jsonSchema={type:Sr("string",hs._jsonSchemaVersion),bytes:Sr("string")};class Mu{constructor(...e){for(let t=0;t<e.length;++t)if(0===e[t].length)throw new ae(q.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new Bn(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}class Ef{constructor(e){this._methodName=e}}class Co{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new ae(q.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new ae(q.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}_compareTo(e){return lt(this._lat,e._lat)||lt(this._long,e._long)}toJSON(){return{latitude:this._lat,longitude:this._long,type:Co._jsonSchemaVersion}}static fromJSON(e){if(su(e,Co._jsonSchema))return new Co(e.latitude,e.longitude)}}Co._jsonSchemaVersion="firestore/geoPoint/1.0",Co._jsonSchema={type:Sr("string",Co._jsonSchemaVersion),latitude:Sr("number"),longitude:Sr("number")};class Ys{constructor(e){this._values=(e||[]).map(t=>t)}toArray(){return this._values.map(e=>e)}isEqual(e){return function(r,i){if(r.length!==i.length)return!1;for(let s=0;s<r.length;++s)if(r[s]!==i[s])return!1;return!0}(this._values,e._values)}toJSON(){return{type:Ys._jsonSchemaVersion,vectorValues:this._values}}static fromJSON(e){if(su(e,Ys._jsonSchema)){if(Array.isArray(e.vectorValues)&&e.vectorValues.every(t=>"number"==typeof t))return new Ys(e.vectorValues);throw new ae(q.INVALID_ARGUMENT,"Expected 'vectorValues' field to be a number array")}}}Ys._jsonSchemaVersion="firestore/vectorValue/1.0",Ys._jsonSchema={type:Sr("string",Ys._jsonSchemaVersion),vectorValues:Sr("object")};const zSe=/^__.*__$/;class GSe{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return null!==this.fieldMask?new va(e,this.data,this.fieldMask,t,this.fieldTransforms):new Zh(e,this.data,t,this.fieldTransforms)}}class e7{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return new va(e,this.data,this.fieldMask,t,this.fieldTransforms)}}function t7(n){switch(n){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw Be(40011,{Ec:n})}}class Xb{constructor(e,t,r,i,s,o){this.settings=e,this.databaseId=t,this.serializer=r,this.ignoreUndefinedProperties=i,void 0===s&&this.Ac(),this.fieldTransforms=s||[],this.fieldMask=o||[]}get path(){return this.settings.path}get Ec(){return this.settings.Ec}Rc(e){return new Xb(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}Vc(e){var t;const r=null===(t=this.path)||void 0===t?void 0:t.child(e),i=this.Rc({path:r,mc:!1});return i.fc(e),i}gc(e){var t;const r=null===(t=this.path)||void 0===t?void 0:t.child(e),i=this.Rc({path:r,mc:!1});return i.Ac(),i}yc(e){return this.Rc({path:void 0,mc:!0})}wc(e){return Jb(e,this.settings.methodName,this.settings.Sc||!1,this.path,this.settings.bc)}contains(e){return void 0!==this.fieldMask.find(t=>e.isPrefixOf(t))||void 0!==this.fieldTransforms.find(t=>e.isPrefixOf(t.field))}Ac(){if(this.path)for(let e=0;e<this.path.length;e++)this.fc(this.path.get(e))}fc(e){if(0===e.length)throw this.wc("Document fields must not be empty");if(t7(this.Ec)&&zSe.test(e))throw this.wc('Document fields cannot begin and end with "__"')}}class WSe{constructor(e,t,r){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=r||Iu(e)}Dc(e,t,r,i=!1){return new Xb({Ec:e,methodName:t,bc:r,path:Bn.emptyPath(),mc:!1,Sc:i},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function Cu(n){const e=n._freezeSettings(),t=Iu(n._databaseId);return new WSe(n._databaseId,!!e.ignoreUndefinedProperties,t)}function Kb(n,e,t,r,i,s={}){const o=n.Dc(s.merge||s.mergeFields?2:0,e,t,i);XN("Data must be an object, but it was:",o,r);const a=i7(r,o);let c,l;if(s.merge)c=new Ki(o.fieldMask),l=o.fieldTransforms;else if(s.mergeFields){const u=[];for(const d of s.mergeFields){const h=y_(e,d,t);if(!o.contains(h))throw new ae(q.INVALID_ARGUMENT,`Field '${h}' is specified in your field mask but missing from your input data.`);o7(u,h)||u.push(h)}c=new Ki(u),l=o.fieldTransforms.filter(d=>c.covers(d.field))}else c=null,l=o.fieldTransforms;return new GSe(new ni(a),c,l)}class __ extends Ef{_toFieldTransform(e){if(2!==e.Ec)throw e.wc(1===e.Ec?`${this._methodName}() can only appear at the top level of your update data`:`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof __}}function Du(n,e){if(s7(n=Xn(n)))return XN("Unsupported field value:",e,n),i7(n,e);if(n instanceof Ef)return function(r,i){if(!t7(i.Ec))throw i.wc(`${r._methodName}() can only be used with update() and set()`);if(!i.path)throw i.wc(`${r._methodName}() is not currently supported inside arrays`);const s=r._toFieldTransform(i);s&&i.fieldTransforms.push(s)}(n,e),null;if(void 0===n&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),n instanceof Array){if(e.settings.mc&&4!==e.Ec)throw e.wc("Nested arrays are not supported");return function(r,i){const s=[];let o=0;for(const a of r){let c=Du(a,i.yc(o));null==c&&(c={nullValue:"NULL_VALUE"}),s.push(c),o++}return{arrayValue:{values:s}}}(n,e)}return function(r,i){if(null===(r=Xn(r)))return{nullValue:"NULL_VALUE"};if("number"==typeof r)return P$(i.serializer,r);if("boolean"==typeof r)return{booleanValue:r};if("string"==typeof r)return{stringValue:r};if(r instanceof Date){const s=sn.fromDate(r);return{timestampValue:ef(i.serializer,s)}}if(r instanceof sn){const s=new sn(r.seconds,1e3*Math.floor(r.nanoseconds/1e3));return{timestampValue:ef(i.serializer,s)}}if(r instanceof Co)return{geoPointValue:{latitude:r.latitude,longitude:r.longitude}};if(r instanceof hs)return{bytesValue:Z$(i.serializer,r._byteString)};if(r instanceof fn){const s=i.databaseId,o=r.firestore._databaseId;if(!o.isEqual(s))throw i.wc(`Document reference is for database ${o.projectId}/${o.database} but should be for database ${s.projectId}/${s.database}`);return{referenceValue:tP(r.firestore._databaseId||i.databaseId,r._key.path)}}if(r instanceof Ys)return o=r,a=i,{mapValue:{fields:{[F1]:{stringValue:V1},[Wh]:{arrayValue:{values:o.toArray().map(l=>{if("number"!=typeof l)throw a.wc("VectorValues must only contain numeric values.");return X1(a.serializer,l)})}}}}};var o,a;throw i.wc(`Unsupported field value: ${J0(r)}`)}(n,e)}function i7(n,e){const t={};return q8(n)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):xc(n,(r,i)=>{const s=Du(i,e.Vc(r));null!=s&&(t[r]=s)}),{mapValue:{fields:t}}}function s7(n){return!("object"!=typeof n||null===n||n instanceof Array||n instanceof Date||n instanceof sn||n instanceof Co||n instanceof hs||n instanceof fn||n instanceof Ef||n instanceof Ys)}function XN(n,e,t){if(!s7(t)||!b8(t)){const r=J0(t);throw e.wc("an object"===r?n+" a custom object":n+" "+r)}}function y_(n,e,t){if((e=Xn(e))instanceof Mu)return e._internalPath;if("string"==typeof e)return Yb(n,e);throw Jb("Field path arguments must be of type string or ",n,!1,void 0,t)}const jSe=new RegExp("[~\\*/\\[\\]]");function Yb(n,e,t){if(e.search(jSe)>=0)throw Jb(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,n,!1,void 0,t);try{return new Mu(...e.split("."))._internalPath}catch{throw Jb(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,n,!1,void 0,t)}}function Jb(n,e,t,r,i){const s=r&&!r.isEmpty(),o=void 0!==i;let a=`Function ${e}() called with invalid data`;t&&(a+=" (via `toFirestore()`)"),a+=". ";let c="";return(s||o)&&(c+=" (found",s&&(c+=` in field ${r}`),o&&(c+=` in document ${i}`),c+=")"),new ae(q.INVALID_ARGUMENT,a+n+c)}function o7(n,e){return n.some(t=>t.isEqual(e))}class v_{constructor(e,t,r,i,s){this._firestore=e,this._userDataWriter=t,this._key=r,this._document=i,this._converter=s}get id(){return this._key.path.lastSegment()}get ref(){return new fn(this._firestore,this._converter,this._key)}exists(){return null!==this._document}data(){if(this._document){if(this._converter){const e=new $Se(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){const t=this._document.data.field(Zb("DocumentSnapshot.get",e));if(null!==t)return this._userDataWriter.convertValue(t)}}}class $Se extends v_{data(){return super.data()}}function Zb(n,e){return"string"==typeof e?Yb(n,e):e instanceof Mu?e._internalPath:e._delegate._internalPath}class KN{}class E_ extends KN{}function qSe(n,e,...t){let r=[];e instanceof KN&&r.push(e),r=r.concat(t),function(s){const o=s.filter(c=>c instanceof bf).length,a=s.filter(c=>c instanceof b_).length;if(o>1||o>0&&a>0)throw new ae(q.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(r);for(const i of r)n=i._apply(n);return n}class b_ extends E_{constructor(e,t,r){super(),this._field=e,this._op=t,this._value=r,this.type="where"}static _create(e,t,r){return new b_(e,t,r)}_apply(e){const t=this._parse(e);return d7(e._query,t),new Wr(e.firestore,e.converter,$1(e._query,t))}_parse(e){const t=Cu(e.firestore);return function(s,o,a,c,l,u,d){let h;if(l.isKeyField()){if("array-contains"===u||"array-contains-any"===u)throw new ae(q.INVALID_ARGUMENT,`Invalid Query. You can't perform '${u}' queries on documentId().`);if("in"===u||"not-in"===u){u7(d,u);const m=[];for(const y of d)m.push(l7(c,s,y));h={arrayValue:{values:m}}}else h=l7(c,s,d)}else"in"!==u&&"not-in"!==u&&"array-contains-any"!==u||u7(d,u),h=function r7(n,e,t,r=!1){return Du(t,n.Dc(r?4:3,e))}(a,"where",d,"in"===u||"not-in"===u);return Xt.create(l,u,h)}(e._query,0,t,e.firestore._databaseId,this._field,this._op,this._value)}}function XSe(n,e,t){const r=e,i=Zb("where",n);return b_._create(i,r,t)}class bf extends KN{constructor(e,t){super(),this.type=e,this._queryConstraints=t}static _create(e,t){return new bf(e,t)}_parse(e){const t=this._queryConstraints.map(r=>r._parse(e)).filter(r=>r.getFilters().length>0);return 1===t.length?t[0]:an.create(t,this._getOperator())}_apply(e){const t=this._parse(e);return 0===t.getFilters().length?e:(function(i,s){let o=i;const a=s.getFlattenedFilters();for(const c of a)d7(o,c),o=$1(o,c)}(e._query,t),new Wr(e.firestore,e.converter,$1(e._query,t)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return"and"===this.type?"and":"or"}}class YN extends E_{constructor(e,t){super(),this._field=e,this._direction=t,this.type="orderBy"}static _create(e,t){return new YN(e,t)}_apply(e){const t=function(i,s,o){if(null!==i.startAt)throw new ae(q.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(null!==i.endAt)throw new ae(q.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new Xg(s,o)}(e._query,this._field,this._direction);return new Wr(e.firestore,e.converter,function(i,s){const o=i.explicitOrderBy.concat([s]);return new _a(i.path,i.collectionGroup,o,i.filters.slice(),i.limit,i.limitType,i.startAt,i.endAt)}(e._query,t))}}function KSe(n,e="asc"){const t=e,r=Zb("orderBy",n);return YN._create(r,t)}class Qb extends E_{constructor(e,t,r){super(),this.type=e,this._limit=t,this._limitType=r}static _create(e,t,r){return new Qb(e,t,r)}_apply(e){return new Wr(e.firestore,e.converter,gb(e._query,this._limit,this._limitType))}}function YSe(n){return function T8(n,e){if(e<=0)throw new ae(q.INVALID_ARGUMENT,`Function ${n}() requires a positive number, but it was: ${e}.`)}("limit",n),Qb._create("limit",n,"F")}function l7(n,e,t){if("string"==typeof(t=Xn(t))){if(""===t)throw new ae(q.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!j1(e)&&-1!==t.indexOf("/"))throw new ae(q.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${t}' contains a '/' character.`);const r=e.path.child(jt.fromString(t));if(!Re.isDocumentKey(r))throw new ae(q.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${r}' is not because it has an odd number of segments (${r.length}).`);return fu(n,new Re(r))}if(t instanceof fn)return fu(n,t._key);throw new ae(q.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${J0(t)}.`)}function u7(n,e){if(!Array.isArray(n)||0===n.length)throw new ae(q.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`)}function d7(n,e){const t=function(i,s){for(const o of i)for(const a of o.getFlattenedFilters())if(s.indexOf(a.op)>=0)return a.op;return null}(n.filters,function(i){switch(i){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(e.op));if(null!==t)throw new ae(q.INVALID_ARGUMENT,t===e.op?`Invalid query. You cannot use more than one '${e.op.toString()}' filter.`:`Invalid query. You cannot use '${e.op.toString()}' filters with '${t.toString()}' filters.`)}class f7{convertValue(e,t="none"){switch(Mc(e)){case 0:return null;case 1:return e.booleanValue;case 2:return Hn(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(ga(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 11:return this.convertObject(e.mapValue,t);case 10:return this.convertVectorValue(e.mapValue);default:throw Be(62114,{value:e})}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t="none"){const r={};return xc(e,(i,s)=>{r[i]=this.convertValue(s,t)}),r}convertVectorValue(e){var t,r,i;const s=null===(i=null===(r=null===(t=e.fields)||void 0===t?void 0:t[Wh].arrayValue)||void 0===r?void 0:r.values)||void 0===i?void 0:i.map(o=>Hn(o.doubleValue));return new Ys(s)}convertGeoPoint(e){return new Co(Hn(e.latitude),Hn(e.longitude))}convertArray(e,t){return(e.values||[]).map(r=>this.convertValue(r,t))}convertServerTimestamp(e,t){switch(t){case"previous":const r=lb(e);return null==r?null:this.convertValue(r,t);case"estimate":return this.convertTimestamp(Gg(e));default:return null}}convertTimestamp(e){const t=ma(e);return new sn(t.seconds,t.nanos)}convertDocumentKey(e,t){const r=jt.fromString(e);$e(l9(r),9688,{name:e});const i=new hu(r.get(1),r.get(3)),s=new Re(r.popFirst(5));return i.isEqual(t)||fr(`Document ${s} contains a document reference within a different database (${i.projectId}/${i.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),s}}class Bc{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class fs extends v_{constructor(e,t,r,i,s,o){super(e,t,r,i,o),this._firestore=e,this._firestoreImpl=e,this.metadata=s}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const t=new rT(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){const r=this._document.data.field(Zb("DocumentSnapshot.get",e));if(null!==r)return this._userDataWriter.convertValue(r,t.serverTimestamps)}}toJSON(){if(this.metadata.hasPendingWrites)throw new ae(q.FAILED_PRECONDITION,"DocumentSnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const e=this._document,t={};return t.type=fs._jsonSchemaVersion,t.bundle="",t.bundleSource="DocumentSnapshot",t.bundleName=this._key.toString(),e&&e.isValidDocument()&&e.isFoundDocument()?(this._userDataWriter.convertObjectMap(e.data.value.mapValue.fields,"previous"),t.bundle="NOT SUPPORTED",t):t}}fs._jsonSchemaVersion="firestore/documentSnapshot/1.0",fs._jsonSchema={type:Sr("string",fs._jsonSchemaVersion),bundleSource:Sr("string","DocumentSnapshot"),bundleName:Sr("string"),bundle:Sr("string")};class rT extends fs{data(e={}){return super.data(e)}}class ps{constructor(e,t,r,i){this._firestore=e,this._userDataWriter=t,this._snapshot=i,this.metadata=new Bc(i.hasPendingWrites,i.fromCache),this.query=r}get docs(){const e=[];return this.forEach(t=>e.push(t)),e}get size(){return this._snapshot.docs.size}get empty(){return 0===this.size}forEach(e,t){this._snapshot.docs.forEach(r=>{e.call(t,new rT(this._firestore,this._userDataWriter,r.key,r,new Bc(this._snapshot.mutatedKeys.has(r.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){const t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new ae(q.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=function(i,s){if(i._snapshot.oldDocs.isEmpty()){let o=0;return i._snapshot.docChanges.map(a=>({type:"added",doc:new rT(i._firestore,i._userDataWriter,a.doc.key,a.doc,new Bc(i._snapshot.mutatedKeys.has(a.doc.key),i._snapshot.fromCache),i.query.converter),oldIndex:-1,newIndex:o++}))}{let o=i._snapshot.oldDocs;return i._snapshot.docChanges.filter(a=>s||3!==a.type).map(a=>{const c=new rT(i._firestore,i._userDataWriter,a.doc.key,a.doc,new Bc(i._snapshot.mutatedKeys.has(a.doc.key),i._snapshot.fromCache),i.query.converter);let l=-1,u=-1;return 0!==a.type&&(l=o.indexOf(a.doc.key),o=o.delete(a.doc.key)),1!==a.type&&(o=o.add(a.doc),u=o.indexOf(a.doc.key)),{type:ZSe(a.type),doc:c,oldIndex:l,newIndex:u}})}}(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}toJSON(){if(this.metadata.hasPendingWrites)throw new ae(q.FAILED_PRECONDITION,"QuerySnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const e={};e.type=ps._jsonSchemaVersion,e.bundleSource="QuerySnapshot",e.bundleName=b1.newId();const t=[],r=[],i=[];return this.docs.forEach(s=>{null!==s._document&&(t.push(s._document),r.push(this._userDataWriter.convertObjectMap(s._document.data.value.mapValue.fields,"previous")),i.push(s.ref.path))}),e.bundle="NOT SUPPORTED",e}}function ZSe(n){switch(n){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return Be(61501,{type:n})}}ps._jsonSchemaVersion="firestore/querySnapshot/1.0",ps._jsonSchema={type:Sr("string",ps._jsonSchemaVersion),bundleSource:Sr("string","QuerySnapshot"),bundleName:Sr("string"),bundle:Sr("string")};class Hc extends f7{constructor(e){super(),this.firestore=e}convertBytes(e){return new hs(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new fn(this.firestore,null,t)}}function QSe(n,e,t){n=$t(n,fn);const r=$t(n.firestore,_n),i=function nT(n,e,t){let r;return r=n?t&&(t.merge||t.mergeFields)?n.toFirestore(e,t):n.toFirestore(e):e,r}(n.converter,e,t);return T_(r,[Kb(Cu(r),"setDoc",n._key,i,null!==n.converter,t).toMutation(n._key,zn.none())])}function exe(n,e,t,...r){n=$t(n,fn);const i=$t(n.firestore,_n),s=Cu(i);let o;return o="string"==typeof(e=Xn(e))||e instanceof Mu?function qN(n,e,t,r,i,s){const o=n.Dc(1,e,t),a=[y_(e,r,t)],c=[i];if(s.length%2!=0)throw new ae(q.INVALID_ARGUMENT,`Function ${e}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let h=0;h<s.length;h+=2)a.push(y_(e,s[h])),c.push(s[h+1]);const l=[],u=ni.empty();for(let h=a.length-1;h>=0;--h)if(!o7(l,a[h])){const f=a[h];let m=c[h];m=Xn(m);const y=o.gc(f);if(m instanceof __)l.push(f);else{const _=Du(m,y);null!=_&&(l.push(f),u.set(f,_))}}const d=new Ki(l);return new e7(u,d,o.fieldTransforms)}(s,"updateDoc",n._key,e,t,r):function $N(n,e,t,r){const i=n.Dc(1,e,t);XN("Data must be an object, but it was:",i,r);const s=[],o=ni.empty();xc(r,(c,l)=>{const u=Yb(e,c,t);l=Xn(l);const d=i.gc(u);if(l instanceof __)s.push(u);else{const h=Du(l,d);null!=h&&(s.push(u),o.set(u,h))}});const a=new Ki(s);return new e7(o,a,i.fieldTransforms)}(s,"updateDoc",n._key,e),T_(i,[o.toMutation(n._key,zn.exists(!0))])}function txe(n){return T_($t(n.firestore,_n),[new Qh(n._key,zn.none())])}function iT(n,...e){var t,r,i;n=Xn(n);let s={includeMetadataChanges:!1,source:"default"},o=0;"object"!=typeof e[o]||vf(e[o])||(s=e[o++]);const a={includeMetadataChanges:s.includeMetadataChanges,source:s.source};if(vf(e[o])){const d=e[o];e[o]=null===(t=d.next)||void 0===t?void 0:t.bind(d),e[o+1]=null===(r=d.error)||void 0===r?void 0:r.bind(d),e[o+2]=null===(i=d.complete)||void 0===i?void 0:i.bind(d)}let c,l,u;if(n instanceof fn)l=$t(n.firestore,_n),u=qh(n._key.path),c={next:d=>{e[o]&&e[o](function ZN(n,e,t){const r=t.docs.get(e._key),i=new Hc(n);return new fs(n,i,e._key,r,new Bc(t.hasPendingWrites,t.fromCache),e.converter)}(l,n,d))},error:e[o+1],complete:e[o+2]};else{const d=$t(n,Wr);l=$t(d.firestore,_n),u=d._query;const h=new Hc(l);c={next:f=>{e[o]&&e[o](new ps(l,h,d,f))},error:e[o+1],complete:e[o+2]},function a7(n){if("L"===n.limitType&&0===n.explicitOrderBy.length)throw new ae(q.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}(n._query)}return function(h,f,m,y){const _=new $b(y),g=new nN(f,_,m);return h.asyncQueue.enqueueAndForget(O(function*(){return function YP(n,e){return JP.apply(this,arguments)}(yield yf(h),g)})),()=>{_.Ou(),h.asyncQueue.enqueueAndForget(O(function*(){return function ZP(n,e){return QP.apply(this,arguments)}(yield yf(h),g)}))}}(Kn(l),u,a,c)}function T_(n,e){return function(r,i){const s=new zr;return r.asyncQueue.enqueueAndForget(O(function*(){return function iSe(n,e,t){return dN.apply(this,arguments)}(yield function UN(n){return qb(n).then(e=>e.syncEngine)}(r),i,s)})),s.promise}(Kn(n),e)}!function(e,t=!0){Ph=Th,aa(new vo("firestore",(r,{instanceIdentifier:i,options:s})=>{const o=r.getProvider("app").getImmediate(),a=new _n(new bTe(r.getProvider("auth-internal")),new ITe(o,r.getProvider("app-check-internal")),function(l,u){if(!Object.prototype.hasOwnProperty.apply(l.options,["projectId"]))throw new ae(q.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new hu(l.options.projectId,u)}(o,i),o);return s=Object.assign({useFetchStreams:t},s),a._setSettings(s),a},"PUBLIC").setMultipleInstances(!0)),Ur(f8,"4.8.0",e),Ur(f8,"4.8.0","esm2017")}();var oT=function(){return oT=Object.assign||function(e){for(var t,r=1,i=arguments.length;r<i;r++)for(var s in t=arguments[r])Object.prototype.hasOwnProperty.call(t,s)&&(e[s]=t[s]);return e},oT.apply(this,arguments)};"function"==typeof SuppressedError&&SuppressedError;var mxe={includeMetadataChanges:!1};function Txe(n,e){return void 0===e&&(e={}),function bxe(n){return function tO(n,e){return void 0===e&&(e=mxe),new jn(function(t){return{unsubscribe:iT(n,e,{next:t.next.bind(t),error:t.error.bind(t),complete:t.complete.bind(t)})}})}(n,{includeMetadataChanges:!0}).pipe(Hs(function(e){return e.docs}))}(n).pipe(Hs(function(t){return t.map(function(r){return function y7(n,e){var t;void 0===e&&(e={});var r=n.data(e);return n.exists()&&"object"==typeof r&&null!==r&&e.idField?oT(oT({},r),((t={})[e.idField]=n.id,t)):r}(r,e)})}))}class Tf{constructor(e){return e}}const T7="firestore",iO=new Ae("angularfire2.firestore-instances");function xxe(n){return(e,t)=>{const r=e.runOutsideAngular(()=>n(t));return new Tf(r)}}const Axe={provide:class Ixe{constructor(){return b0(T7)}},deps:[[new ui,iO]]},Mxe={provide:Tf,useFactory:function Sxe(n,e){const t=E0(T7,n,e);return t&&new Tf(t)},deps:[[new ui,iO],nu]};function Cxe(n,...e){return Ur("angularfire",pg.full,"fst"),_l([Mxe,Axe,{provide:iO,useFactory:xxe(n),multi:!0,deps:[Vt,Yr,mg,T0,[new ui,m1],[new ui,D0],...e]}])}const w7=Pr(Txe,!0),aT=Pr(FSe,!0,2),Dxe=Pr(txe,!0,2),w_=Pr($q,!0,2),Rxe=Pr(USe,!0),I7=Pr(YSe,!0,2),S7=Pr(iT,!0),sO=Pr(KSe,!0,2),cT=Pr(qSe,!0,2),oO=Pr(QSe,!0,2),Pxe=Pr(exe,!0,2),lT=Pr(XSe,!0,2),aO="functions";class Lxe{constructor(e,t,r,i){this.app=e,this.auth=null,this.messaging=null,this.appCheck=null,this.serverAppAppCheckToken=null,Rs(e)&&e.settings.appCheckToken&&(this.serverAppAppCheckToken=e.settings.appCheckToken),this.auth=t.getImmediate({optional:!0}),this.messaging=r.getImmediate({optional:!0}),this.auth||t.get().then(s=>this.auth=s,()=>{}),this.messaging||r.get().then(s=>this.messaging=s,()=>{}),this.appCheck||i?.get().then(s=>this.appCheck=s,()=>{})}getAuthToken(){var e=this;return O(function*(){if(e.auth)try{const t=yield e.auth.getToken();return t?.accessToken}catch{return}})()}getMessagingToken(){var e=this;return O(function*(){if(e.messaging&&"Notification"in self&&"granted"===Notification.permission)try{return yield e.messaging.getToken()}catch{return}})()}getAppCheckToken(e){var t=this;return O(function*(){if(t.serverAppAppCheckToken)return t.serverAppAppCheckToken;if(t.appCheck){const r=e?yield t.appCheck.getLimitedUseToken():yield t.appCheck.getToken();return r.error?null:r.token}return null})()}getContext(e){var t=this;return O(function*(){return{authToken:yield t.getAuthToken(),messagingToken:yield t.getMessagingToken(),appCheckToken:yield t.getAppCheckToken(e)}})()}}const cO="us-central1";class Uxe{constructor(e,t,r,i,s=cO,o=(...a)=>fetch(...a)){this.app=e,this.fetchImpl=o,this.emulatorOrigin=null,this.contextProvider=new Lxe(e,t,r,i),this.cancelAllRequests=new Promise(a=>{this.deleteService=()=>Promise.resolve(a())});try{const a=new URL(s);this.customDomain=a.origin+("/"===a.pathname?"":a.pathname),this.region=cO}catch{this.customDomain=null,this.region=s}}_delete(){return this.deleteService()}_url(e){const t=this.app.options.projectId;return null!==this.emulatorOrigin?`${this.emulatorOrigin}/${t}/${this.region}/${e}`:null!==this.customDomain?`${this.customDomain}/${e}`:`https://${this.region}-${t}.cloudfunctions.net/${e}`}}const R7="@firebase/functions";function Jxe(n=y0(),e=cO){const r=dg(Xn(n),aO).getImmediate({identifier:e}),i=q6("functions");return i&&function Zxe(n,e,t){!function Bxe(n,e,t){const r=Zl(e);n.emulatorOrigin=`http${r?"s":""}://${e}:${t}`,r&&(pC(n.emulatorOrigin),gC("Functions",!0))}(Xn(n),e,t)}(r,...i),r}!function Yxe(n){aa(new vo(aO,(t,{instanceIdentifier:r})=>{const i=t.getProvider("app").getImmediate(),s=t.getProvider("auth-internal"),o=t.getProvider("messaging-internal"),a=t.getProvider("app-check-internal");return new Uxe(i,s,o,a,r)},"PUBLIC").setMultipleInstances(!0)),Ur(R7,"0.12.9",n),Ur(R7,"0.12.9","esm2017")}();class fO{constructor(e){return e}}const N7="functions",pO=new Ae("angularfire2.functions-instances");function tAe(n){return(e,t)=>{const r=e.runOutsideAngular(()=>n(t));return new fO(r)}}const nAe={provide:class Qxe{constructor(){return b0(N7)}},deps:[[new ui,pO]]},rAe={provide:fO,useFactory:function eAe(n,e){const t=E0(N7,n,e);return t&&new fO(t)},deps:[[new ui,pO],nu]};function iAe(n,...e){return Ur("angularfire",pg.full,"fn"),_l([rAe,nAe,{provide:pO,useFactory:tAe(n),multi:!0,deps:[Vt,Yr,mg,T0,[new ui,m1],[new ui,D0],...e]}])}const sAe=Pr(Jxe,!0);function mO(n){return Ss((e,t)=>{let s,r=null,i=!1;r=e.subscribe(os(t,void 0,void 0,o=>{s=dc(n(o,mO(n)(e))),r?(r.unsubscribe(),r=null,s.subscribe(t)):i=!0})),i&&(r.unsubscribe(),r=null,s.subscribe(t))})}function O7(n,e,t){const r=Zn(n)||e||t?{next:n,error:e,complete:t}:n;return r?Ss((i,s)=>{var o;null===(o=r.subscribe)||void 0===o||o.call(r);let a=!0;i.subscribe(os(s,c=>{var l;null===(l=r.next)||void 0===l||l.call(r,c),s.next(c)},()=>{var c;a=!1,null===(c=r.complete)||void 0===c||c.call(r),s.complete()},c=>{var l;a=!1,null===(l=r.error)||void 0===l||l.call(r,c),s.error(c)},()=>{var c,l;a&&(null===(c=r.unsubscribe)||void 0===c||c.call(r)),null===(l=r.finalize)||void 0===l||l.call(r)}))}):II}const Gc=0,Zi=1,wa=2,Ru=100,uAe=101,dAe=102,hAe=200,fAe=201,pAe=202,mAe=203,_O=204,yO=205,gAe=206,_Ae=207,yAe=208,vAe=209,EAe=210,bAe=211,TAe=212,wAe=213,IAe=214,gT=1e3,Ri=1001,_T=1002,Ar=1003,EO=1004,yT=1005,Mr=1006,G7=1007,Nu=1008,qc=1009,Xc=1014,Ia=1015,S_=1016,Ou=1020,Os=1023,ku=1026,Af=1027,Lu=3001,jr="srgb",Sa="srgb-linear",CO="display-p3",TT="display-p3-linear",wT="linear",On="srgb",IT="rec709",Df=7680,tMe=512,nMe=513,rMe=514,iMe=515,sMe=516,oMe=517,aMe=518,cMe=519,xa=2e3;class Aa{addEventListener(e,t){void 0===this._listeners&&(this._listeners={});const r=this._listeners;void 0===r[e]&&(r[e]=[]),-1===r[e].indexOf(t)&&r[e].push(t)}hasEventListener(e,t){if(void 0===this._listeners)return!1;const r=this._listeners;return void 0!==r[e]&&-1!==r[e].indexOf(t)}removeEventListener(e,t){if(void 0===this._listeners)return;const i=this._listeners[e];if(void 0!==i){const s=i.indexOf(t);-1!==s&&i.splice(s,1)}}dispatchEvent(e){if(void 0===this._listeners)return;const r=this._listeners[e.type];if(void 0!==r){e.target=this;const i=r.slice(0);for(let s=0,o=i.length;s<o;s++)i[s].call(this,e);e.target=null}}}const yi=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"],Vu=Math.PI/180,Rf=180/Math.PI;function ms(){const n=4294967295*Math.random()|0,e=4294967295*Math.random()|0,t=4294967295*Math.random()|0,r=4294967295*Math.random()|0;return(yi[255&n]+yi[n>>8&255]+yi[n>>16&255]+yi[n>>24&255]+"-"+yi[255&e]+yi[e>>8&255]+"-"+yi[e>>16&15|64]+yi[e>>24&255]+"-"+yi[63&t|128]+yi[t>>8&255]+"-"+yi[t>>16&255]+yi[t>>24&255]+yi[255&r]+yi[r>>8&255]+yi[r>>16&255]+yi[r>>24&255]).toLowerCase()}function sr(n,e,t){return Math.max(e,Math.min(t,n))}function x_(n,e,t){return(1-t)*n+t*e}function PO(n){return!(n&n-1)&&0!==n}function MT(n){return Math.pow(2,Math.floor(Math.log(n)/Math.LN2))}function Qi(n,e){switch(e.constructor){case Float32Array:return n;case Uint32Array:return n/4294967295;case Uint16Array:return n/65535;case Uint8Array:return n/255;case Int32Array:return Math.max(n/2147483647,-1);case Int16Array:return Math.max(n/32767,-1);case Int8Array:return Math.max(n/127,-1);default:throw new Error("Invalid component type.")}}function Ot(n,e){switch(e.constructor){case Float32Array:return n;case Uint32Array:return Math.round(4294967295*n);case Uint16Array:return Math.round(65535*n);case Uint8Array:return Math.round(255*n);case Int32Array:return Math.round(2147483647*n);case Int16Array:return Math.round(32767*n);case Int8Array:return Math.round(127*n);default:throw new Error("Invalid component type.")}}const TMe_DEG2RAD=Vu;class oe{constructor(e=0,t=0){oe.prototype.isVector2=!0,this.x=e,this.y=t}get width(){return this.x}set width(e){this.x=e}get height(){return this.y}set height(e){this.y=e}set(e,t){return this.x=e,this.y=t,this}setScalar(e){return this.x=e,this.y=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y)}copy(e){return this.x=e.x,this.y=e.y,this}add(e){return this.x+=e.x,this.y+=e.y,this}addScalar(e){return this.x+=e,this.y+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this}subScalar(e){return this.x-=e,this.y-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this}multiply(e){return this.x*=e.x,this.y*=e.y,this}multiplyScalar(e){return this.x*=e,this.y*=e,this}divide(e){return this.x/=e.x,this.y/=e.y,this}divideScalar(e){return this.multiplyScalar(1/e)}applyMatrix3(e){const t=this.x,r=this.y,i=e.elements;return this.x=i[0]*t+i[3]*r+i[6],this.y=i[1]*t+i[4]*r+i[7],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this}clampLength(e,t){const r=this.length();return this.divideScalar(r||1).multiplyScalar(Math.max(e,Math.min(t,r)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(e){return this.x*e.x+this.y*e.y}cross(e){return this.x*e.y-this.y*e.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}angleTo(e){const t=Math.sqrt(this.lengthSq()*e.lengthSq());if(0===t)return Math.PI/2;const r=this.dot(e)/t;return Math.acos(sr(r,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,r=this.y-e.y;return t*t+r*r}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this}lerpVectors(e,t,r){return this.x=e.x+(t.x-e.x)*r,this.y=e.y+(t.y-e.y)*r,this}equals(e){return e.x===this.x&&e.y===this.y}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this}rotateAround(e,t){const r=Math.cos(t),i=Math.sin(t),s=this.x-e.x,o=this.y-e.y;return this.x=s*r-o*i+e.x,this.y=s*i+o*r+e.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}class Ut{constructor(e,t,r,i,s,o,a,c,l){Ut.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1],void 0!==e&&this.set(e,t,r,i,s,o,a,c,l)}set(e,t,r,i,s,o,a,c,l){const u=this.elements;return u[0]=e,u[1]=i,u[2]=a,u[3]=t,u[4]=s,u[5]=c,u[6]=r,u[7]=o,u[8]=l,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(e){const t=this.elements,r=e.elements;return t[0]=r[0],t[1]=r[1],t[2]=r[2],t[3]=r[3],t[4]=r[4],t[5]=r[5],t[6]=r[6],t[7]=r[7],t[8]=r[8],this}extractBasis(e,t,r){return e.setFromMatrix3Column(this,0),t.setFromMatrix3Column(this,1),r.setFromMatrix3Column(this,2),this}setFromMatrix4(e){const t=e.elements;return this.set(t[0],t[4],t[8],t[1],t[5],t[9],t[2],t[6],t[10]),this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const r=e.elements,i=t.elements,s=this.elements,o=r[0],a=r[3],c=r[6],l=r[1],u=r[4],d=r[7],h=r[2],f=r[5],m=r[8],y=i[0],_=i[3],g=i[6],b=i[1],E=i[4],x=i[7],M=i[2],C=i[5],w=i[8];return s[0]=o*y+a*b+c*M,s[3]=o*_+a*E+c*C,s[6]=o*g+a*x+c*w,s[1]=l*y+u*b+d*M,s[4]=l*_+u*E+d*C,s[7]=l*g+u*x+d*w,s[2]=h*y+f*b+m*M,s[5]=h*_+f*E+m*C,s[8]=h*g+f*x+m*w,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[3]*=e,t[6]*=e,t[1]*=e,t[4]*=e,t[7]*=e,t[2]*=e,t[5]*=e,t[8]*=e,this}determinant(){const e=this.elements,t=e[0],r=e[1],i=e[2],s=e[3],o=e[4],a=e[5],c=e[6],l=e[7],u=e[8];return t*o*u-t*a*l-r*s*u+r*a*c+i*s*l-i*o*c}invert(){const e=this.elements,t=e[0],r=e[1],i=e[2],s=e[3],o=e[4],a=e[5],c=e[6],l=e[7],u=e[8],d=u*o-a*l,h=a*c-u*s,f=l*s-o*c,m=t*d+r*h+i*f;if(0===m)return this.set(0,0,0,0,0,0,0,0,0);const y=1/m;return e[0]=d*y,e[1]=(i*l-u*r)*y,e[2]=(a*r-i*o)*y,e[3]=h*y,e[4]=(u*t-i*c)*y,e[5]=(i*s-a*t)*y,e[6]=f*y,e[7]=(r*c-l*t)*y,e[8]=(o*t-r*s)*y,this}transpose(){let e;const t=this.elements;return e=t[1],t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this}getNormalMatrix(e){return this.setFromMatrix4(e).invert().transpose()}transposeIntoArray(e){const t=this.elements;return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],this}setUvTransform(e,t,r,i,s,o,a){const c=Math.cos(s),l=Math.sin(s);return this.set(r*c,r*l,-r*(c*o+l*a)+o+e,-i*l,i*c,-i*(-l*o+c*a)+a+t,0,0,1),this}scale(e,t){return this.premultiply(NO.makeScale(e,t)),this}rotate(e){return this.premultiply(NO.makeRotation(-e)),this}translate(e,t){return this.premultiply(NO.makeTranslation(e,t)),this}makeTranslation(e,t){return e.isVector2?this.set(1,0,e.x,0,1,e.y,0,0,1):this.set(1,0,e,0,1,t,0,0,1),this}makeRotation(e){const t=Math.cos(e),r=Math.sin(e);return this.set(t,-r,0,r,t,0,0,0,1),this}makeScale(e,t){return this.set(e,0,0,0,t,0,0,0,1),this}equals(e){const t=this.elements,r=e.elements;for(let i=0;i<9;i++)if(t[i]!==r[i])return!1;return!0}fromArray(e,t=0){for(let r=0;r<9;r++)this.elements[r]=e[r+t];return this}toArray(e=[],t=0){const r=this.elements;return e[t]=r[0],e[t+1]=r[1],e[t+2]=r[2],e[t+3]=r[3],e[t+4]=r[4],e[t+5]=r[5],e[t+6]=r[6],e[t+7]=r[7],e[t+8]=r[8],e}clone(){return(new this.constructor).fromArray(this.elements)}}const NO=new Ut;function AX(n){for(let e=n.length-1;e>=0;--e)if(n[e]>=65535)return!0;return!1}function A_(n){return document.createElementNS("http://www.w3.org/1999/xhtml",n)}function IMe(){const n=A_("canvas");return n.style.display="block",n}Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array;const MX={};function M_(n){n in MX||(MX[n]=!0,console.warn(n))}const CX=(new Ut).set(.8224621,.177538,0,.0331941,.9668058,0,.0170827,.0723974,.9105199),DX=(new Ut).set(1.2249401,-.2249404,0,-.0420569,1.0420571,0,-.0196376,-.0786361,1.0982735),CT={[Sa]:{transfer:wT,primaries:IT,toReference:n=>n,fromReference:n=>n},[jr]:{transfer:On,primaries:IT,toReference:n=>n.convertSRGBToLinear(),fromReference:n=>n.convertLinearToSRGB()},[TT]:{transfer:wT,primaries:"p3",toReference:n=>n.applyMatrix3(DX),fromReference:n=>n.applyMatrix3(CX)},[CO]:{transfer:On,primaries:"p3",toReference:n=>n.convertSRGBToLinear().applyMatrix3(DX),fromReference:n=>n.applyMatrix3(CX).convertLinearToSRGB()}},SMe=new Set([Sa,TT]),pn={enabled:!0,_workingColorSpace:Sa,get legacyMode(){return console.warn("THREE.ColorManagement: .legacyMode=false renamed to .enabled=true in r150."),!this.enabled},set legacyMode(n){console.warn("THREE.ColorManagement: .legacyMode=false renamed to .enabled=true in r150."),this.enabled=!n},get workingColorSpace(){return this._workingColorSpace},set workingColorSpace(n){if(!SMe.has(n))throw new Error(`Unsupported working color space, "${n}".`);this._workingColorSpace=n},convert:function(n,e,t){return!1!==this.enabled&&e!==t&&e&&t?(0,CT[t].fromReference)((0,CT[e].toReference)(n)):n},fromWorkingColorSpace:function(n,e){return this.convert(n,this._workingColorSpace,e)},toWorkingColorSpace:function(n,e){return this.convert(n,e,this._workingColorSpace)},getPrimaries:function(n){return CT[n].primaries},getTransfer:function(n){return""===n?wT:CT[n].transfer}};function Nf(n){return n<.04045?.0773993808*n:Math.pow(.9478672986*n+.0521327014,2.4)}function OO(n){return n<.0031308?12.92*n:1.055*Math.pow(n,.41666)-.055}let Of;class RX{static getDataURL(e){if(/^data:/i.test(e.src)||typeof HTMLCanvasElement>"u")return e.src;let t;if(e instanceof HTMLCanvasElement)t=e;else{void 0===Of&&(Of=A_("canvas")),Of.width=e.width,Of.height=e.height;const r=Of.getContext("2d");e instanceof ImageData?r.putImageData(e,0,0):r.drawImage(e,0,0,e.width,e.height),t=Of}return t.width>2048||t.height>2048?(console.warn("THREE.ImageUtils.getDataURL: Image converted to jpg for performance reasons",e),t.toDataURL("image/jpeg",.6)):t.toDataURL("image/png")}static sRGBToLinear(e){if(typeof HTMLImageElement<"u"&&e instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&e instanceof ImageBitmap){const t=A_("canvas");t.width=e.width,t.height=e.height;const r=t.getContext("2d");r.drawImage(e,0,0,e.width,e.height);const i=r.getImageData(0,0,e.width,e.height),s=i.data;for(let o=0;o<s.length;o++)s[o]=255*Nf(s[o]/255);return r.putImageData(i,0,0),t}if(e.data){const t=e.data.slice(0);for(let r=0;r<t.length;r++)t[r]=t instanceof Uint8Array||t instanceof Uint8ClampedArray?Math.floor(255*Nf(t[r]/255)):Nf(t[r]);return{data:t,width:e.width,height:e.height}}return console.warn("THREE.ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),e}}let xMe=0;class kf{constructor(e=null){this.isSource=!0,Object.defineProperty(this,"id",{value:xMe++}),this.uuid=ms(),this.data=e,this.version=0}set needsUpdate(e){!0===e&&this.version++}toJSON(e){const t=void 0===e||"string"==typeof e;if(!t&&void 0!==e.images[this.uuid])return e.images[this.uuid];const r={uuid:this.uuid,url:""},i=this.data;if(null!==i){let s;if(Array.isArray(i)){s=[];for(let o=0,a=i.length;o<a;o++)s.push(kO(i[o].isDataTexture?i[o].image:i[o]))}else s=kO(i);r.url=s}return t||(e.images[this.uuid]=r),r}}function kO(n){return typeof HTMLImageElement<"u"&&n instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&n instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&n instanceof ImageBitmap?RX.getDataURL(n):n.data?{data:Array.from(n.data),width:n.width,height:n.height,type:n.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}let AMe=0,gs=(()=>{class n extends Aa{constructor(t=n.DEFAULT_IMAGE,r=n.DEFAULT_MAPPING,i=Ri,s=Ri,o=Mr,a=Nu,c=Os,l=qc,u=n.DEFAULT_ANISOTROPY,d=""){super(),this.isTexture=!0,Object.defineProperty(this,"id",{value:AMe++}),this.uuid=ms(),this.name="",this.source=new kf(t),this.mipmaps=[],this.mapping=r,this.channel=0,this.wrapS=i,this.wrapT=s,this.magFilter=o,this.minFilter=a,this.anisotropy=u,this.format=c,this.internalFormat=null,this.type=l,this.offset=new oe(0,0),this.repeat=new oe(1,1),this.center=new oe(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new Ut,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,"string"==typeof d?this.colorSpace=d:(M_("THREE.Texture: Property .encoding has been replaced by .colorSpace."),this.colorSpace=d===Lu?jr:""),this.userData={},this.version=0,this.onUpdate=null,this.isRenderTargetTexture=!1,this.needsPMREMUpdate=!1}get image(){return this.source.data}set image(t=null){this.source.data=t}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return(new this.constructor).copy(this)}copy(t){return this.name=t.name,this.source=t.source,this.mipmaps=t.mipmaps.slice(0),this.mapping=t.mapping,this.channel=t.channel,this.wrapS=t.wrapS,this.wrapT=t.wrapT,this.magFilter=t.magFilter,this.minFilter=t.minFilter,this.anisotropy=t.anisotropy,this.format=t.format,this.internalFormat=t.internalFormat,this.type=t.type,this.offset.copy(t.offset),this.repeat.copy(t.repeat),this.center.copy(t.center),this.rotation=t.rotation,this.matrixAutoUpdate=t.matrixAutoUpdate,this.matrix.copy(t.matrix),this.generateMipmaps=t.generateMipmaps,this.premultiplyAlpha=t.premultiplyAlpha,this.flipY=t.flipY,this.unpackAlignment=t.unpackAlignment,this.colorSpace=t.colorSpace,this.userData=JSON.parse(JSON.stringify(t.userData)),this.needsUpdate=!0,this}toJSON(t){const r=void 0===t||"string"==typeof t;if(!r&&void 0!==t.textures[this.uuid])return t.textures[this.uuid];const i={metadata:{version:4.6,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(t).uuid,mapping:this.mapping,channel:this.channel,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,internalFormat:this.internalFormat,type:this.type,colorSpace:this.colorSpace,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,generateMipmaps:this.generateMipmaps,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return Object.keys(this.userData).length>0&&(i.userData=this.userData),r||(t.textures[this.uuid]=i),i}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(t){if(300!==this.mapping)return t;if(t.applyMatrix3(this.matrix),t.x<0||t.x>1)switch(this.wrapS){case 1e3:t.x=t.x-Math.floor(t.x);break;case Ri:t.x=t.x<0?0:1;break;case 1002:t.x=1===Math.abs(Math.floor(t.x)%2)?Math.ceil(t.x)-t.x:t.x-Math.floor(t.x)}if(t.y<0||t.y>1)switch(this.wrapT){case 1e3:t.y=t.y-Math.floor(t.y);break;case Ri:t.y=t.y<0?0:1;break;case 1002:t.y=1===Math.abs(Math.floor(t.y)%2)?Math.ceil(t.y)-t.y:t.y-Math.floor(t.y)}return this.flipY&&(t.y=1-t.y),t}set needsUpdate(t){!0===t&&(this.version++,this.source.needsUpdate=!0)}get encoding(){return M_("THREE.Texture: Property .encoding has been replaced by .colorSpace."),this.colorSpace===jr?Lu:3e3}set encoding(t){M_("THREE.Texture: Property .encoding has been replaced by .colorSpace."),this.colorSpace=t===Lu?jr:""}}return n.DEFAULT_IMAGE=null,n.DEFAULT_MAPPING=300,n.DEFAULT_ANISOTROPY=1,n})();class mn{constructor(e=0,t=0,r=0,i=1){mn.prototype.isVector4=!0,this.x=e,this.y=t,this.z=r,this.w=i}get width(){return this.z}set width(e){this.z=e}get height(){return this.w}set height(e){this.w=e}set(e,t,r,i){return this.x=e,this.y=t,this.z=r,this.w=i,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this.w=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setW(e){return this.w=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;case 3:this.w=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=void 0!==e.w?e.w:1,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this.w=e.w+t.w,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this.w+=e.w*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this.w-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this.w=e.w-t.w,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this.w*=e.w,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this}applyMatrix4(e){const t=this.x,r=this.y,i=this.z,s=this.w,o=e.elements;return this.x=o[0]*t+o[4]*r+o[8]*i+o[12]*s,this.y=o[1]*t+o[5]*r+o[9]*i+o[13]*s,this.z=o[2]*t+o[6]*r+o[10]*i+o[14]*s,this.w=o[3]*t+o[7]*r+o[11]*i+o[15]*s,this}divideScalar(e){return this.multiplyScalar(1/e)}setAxisAngleFromQuaternion(e){this.w=2*Math.acos(e.w);const t=Math.sqrt(1-e.w*e.w);return t<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=e.x/t,this.y=e.y/t,this.z=e.z/t),this}setAxisAngleFromRotationMatrix(e){let t,r,i,s;const c=e.elements,l=c[0],u=c[4],d=c[8],h=c[1],f=c[5],m=c[9],y=c[2],_=c[6],g=c[10];if(Math.abs(u-h)<.01&&Math.abs(d-y)<.01&&Math.abs(m-_)<.01){if(Math.abs(u+h)<.1&&Math.abs(d+y)<.1&&Math.abs(m+_)<.1&&Math.abs(l+f+g-3)<.1)return this.set(1,0,0,0),this;t=Math.PI;const E=(l+1)/2,x=(f+1)/2,M=(g+1)/2,C=(u+h)/4,w=(d+y)/4,A=(m+_)/4;return E>x&&E>M?E<.01?(r=0,i=.707106781,s=.707106781):(r=Math.sqrt(E),i=C/r,s=w/r):x>M?x<.01?(r=.707106781,i=0,s=.707106781):(i=Math.sqrt(x),r=C/i,s=A/i):M<.01?(r=.707106781,i=.707106781,s=0):(s=Math.sqrt(M),r=w/s,i=A/s),this.set(r,i,s,t),this}let b=Math.sqrt((_-m)*(_-m)+(d-y)*(d-y)+(h-u)*(h-u));return Math.abs(b)<.001&&(b=1),this.x=(_-m)/b,this.y=(d-y)/b,this.z=(h-u)/b,this.w=Math.acos((l+f+g-1)/2),this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this.w=Math.min(this.w,e.w),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this.w=Math.max(this.w,e.w),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this.w=Math.max(e.w,Math.min(t.w,this.w)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this.w=Math.max(e,Math.min(t,this.w)),this}clampLength(e,t){const r=this.length();return this.divideScalar(r||1).multiplyScalar(Math.max(e,Math.min(t,r)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this.w=Math.trunc(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this.w+=(e.w-this.w)*t,this}lerpVectors(e,t,r){return this.x=e.x+(t.x-e.x)*r,this.y=e.y+(t.y-e.y)*r,this.z=e.z+(t.z-e.z)*r,this.w=e.w+(t.w-e.w)*r,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this.w=e[t+3],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.w,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this.w=e.getW(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}}class MMe extends Aa{constructor(e=1,t=1,r={}){super(),this.isRenderTarget=!0,this.width=e,this.height=t,this.depth=1,this.scissor=new mn(0,0,e,t),this.scissorTest=!1,this.viewport=new mn(0,0,e,t);const i={width:e,height:t,depth:1};void 0!==r.encoding&&(M_("THREE.WebGLRenderTarget: option.encoding has been replaced by option.colorSpace."),r.colorSpace=r.encoding===Lu?jr:""),r=Object.assign({generateMipmaps:!1,internalFormat:null,minFilter:Mr,depthBuffer:!0,stencilBuffer:!1,depthTexture:null,samples:0},r),this.texture=new gs(i,r.mapping,r.wrapS,r.wrapT,r.magFilter,r.minFilter,r.format,r.type,r.anisotropy,r.colorSpace),this.texture.isRenderTargetTexture=!0,this.texture.flipY=!1,this.texture.generateMipmaps=r.generateMipmaps,this.texture.internalFormat=r.internalFormat,this.depthBuffer=r.depthBuffer,this.stencilBuffer=r.stencilBuffer,this.depthTexture=r.depthTexture,this.samples=r.samples}setSize(e,t,r=1){(this.width!==e||this.height!==t||this.depth!==r)&&(this.width=e,this.height=t,this.depth=r,this.texture.image.width=e,this.texture.image.height=t,this.texture.image.depth=r,this.dispose()),this.viewport.set(0,0,e,t),this.scissor.set(0,0,e,t)}clone(){return(new this.constructor).copy(this)}copy(e){this.width=e.width,this.height=e.height,this.depth=e.depth,this.scissor.copy(e.scissor),this.scissorTest=e.scissorTest,this.viewport.copy(e.viewport),this.texture=e.texture.clone(),this.texture.isRenderTargetTexture=!0;const t=Object.assign({},e.texture.image);return this.texture.source=new kf(t),this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,null!==e.depthTexture&&(this.depthTexture=e.depthTexture.clone()),this.samples=e.samples,this}dispose(){this.dispatchEvent({type:"dispose"})}}class Do extends MMe{constructor(e=1,t=1,r={}){super(e,t,r),this.isWebGLRenderTarget=!0}}class LO extends gs{constructor(e=null,t=1,r=1,i=1){super(null),this.isDataArrayTexture=!0,this.image={data:e,width:t,height:r,depth:i},this.magFilter=Ar,this.minFilter=Ar,this.wrapR=Ri,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class PX extends gs{constructor(e=null,t=1,r=1,i=1){super(null),this.isData3DTexture=!0,this.image={data:e,width:t,height:r,depth:i},this.magFilter=Ar,this.minFilter=Ar,this.wrapR=Ri,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class Pi{constructor(e=0,t=0,r=0,i=1){this.isQuaternion=!0,this._x=e,this._y=t,this._z=r,this._w=i}static slerpFlat(e,t,r,i,s,o,a){let c=r[i+0],l=r[i+1],u=r[i+2],d=r[i+3];const h=s[o+0],f=s[o+1],m=s[o+2],y=s[o+3];if(0===a)return e[t+0]=c,e[t+1]=l,e[t+2]=u,void(e[t+3]=d);if(1===a)return e[t+0]=h,e[t+1]=f,e[t+2]=m,void(e[t+3]=y);if(d!==y||c!==h||l!==f||u!==m){let _=1-a;const g=c*h+l*f+u*m+d*y,b=g>=0?1:-1,E=1-g*g;if(E>Number.EPSILON){const M=Math.sqrt(E),C=Math.atan2(M,g*b);_=Math.sin(_*C)/M,a=Math.sin(a*C)/M}const x=a*b;if(c=c*_+h*x,l=l*_+f*x,u=u*_+m*x,d=d*_+y*x,_===1-a){const M=1/Math.sqrt(c*c+l*l+u*u+d*d);c*=M,l*=M,u*=M,d*=M}}e[t]=c,e[t+1]=l,e[t+2]=u,e[t+3]=d}static multiplyQuaternionsFlat(e,t,r,i,s,o){const a=r[i],c=r[i+1],l=r[i+2],u=r[i+3],d=s[o],h=s[o+1],f=s[o+2],m=s[o+3];return e[t]=a*m+u*d+c*f-l*h,e[t+1]=c*m+u*h+l*d-a*f,e[t+2]=l*m+u*f+a*h-c*d,e[t+3]=u*m-a*d-c*h-l*f,e}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get w(){return this._w}set w(e){this._w=e,this._onChangeCallback()}set(e,t,r,i){return this._x=e,this._y=t,this._z=r,this._w=i,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this._onChangeCallback(),this}setFromEuler(e,t){const r=e._x,i=e._y,s=e._z,o=e._order,a=Math.cos,c=Math.sin,l=a(r/2),u=a(i/2),d=a(s/2),h=c(r/2),f=c(i/2),m=c(s/2);switch(o){case"XYZ":this._x=h*u*d+l*f*m,this._y=l*f*d-h*u*m,this._z=l*u*m+h*f*d,this._w=l*u*d-h*f*m;break;case"YXZ":this._x=h*u*d+l*f*m,this._y=l*f*d-h*u*m,this._z=l*u*m-h*f*d,this._w=l*u*d+h*f*m;break;case"ZXY":this._x=h*u*d-l*f*m,this._y=l*f*d+h*u*m,this._z=l*u*m+h*f*d,this._w=l*u*d-h*f*m;break;case"ZYX":this._x=h*u*d-l*f*m,this._y=l*f*d+h*u*m,this._z=l*u*m-h*f*d,this._w=l*u*d+h*f*m;break;case"YZX":this._x=h*u*d+l*f*m,this._y=l*f*d+h*u*m,this._z=l*u*m-h*f*d,this._w=l*u*d-h*f*m;break;case"XZY":this._x=h*u*d-l*f*m,this._y=l*f*d-h*u*m,this._z=l*u*m+h*f*d,this._w=l*u*d+h*f*m;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+o)}return!1!==t&&this._onChangeCallback(),this}setFromAxisAngle(e,t){const r=t/2,i=Math.sin(r);return this._x=e.x*i,this._y=e.y*i,this._z=e.z*i,this._w=Math.cos(r),this._onChangeCallback(),this}setFromRotationMatrix(e){const t=e.elements,r=t[0],i=t[4],s=t[8],o=t[1],a=t[5],c=t[9],l=t[2],u=t[6],d=t[10],h=r+a+d;if(h>0){const f=.5/Math.sqrt(h+1);this._w=.25/f,this._x=(u-c)*f,this._y=(s-l)*f,this._z=(o-i)*f}else if(r>a&&r>d){const f=2*Math.sqrt(1+r-a-d);this._w=(u-c)/f,this._x=.25*f,this._y=(i+o)/f,this._z=(s+l)/f}else if(a>d){const f=2*Math.sqrt(1+a-r-d);this._w=(s-l)/f,this._x=(i+o)/f,this._y=.25*f,this._z=(c+u)/f}else{const f=2*Math.sqrt(1+d-r-a);this._w=(o-i)/f,this._x=(s+l)/f,this._y=(c+u)/f,this._z=.25*f}return this._onChangeCallback(),this}setFromUnitVectors(e,t){let r=e.dot(t)+1;return r<Number.EPSILON?(r=0,Math.abs(e.x)>Math.abs(e.z)?(this._x=-e.y,this._y=e.x,this._z=0,this._w=r):(this._x=0,this._y=-e.z,this._z=e.y,this._w=r)):(this._x=e.y*t.z-e.z*t.y,this._y=e.z*t.x-e.x*t.z,this._z=e.x*t.y-e.y*t.x,this._w=r),this.normalize()}angleTo(e){return 2*Math.acos(Math.abs(sr(this.dot(e),-1,1)))}rotateTowards(e,t){const r=this.angleTo(e);if(0===r)return this;const i=Math.min(1,t/r);return this.slerp(e,i),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let e=this.length();return 0===e?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this._onChangeCallback(),this}multiply(e){return this.multiplyQuaternions(this,e)}premultiply(e){return this.multiplyQuaternions(e,this)}multiplyQuaternions(e,t){const r=e._x,i=e._y,s=e._z,o=e._w,a=t._x,c=t._y,l=t._z,u=t._w;return this._x=r*u+o*a+i*l-s*c,this._y=i*u+o*c+s*a-r*l,this._z=s*u+o*l+r*c-i*a,this._w=o*u-r*a-i*c-s*l,this._onChangeCallback(),this}slerp(e,t){if(0===t)return this;if(1===t)return this.copy(e);const r=this._x,i=this._y,s=this._z,o=this._w;let a=o*e._w+r*e._x+i*e._y+s*e._z;if(a<0?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,a=-a):this.copy(e),a>=1)return this._w=o,this._x=r,this._y=i,this._z=s,this;const c=1-a*a;if(c<=Number.EPSILON){const f=1-t;return this._w=f*o+t*this._w,this._x=f*r+t*this._x,this._y=f*i+t*this._y,this._z=f*s+t*this._z,this.normalize(),this._onChangeCallback(),this}const l=Math.sqrt(c),u=Math.atan2(l,a),d=Math.sin((1-t)*u)/l,h=Math.sin(t*u)/l;return this._w=o*d+this._w*h,this._x=r*d+this._x*h,this._y=i*d+this._y*h,this._z=s*d+this._z*h,this._onChangeCallback(),this}slerpQuaternions(e,t,r){return this.copy(e).slerp(t,r)}random(){const e=Math.random(),t=Math.sqrt(1-e),r=Math.sqrt(e),i=2*Math.PI*Math.random(),s=2*Math.PI*Math.random();return this.set(t*Math.cos(i),r*Math.sin(s),r*Math.cos(s),t*Math.sin(i))}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w}fromArray(e,t=0){return this._x=e[t],this._y=e[t+1],this._z=e[t+2],this._w=e[t+3],this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._w,e}fromBufferAttribute(e,t){return this._x=e.getX(t),this._y=e.getY(t),this._z=e.getZ(t),this._w=e.getW(t),this}toJSON(){return this.toArray()}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}}class L{constructor(e=0,t=0,r=0){L.prototype.isVector3=!0,this.x=e,this.y=t,this.z=r}set(e,t,r){return void 0===r&&(r=this.z),this.x=e,this.y=t,this.z=r,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this}multiplyVectors(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this}applyEuler(e){return this.applyQuaternion(NX.setFromEuler(e))}applyAxisAngle(e,t){return this.applyQuaternion(NX.setFromAxisAngle(e,t))}applyMatrix3(e){const t=this.x,r=this.y,i=this.z,s=e.elements;return this.x=s[0]*t+s[3]*r+s[6]*i,this.y=s[1]*t+s[4]*r+s[7]*i,this.z=s[2]*t+s[5]*r+s[8]*i,this}applyNormalMatrix(e){return this.applyMatrix3(e).normalize()}applyMatrix4(e){const t=this.x,r=this.y,i=this.z,s=e.elements,o=1/(s[3]*t+s[7]*r+s[11]*i+s[15]);return this.x=(s[0]*t+s[4]*r+s[8]*i+s[12])*o,this.y=(s[1]*t+s[5]*r+s[9]*i+s[13])*o,this.z=(s[2]*t+s[6]*r+s[10]*i+s[14])*o,this}applyQuaternion(e){const t=this.x,r=this.y,i=this.z,s=e.x,o=e.y,a=e.z,c=e.w,l=2*(o*i-a*r),u=2*(a*t-s*i),d=2*(s*r-o*t);return this.x=t+c*l+o*d-a*u,this.y=r+c*u+a*l-s*d,this.z=i+c*d+s*u-o*l,this}project(e){return this.applyMatrix4(e.matrixWorldInverse).applyMatrix4(e.projectionMatrix)}unproject(e){return this.applyMatrix4(e.projectionMatrixInverse).applyMatrix4(e.matrixWorld)}transformDirection(e){const t=this.x,r=this.y,i=this.z,s=e.elements;return this.x=s[0]*t+s[4]*r+s[8]*i,this.y=s[1]*t+s[5]*r+s[9]*i,this.z=s[2]*t+s[6]*r+s[10]*i,this.normalize()}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this}divideScalar(e){return this.multiplyScalar(1/e)}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this}clampLength(e,t){const r=this.length();return this.divideScalar(r||1).multiplyScalar(Math.max(e,Math.min(t,r)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this}lerpVectors(e,t,r){return this.x=e.x+(t.x-e.x)*r,this.y=e.y+(t.y-e.y)*r,this.z=e.z+(t.z-e.z)*r,this}cross(e){return this.crossVectors(this,e)}crossVectors(e,t){const r=e.x,i=e.y,s=e.z,o=t.x,a=t.y,c=t.z;return this.x=i*c-s*a,this.y=s*o-r*c,this.z=r*a-i*o,this}projectOnVector(e){const t=e.lengthSq();if(0===t)return this.set(0,0,0);const r=e.dot(this)/t;return this.copy(e).multiplyScalar(r)}projectOnPlane(e){return FO.copy(this).projectOnVector(e),this.sub(FO)}reflect(e){return this.sub(FO.copy(e).multiplyScalar(2*this.dot(e)))}angleTo(e){const t=Math.sqrt(this.lengthSq()*e.lengthSq());if(0===t)return Math.PI/2;const r=this.dot(e)/t;return Math.acos(sr(r,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,r=this.y-e.y,i=this.z-e.z;return t*t+r*r+i*i}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)}setFromSpherical(e){return this.setFromSphericalCoords(e.radius,e.phi,e.theta)}setFromSphericalCoords(e,t,r){const i=Math.sin(t)*e;return this.x=i*Math.sin(r),this.y=Math.cos(t)*e,this.z=i*Math.cos(r),this}setFromCylindrical(e){return this.setFromCylindricalCoords(e.radius,e.theta,e.y)}setFromCylindricalCoords(e,t,r){return this.x=e*Math.sin(t),this.y=r,this.z=e*Math.cos(t),this}setFromMatrixPosition(e){const t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this}setFromMatrixScale(e){const t=this.setFromMatrixColumn(e,0).length(),r=this.setFromMatrixColumn(e,1).length(),i=this.setFromMatrixColumn(e,2).length();return this.x=t,this.y=r,this.z=i,this}setFromMatrixColumn(e,t){return this.fromArray(e.elements,4*t)}setFromMatrix3Column(e,t){return this.fromArray(e.elements,3*t)}setFromEuler(e){return this.x=e._x,this.y=e._y,this.z=e._z,this}setFromColor(e){return this.x=e.r,this.y=e.g,this.z=e.b,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){const e=2*(Math.random()-.5),t=Math.random()*Math.PI*2,r=Math.sqrt(1-e**2);return this.x=r*Math.cos(t),this.y=r*Math.sin(t),this.z=e,this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}}const FO=new L,NX=new Pi;class Ro{constructor(e=new L(1/0,1/0,1/0),t=new L(-1/0,-1/0,-1/0)){this.isBox3=!0,this.min=e,this.max=t}set(e,t){return this.min.copy(e),this.max.copy(t),this}setFromArray(e){this.makeEmpty();for(let t=0,r=e.length;t<r;t+=3)this.expandByPoint(Js.fromArray(e,t));return this}setFromBufferAttribute(e){this.makeEmpty();for(let t=0,r=e.count;t<r;t++)this.expandByPoint(Js.fromBufferAttribute(e,t));return this}setFromPoints(e){this.makeEmpty();for(let t=0,r=e.length;t<r;t++)this.expandByPoint(e[t]);return this}setFromCenterAndSize(e,t){const r=Js.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(r),this.max.copy(e).add(r),this}setFromObject(e,t=!1){return this.makeEmpty(),this.expandByObject(e,t)}clone(){return(new this.constructor).copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(e){return this.isEmpty()?e.set(0,0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}expandByObject(e,t=!1){e.updateWorldMatrix(!1,!1);const r=e.geometry;if(void 0!==r){const s=r.getAttribute("position");if(!0===t&&void 0!==s&&!0!==e.isInstancedMesh)for(let o=0,a=s.count;o<a;o++)!0===e.isMesh?e.getVertexPosition(o,Js):Js.fromBufferAttribute(s,o),Js.applyMatrix4(e.matrixWorld),this.expandByPoint(Js);else void 0!==e.boundingBox?(null===e.boundingBox&&e.computeBoundingBox(),DT.copy(e.boundingBox)):(null===r.boundingBox&&r.computeBoundingBox(),DT.copy(r.boundingBox)),DT.applyMatrix4(e.matrixWorld),this.union(DT)}const i=e.children;for(let s=0,o=i.length;s<o;s++)this.expandByObject(i[s],t);return this}containsPoint(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y||e.z<this.min.z||e.z>this.max.z)}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z}getParameter(e,t){return t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y||e.max.z<this.min.z||e.min.z>this.max.z)}intersectsSphere(e){return this.clampPoint(e.center,Js),Js.distanceToSquared(e.center)<=e.radius*e.radius}intersectsPlane(e){let t,r;return e.normal.x>0?(t=e.normal.x*this.min.x,r=e.normal.x*this.max.x):(t=e.normal.x*this.max.x,r=e.normal.x*this.min.x),e.normal.y>0?(t+=e.normal.y*this.min.y,r+=e.normal.y*this.max.y):(t+=e.normal.y*this.max.y,r+=e.normal.y*this.min.y),e.normal.z>0?(t+=e.normal.z*this.min.z,r+=e.normal.z*this.max.z):(t+=e.normal.z*this.max.z,r+=e.normal.z*this.min.z),t<=-e.constant&&r>=-e.constant}intersectsTriangle(e){if(this.isEmpty())return!1;this.getCenter(C_),RT.subVectors(this.max,C_),Lf.subVectors(e.a,C_),Ff.subVectors(e.b,C_),Vf.subVectors(e.c,C_),Kc.subVectors(Ff,Lf),Yc.subVectors(Vf,Ff),Uu.subVectors(Lf,Vf);let t=[0,-Kc.z,Kc.y,0,-Yc.z,Yc.y,0,-Uu.z,Uu.y,Kc.z,0,-Kc.x,Yc.z,0,-Yc.x,Uu.z,0,-Uu.x,-Kc.y,Kc.x,0,-Yc.y,Yc.x,0,-Uu.y,Uu.x,0];return!(!VO(t,Lf,Ff,Vf,RT)||(t=[1,0,0,0,1,0,0,0,1],!VO(t,Lf,Ff,Vf,RT)))&&(PT.crossVectors(Kc,Yc),t=[PT.x,PT.y,PT.z],VO(t,Lf,Ff,Vf,RT))}clampPoint(e,t){return t.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return this.clampPoint(e,Js).distanceTo(e)}getBoundingSphere(e){return this.isEmpty()?e.makeEmpty():(this.getCenter(e.center),e.radius=.5*this.getSize(Js).length()),e}intersect(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}applyMatrix4(e){return this.isEmpty()||(Ma[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(e),Ma[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(e),Ma[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(e),Ma[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(e),Ma[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(e),Ma[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(e),Ma[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(e),Ma[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(e),this.setFromPoints(Ma)),this}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}const Ma=[new L,new L,new L,new L,new L,new L,new L,new L],Js=new L,DT=new Ro,Lf=new L,Ff=new L,Vf=new L,Kc=new L,Yc=new L,Uu=new L,C_=new L,RT=new L,PT=new L,Bu=new L;function VO(n,e,t,r,i){for(let s=0,o=n.length-3;s<=o;s+=3){Bu.fromArray(n,s);const a=i.x*Math.abs(Bu.x)+i.y*Math.abs(Bu.y)+i.z*Math.abs(Bu.z),c=e.dot(Bu),l=t.dot(Bu),u=r.dot(Bu);if(Math.max(-Math.max(c,l,u),Math.min(c,l,u))>a)return!1}return!0}const CMe=new Ro,D_=new L,UO=new L;class Po{constructor(e=new L,t=-1){this.center=e,this.radius=t}set(e,t){return this.center.copy(e),this.radius=t,this}setFromPoints(e,t){const r=this.center;void 0!==t?r.copy(t):CMe.setFromPoints(e).getCenter(r);let i=0;for(let s=0,o=e.length;s<o;s++)i=Math.max(i,r.distanceToSquared(e[s]));return this.radius=Math.sqrt(i),this}copy(e){return this.center.copy(e.center),this.radius=e.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(e){return e.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(e){return e.distanceTo(this.center)-this.radius}intersectsSphere(e){const t=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=t*t}intersectsBox(e){return e.intersectsSphere(this)}intersectsPlane(e){return Math.abs(e.distanceToPoint(this.center))<=this.radius}clampPoint(e,t){const r=this.center.distanceToSquared(e);return t.copy(e),r>this.radius*this.radius&&(t.sub(this.center).normalize(),t.multiplyScalar(this.radius).add(this.center)),t}getBoundingBox(e){return this.isEmpty()?(e.makeEmpty(),e):(e.set(this.center,this.center),e.expandByScalar(this.radius),e)}applyMatrix4(e){return this.center.applyMatrix4(e),this.radius=this.radius*e.getMaxScaleOnAxis(),this}translate(e){return this.center.add(e),this}expandByPoint(e){if(this.isEmpty())return this.center.copy(e),this.radius=0,this;D_.subVectors(e,this.center);const t=D_.lengthSq();if(t>this.radius*this.radius){const r=Math.sqrt(t),i=.5*(r-this.radius);this.center.addScaledVector(D_,i/r),this.radius+=i}return this}union(e){return e.isEmpty()?this:this.isEmpty()?(this.copy(e),this):(!0===this.center.equals(e.center)?this.radius=Math.max(this.radius,e.radius):(UO.subVectors(e.center,this.center).setLength(e.radius),this.expandByPoint(D_.copy(e.center).add(UO)),this.expandByPoint(D_.copy(e.center).sub(UO))),this)}equals(e){return e.center.equals(this.center)&&e.radius===this.radius}clone(){return(new this.constructor).copy(this)}}const Ca=new L,BO=new L,NT=new L,Jc=new L,HO=new L,OT=new L,zO=new L;class Uf{constructor(e=new L,t=new L(0,0,-1)){this.origin=e,this.direction=t}set(e,t){return this.origin.copy(e),this.direction.copy(t),this}copy(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this}at(e,t){return t.copy(this.origin).addScaledVector(this.direction,e)}lookAt(e){return this.direction.copy(e).sub(this.origin).normalize(),this}recast(e){return this.origin.copy(this.at(e,Ca)),this}closestPointToPoint(e,t){t.subVectors(e,this.origin);const r=t.dot(this.direction);return r<0?t.copy(this.origin):t.copy(this.origin).addScaledVector(this.direction,r)}distanceToPoint(e){return Math.sqrt(this.distanceSqToPoint(e))}distanceSqToPoint(e){const t=Ca.subVectors(e,this.origin).dot(this.direction);return t<0?this.origin.distanceToSquared(e):(Ca.copy(this.origin).addScaledVector(this.direction,t),Ca.distanceToSquared(e))}distanceSqToSegment(e,t,r,i){BO.copy(e).add(t).multiplyScalar(.5),NT.copy(t).sub(e).normalize(),Jc.copy(this.origin).sub(BO);const s=.5*e.distanceTo(t),o=-this.direction.dot(NT),a=Jc.dot(this.direction),c=-Jc.dot(NT),l=Jc.lengthSq(),u=Math.abs(1-o*o);let d,h,f,m;if(u>0)if(d=o*c-a,h=o*a-c,m=s*u,d>=0)if(h>=-m)if(h<=m){const y=1/u;d*=y,h*=y,f=d*(d+o*h+2*a)+h*(o*d+h+2*c)+l}else h=s,d=Math.max(0,-(o*h+a)),f=-d*d+h*(h+2*c)+l;else h=-s,d=Math.max(0,-(o*h+a)),f=-d*d+h*(h+2*c)+l;else h<=-m?(d=Math.max(0,-(-o*s+a)),h=d>0?-s:Math.min(Math.max(-s,-c),s),f=-d*d+h*(h+2*c)+l):h<=m?(d=0,h=Math.min(Math.max(-s,-c),s),f=h*(h+2*c)+l):(d=Math.max(0,-(o*s+a)),h=d>0?s:Math.min(Math.max(-s,-c),s),f=-d*d+h*(h+2*c)+l);else h=o>0?-s:s,d=Math.max(0,-(o*h+a)),f=-d*d+h*(h+2*c)+l;return r&&r.copy(this.origin).addScaledVector(this.direction,d),i&&i.copy(BO).addScaledVector(NT,h),f}intersectSphere(e,t){Ca.subVectors(e.center,this.origin);const r=Ca.dot(this.direction),i=Ca.dot(Ca)-r*r,s=e.radius*e.radius;if(i>s)return null;const o=Math.sqrt(s-i),a=r-o,c=r+o;return c<0?null:this.at(a<0?c:a,t)}intersectsSphere(e){return this.distanceSqToPoint(e.center)<=e.radius*e.radius}distanceToPlane(e){const t=e.normal.dot(this.direction);if(0===t)return 0===e.distanceToPoint(this.origin)?0:null;const r=-(this.origin.dot(e.normal)+e.constant)/t;return r>=0?r:null}intersectPlane(e,t){const r=this.distanceToPlane(e);return null===r?null:this.at(r,t)}intersectsPlane(e){const t=e.distanceToPoint(this.origin);return 0===t||e.normal.dot(this.direction)*t<0}intersectBox(e,t){let r,i,s,o,a,c;const l=1/this.direction.x,u=1/this.direction.y,d=1/this.direction.z,h=this.origin;return l>=0?(r=(e.min.x-h.x)*l,i=(e.max.x-h.x)*l):(r=(e.max.x-h.x)*l,i=(e.min.x-h.x)*l),u>=0?(s=(e.min.y-h.y)*u,o=(e.max.y-h.y)*u):(s=(e.max.y-h.y)*u,o=(e.min.y-h.y)*u),r>o||s>i||((s>r||isNaN(r))&&(r=s),(o<i||isNaN(i))&&(i=o),d>=0?(a=(e.min.z-h.z)*d,c=(e.max.z-h.z)*d):(a=(e.max.z-h.z)*d,c=(e.min.z-h.z)*d),r>c||a>i)||((a>r||r!=r)&&(r=a),(c<i||i!=i)&&(i=c),i<0)?null:this.at(r>=0?r:i,t)}intersectsBox(e){return null!==this.intersectBox(e,Ca)}intersectTriangle(e,t,r,i,s){HO.subVectors(t,e),OT.subVectors(r,e),zO.crossVectors(HO,OT);let a,o=this.direction.dot(zO);if(o>0){if(i)return null;a=1}else{if(!(o<0))return null;a=-1,o=-o}Jc.subVectors(this.origin,e);const c=a*this.direction.dot(OT.crossVectors(Jc,OT));if(c<0)return null;const l=a*this.direction.dot(HO.cross(Jc));if(l<0||c+l>o)return null;const u=-a*Jc.dot(zO);return u<0?null:this.at(u/o,s)}applyMatrix4(e){return this.origin.applyMatrix4(e),this.direction.transformDirection(e),this}equals(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)}clone(){return(new this.constructor).copy(this)}}class Pt{constructor(e,t,r,i,s,o,a,c,l,u,d,h,f,m,y,_){Pt.prototype.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],void 0!==e&&this.set(e,t,r,i,s,o,a,c,l,u,d,h,f,m,y,_)}set(e,t,r,i,s,o,a,c,l,u,d,h,f,m,y,_){const g=this.elements;return g[0]=e,g[4]=t,g[8]=r,g[12]=i,g[1]=s,g[5]=o,g[9]=a,g[13]=c,g[2]=l,g[6]=u,g[10]=d,g[14]=h,g[3]=f,g[7]=m,g[11]=y,g[15]=_,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return(new Pt).fromArray(this.elements)}copy(e){const t=this.elements,r=e.elements;return t[0]=r[0],t[1]=r[1],t[2]=r[2],t[3]=r[3],t[4]=r[4],t[5]=r[5],t[6]=r[6],t[7]=r[7],t[8]=r[8],t[9]=r[9],t[10]=r[10],t[11]=r[11],t[12]=r[12],t[13]=r[13],t[14]=r[14],t[15]=r[15],this}copyPosition(e){const t=this.elements,r=e.elements;return t[12]=r[12],t[13]=r[13],t[14]=r[14],this}setFromMatrix3(e){const t=e.elements;return this.set(t[0],t[3],t[6],0,t[1],t[4],t[7],0,t[2],t[5],t[8],0,0,0,0,1),this}extractBasis(e,t,r){return e.setFromMatrixColumn(this,0),t.setFromMatrixColumn(this,1),r.setFromMatrixColumn(this,2),this}makeBasis(e,t,r){return this.set(e.x,t.x,r.x,0,e.y,t.y,r.y,0,e.z,t.z,r.z,0,0,0,0,1),this}extractRotation(e){const t=this.elements,r=e.elements,i=1/Bf.setFromMatrixColumn(e,0).length(),s=1/Bf.setFromMatrixColumn(e,1).length(),o=1/Bf.setFromMatrixColumn(e,2).length();return t[0]=r[0]*i,t[1]=r[1]*i,t[2]=r[2]*i,t[3]=0,t[4]=r[4]*s,t[5]=r[5]*s,t[6]=r[6]*s,t[7]=0,t[8]=r[8]*o,t[9]=r[9]*o,t[10]=r[10]*o,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromEuler(e){const t=this.elements,r=e.x,i=e.y,s=e.z,o=Math.cos(r),a=Math.sin(r),c=Math.cos(i),l=Math.sin(i),u=Math.cos(s),d=Math.sin(s);if("XYZ"===e.order){const h=o*u,f=o*d,m=a*u,y=a*d;t[0]=c*u,t[4]=-c*d,t[8]=l,t[1]=f+m*l,t[5]=h-y*l,t[9]=-a*c,t[2]=y-h*l,t[6]=m+f*l,t[10]=o*c}else if("YXZ"===e.order){const h=c*u,f=c*d,m=l*u,y=l*d;t[0]=h+y*a,t[4]=m*a-f,t[8]=o*l,t[1]=o*d,t[5]=o*u,t[9]=-a,t[2]=f*a-m,t[6]=y+h*a,t[10]=o*c}else if("ZXY"===e.order){const h=c*u,f=c*d,m=l*u,y=l*d;t[0]=h-y*a,t[4]=-o*d,t[8]=m+f*a,t[1]=f+m*a,t[5]=o*u,t[9]=y-h*a,t[2]=-o*l,t[6]=a,t[10]=o*c}else if("ZYX"===e.order){const h=o*u,f=o*d,m=a*u,y=a*d;t[0]=c*u,t[4]=m*l-f,t[8]=h*l+y,t[1]=c*d,t[5]=y*l+h,t[9]=f*l-m,t[2]=-l,t[6]=a*c,t[10]=o*c}else if("YZX"===e.order){const h=o*c,f=o*l,m=a*c,y=a*l;t[0]=c*u,t[4]=y-h*d,t[8]=m*d+f,t[1]=d,t[5]=o*u,t[9]=-a*u,t[2]=-l*u,t[6]=f*d+m,t[10]=h-y*d}else if("XZY"===e.order){const h=o*c,f=o*l,m=a*c,y=a*l;t[0]=c*u,t[4]=-d,t[8]=l*u,t[1]=h*d+y,t[5]=o*u,t[9]=f*d-m,t[2]=m*d-f,t[6]=a*u,t[10]=y*d+h}return t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromQuaternion(e){return this.compose(DMe,e,RMe)}lookAt(e,t,r){const i=this.elements;return _s.subVectors(e,t),0===_s.lengthSq()&&(_s.z=1),_s.normalize(),Zc.crossVectors(r,_s),0===Zc.lengthSq()&&(1===Math.abs(r.z)?_s.x+=1e-4:_s.z+=1e-4,_s.normalize(),Zc.crossVectors(r,_s)),Zc.normalize(),kT.crossVectors(_s,Zc),i[0]=Zc.x,i[4]=kT.x,i[8]=_s.x,i[1]=Zc.y,i[5]=kT.y,i[9]=_s.y,i[2]=Zc.z,i[6]=kT.z,i[10]=_s.z,this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const r=e.elements,i=t.elements,s=this.elements,o=r[0],a=r[4],c=r[8],l=r[12],u=r[1],d=r[5],h=r[9],f=r[13],m=r[2],y=r[6],_=r[10],g=r[14],b=r[3],E=r[7],x=r[11],M=r[15],C=i[0],w=i[4],A=i[8],T=i[12],S=i[1],R=i[5],F=i[9],N=i[13],H=i[2],K=i[6],se=i[10],ne=i[14],ye=i[3],ce=i[7],ge=i[11],G=i[15];return s[0]=o*C+a*S+c*H+l*ye,s[4]=o*w+a*R+c*K+l*ce,s[8]=o*A+a*F+c*se+l*ge,s[12]=o*T+a*N+c*ne+l*G,s[1]=u*C+d*S+h*H+f*ye,s[5]=u*w+d*R+h*K+f*ce,s[9]=u*A+d*F+h*se+f*ge,s[13]=u*T+d*N+h*ne+f*G,s[2]=m*C+y*S+_*H+g*ye,s[6]=m*w+y*R+_*K+g*ce,s[10]=m*A+y*F+_*se+g*ge,s[14]=m*T+y*N+_*ne+g*G,s[3]=b*C+E*S+x*H+M*ye,s[7]=b*w+E*R+x*K+M*ce,s[11]=b*A+E*F+x*se+M*ge,s[15]=b*T+E*N+x*ne+M*G,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this}determinant(){const e=this.elements,t=e[0],r=e[4],i=e[8],s=e[12],o=e[1],a=e[5],c=e[9],l=e[13],u=e[2],d=e[6],h=e[10],f=e[14];return e[3]*(+s*c*d-i*l*d-s*a*h+r*l*h+i*a*f-r*c*f)+e[7]*(+t*c*f-t*l*h+s*o*h-i*o*f+i*l*u-s*c*u)+e[11]*(+t*l*d-t*a*f-s*o*d+r*o*f+s*a*u-r*l*u)+e[15]*(-i*a*u-t*c*d+t*a*h+i*o*d-r*o*h+r*c*u)}transpose(){const e=this.elements;let t;return t=e[1],e[1]=e[4],e[4]=t,t=e[2],e[2]=e[8],e[8]=t,t=e[6],e[6]=e[9],e[9]=t,t=e[3],e[3]=e[12],e[12]=t,t=e[7],e[7]=e[13],e[13]=t,t=e[11],e[11]=e[14],e[14]=t,this}setPosition(e,t,r){const i=this.elements;return e.isVector3?(i[12]=e.x,i[13]=e.y,i[14]=e.z):(i[12]=e,i[13]=t,i[14]=r),this}invert(){const e=this.elements,t=e[0],r=e[1],i=e[2],s=e[3],o=e[4],a=e[5],c=e[6],l=e[7],u=e[8],d=e[9],h=e[10],f=e[11],m=e[12],y=e[13],_=e[14],g=e[15],b=d*_*l-y*h*l+y*c*f-a*_*f-d*c*g+a*h*g,E=m*h*l-u*_*l-m*c*f+o*_*f+u*c*g-o*h*g,x=u*y*l-m*d*l+m*a*f-o*y*f-u*a*g+o*d*g,M=m*d*c-u*y*c-m*a*h+o*y*h+u*a*_-o*d*_,C=t*b+r*E+i*x+s*M;if(0===C)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const w=1/C;return e[0]=b*w,e[1]=(y*h*s-d*_*s-y*i*f+r*_*f+d*i*g-r*h*g)*w,e[2]=(a*_*s-y*c*s+y*i*l-r*_*l-a*i*g+r*c*g)*w,e[3]=(d*c*s-a*h*s-d*i*l+r*h*l+a*i*f-r*c*f)*w,e[4]=E*w,e[5]=(u*_*s-m*h*s+m*i*f-t*_*f-u*i*g+t*h*g)*w,e[6]=(m*c*s-o*_*s-m*i*l+t*_*l+o*i*g-t*c*g)*w,e[7]=(o*h*s-u*c*s+u*i*l-t*h*l-o*i*f+t*c*f)*w,e[8]=x*w,e[9]=(m*d*s-u*y*s-m*r*f+t*y*f+u*r*g-t*d*g)*w,e[10]=(o*y*s-m*a*s+m*r*l-t*y*l-o*r*g+t*a*g)*w,e[11]=(u*a*s-o*d*s-u*r*l+t*d*l+o*r*f-t*a*f)*w,e[12]=M*w,e[13]=(u*y*i-m*d*i+m*r*h-t*y*h-u*r*_+t*d*_)*w,e[14]=(m*a*i-o*y*i-m*r*c+t*y*c+o*r*_-t*a*_)*w,e[15]=(o*d*i-u*a*i+u*r*c-t*d*c-o*r*h+t*a*h)*w,this}scale(e){const t=this.elements,r=e.x,i=e.y,s=e.z;return t[0]*=r,t[4]*=i,t[8]*=s,t[1]*=r,t[5]*=i,t[9]*=s,t[2]*=r,t[6]*=i,t[10]*=s,t[3]*=r,t[7]*=i,t[11]*=s,this}getMaxScaleOnAxis(){const e=this.elements;return Math.sqrt(Math.max(e[0]*e[0]+e[1]*e[1]+e[2]*e[2],e[4]*e[4]+e[5]*e[5]+e[6]*e[6],e[8]*e[8]+e[9]*e[9]+e[10]*e[10]))}makeTranslation(e,t,r){return e.isVector3?this.set(1,0,0,e.x,0,1,0,e.y,0,0,1,e.z,0,0,0,1):this.set(1,0,0,e,0,1,0,t,0,0,1,r,0,0,0,1),this}makeRotationX(e){const t=Math.cos(e),r=Math.sin(e);return this.set(1,0,0,0,0,t,-r,0,0,r,t,0,0,0,0,1),this}makeRotationY(e){const t=Math.cos(e),r=Math.sin(e);return this.set(t,0,r,0,0,1,0,0,-r,0,t,0,0,0,0,1),this}makeRotationZ(e){const t=Math.cos(e),r=Math.sin(e);return this.set(t,-r,0,0,r,t,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(e,t){const r=Math.cos(t),i=Math.sin(t),s=1-r,o=e.x,a=e.y,c=e.z,l=s*o,u=s*a;return this.set(l*o+r,l*a-i*c,l*c+i*a,0,l*a+i*c,u*a+r,u*c-i*o,0,l*c-i*a,u*c+i*o,s*c*c+r,0,0,0,0,1),this}makeScale(e,t,r){return this.set(e,0,0,0,0,t,0,0,0,0,r,0,0,0,0,1),this}makeShear(e,t,r,i,s,o){return this.set(1,r,s,0,e,1,o,0,t,i,1,0,0,0,0,1),this}compose(e,t,r){const i=this.elements,s=t._x,o=t._y,a=t._z,c=t._w,l=s+s,u=o+o,d=a+a,h=s*l,f=s*u,m=s*d,y=o*u,_=o*d,g=a*d,b=c*l,E=c*u,x=c*d,M=r.x,C=r.y,w=r.z;return i[0]=(1-(y+g))*M,i[1]=(f+x)*M,i[2]=(m-E)*M,i[3]=0,i[4]=(f-x)*C,i[5]=(1-(h+g))*C,i[6]=(_+b)*C,i[7]=0,i[8]=(m+E)*w,i[9]=(_-b)*w,i[10]=(1-(h+y))*w,i[11]=0,i[12]=e.x,i[13]=e.y,i[14]=e.z,i[15]=1,this}decompose(e,t,r){const i=this.elements;let s=Bf.set(i[0],i[1],i[2]).length();const o=Bf.set(i[4],i[5],i[6]).length(),a=Bf.set(i[8],i[9],i[10]).length();this.determinant()<0&&(s=-s),e.x=i[12],e.y=i[13],e.z=i[14],Zs.copy(this);const l=1/s,u=1/o,d=1/a;return Zs.elements[0]*=l,Zs.elements[1]*=l,Zs.elements[2]*=l,Zs.elements[4]*=u,Zs.elements[5]*=u,Zs.elements[6]*=u,Zs.elements[8]*=d,Zs.elements[9]*=d,Zs.elements[10]*=d,t.setFromRotationMatrix(Zs),r.x=s,r.y=o,r.z=a,this}makePerspective(e,t,r,i,s,o,a=xa){const c=this.elements,l=2*s/(t-e),u=2*s/(r-i),d=(t+e)/(t-e),h=(r+i)/(r-i);let f,m;if(a===xa)f=-(o+s)/(o-s),m=-2*o*s/(o-s);else{if(2001!==a)throw new Error("THREE.Matrix4.makePerspective(): Invalid coordinate system: "+a);f=-o/(o-s),m=-o*s/(o-s)}return c[0]=l,c[4]=0,c[8]=d,c[12]=0,c[1]=0,c[5]=u,c[9]=h,c[13]=0,c[2]=0,c[6]=0,c[10]=f,c[14]=m,c[3]=0,c[7]=0,c[11]=-1,c[15]=0,this}makeOrthographic(e,t,r,i,s,o,a=xa){const c=this.elements,l=1/(t-e),u=1/(r-i),d=1/(o-s),h=(t+e)*l,f=(r+i)*u;let m,y;if(a===xa)m=(o+s)*d,y=-2*d;else{if(2001!==a)throw new Error("THREE.Matrix4.makeOrthographic(): Invalid coordinate system: "+a);m=s*d,y=-1*d}return c[0]=2*l,c[4]=0,c[8]=0,c[12]=-h,c[1]=0,c[5]=2*u,c[9]=0,c[13]=-f,c[2]=0,c[6]=0,c[10]=y,c[14]=-m,c[3]=0,c[7]=0,c[11]=0,c[15]=1,this}equals(e){const t=this.elements,r=e.elements;for(let i=0;i<16;i++)if(t[i]!==r[i])return!1;return!0}fromArray(e,t=0){for(let r=0;r<16;r++)this.elements[r]=e[r+t];return this}toArray(e=[],t=0){const r=this.elements;return e[t]=r[0],e[t+1]=r[1],e[t+2]=r[2],e[t+3]=r[3],e[t+4]=r[4],e[t+5]=r[5],e[t+6]=r[6],e[t+7]=r[7],e[t+8]=r[8],e[t+9]=r[9],e[t+10]=r[10],e[t+11]=r[11],e[t+12]=r[12],e[t+13]=r[13],e[t+14]=r[14],e[t+15]=r[15],e}}const Bf=new L,Zs=new Pt,DMe=new L(0,0,0),RMe=new L(1,1,1),Zc=new L,kT=new L,_s=new L,OX=new Pt,kX=new Pi;let PMe=(()=>{class n{constructor(t=0,r=0,i=0,s=n.DEFAULT_ORDER){this.isEuler=!0,this._x=t,this._y=r,this._z=i,this._order=s}get x(){return this._x}set x(t){this._x=t,this._onChangeCallback()}get y(){return this._y}set y(t){this._y=t,this._onChangeCallback()}get z(){return this._z}set z(t){this._z=t,this._onChangeCallback()}get order(){return this._order}set order(t){this._order=t,this._onChangeCallback()}set(t,r,i,s=this._order){return this._x=t,this._y=r,this._z=i,this._order=s,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(t){return this._x=t._x,this._y=t._y,this._z=t._z,this._order=t._order,this._onChangeCallback(),this}setFromRotationMatrix(t,r=this._order,i=!0){const s=t.elements,o=s[0],a=s[4],c=s[8],l=s[1],u=s[5],d=s[9],h=s[2],f=s[6],m=s[10];switch(r){case"XYZ":this._y=Math.asin(sr(c,-1,1)),Math.abs(c)<.9999999?(this._x=Math.atan2(-d,m),this._z=Math.atan2(-a,o)):(this._x=Math.atan2(f,u),this._z=0);break;case"YXZ":this._x=Math.asin(-sr(d,-1,1)),Math.abs(d)<.9999999?(this._y=Math.atan2(c,m),this._z=Math.atan2(l,u)):(this._y=Math.atan2(-h,o),this._z=0);break;case"ZXY":this._x=Math.asin(sr(f,-1,1)),Math.abs(f)<.9999999?(this._y=Math.atan2(-h,m),this._z=Math.atan2(-a,u)):(this._y=0,this._z=Math.atan2(l,o));break;case"ZYX":this._y=Math.asin(-sr(h,-1,1)),Math.abs(h)<.9999999?(this._x=Math.atan2(f,m),this._z=Math.atan2(l,o)):(this._x=0,this._z=Math.atan2(-a,u));break;case"YZX":this._z=Math.asin(sr(l,-1,1)),Math.abs(l)<.9999999?(this._x=Math.atan2(-d,u),this._y=Math.atan2(-h,o)):(this._x=0,this._y=Math.atan2(c,m));break;case"XZY":this._z=Math.asin(-sr(a,-1,1)),Math.abs(a)<.9999999?(this._x=Math.atan2(f,u),this._y=Math.atan2(c,o)):(this._x=Math.atan2(-d,m),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+r)}return this._order=r,!0===i&&this._onChangeCallback(),this}setFromQuaternion(t,r,i){return OX.makeRotationFromQuaternion(t),this.setFromRotationMatrix(OX,r,i)}setFromVector3(t,r=this._order){return this.set(t.x,t.y,t.z,r)}reorder(t){return kX.setFromEuler(this),this.setFromQuaternion(kX,t)}equals(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._order===this._order}fromArray(t){return this._x=t[0],this._y=t[1],this._z=t[2],void 0!==t[3]&&(this._order=t[3]),this._onChangeCallback(),this}toArray(t=[],r=0){return t[r]=this._x,t[r+1]=this._y,t[r+2]=this._z,t[r+3]=this._order,t}_onChange(t){return this._onChangeCallback=t,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._order}}return n.DEFAULT_ORDER="XYZ",n})();class GO{constructor(){this.mask=1}set(e){this.mask=1<<e>>>0}enable(e){this.mask|=1<<e}enableAll(){this.mask=-1}toggle(e){this.mask^=1<<e}disable(e){this.mask&=~(1<<e)}disableAll(){this.mask=0}test(e){return 0!==(this.mask&e.mask)}isEnabled(e){return!!(this.mask&1<<e)}}let NMe=0;const LX=new L,Hf=new Pi,Da=new Pt,LT=new L,R_=new L,OMe=new L,kMe=new Pi,FX=new L(1,0,0),VX=new L(0,1,0),UX=new L(0,0,1),LMe={type:"added"},FMe={type:"removed"};let Gn=(()=>{class n extends Aa{constructor(){super(),this.isObject3D=!0,Object.defineProperty(this,"id",{value:NMe++}),this.uuid=ms(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=n.DEFAULT_UP.clone();const t=new L,r=new PMe,i=new Pi,s=new L(1,1,1);r._onChange(function o(){i.setFromEuler(r,!1)}),i._onChange(function a(){r.setFromQuaternion(i,void 0,!1)}),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:t},rotation:{configurable:!0,enumerable:!0,value:r},quaternion:{configurable:!0,enumerable:!0,value:i},scale:{configurable:!0,enumerable:!0,value:s},modelViewMatrix:{value:new Pt},normalMatrix:{value:new Ut}}),this.matrix=new Pt,this.matrixWorld=new Pt,this.matrixAutoUpdate=n.DEFAULT_MATRIX_AUTO_UPDATE,this.matrixWorldNeedsUpdate=!1,this.matrixWorldAutoUpdate=n.DEFAULT_MATRIX_WORLD_AUTO_UPDATE,this.layers=new GO,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}onBeforeRender(){}onAfterRender(){}applyMatrix4(t){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(t),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(t){return this.quaternion.premultiply(t),this}setRotationFromAxisAngle(t,r){this.quaternion.setFromAxisAngle(t,r)}setRotationFromEuler(t){this.quaternion.setFromEuler(t,!0)}setRotationFromMatrix(t){this.quaternion.setFromRotationMatrix(t)}setRotationFromQuaternion(t){this.quaternion.copy(t)}rotateOnAxis(t,r){return Hf.setFromAxisAngle(t,r),this.quaternion.multiply(Hf),this}rotateOnWorldAxis(t,r){return Hf.setFromAxisAngle(t,r),this.quaternion.premultiply(Hf),this}rotateX(t){return this.rotateOnAxis(FX,t)}rotateY(t){return this.rotateOnAxis(VX,t)}rotateZ(t){return this.rotateOnAxis(UX,t)}translateOnAxis(t,r){return LX.copy(t).applyQuaternion(this.quaternion),this.position.add(LX.multiplyScalar(r)),this}translateX(t){return this.translateOnAxis(FX,t)}translateY(t){return this.translateOnAxis(VX,t)}translateZ(t){return this.translateOnAxis(UX,t)}localToWorld(t){return this.updateWorldMatrix(!0,!1),t.applyMatrix4(this.matrixWorld)}worldToLocal(t){return this.updateWorldMatrix(!0,!1),t.applyMatrix4(Da.copy(this.matrixWorld).invert())}lookAt(t,r,i){t.isVector3?LT.copy(t):LT.set(t,r,i);const s=this.parent;this.updateWorldMatrix(!0,!1),R_.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?Da.lookAt(R_,LT,this.up):Da.lookAt(LT,R_,this.up),this.quaternion.setFromRotationMatrix(Da),s&&(Da.extractRotation(s.matrixWorld),Hf.setFromRotationMatrix(Da),this.quaternion.premultiply(Hf.invert()))}add(t){if(arguments.length>1){for(let r=0;r<arguments.length;r++)this.add(arguments[r]);return this}return t===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",t),this):(t&&t.isObject3D?(null!==t.parent&&t.parent.remove(t),t.parent=this,this.children.push(t),t.dispatchEvent(LMe)):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",t),this)}remove(t){if(arguments.length>1){for(let i=0;i<arguments.length;i++)this.remove(arguments[i]);return this}const r=this.children.indexOf(t);return-1!==r&&(t.parent=null,this.children.splice(r,1),t.dispatchEvent(FMe)),this}removeFromParent(){const t=this.parent;return null!==t&&t.remove(this),this}clear(){return this.remove(...this.children)}attach(t){return this.updateWorldMatrix(!0,!1),Da.copy(this.matrixWorld).invert(),null!==t.parent&&(t.parent.updateWorldMatrix(!0,!1),Da.multiply(t.parent.matrixWorld)),t.applyMatrix4(Da),this.add(t),t.updateWorldMatrix(!1,!0),this}getObjectById(t){return this.getObjectByProperty("id",t)}getObjectByName(t){return this.getObjectByProperty("name",t)}getObjectByProperty(t,r){if(this[t]===r)return this;for(let i=0,s=this.children.length;i<s;i++){const a=this.children[i].getObjectByProperty(t,r);if(void 0!==a)return a}}getObjectsByProperty(t,r){let i=[];this[t]===r&&i.push(this);for(let s=0,o=this.children.length;s<o;s++){const a=this.children[s].getObjectsByProperty(t,r);a.length>0&&(i=i.concat(a))}return i}getWorldPosition(t){return this.updateWorldMatrix(!0,!1),t.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(t){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(R_,t,OMe),t}getWorldScale(t){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(R_,kMe,t),t}getWorldDirection(t){this.updateWorldMatrix(!0,!1);const r=this.matrixWorld.elements;return t.set(r[8],r[9],r[10]).normalize()}raycast(){}traverse(t){t(this);const r=this.children;for(let i=0,s=r.length;i<s;i++)r[i].traverse(t)}traverseVisible(t){if(!1===this.visible)return;t(this);const r=this.children;for(let i=0,s=r.length;i<s;i++)r[i].traverseVisible(t)}traverseAncestors(t){const r=this.parent;null!==r&&(t(r),r.traverseAncestors(t))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(t){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||t)&&(null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,t=!0);const r=this.children;for(let i=0,s=r.length;i<s;i++){const o=r[i];(!0===o.matrixWorldAutoUpdate||!0===t)&&o.updateMatrixWorld(t)}}updateWorldMatrix(t,r){const i=this.parent;if(!0===t&&null!==i&&!0===i.matrixWorldAutoUpdate&&i.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),!0===r){const s=this.children;for(let o=0,a=s.length;o<a;o++){const c=s[o];!0===c.matrixWorldAutoUpdate&&c.updateWorldMatrix(!1,!0)}}}toJSON(t){const r=void 0===t||"string"==typeof t,i={};r&&(t={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},i.metadata={version:4.6,type:"Object",generator:"Object3D.toJSON"});const s={};function o(c,l){return void 0===c[l.uuid]&&(c[l.uuid]=l.toJSON(t)),l.uuid}if(s.uuid=this.uuid,s.type=this.type,""!==this.name&&(s.name=this.name),!0===this.castShadow&&(s.castShadow=!0),!0===this.receiveShadow&&(s.receiveShadow=!0),!1===this.visible&&(s.visible=!1),!1===this.frustumCulled&&(s.frustumCulled=!1),0!==this.renderOrder&&(s.renderOrder=this.renderOrder),Object.keys(this.userData).length>0&&(s.userData=this.userData),s.layers=this.layers.mask,s.matrix=this.matrix.toArray(),s.up=this.up.toArray(),!1===this.matrixAutoUpdate&&(s.matrixAutoUpdate=!1),this.isInstancedMesh&&(s.type="InstancedMesh",s.count=this.count,s.instanceMatrix=this.instanceMatrix.toJSON(),null!==this.instanceColor&&(s.instanceColor=this.instanceColor.toJSON())),this.isScene)this.background&&(this.background.isColor?s.background=this.background.toJSON():this.background.isTexture&&(s.background=this.background.toJSON(t).uuid)),this.environment&&this.environment.isTexture&&!0!==this.environment.isRenderTargetTexture&&(s.environment=this.environment.toJSON(t).uuid);else if(this.isMesh||this.isLine||this.isPoints){s.geometry=o(t.geometries,this.geometry);const c=this.geometry.parameters;if(void 0!==c&&void 0!==c.shapes){const l=c.shapes;if(Array.isArray(l))for(let u=0,d=l.length;u<d;u++)o(t.shapes,l[u]);else o(t.shapes,l)}}if(this.isSkinnedMesh&&(s.bindMode=this.bindMode,s.bindMatrix=this.bindMatrix.toArray(),void 0!==this.skeleton&&(o(t.skeletons,this.skeleton),s.skeleton=this.skeleton.uuid)),void 0!==this.material)if(Array.isArray(this.material)){const c=[];for(let l=0,u=this.material.length;l<u;l++)c.push(o(t.materials,this.material[l]));s.material=c}else s.material=o(t.materials,this.material);if(this.children.length>0){s.children=[];for(let c=0;c<this.children.length;c++)s.children.push(this.children[c].toJSON(t).object)}if(this.animations.length>0){s.animations=[];for(let c=0;c<this.animations.length;c++)s.animations.push(o(t.animations,this.animations[c]))}if(r){const c=a(t.geometries),l=a(t.materials),u=a(t.textures),d=a(t.images),h=a(t.shapes),f=a(t.skeletons),m=a(t.animations),y=a(t.nodes);c.length>0&&(i.geometries=c),l.length>0&&(i.materials=l),u.length>0&&(i.textures=u),d.length>0&&(i.images=d),h.length>0&&(i.shapes=h),f.length>0&&(i.skeletons=f),m.length>0&&(i.animations=m),y.length>0&&(i.nodes=y)}return i.object=s,i;function a(c){const l=[];for(const u in c){const d=c[u];delete d.metadata,l.push(d)}return l}}clone(t){return(new this.constructor).copy(this,t)}copy(t,r=!0){if(this.name=t.name,this.up.copy(t.up),this.position.copy(t.position),this.rotation.order=t.rotation.order,this.quaternion.copy(t.quaternion),this.scale.copy(t.scale),this.matrix.copy(t.matrix),this.matrixWorld.copy(t.matrixWorld),this.matrixAutoUpdate=t.matrixAutoUpdate,this.matrixWorldNeedsUpdate=t.matrixWorldNeedsUpdate,this.matrixWorldAutoUpdate=t.matrixWorldAutoUpdate,this.layers.mask=t.layers.mask,this.visible=t.visible,this.castShadow=t.castShadow,this.receiveShadow=t.receiveShadow,this.frustumCulled=t.frustumCulled,this.renderOrder=t.renderOrder,this.animations=t.animations.slice(),this.userData=JSON.parse(JSON.stringify(t.userData)),!0===r)for(let i=0;i<t.children.length;i++)this.add(t.children[i].clone());return this}}return n.DEFAULT_UP=new L(0,1,0),n.DEFAULT_MATRIX_AUTO_UPDATE=!0,n.DEFAULT_MATRIX_WORLD_AUTO_UPDATE=!0,n})();const Qs=new L,Ra=new L,WO=new L,Pa=new L,zf=new L,Gf=new L,BX=new L,jO=new L,$O=new L,qO=new L;let FT=!1;class ys{constructor(e=new L,t=new L,r=new L){this.a=e,this.b=t,this.c=r}static getNormal(e,t,r,i){i.subVectors(r,t),Qs.subVectors(e,t),i.cross(Qs);const s=i.lengthSq();return s>0?i.multiplyScalar(1/Math.sqrt(s)):i.set(0,0,0)}static getBarycoord(e,t,r,i,s){Qs.subVectors(i,t),Ra.subVectors(r,t),WO.subVectors(e,t);const o=Qs.dot(Qs),a=Qs.dot(Ra),c=Qs.dot(WO),l=Ra.dot(Ra),u=Ra.dot(WO),d=o*l-a*a;if(0===d)return s.set(-2,-1,-1);const h=1/d,f=(l*c-a*u)*h,m=(o*u-a*c)*h;return s.set(1-f-m,m,f)}static containsPoint(e,t,r,i){return this.getBarycoord(e,t,r,i,Pa),Pa.x>=0&&Pa.y>=0&&Pa.x+Pa.y<=1}static getUV(e,t,r,i,s,o,a,c){return!1===FT&&(console.warn("THREE.Triangle.getUV() has been renamed to THREE.Triangle.getInterpolation()."),FT=!0),this.getInterpolation(e,t,r,i,s,o,a,c)}static getInterpolation(e,t,r,i,s,o,a,c){return this.getBarycoord(e,t,r,i,Pa),c.setScalar(0),c.addScaledVector(s,Pa.x),c.addScaledVector(o,Pa.y),c.addScaledVector(a,Pa.z),c}static isFrontFacing(e,t,r,i){return Qs.subVectors(r,t),Ra.subVectors(e,t),Qs.cross(Ra).dot(i)<0}set(e,t,r){return this.a.copy(e),this.b.copy(t),this.c.copy(r),this}setFromPointsAndIndices(e,t,r,i){return this.a.copy(e[t]),this.b.copy(e[r]),this.c.copy(e[i]),this}setFromAttributeAndIndices(e,t,r,i){return this.a.fromBufferAttribute(e,t),this.b.fromBufferAttribute(e,r),this.c.fromBufferAttribute(e,i),this}clone(){return(new this.constructor).copy(this)}copy(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this}getArea(){return Qs.subVectors(this.c,this.b),Ra.subVectors(this.a,this.b),.5*Qs.cross(Ra).length()}getMidpoint(e){return e.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(e){return ys.getNormal(this.a,this.b,this.c,e)}getPlane(e){return e.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(e,t){return ys.getBarycoord(e,this.a,this.b,this.c,t)}getUV(e,t,r,i,s){return!1===FT&&(console.warn("THREE.Triangle.getUV() has been renamed to THREE.Triangle.getInterpolation()."),FT=!0),ys.getInterpolation(e,this.a,this.b,this.c,t,r,i,s)}getInterpolation(e,t,r,i,s){return ys.getInterpolation(e,this.a,this.b,this.c,t,r,i,s)}containsPoint(e){return ys.containsPoint(e,this.a,this.b,this.c)}isFrontFacing(e){return ys.isFrontFacing(this.a,this.b,this.c,e)}intersectsBox(e){return e.intersectsTriangle(this)}closestPointToPoint(e,t){const r=this.a,i=this.b,s=this.c;let o,a;zf.subVectors(i,r),Gf.subVectors(s,r),jO.subVectors(e,r);const c=zf.dot(jO),l=Gf.dot(jO);if(c<=0&&l<=0)return t.copy(r);$O.subVectors(e,i);const u=zf.dot($O),d=Gf.dot($O);if(u>=0&&d<=u)return t.copy(i);const h=c*d-u*l;if(h<=0&&c>=0&&u<=0)return o=c/(c-u),t.copy(r).addScaledVector(zf,o);qO.subVectors(e,s);const f=zf.dot(qO),m=Gf.dot(qO);if(m>=0&&f<=m)return t.copy(s);const y=f*l-c*m;if(y<=0&&l>=0&&m<=0)return a=l/(l-m),t.copy(r).addScaledVector(Gf,a);const _=u*m-f*d;if(_<=0&&d-u>=0&&f-m>=0)return BX.subVectors(s,i),a=(d-u)/(d-u+(f-m)),t.copy(i).addScaledVector(BX,a);const g=1/(_+y+h);return o=y*g,a=h*g,t.copy(r).addScaledVector(zf,o).addScaledVector(Gf,a)}equals(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)}}const HX={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},Qc={h:0,s:0,l:0},VT={h:0,s:0,l:0};function XO(n,e,t){return t<0&&(t+=1),t>1&&(t-=1),t<1/6?n+6*(e-n)*t:t<.5?e:t<2/3?n+6*(e-n)*(2/3-t):n}class Ge{constructor(e,t,r){return this.isColor=!0,this.r=1,this.g=1,this.b=1,this.set(e,t,r)}set(e,t,r){if(void 0===t&&void 0===r){const i=e;i&&i.isColor?this.copy(i):"number"==typeof i?this.setHex(i):"string"==typeof i&&this.setStyle(i)}else this.setRGB(e,t,r);return this}setScalar(e){return this.r=e,this.g=e,this.b=e,this}setHex(e,t=jr){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(255&e)/255,pn.toWorkingColorSpace(this,t),this}setRGB(e,t,r,i=pn.workingColorSpace){return this.r=e,this.g=t,this.b=r,pn.toWorkingColorSpace(this,i),this}setHSL(e,t,r,i=pn.workingColorSpace){if(e=function RO(n,e){return(n%e+e)%e}(e,1),t=sr(t,0,1),r=sr(r,0,1),0===t)this.r=this.g=this.b=r;else{const s=r<=.5?r*(1+t):r+t-r*t,o=2*r-s;this.r=XO(o,s,e+1/3),this.g=XO(o,s,e),this.b=XO(o,s,e-1/3)}return pn.toWorkingColorSpace(this,i),this}setStyle(e,t=jr){function r(s){void 0!==s&&parseFloat(s)<1&&console.warn("THREE.Color: Alpha component of "+e+" will be ignored.")}let i;if(i=/^(\w+)\(([^\)]*)\)/.exec(e)){let s;const a=i[2];switch(i[1]){case"rgb":case"rgba":if(s=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return r(s[4]),this.setRGB(Math.min(255,parseInt(s[1],10))/255,Math.min(255,parseInt(s[2],10))/255,Math.min(255,parseInt(s[3],10))/255,t);if(s=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return r(s[4]),this.setRGB(Math.min(100,parseInt(s[1],10))/100,Math.min(100,parseInt(s[2],10))/100,Math.min(100,parseInt(s[3],10))/100,t);break;case"hsl":case"hsla":if(s=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return r(s[4]),this.setHSL(parseFloat(s[1])/360,parseFloat(s[2])/100,parseFloat(s[3])/100,t);break;default:console.warn("THREE.Color: Unknown color model "+e)}}else if(i=/^\#([A-Fa-f\d]+)$/.exec(e)){const s=i[1],o=s.length;if(3===o)return this.setRGB(parseInt(s.charAt(0),16)/15,parseInt(s.charAt(1),16)/15,parseInt(s.charAt(2),16)/15,t);if(6===o)return this.setHex(parseInt(s,16),t);console.warn("THREE.Color: Invalid hex color "+e)}else if(e&&e.length>0)return this.setColorName(e,t);return this}setColorName(e,t=jr){const r=HX[e.toLowerCase()];return void 0!==r?this.setHex(r,t):console.warn("THREE.Color: Unknown color "+e),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(e){return this.r=e.r,this.g=e.g,this.b=e.b,this}copySRGBToLinear(e){return this.r=Nf(e.r),this.g=Nf(e.g),this.b=Nf(e.b),this}copyLinearToSRGB(e){return this.r=OO(e.r),this.g=OO(e.g),this.b=OO(e.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(e=jr){return pn.fromWorkingColorSpace(vi.copy(this),e),65536*Math.round(sr(255*vi.r,0,255))+256*Math.round(sr(255*vi.g,0,255))+Math.round(sr(255*vi.b,0,255))}getHexString(e=jr){return("000000"+this.getHex(e).toString(16)).slice(-6)}getHSL(e,t=pn.workingColorSpace){pn.fromWorkingColorSpace(vi.copy(this),t);const r=vi.r,i=vi.g,s=vi.b,o=Math.max(r,i,s),a=Math.min(r,i,s);let c,l;const u=(a+o)/2;if(a===o)c=0,l=0;else{const d=o-a;switch(l=u<=.5?d/(o+a):d/(2-o-a),o){case r:c=(i-s)/d+(i<s?6:0);break;case i:c=(s-r)/d+2;break;case s:c=(r-i)/d+4}c/=6}return e.h=c,e.s=l,e.l=u,e}getRGB(e,t=pn.workingColorSpace){return pn.fromWorkingColorSpace(vi.copy(this),t),e.r=vi.r,e.g=vi.g,e.b=vi.b,e}getStyle(e=jr){pn.fromWorkingColorSpace(vi.copy(this),e);const t=vi.r,r=vi.g,i=vi.b;return e!==jr?`color(${e} ${t.toFixed(3)} ${r.toFixed(3)} ${i.toFixed(3)})`:`rgb(${Math.round(255*t)},${Math.round(255*r)},${Math.round(255*i)})`}offsetHSL(e,t,r){return this.getHSL(Qc),this.setHSL(Qc.h+e,Qc.s+t,Qc.l+r)}add(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this}addColors(e,t){return this.r=e.r+t.r,this.g=e.g+t.g,this.b=e.b+t.b,this}addScalar(e){return this.r+=e,this.g+=e,this.b+=e,this}sub(e){return this.r=Math.max(0,this.r-e.r),this.g=Math.max(0,this.g-e.g),this.b=Math.max(0,this.b-e.b),this}multiply(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this}multiplyScalar(e){return this.r*=e,this.g*=e,this.b*=e,this}lerp(e,t){return this.r+=(e.r-this.r)*t,this.g+=(e.g-this.g)*t,this.b+=(e.b-this.b)*t,this}lerpColors(e,t,r){return this.r=e.r+(t.r-e.r)*r,this.g=e.g+(t.g-e.g)*r,this.b=e.b+(t.b-e.b)*r,this}lerpHSL(e,t){this.getHSL(Qc),e.getHSL(VT);const r=x_(Qc.h,VT.h,t),i=x_(Qc.s,VT.s,t),s=x_(Qc.l,VT.l,t);return this.setHSL(r,i,s),this}setFromVector3(e){return this.r=e.x,this.g=e.y,this.b=e.z,this}applyMatrix3(e){const t=this.r,r=this.g,i=this.b,s=e.elements;return this.r=s[0]*t+s[3]*r+s[6]*i,this.g=s[1]*t+s[4]*r+s[7]*i,this.b=s[2]*t+s[5]*r+s[8]*i,this}equals(e){return e.r===this.r&&e.g===this.g&&e.b===this.b}fromArray(e,t=0){return this.r=e[t],this.g=e[t+1],this.b=e[t+2],this}toArray(e=[],t=0){return e[t]=this.r,e[t+1]=this.g,e[t+2]=this.b,e}fromBufferAttribute(e,t){return this.r=e.getX(t),this.g=e.getY(t),this.b=e.getZ(t),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}}const vi=new Ge;Ge.NAMES=HX;let VMe=0;class Ni extends Aa{constructor(){super(),this.isMaterial=!0,Object.defineProperty(this,"id",{value:VMe++}),this.uuid=ms(),this.name="",this.type="Material",this.blending=1,this.side=0,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.alphaHash=!1,this.blendSrc=204,this.blendDst=205,this.blendEquation=100,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.blendColor=new Ge(0,0,0),this.blendAlpha=0,this.depthFunc=3,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=519,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=Df,this.stencilZFail=Df,this.stencilZPass=Df,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.forceSinglePass=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(e){this._alphaTest>0!=e>0&&this.version++,this._alphaTest=e}onBuild(){}onBeforeRender(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(e){if(void 0!==e)for(const t in e){const r=e[t];if(void 0===r){console.warn(`THREE.Material: parameter '${t}' has value of undefined.`);continue}const i=this[t];void 0!==i?i&&i.isColor?i.set(r):i&&i.isVector3&&r&&r.isVector3?i.copy(r):this[t]=r:console.warn(`THREE.Material: '${t}' is not a property of THREE.${this.type}.`)}}toJSON(e){const t=void 0===e||"string"==typeof e;t&&(e={textures:{},images:{}});const r={metadata:{version:4.6,type:"Material",generator:"Material.toJSON"}};function i(s){const o=[];for(const a in s){const c=s[a];delete c.metadata,o.push(c)}return o}if(r.uuid=this.uuid,r.type=this.type,""!==this.name&&(r.name=this.name),this.color&&this.color.isColor&&(r.color=this.color.getHex()),void 0!==this.roughness&&(r.roughness=this.roughness),void 0!==this.metalness&&(r.metalness=this.metalness),void 0!==this.sheen&&(r.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(r.sheenColor=this.sheenColor.getHex()),void 0!==this.sheenRoughness&&(r.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(r.emissive=this.emissive.getHex()),this.emissiveIntensity&&1!==this.emissiveIntensity&&(r.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(r.specular=this.specular.getHex()),void 0!==this.specularIntensity&&(r.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(r.specularColor=this.specularColor.getHex()),void 0!==this.shininess&&(r.shininess=this.shininess),void 0!==this.clearcoat&&(r.clearcoat=this.clearcoat),void 0!==this.clearcoatRoughness&&(r.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(r.clearcoatMap=this.clearcoatMap.toJSON(e).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(r.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(e).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(r.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(e).uuid,r.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),void 0!==this.iridescence&&(r.iridescence=this.iridescence),void 0!==this.iridescenceIOR&&(r.iridescenceIOR=this.iridescenceIOR),void 0!==this.iridescenceThicknessRange&&(r.iridescenceThicknessRange=this.iridescenceThicknessRange),this.iridescenceMap&&this.iridescenceMap.isTexture&&(r.iridescenceMap=this.iridescenceMap.toJSON(e).uuid),this.iridescenceThicknessMap&&this.iridescenceThicknessMap.isTexture&&(r.iridescenceThicknessMap=this.iridescenceThicknessMap.toJSON(e).uuid),void 0!==this.anisotropy&&(r.anisotropy=this.anisotropy),void 0!==this.anisotropyRotation&&(r.anisotropyRotation=this.anisotropyRotation),this.anisotropyMap&&this.anisotropyMap.isTexture&&(r.anisotropyMap=this.anisotropyMap.toJSON(e).uuid),this.map&&this.map.isTexture&&(r.map=this.map.toJSON(e).uuid),this.matcap&&this.matcap.isTexture&&(r.matcap=this.matcap.toJSON(e).uuid),this.alphaMap&&this.alphaMap.isTexture&&(r.alphaMap=this.alphaMap.toJSON(e).uuid),this.lightMap&&this.lightMap.isTexture&&(r.lightMap=this.lightMap.toJSON(e).uuid,r.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(r.aoMap=this.aoMap.toJSON(e).uuid,r.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(r.bumpMap=this.bumpMap.toJSON(e).uuid,r.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(r.normalMap=this.normalMap.toJSON(e).uuid,r.normalMapType=this.normalMapType,r.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(r.displacementMap=this.displacementMap.toJSON(e).uuid,r.displacementScale=this.displacementScale,r.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(r.roughnessMap=this.roughnessMap.toJSON(e).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(r.metalnessMap=this.metalnessMap.toJSON(e).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(r.emissiveMap=this.emissiveMap.toJSON(e).uuid),this.specularMap&&this.specularMap.isTexture&&(r.specularMap=this.specularMap.toJSON(e).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(r.specularIntensityMap=this.specularIntensityMap.toJSON(e).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(r.specularColorMap=this.specularColorMap.toJSON(e).uuid),this.envMap&&this.envMap.isTexture&&(r.envMap=this.envMap.toJSON(e).uuid,void 0!==this.combine&&(r.combine=this.combine)),void 0!==this.envMapIntensity&&(r.envMapIntensity=this.envMapIntensity),void 0!==this.reflectivity&&(r.reflectivity=this.reflectivity),void 0!==this.refractionRatio&&(r.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(r.gradientMap=this.gradientMap.toJSON(e).uuid),void 0!==this.transmission&&(r.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(r.transmissionMap=this.transmissionMap.toJSON(e).uuid),void 0!==this.thickness&&(r.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(r.thicknessMap=this.thicknessMap.toJSON(e).uuid),void 0!==this.attenuationDistance&&this.attenuationDistance!==1/0&&(r.attenuationDistance=this.attenuationDistance),void 0!==this.attenuationColor&&(r.attenuationColor=this.attenuationColor.getHex()),void 0!==this.size&&(r.size=this.size),null!==this.shadowSide&&(r.shadowSide=this.shadowSide),void 0!==this.sizeAttenuation&&(r.sizeAttenuation=this.sizeAttenuation),1!==this.blending&&(r.blending=this.blending),0!==this.side&&(r.side=this.side),!0===this.vertexColors&&(r.vertexColors=!0),this.opacity<1&&(r.opacity=this.opacity),!0===this.transparent&&(r.transparent=!0),204!==this.blendSrc&&(r.blendSrc=this.blendSrc),205!==this.blendDst&&(r.blendDst=this.blendDst),100!==this.blendEquation&&(r.blendEquation=this.blendEquation),null!==this.blendSrcAlpha&&(r.blendSrcAlpha=this.blendSrcAlpha),null!==this.blendDstAlpha&&(r.blendDstAlpha=this.blendDstAlpha),null!==this.blendEquationAlpha&&(r.blendEquationAlpha=this.blendEquationAlpha),this.blendColor&&this.blendColor.isColor&&(r.blendColor=this.blendColor.getHex()),0!==this.blendAlpha&&(r.blendAlpha=this.blendAlpha),3!==this.depthFunc&&(r.depthFunc=this.depthFunc),!1===this.depthTest&&(r.depthTest=this.depthTest),!1===this.depthWrite&&(r.depthWrite=this.depthWrite),!1===this.colorWrite&&(r.colorWrite=this.colorWrite),255!==this.stencilWriteMask&&(r.stencilWriteMask=this.stencilWriteMask),519!==this.stencilFunc&&(r.stencilFunc=this.stencilFunc),0!==this.stencilRef&&(r.stencilRef=this.stencilRef),255!==this.stencilFuncMask&&(r.stencilFuncMask=this.stencilFuncMask),this.stencilFail!==Df&&(r.stencilFail=this.stencilFail),this.stencilZFail!==Df&&(r.stencilZFail=this.stencilZFail),this.stencilZPass!==Df&&(r.stencilZPass=this.stencilZPass),!0===this.stencilWrite&&(r.stencilWrite=this.stencilWrite),void 0!==this.rotation&&0!==this.rotation&&(r.rotation=this.rotation),!0===this.polygonOffset&&(r.polygonOffset=!0),0!==this.polygonOffsetFactor&&(r.polygonOffsetFactor=this.polygonOffsetFactor),0!==this.polygonOffsetUnits&&(r.polygonOffsetUnits=this.polygonOffsetUnits),void 0!==this.linewidth&&1!==this.linewidth&&(r.linewidth=this.linewidth),void 0!==this.dashSize&&(r.dashSize=this.dashSize),void 0!==this.gapSize&&(r.gapSize=this.gapSize),void 0!==this.scale&&(r.scale=this.scale),!0===this.dithering&&(r.dithering=!0),this.alphaTest>0&&(r.alphaTest=this.alphaTest),!0===this.alphaHash&&(r.alphaHash=!0),!0===this.alphaToCoverage&&(r.alphaToCoverage=!0),!0===this.premultipliedAlpha&&(r.premultipliedAlpha=!0),!0===this.forceSinglePass&&(r.forceSinglePass=!0),!0===this.wireframe&&(r.wireframe=!0),this.wireframeLinewidth>1&&(r.wireframeLinewidth=this.wireframeLinewidth),"round"!==this.wireframeLinecap&&(r.wireframeLinecap=this.wireframeLinecap),"round"!==this.wireframeLinejoin&&(r.wireframeLinejoin=this.wireframeLinejoin),!0===this.flatShading&&(r.flatShading=!0),!1===this.visible&&(r.visible=!1),!1===this.toneMapped&&(r.toneMapped=!1),!1===this.fog&&(r.fog=!1),Object.keys(this.userData).length>0&&(r.userData=this.userData),t){const s=i(e.textures),o=i(e.images);s.length>0&&(r.textures=s),o.length>0&&(r.images=o)}return r}clone(){return(new this.constructor).copy(this)}copy(e){this.name=e.name,this.blending=e.blending,this.side=e.side,this.vertexColors=e.vertexColors,this.opacity=e.opacity,this.transparent=e.transparent,this.blendSrc=e.blendSrc,this.blendDst=e.blendDst,this.blendEquation=e.blendEquation,this.blendSrcAlpha=e.blendSrcAlpha,this.blendDstAlpha=e.blendDstAlpha,this.blendEquationAlpha=e.blendEquationAlpha,this.blendColor.copy(e.blendColor),this.blendAlpha=e.blendAlpha,this.depthFunc=e.depthFunc,this.depthTest=e.depthTest,this.depthWrite=e.depthWrite,this.stencilWriteMask=e.stencilWriteMask,this.stencilFunc=e.stencilFunc,this.stencilRef=e.stencilRef,this.stencilFuncMask=e.stencilFuncMask,this.stencilFail=e.stencilFail,this.stencilZFail=e.stencilZFail,this.stencilZPass=e.stencilZPass,this.stencilWrite=e.stencilWrite;const t=e.clippingPlanes;let r=null;if(null!==t){const i=t.length;r=new Array(i);for(let s=0;s!==i;++s)r[s]=t[s].clone()}return this.clippingPlanes=r,this.clipIntersection=e.clipIntersection,this.clipShadows=e.clipShadows,this.shadowSide=e.shadowSide,this.colorWrite=e.colorWrite,this.precision=e.precision,this.polygonOffset=e.polygonOffset,this.polygonOffsetFactor=e.polygonOffsetFactor,this.polygonOffsetUnits=e.polygonOffsetUnits,this.dithering=e.dithering,this.alphaTest=e.alphaTest,this.alphaHash=e.alphaHash,this.alphaToCoverage=e.alphaToCoverage,this.premultipliedAlpha=e.premultipliedAlpha,this.forceSinglePass=e.forceSinglePass,this.visible=e.visible,this.toneMapped=e.toneMapped,this.userData=JSON.parse(JSON.stringify(e.userData)),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(e){!0===e&&this.version++}}class eo extends Ni{constructor(e){super(),this.isMeshBasicMaterial=!0,this.type="MeshBasicMaterial",this.color=new Ge(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=0,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.fog=e.fog,this}}const Cr=new L,UT=new oe;class xn{constructor(e,t,r=!1){if(Array.isArray(e))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.isBufferAttribute=!0,this.name="",this.array=e,this.itemSize=t,this.count=void 0!==e?e.length/t:0,this.normalized=r,this.usage=35044,this.updateRange={offset:0,count:-1},this.gpuType=Ia,this.version=0}onUploadCallback(){}set needsUpdate(e){!0===e&&this.version++}setUsage(e){return this.usage=e,this}copy(e){return this.name=e.name,this.array=new e.array.constructor(e.array),this.itemSize=e.itemSize,this.count=e.count,this.normalized=e.normalized,this.usage=e.usage,this.gpuType=e.gpuType,this}copyAt(e,t,r){e*=this.itemSize,r*=t.itemSize;for(let i=0,s=this.itemSize;i<s;i++)this.array[e+i]=t.array[r+i];return this}copyArray(e){return this.array.set(e),this}applyMatrix3(e){if(2===this.itemSize)for(let t=0,r=this.count;t<r;t++)UT.fromBufferAttribute(this,t),UT.applyMatrix3(e),this.setXY(t,UT.x,UT.y);else if(3===this.itemSize)for(let t=0,r=this.count;t<r;t++)Cr.fromBufferAttribute(this,t),Cr.applyMatrix3(e),this.setXYZ(t,Cr.x,Cr.y,Cr.z);return this}applyMatrix4(e){for(let t=0,r=this.count;t<r;t++)Cr.fromBufferAttribute(this,t),Cr.applyMatrix4(e),this.setXYZ(t,Cr.x,Cr.y,Cr.z);return this}applyNormalMatrix(e){for(let t=0,r=this.count;t<r;t++)Cr.fromBufferAttribute(this,t),Cr.applyNormalMatrix(e),this.setXYZ(t,Cr.x,Cr.y,Cr.z);return this}transformDirection(e){for(let t=0,r=this.count;t<r;t++)Cr.fromBufferAttribute(this,t),Cr.transformDirection(e),this.setXYZ(t,Cr.x,Cr.y,Cr.z);return this}set(e,t=0){return this.array.set(e,t),this}getComponent(e,t){let r=this.array[e*this.itemSize+t];return this.normalized&&(r=Qi(r,this.array)),r}setComponent(e,t,r){return this.normalized&&(r=Ot(r,this.array)),this.array[e*this.itemSize+t]=r,this}getX(e){let t=this.array[e*this.itemSize];return this.normalized&&(t=Qi(t,this.array)),t}setX(e,t){return this.normalized&&(t=Ot(t,this.array)),this.array[e*this.itemSize]=t,this}getY(e){let t=this.array[e*this.itemSize+1];return this.normalized&&(t=Qi(t,this.array)),t}setY(e,t){return this.normalized&&(t=Ot(t,this.array)),this.array[e*this.itemSize+1]=t,this}getZ(e){let t=this.array[e*this.itemSize+2];return this.normalized&&(t=Qi(t,this.array)),t}setZ(e,t){return this.normalized&&(t=Ot(t,this.array)),this.array[e*this.itemSize+2]=t,this}getW(e){let t=this.array[e*this.itemSize+3];return this.normalized&&(t=Qi(t,this.array)),t}setW(e,t){return this.normalized&&(t=Ot(t,this.array)),this.array[e*this.itemSize+3]=t,this}setXY(e,t,r){return e*=this.itemSize,this.normalized&&(t=Ot(t,this.array),r=Ot(r,this.array)),this.array[e+0]=t,this.array[e+1]=r,this}setXYZ(e,t,r,i){return e*=this.itemSize,this.normalized&&(t=Ot(t,this.array),r=Ot(r,this.array),i=Ot(i,this.array)),this.array[e+0]=t,this.array[e+1]=r,this.array[e+2]=i,this}setXYZW(e,t,r,i,s){return e*=this.itemSize,this.normalized&&(t=Ot(t,this.array),r=Ot(r,this.array),i=Ot(i,this.array),s=Ot(s,this.array)),this.array[e+0]=t,this.array[e+1]=r,this.array[e+2]=i,this.array[e+3]=s,this}onUpload(e){return this.onUploadCallback=e,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){const e={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.from(this.array),normalized:this.normalized};return""!==this.name&&(e.name=this.name),35044!==this.usage&&(e.usage=this.usage),(0!==this.updateRange.offset||-1!==this.updateRange.count)&&(e.updateRange=this.updateRange),e}}class zX extends xn{constructor(e,t,r){super(new Uint16Array(e),t,r)}}class GX extends xn{constructor(e,t,r){super(new Uint32Array(e),t,r)}}class Xe extends xn{constructor(e,t,r){super(new Float32Array(e),t,r)}}let BMe=0;const Ls=new Pt,KO=new Gn,Wf=new L,vs=new Ro,N_=new Ro,$r=new L;class Bt extends Aa{constructor(){super(),this.isBufferGeometry=!0,Object.defineProperty(this,"id",{value:BMe++}),this.uuid=ms(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(e){return this.index=Array.isArray(e)?new(AX(e)?GX:zX)(e,1):e,this}getAttribute(e){return this.attributes[e]}setAttribute(e,t){return this.attributes[e]=t,this}deleteAttribute(e){return delete this.attributes[e],this}hasAttribute(e){return void 0!==this.attributes[e]}addGroup(e,t,r=0){this.groups.push({start:e,count:t,materialIndex:r})}clearGroups(){this.groups=[]}setDrawRange(e,t){this.drawRange.start=e,this.drawRange.count=t}applyMatrix4(e){const t=this.attributes.position;void 0!==t&&(t.applyMatrix4(e),t.needsUpdate=!0);const r=this.attributes.normal;if(void 0!==r){const s=(new Ut).getNormalMatrix(e);r.applyNormalMatrix(s),r.needsUpdate=!0}const i=this.attributes.tangent;return void 0!==i&&(i.transformDirection(e),i.needsUpdate=!0),null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this}applyQuaternion(e){return Ls.makeRotationFromQuaternion(e),this.applyMatrix4(Ls),this}rotateX(e){return Ls.makeRotationX(e),this.applyMatrix4(Ls),this}rotateY(e){return Ls.makeRotationY(e),this.applyMatrix4(Ls),this}rotateZ(e){return Ls.makeRotationZ(e),this.applyMatrix4(Ls),this}translate(e,t,r){return Ls.makeTranslation(e,t,r),this.applyMatrix4(Ls),this}scale(e,t,r){return Ls.makeScale(e,t,r),this.applyMatrix4(Ls),this}lookAt(e){return KO.lookAt(e),KO.updateMatrix(),this.applyMatrix4(KO.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(Wf).negate(),this.translate(Wf.x,Wf.y,Wf.z),this}setFromPoints(e){const t=[];for(let r=0,i=e.length;r<i;r++){const s=e[r];t.push(s.x,s.y,s.z||0)}return this.setAttribute("position",new Xe(t,3)),this}computeBoundingBox(){null===this.boundingBox&&(this.boundingBox=new Ro);const e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute)return console.error('THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box. Alternatively set "mesh.frustumCulled" to "false".',this),void this.boundingBox.set(new L(-1/0,-1/0,-1/0),new L(1/0,1/0,1/0));if(void 0!==e){if(this.boundingBox.setFromBufferAttribute(e),t)for(let r=0,i=t.length;r<i;r++)vs.setFromBufferAttribute(t[r]),this.morphTargetsRelative?($r.addVectors(this.boundingBox.min,vs.min),this.boundingBox.expandByPoint($r),$r.addVectors(this.boundingBox.max,vs.max),this.boundingBox.expandByPoint($r)):(this.boundingBox.expandByPoint(vs.min),this.boundingBox.expandByPoint(vs.max))}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){null===this.boundingSphere&&(this.boundingSphere=new Po);const e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute)return console.error('THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere. Alternatively set "mesh.frustumCulled" to "false".',this),void this.boundingSphere.set(new L,1/0);if(e){const r=this.boundingSphere.center;if(vs.setFromBufferAttribute(e),t)for(let s=0,o=t.length;s<o;s++)N_.setFromBufferAttribute(t[s]),this.morphTargetsRelative?($r.addVectors(vs.min,N_.min),vs.expandByPoint($r),$r.addVectors(vs.max,N_.max),vs.expandByPoint($r)):(vs.expandByPoint(N_.min),vs.expandByPoint(N_.max));vs.getCenter(r);let i=0;for(let s=0,o=e.count;s<o;s++)$r.fromBufferAttribute(e,s),i=Math.max(i,r.distanceToSquared($r));if(t)for(let s=0,o=t.length;s<o;s++){const a=t[s],c=this.morphTargetsRelative;for(let l=0,u=a.count;l<u;l++)$r.fromBufferAttribute(a,l),c&&(Wf.fromBufferAttribute(e,l),$r.add(Wf)),i=Math.max(i,r.distanceToSquared($r))}this.boundingSphere.radius=Math.sqrt(i),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){const e=this.index,t=this.attributes;if(null===e||void 0===t.position||void 0===t.normal||void 0===t.uv)return void console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");const r=e.array,i=t.position.array,s=t.normal.array,o=t.uv.array,a=i.length/3;!1===this.hasAttribute("tangent")&&this.setAttribute("tangent",new xn(new Float32Array(4*a),4));const c=this.getAttribute("tangent").array,l=[],u=[];for(let S=0;S<a;S++)l[S]=new L,u[S]=new L;const d=new L,h=new L,f=new L,m=new oe,y=new oe,_=new oe,g=new L,b=new L;function E(S,R,F){d.fromArray(i,3*S),h.fromArray(i,3*R),f.fromArray(i,3*F),m.fromArray(o,2*S),y.fromArray(o,2*R),_.fromArray(o,2*F),h.sub(d),f.sub(d),y.sub(m),_.sub(m);const N=1/(y.x*_.y-_.x*y.y);isFinite(N)&&(g.copy(h).multiplyScalar(_.y).addScaledVector(f,-y.y).multiplyScalar(N),b.copy(f).multiplyScalar(y.x).addScaledVector(h,-_.x).multiplyScalar(N),l[S].add(g),l[R].add(g),l[F].add(g),u[S].add(b),u[R].add(b),u[F].add(b))}let x=this.groups;0===x.length&&(x=[{start:0,count:r.length}]);for(let S=0,R=x.length;S<R;++S){const F=x[S],N=F.start;for(let K=N,se=N+F.count;K<se;K+=3)E(r[K+0],r[K+1],r[K+2])}const M=new L,C=new L,w=new L,A=new L;function T(S){w.fromArray(s,3*S),A.copy(w);const R=l[S];M.copy(R),M.sub(w.multiplyScalar(w.dot(R))).normalize(),C.crossVectors(A,R);const N=C.dot(u[S])<0?-1:1;c[4*S]=M.x,c[4*S+1]=M.y,c[4*S+2]=M.z,c[4*S+3]=N}for(let S=0,R=x.length;S<R;++S){const F=x[S],N=F.start;for(let K=N,se=N+F.count;K<se;K+=3)T(r[K+0]),T(r[K+1]),T(r[K+2])}}computeVertexNormals(){const e=this.index,t=this.getAttribute("position");if(void 0!==t){let r=this.getAttribute("normal");if(void 0===r)r=new xn(new Float32Array(3*t.count),3),this.setAttribute("normal",r);else for(let h=0,f=r.count;h<f;h++)r.setXYZ(h,0,0,0);const i=new L,s=new L,o=new L,a=new L,c=new L,l=new L,u=new L,d=new L;if(e)for(let h=0,f=e.count;h<f;h+=3){const m=e.getX(h+0),y=e.getX(h+1),_=e.getX(h+2);i.fromBufferAttribute(t,m),s.fromBufferAttribute(t,y),o.fromBufferAttribute(t,_),u.subVectors(o,s),d.subVectors(i,s),u.cross(d),a.fromBufferAttribute(r,m),c.fromBufferAttribute(r,y),l.fromBufferAttribute(r,_),a.add(u),c.add(u),l.add(u),r.setXYZ(m,a.x,a.y,a.z),r.setXYZ(y,c.x,c.y,c.z),r.setXYZ(_,l.x,l.y,l.z)}else for(let h=0,f=t.count;h<f;h+=3)i.fromBufferAttribute(t,h+0),s.fromBufferAttribute(t,h+1),o.fromBufferAttribute(t,h+2),u.subVectors(o,s),d.subVectors(i,s),u.cross(d),r.setXYZ(h+0,u.x,u.y,u.z),r.setXYZ(h+1,u.x,u.y,u.z),r.setXYZ(h+2,u.x,u.y,u.z);this.normalizeNormals(),r.needsUpdate=!0}}normalizeNormals(){const e=this.attributes.normal;for(let t=0,r=e.count;t<r;t++)$r.fromBufferAttribute(e,t),$r.normalize(),e.setXYZ(t,$r.x,$r.y,$r.z)}toNonIndexed(){function e(a,c){const l=a.array,u=a.itemSize,d=a.normalized,h=new l.constructor(c.length*u);let f=0,m=0;for(let y=0,_=c.length;y<_;y++){f=a.isInterleavedBufferAttribute?c[y]*a.data.stride+a.offset:c[y]*u;for(let g=0;g<u;g++)h[m++]=l[f++]}return new xn(h,u,d)}if(null===this.index)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;const t=new Bt,r=this.index.array,i=this.attributes;for(const a in i){const l=e(i[a],r);t.setAttribute(a,l)}const s=this.morphAttributes;for(const a in s){const c=[],l=s[a];for(let u=0,d=l.length;u<d;u++){const f=e(l[u],r);c.push(f)}t.morphAttributes[a]=c}t.morphTargetsRelative=this.morphTargetsRelative;const o=this.groups;for(let a=0,c=o.length;a<c;a++){const l=o[a];t.addGroup(l.start,l.count,l.materialIndex)}return t}toJSON(){const e={metadata:{version:4.6,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,""!==this.name&&(e.name=this.name),Object.keys(this.userData).length>0&&(e.userData=this.userData),void 0!==this.parameters){const c=this.parameters;for(const l in c)void 0!==c[l]&&(e[l]=c[l]);return e}e.data={attributes:{}};const t=this.index;null!==t&&(e.data.index={type:t.array.constructor.name,array:Array.prototype.slice.call(t.array)});const r=this.attributes;for(const c in r)e.data.attributes[c]=r[c].toJSON(e.data);const i={};let s=!1;for(const c in this.morphAttributes){const l=this.morphAttributes[c],u=[];for(let d=0,h=l.length;d<h;d++)u.push(l[d].toJSON(e.data));u.length>0&&(i[c]=u,s=!0)}s&&(e.data.morphAttributes=i,e.data.morphTargetsRelative=this.morphTargetsRelative);const o=this.groups;o.length>0&&(e.data.groups=JSON.parse(JSON.stringify(o)));const a=this.boundingSphere;return null!==a&&(e.data.boundingSphere={center:a.center.toArray(),radius:a.radius}),e}clone(){return(new this.constructor).copy(this)}copy(e){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;const t={};this.name=e.name;const r=e.index;null!==r&&this.setIndex(r.clone(t));const i=e.attributes;for(const l in i)this.setAttribute(l,i[l].clone(t));const s=e.morphAttributes;for(const l in s){const u=[],d=s[l];for(let h=0,f=d.length;h<f;h++)u.push(d[h].clone(t));this.morphAttributes[l]=u}this.morphTargetsRelative=e.morphTargetsRelative;const o=e.groups;for(let l=0,u=o.length;l<u;l++){const d=o[l];this.addGroup(d.start,d.count,d.materialIndex)}const a=e.boundingBox;null!==a&&(this.boundingBox=a.clone());const c=e.boundingSphere;return null!==c&&(this.boundingSphere=c.clone()),this.drawRange.start=e.drawRange.start,this.drawRange.count=e.drawRange.count,this.userData=e.userData,this}dispose(){this.dispatchEvent({type:"dispose"})}}const WX=new Pt,Hu=new Uf,BT=new Po,jX=new L,jf=new L,$f=new L,qf=new L,YO=new L,HT=new L,zT=new oe,GT=new oe,WT=new oe,$X=new L,qX=new L,XX=new L,jT=new L,$T=new L;class mr extends Gn{constructor(e=new Bt,t=new eo){super(),this.isMesh=!0,this.type="Mesh",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),void 0!==e.morphTargetInfluences&&(this.morphTargetInfluences=e.morphTargetInfluences.slice()),void 0!==e.morphTargetDictionary&&(this.morphTargetDictionary=Object.assign({},e.morphTargetDictionary)),this.material=Array.isArray(e.material)?e.material.slice():e.material,this.geometry=e.geometry,this}updateMorphTargets(){const t=this.geometry.morphAttributes,r=Object.keys(t);if(r.length>0){const i=t[r[0]];if(void 0!==i){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let s=0,o=i.length;s<o;s++){const a=i[s].name||String(s);this.morphTargetInfluences.push(0),this.morphTargetDictionary[a]=s}}}}getVertexPosition(e,t){const r=this.geometry,s=r.morphAttributes.position,o=r.morphTargetsRelative;t.fromBufferAttribute(r.attributes.position,e);const a=this.morphTargetInfluences;if(s&&a){HT.set(0,0,0);for(let c=0,l=s.length;c<l;c++){const u=a[c];0!==u&&(YO.fromBufferAttribute(s[c],e),HT.addScaledVector(o?YO:YO.sub(t),u))}t.add(HT)}return t}raycast(e,t){const r=this.geometry,s=this.matrixWorld;void 0!==this.material&&(null===r.boundingSphere&&r.computeBoundingSphere(),BT.copy(r.boundingSphere),BT.applyMatrix4(s),Hu.copy(e.ray).recast(e.near),(!1!==BT.containsPoint(Hu.origin)||!(null===Hu.intersectSphere(BT,jX)||Hu.origin.distanceToSquared(jX)>(e.far-e.near)**2))&&(WX.copy(s).invert(),Hu.copy(e.ray).applyMatrix4(WX),(null===r.boundingBox||!1!==Hu.intersectsBox(r.boundingBox))&&this._computeIntersections(e,t,Hu)))}_computeIntersections(e,t,r){let i;const s=this.geometry,o=this.material,a=s.index,c=s.attributes.position,l=s.attributes.uv,u=s.attributes.uv1,d=s.attributes.normal,h=s.groups,f=s.drawRange;if(null!==a)if(Array.isArray(o))for(let m=0,y=h.length;m<y;m++){const _=h[m],g=o[_.materialIndex];for(let x=Math.max(_.start,f.start),M=Math.min(a.count,Math.min(_.start+_.count,f.start+f.count));x<M;x+=3)i=qT(this,g,e,r,l,u,d,a.getX(x),a.getX(x+1),a.getX(x+2)),i&&(i.faceIndex=Math.floor(x/3),i.face.materialIndex=_.materialIndex,t.push(i))}else for(let _=Math.max(0,f.start),g=Math.min(a.count,f.start+f.count);_<g;_+=3)i=qT(this,o,e,r,l,u,d,a.getX(_),a.getX(_+1),a.getX(_+2)),i&&(i.faceIndex=Math.floor(_/3),t.push(i));else if(void 0!==c)if(Array.isArray(o))for(let m=0,y=h.length;m<y;m++){const _=h[m],g=o[_.materialIndex];for(let x=Math.max(_.start,f.start),M=Math.min(c.count,Math.min(_.start+_.count,f.start+f.count));x<M;x+=3)i=qT(this,g,e,r,l,u,d,x,x+1,x+2),i&&(i.faceIndex=Math.floor(x/3),i.face.materialIndex=_.materialIndex,t.push(i))}else for(let _=Math.max(0,f.start),g=Math.min(c.count,f.start+f.count);_<g;_+=3)i=qT(this,o,e,r,l,u,d,_,_+1,_+2),i&&(i.faceIndex=Math.floor(_/3),t.push(i))}}function qT(n,e,t,r,i,s,o,a,c,l){n.getVertexPosition(a,jf),n.getVertexPosition(c,$f),n.getVertexPosition(l,qf);const u=function HMe(n,e,t,r,i,s,o,a){let c;if(c=1===e.side?r.intersectTriangle(o,s,i,!0,a):r.intersectTriangle(i,s,o,0===e.side,a),null===c)return null;$T.copy(a),$T.applyMatrix4(n.matrixWorld);const l=t.ray.origin.distanceTo($T);return l<t.near||l>t.far?null:{distance:l,point:$T.clone(),object:n}}(n,e,t,r,jf,$f,qf,jT);if(u){i&&(zT.fromBufferAttribute(i,a),GT.fromBufferAttribute(i,c),WT.fromBufferAttribute(i,l),u.uv=ys.getInterpolation(jT,jf,$f,qf,zT,GT,WT,new oe)),s&&(zT.fromBufferAttribute(s,a),GT.fromBufferAttribute(s,c),WT.fromBufferAttribute(s,l),u.uv1=ys.getInterpolation(jT,jf,$f,qf,zT,GT,WT,new oe),u.uv2=u.uv1),o&&($X.fromBufferAttribute(o,a),qX.fromBufferAttribute(o,c),XX.fromBufferAttribute(o,l),u.normal=ys.getInterpolation(jT,jf,$f,qf,$X,qX,XX,new L),u.normal.dot(r.direction)>0&&u.normal.multiplyScalar(-1));const d={a,b:c,c:l,normal:new L,materialIndex:0};ys.getNormal(jf,$f,qf,d.normal),u.face=d}return u}class Xf extends Bt{constructor(e=1,t=1,r=1,i=1,s=1,o=1){super(),this.type="BoxGeometry",this.parameters={width:e,height:t,depth:r,widthSegments:i,heightSegments:s,depthSegments:o};const a=this;i=Math.floor(i),s=Math.floor(s),o=Math.floor(o);const c=[],l=[],u=[],d=[];let h=0,f=0;function m(y,_,g,b,E,x,M,C,w,A,T){const S=x/w,R=M/A,F=x/2,N=M/2,H=C/2,K=w+1,se=A+1;let ne=0,ye=0;const ce=new L;for(let ge=0;ge<se;ge++){const G=ge*R-N;for(let ee=0;ee<K;ee++)ce[y]=(ee*S-F)*b,ce[_]=G*E,ce[g]=H,l.push(ce.x,ce.y,ce.z),ce[y]=0,ce[_]=0,ce[g]=C>0?1:-1,u.push(ce.x,ce.y,ce.z),d.push(ee/w),d.push(1-ge/A),ne+=1}for(let ge=0;ge<A;ge++)for(let G=0;G<w;G++){const Te=h+G+K*(ge+1),He=h+(G+1)+K*(ge+1),Ue=h+(G+1)+K*ge;c.push(h+G+K*ge,Te,Ue),c.push(Te,He,Ue),ye+=6}a.addGroup(f,ye,T),f+=ye,h+=ne}m("z","y","x",-1,-1,r,t,e,o,s,0),m("z","y","x",1,-1,r,t,-e,o,s,1),m("x","z","y",1,1,e,r,t,i,o,2),m("x","z","y",1,-1,e,r,-t,i,o,3),m("x","y","z",1,-1,e,t,r,i,s,4),m("x","y","z",-1,-1,e,t,-r,i,s,5),this.setIndex(c),this.setAttribute("position",new Xe(l,3)),this.setAttribute("normal",new Xe(u,3)),this.setAttribute("uv",new Xe(d,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new Xf(e.width,e.height,e.depth,e.widthSegments,e.heightSegments,e.depthSegments)}}function Kf(n){const e={};for(const t in n){e[t]={};for(const r in n[t]){const i=n[t][r];i&&(i.isColor||i.isMatrix3||i.isMatrix4||i.isVector2||i.isVector3||i.isVector4||i.isTexture||i.isQuaternion)?i.isRenderTargetTexture?(console.warn("UniformsUtils: Textures of render targets cannot be cloned via cloneUniforms() or mergeUniforms()."),e[t][r]=null):e[t][r]=i.clone():e[t][r]=Array.isArray(i)?i.slice():i}}return e}function Oi(n){const e={};for(let t=0;t<n.length;t++){const r=Kf(n[t]);for(const i in r)e[i]=r[i]}return e}function KX(n){return null===n.getRenderTarget()?n.outputColorSpace:pn.workingColorSpace}const GMe={clone:Kf,merge:Oi};class Oa extends Ni{constructor(e){super(),this.isShaderMaterial=!0,this.type="ShaderMaterial",this.defines={},this.uniforms={},this.uniformsGroups=[],this.vertexShader="void main() {\n\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",this.fragmentShader="void main() {\n\tgl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );\n}",this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.forceSinglePass=!0,this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv1:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,void 0!==e&&this.setValues(e)}copy(e){return super.copy(e),this.fragmentShader=e.fragmentShader,this.vertexShader=e.vertexShader,this.uniforms=Kf(e.uniforms),this.uniformsGroups=function zMe(n){const e=[];for(let t=0;t<n.length;t++)e.push(n[t].clone());return e}(e.uniformsGroups),this.defines=Object.assign({},e.defines),this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.fog=e.fog,this.lights=e.lights,this.clipping=e.clipping,this.extensions=Object.assign({},e.extensions),this.glslVersion=e.glslVersion,this}toJSON(e){const t=super.toJSON(e);t.glslVersion=this.glslVersion,t.uniforms={};for(const i in this.uniforms){const o=this.uniforms[i].value;t.uniforms[i]=o&&o.isTexture?{type:"t",value:o.toJSON(e).uuid}:o&&o.isColor?{type:"c",value:o.getHex()}:o&&o.isVector2?{type:"v2",value:o.toArray()}:o&&o.isVector3?{type:"v3",value:o.toArray()}:o&&o.isVector4?{type:"v4",value:o.toArray()}:o&&o.isMatrix3?{type:"m3",value:o.toArray()}:o&&o.isMatrix4?{type:"m4",value:o.toArray()}:{value:o}}Object.keys(this.defines).length>0&&(t.defines=this.defines),t.vertexShader=this.vertexShader,t.fragmentShader=this.fragmentShader,t.lights=this.lights,t.clipping=this.clipping;const r={};for(const i in this.extensions)!0===this.extensions[i]&&(r[i]=!0);return Object.keys(r).length>0&&(t.extensions=r),t}}class JO extends Gn{constructor(){super(),this.isCamera=!0,this.type="Camera",this.matrixWorldInverse=new Pt,this.projectionMatrix=new Pt,this.projectionMatrixInverse=new Pt,this.coordinateSystem=xa}copy(e,t){return super.copy(e,t),this.matrixWorldInverse.copy(e.matrixWorldInverse),this.projectionMatrix.copy(e.projectionMatrix),this.projectionMatrixInverse.copy(e.projectionMatrixInverse),this.coordinateSystem=e.coordinateSystem,this}getWorldDirection(e){return super.getWorldDirection(e).negate()}updateMatrixWorld(e){super.updateMatrixWorld(e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(e,t){super.updateWorldMatrix(e,t),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return(new this.constructor).copy(this)}}class Or extends JO{constructor(e=50,t=1,r=.1,i=2e3){super(),this.isPerspectiveCamera=!0,this.type="PerspectiveCamera",this.fov=e,this.zoom=1,this.near=r,this.far=i,this.focus=10,this.aspect=t,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.fov=e.fov,this.zoom=e.zoom,this.near=e.near,this.far=e.far,this.focus=e.focus,this.aspect=e.aspect,this.view=null===e.view?null:Object.assign({},e.view),this.filmGauge=e.filmGauge,this.filmOffset=e.filmOffset,this}setFocalLength(e){const t=.5*this.getFilmHeight()/e;this.fov=2*Rf*Math.atan(t),this.updateProjectionMatrix()}getFocalLength(){const e=Math.tan(.5*Vu*this.fov);return.5*this.getFilmHeight()/e}getEffectiveFOV(){return 2*Rf*Math.atan(Math.tan(.5*Vu*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}setViewOffset(e,t,r,i,s,o){this.aspect=e/t,null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=r,this.view.offsetY=i,this.view.width=s,this.view.height=o,this.updateProjectionMatrix()}clearViewOffset(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=this.near;let t=e*Math.tan(.5*Vu*this.fov)/this.zoom,r=2*t,i=this.aspect*r,s=-.5*i;const o=this.view;if(null!==this.view&&this.view.enabled){const c=o.fullWidth,l=o.fullHeight;s+=o.offsetX*i/c,t-=o.offsetY*r/l,i*=o.width/c,r*=o.height/l}const a=this.filmOffset;0!==a&&(s+=e*a/this.getFilmWidth()),this.projectionMatrix.makePerspective(s,s+i,t,t-r,e,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const t=super.toJSON(e);return t.object.fov=this.fov,t.object.zoom=this.zoom,t.object.near=this.near,t.object.far=this.far,t.object.focus=this.focus,t.object.aspect=this.aspect,null!==this.view&&(t.object.view=Object.assign({},this.view)),t.object.filmGauge=this.filmGauge,t.object.filmOffset=this.filmOffset,t}}class $Me extends Gn{constructor(e,t,r){super(),this.type="CubeCamera",this.renderTarget=r,this.coordinateSystem=null,this.activeMipmapLevel=0;const i=new Or(-90,1,e,t);i.layers=this.layers,this.add(i);const s=new Or(-90,1,e,t);s.layers=this.layers,this.add(s);const o=new Or(-90,1,e,t);o.layers=this.layers,this.add(o);const a=new Or(-90,1,e,t);a.layers=this.layers,this.add(a);const c=new Or(-90,1,e,t);c.layers=this.layers,this.add(c);const l=new Or(-90,1,e,t);l.layers=this.layers,this.add(l)}updateCoordinateSystem(){const e=this.coordinateSystem,t=this.children.concat(),[r,i,s,o,a,c]=t;for(const l of t)this.remove(l);if(e===xa)r.up.set(0,1,0),r.lookAt(1,0,0),i.up.set(0,1,0),i.lookAt(-1,0,0),s.up.set(0,0,-1),s.lookAt(0,1,0),o.up.set(0,0,1),o.lookAt(0,-1,0),a.up.set(0,1,0),a.lookAt(0,0,1),c.up.set(0,1,0),c.lookAt(0,0,-1);else{if(2001!==e)throw new Error("THREE.CubeCamera.updateCoordinateSystem(): Invalid coordinate system: "+e);r.up.set(0,-1,0),r.lookAt(-1,0,0),i.up.set(0,-1,0),i.lookAt(1,0,0),s.up.set(0,0,1),s.lookAt(0,1,0),o.up.set(0,0,-1),o.lookAt(0,-1,0),a.up.set(0,-1,0),a.lookAt(0,0,1),c.up.set(0,-1,0),c.lookAt(0,0,-1)}for(const l of t)this.add(l),l.updateMatrixWorld()}update(e,t){null===this.parent&&this.updateMatrixWorld();const{renderTarget:r,activeMipmapLevel:i}=this;this.coordinateSystem!==e.coordinateSystem&&(this.coordinateSystem=e.coordinateSystem,this.updateCoordinateSystem());const[s,o,a,c,l,u]=this.children,d=e.getRenderTarget(),h=e.getActiveCubeFace(),f=e.getActiveMipmapLevel(),m=e.xr.enabled;e.xr.enabled=!1;const y=r.texture.generateMipmaps;r.texture.generateMipmaps=!1,e.setRenderTarget(r,0,i),e.render(t,s),e.setRenderTarget(r,1,i),e.render(t,o),e.setRenderTarget(r,2,i),e.render(t,a),e.setRenderTarget(r,3,i),e.render(t,c),e.setRenderTarget(r,4,i),e.render(t,l),r.texture.generateMipmaps=y,e.setRenderTarget(r,5,i),e.render(t,u),e.setRenderTarget(d,h,f),e.xr.enabled=m,r.texture.needsPMREMUpdate=!0}}class XT extends gs{constructor(e,t,r,i,s,o,a,c,l,u){super(e=void 0!==e?e:[],t=void 0!==t?t:301,r,i,s,o,a,c,l,u),this.isCubeTexture=!0,this.flipY=!1}get images(){return this.image}set images(e){this.image=e}}class qMe extends Do{constructor(e=1,t={}){super(e,e,t),this.isWebGLCubeRenderTarget=!0;const r={width:e,height:e,depth:1},i=[r,r,r,r,r,r];void 0!==t.encoding&&(M_("THREE.WebGLCubeRenderTarget: option.encoding has been replaced by option.colorSpace."),t.colorSpace=t.encoding===Lu?jr:""),this.texture=new XT(i,t.mapping,t.wrapS,t.wrapT,t.magFilter,t.minFilter,t.format,t.type,t.anisotropy,t.colorSpace),this.texture.isRenderTargetTexture=!0,this.texture.generateMipmaps=void 0!==t.generateMipmaps&&t.generateMipmaps,this.texture.minFilter=void 0!==t.minFilter?t.minFilter:Mr}fromEquirectangularTexture(e,t){this.texture.type=t.type,this.texture.colorSpace=t.colorSpace,this.texture.generateMipmaps=t.generateMipmaps,this.texture.minFilter=t.minFilter,this.texture.magFilter=t.magFilter;const r_uniforms={tEquirect:{value:null}},r_vertexShader="\n\n\t\t\t\tvarying vec3 vWorldDirection;\n\n\t\t\t\tvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\n\t\t\t\t\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n\n\t\t\t\t}\n\n\t\t\t\tvoid main() {\n\n\t\t\t\t\tvWorldDirection = transformDirection( position, modelMatrix );\n\n\t\t\t\t\t#include <begin_vertex>\n\t\t\t\t\t#include <project_vertex>\n\n\t\t\t\t}\n\t\t\t",r_fragmentShader="\n\n\t\t\t\tuniform sampler2D tEquirect;\n\n\t\t\t\tvarying vec3 vWorldDirection;\n\n\t\t\t\t#include <common>\n\n\t\t\t\tvoid main() {\n\n\t\t\t\t\tvec3 direction = normalize( vWorldDirection );\n\n\t\t\t\t\tvec2 sampleUV = equirectUv( direction );\n\n\t\t\t\t\tgl_FragColor = texture2D( tEquirect, sampleUV );\n\n\t\t\t\t}\n\t\t\t",i=new Xf(5,5,5),s=new Oa({name:"CubemapFromEquirect",uniforms:Kf(r_uniforms),vertexShader:r_vertexShader,fragmentShader:r_fragmentShader,side:1,blending:0});s.uniforms.tEquirect.value=t;const o=new mr(i,s),a=t.minFilter;return t.minFilter===Nu&&(t.minFilter=Mr),new $Me(1,10,this).update(e,o),t.minFilter=a,o.geometry.dispose(),o.material.dispose(),this}clear(e,t,r,i){const s=e.getRenderTarget();for(let o=0;o<6;o++)e.setRenderTarget(this,o),e.clear(t,r,i);e.setRenderTarget(s)}}const ZO=new L,XMe=new L,KMe=new Ut;class el{constructor(e=new L(1,0,0),t=0){this.isPlane=!0,this.normal=e,this.constant=t}set(e,t){return this.normal.copy(e),this.constant=t,this}setComponents(e,t,r,i){return this.normal.set(e,t,r),this.constant=i,this}setFromNormalAndCoplanarPoint(e,t){return this.normal.copy(e),this.constant=-t.dot(this.normal),this}setFromCoplanarPoints(e,t,r){const i=ZO.subVectors(r,t).cross(XMe.subVectors(e,t)).normalize();return this.setFromNormalAndCoplanarPoint(i,e),this}copy(e){return this.normal.copy(e.normal),this.constant=e.constant,this}normalize(){const e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(e){return this.normal.dot(e)+this.constant}distanceToSphere(e){return this.distanceToPoint(e.center)-e.radius}projectPoint(e,t){return t.copy(e).addScaledVector(this.normal,-this.distanceToPoint(e))}intersectLine(e,t){const r=e.delta(ZO),i=this.normal.dot(r);if(0===i)return 0===this.distanceToPoint(e.start)?t.copy(e.start):null;const s=-(e.start.dot(this.normal)+this.constant)/i;return s<0||s>1?null:t.copy(e.start).addScaledVector(r,s)}intersectsLine(e){const t=this.distanceToPoint(e.start),r=this.distanceToPoint(e.end);return t<0&&r>0||r<0&&t>0}intersectsBox(e){return e.intersectsPlane(this)}intersectsSphere(e){return e.intersectsPlane(this)}coplanarPoint(e){return e.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(e,t){const r=t||KMe.getNormalMatrix(e),i=this.coplanarPoint(ZO).applyMatrix4(e),s=this.normal.applyMatrix3(r).normalize();return this.constant=-i.dot(s),this}translate(e){return this.constant-=e.dot(this.normal),this}equals(e){return e.normal.equals(this.normal)&&e.constant===this.constant}clone(){return(new this.constructor).copy(this)}}const zu=new Po,KT=new L;class QO{constructor(e=new el,t=new el,r=new el,i=new el,s=new el,o=new el){this.planes=[e,t,r,i,s,o]}set(e,t,r,i,s,o){const a=this.planes;return a[0].copy(e),a[1].copy(t),a[2].copy(r),a[3].copy(i),a[4].copy(s),a[5].copy(o),this}copy(e){const t=this.planes;for(let r=0;r<6;r++)t[r].copy(e.planes[r]);return this}setFromProjectionMatrix(e,t=xa){const r=this.planes,i=e.elements,s=i[0],o=i[1],a=i[2],c=i[3],l=i[4],u=i[5],d=i[6],h=i[7],f=i[8],m=i[9],y=i[10],_=i[11],g=i[12],b=i[13],E=i[14],x=i[15];if(r[0].setComponents(c-s,h-l,_-f,x-g).normalize(),r[1].setComponents(c+s,h+l,_+f,x+g).normalize(),r[2].setComponents(c+o,h+u,_+m,x+b).normalize(),r[3].setComponents(c-o,h-u,_-m,x-b).normalize(),r[4].setComponents(c-a,h-d,_-y,x-E).normalize(),t===xa)r[5].setComponents(c+a,h+d,_+y,x+E).normalize();else{if(2001!==t)throw new Error("THREE.Frustum.setFromProjectionMatrix(): Invalid coordinate system: "+t);r[5].setComponents(a,d,y,E).normalize()}return this}intersectsObject(e){if(void 0!==e.boundingSphere)null===e.boundingSphere&&e.computeBoundingSphere(),zu.copy(e.boundingSphere).applyMatrix4(e.matrixWorld);else{const t=e.geometry;null===t.boundingSphere&&t.computeBoundingSphere(),zu.copy(t.boundingSphere).applyMatrix4(e.matrixWorld)}return this.intersectsSphere(zu)}intersectsSprite(e){return zu.center.set(0,0,0),zu.radius=.7071067811865476,zu.applyMatrix4(e.matrixWorld),this.intersectsSphere(zu)}intersectsSphere(e){const t=this.planes,r=e.center,i=-e.radius;for(let s=0;s<6;s++)if(t[s].distanceToPoint(r)<i)return!1;return!0}intersectsBox(e){const t=this.planes;for(let r=0;r<6;r++){const i=t[r];if(KT.x=i.normal.x>0?e.max.x:e.min.x,KT.y=i.normal.y>0?e.max.y:e.min.y,KT.z=i.normal.z>0?e.max.z:e.min.z,i.distanceToPoint(KT)<0)return!1}return!0}containsPoint(e){const t=this.planes;for(let r=0;r<6;r++)if(t[r].distanceToPoint(e)<0)return!1;return!0}clone(){return(new this.constructor).copy(this)}}function YX(){let n=null,e=!1,t=null,r=null;function i(s,o){t(s,o),r=n.requestAnimationFrame(i)}return{start:function(){!0!==e&&null!==t&&(r=n.requestAnimationFrame(i),e=!0)},stop:function(){n.cancelAnimationFrame(r),e=!1},setAnimationLoop:function(s){t=s},setContext:function(s){n=s}}}function YMe(n,e){const t=e.isWebGL2,r=new WeakMap;return{get:function o(l){return l.isInterleavedBufferAttribute&&(l=l.data),r.get(l)},remove:function a(l){l.isInterleavedBufferAttribute&&(l=l.data);const u=r.get(l);u&&(n.deleteBuffer(u.buffer),r.delete(l))},update:function c(l,u){if(l.isGLBufferAttribute){const h=r.get(l);return void((!h||h.version<l.version)&&r.set(l,{buffer:l.buffer,type:l.type,bytesPerElement:l.elementSize,version:l.version}))}l.isInterleavedBufferAttribute&&(l=l.data);const d=r.get(l);void 0===d?r.set(l,function i(l,u){const d=l.array,h=l.usage,f=n.createBuffer();let m;if(n.bindBuffer(u,f),n.bufferData(u,d,h),l.onUploadCallback(),d instanceof Float32Array)m=n.FLOAT;else if(d instanceof Uint16Array)if(l.isFloat16BufferAttribute){if(!t)throw new Error("THREE.WebGLAttributes: Usage of Float16BufferAttribute requires WebGL2.");m=n.HALF_FLOAT}else m=n.UNSIGNED_SHORT;else if(d instanceof Int16Array)m=n.SHORT;else if(d instanceof Uint32Array)m=n.UNSIGNED_INT;else if(d instanceof Int32Array)m=n.INT;else if(d instanceof Int8Array)m=n.BYTE;else if(d instanceof Uint8Array)m=n.UNSIGNED_BYTE;else{if(!(d instanceof Uint8ClampedArray))throw new Error("THREE.WebGLAttributes: Unsupported buffer data format: "+d);m=n.UNSIGNED_BYTE}return{buffer:f,type:m,bytesPerElement:d.BYTES_PER_ELEMENT,version:l.version}}(l,u)):d.version<l.version&&(function s(l,u,d){const h=u.array,f=u.updateRange;n.bindBuffer(d,l),-1===f.count?n.bufferSubData(d,0,h):(t?n.bufferSubData(d,f.offset*h.BYTES_PER_ELEMENT,h,f.offset,f.count):n.bufferSubData(d,f.offset*h.BYTES_PER_ELEMENT,h.subarray(f.offset,f.offset+f.count)),f.count=-1),u.onUploadCallback()}(d.buffer,l,u),d.version=l.version)}}}class Zf extends Bt{constructor(e=1,t=1,r=1,i=1){super(),this.type="PlaneGeometry",this.parameters={width:e,height:t,widthSegments:r,heightSegments:i};const s=e/2,o=t/2,a=Math.floor(r),c=Math.floor(i),l=a+1,u=c+1,d=e/a,h=t/c,f=[],m=[],y=[],_=[];for(let g=0;g<u;g++){const b=g*h-o;for(let E=0;E<l;E++)m.push(E*d-s,-b,0),y.push(0,0,1),_.push(E/a),_.push(1-g/c)}for(let g=0;g<c;g++)for(let b=0;b<a;b++){const x=b+l*(g+1),M=b+1+l*(g+1),C=b+1+l*g;f.push(b+l*g,x,C),f.push(x,M,C)}this.setIndex(f),this.setAttribute("position",new Xe(m,3)),this.setAttribute("normal",new Xe(y,3)),this.setAttribute("uv",new Xe(_,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new Zf(e.width,e.height,e.widthSegments,e.heightSegments)}}const Lt={alphahash_fragment:"#ifdef USE_ALPHAHASH\n\tif ( diffuseColor.a < getAlphaHashThreshold( vPosition ) ) discard;\n#endif",alphahash_pars_fragment:"#ifdef USE_ALPHAHASH\n\tconst float ALPHA_HASH_SCALE = 0.05;\n\tfloat hash2D( vec2 value ) {\n\t\treturn fract( 1.0e4 * sin( 17.0 * value.x + 0.1 * value.y ) * ( 0.1 + abs( sin( 13.0 * value.y + value.x ) ) ) );\n\t}\n\tfloat hash3D( vec3 value ) {\n\t\treturn hash2D( vec2( hash2D( value.xy ), value.z ) );\n\t}\n\tfloat getAlphaHashThreshold( vec3 position ) {\n\t\tfloat maxDeriv = max(\n\t\t\tlength( dFdx( position.xyz ) ),\n\t\t\tlength( dFdy( position.xyz ) )\n\t\t);\n\t\tfloat pixScale = 1.0 / ( ALPHA_HASH_SCALE * maxDeriv );\n\t\tvec2 pixScales = vec2(\n\t\t\texp2( floor( log2( pixScale ) ) ),\n\t\t\texp2( ceil( log2( pixScale ) ) )\n\t\t);\n\t\tvec2 alpha = vec2(\n\t\t\thash3D( floor( pixScales.x * position.xyz ) ),\n\t\t\thash3D( floor( pixScales.y * position.xyz ) )\n\t\t);\n\t\tfloat lerpFactor = fract( log2( pixScale ) );\n\t\tfloat x = ( 1.0 - lerpFactor ) * alpha.x + lerpFactor * alpha.y;\n\t\tfloat a = min( lerpFactor, 1.0 - lerpFactor );\n\t\tvec3 cases = vec3(\n\t\t\tx * x / ( 2.0 * a * ( 1.0 - a ) ),\n\t\t\t( x - 0.5 * a ) / ( 1.0 - a ),\n\t\t\t1.0 - ( ( 1.0 - x ) * ( 1.0 - x ) / ( 2.0 * a * ( 1.0 - a ) ) )\n\t\t);\n\t\tfloat threshold = ( x < ( 1.0 - a ) )\n\t\t\t? ( ( x < a ) ? cases.x : cases.y )\n\t\t\t: cases.z;\n\t\treturn clamp( threshold , 1.0e-6, 1.0 );\n\t}\n#endif",alphamap_fragment:"#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, vAlphaMapUv ).g;\n#endif",alphamap_pars_fragment:"#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",alphatest_fragment:"#ifdef USE_ALPHATEST\n\tif ( diffuseColor.a < alphaTest ) discard;\n#endif",alphatest_pars_fragment:"#ifdef USE_ALPHATEST\n\tuniform float alphaTest;\n#endif",aomap_fragment:"#ifdef USE_AOMAP\n\tfloat ambientOcclusion = ( texture2D( aoMap, vAoMapUv ).r - 1.0 ) * aoMapIntensity + 1.0;\n\treflectedLight.indirectDiffuse *= ambientOcclusion;\n\t#if defined( USE_CLEARCOAT ) \n\t\tclearcoatSpecularIndirect *= ambientOcclusion;\n\t#endif\n\t#if defined( USE_SHEEN ) \n\t\tsheenSpecularIndirect *= ambientOcclusion;\n\t#endif\n\t#if defined( USE_ENVMAP ) && defined( STANDARD )\n\t\tfloat dotNV = saturate( dot( geometryNormal, geometryViewDir ) );\n\t\treflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.roughness );\n\t#endif\n#endif",aomap_pars_fragment:"#ifdef USE_AOMAP\n\tuniform sampler2D aoMap;\n\tuniform float aoMapIntensity;\n#endif",begin_vertex:"vec3 transformed = vec3( position );\n#ifdef USE_ALPHAHASH\n\tvPosition = vec3( position );\n#endif",beginnormal_vertex:"vec3 objectNormal = vec3( normal );\n#ifdef USE_TANGENT\n\tvec3 objectTangent = vec3( tangent.xyz );\n#endif",bsdfs:"float G_BlinnPhong_Implicit( ) {\n\treturn 0.25;\n}\nfloat D_BlinnPhong( const in float shininess, const in float dotNH ) {\n\treturn RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );\n}\nvec3 BRDF_BlinnPhong( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float shininess ) {\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat dotVH = saturate( dot( viewDir, halfDir ) );\n\tvec3 F = F_Schlick( specularColor, 1.0, dotVH );\n\tfloat G = G_BlinnPhong_Implicit( );\n\tfloat D = D_BlinnPhong( shininess, dotNH );\n\treturn F * ( G * D );\n} // validated",iridescence_fragment:"#ifdef USE_IRIDESCENCE\n\tconst mat3 XYZ_TO_REC709 = mat3(\n\t\t 3.2404542, -0.9692660,  0.0556434,\n\t\t-1.5371385,  1.8760108, -0.2040259,\n\t\t-0.4985314,  0.0415560,  1.0572252\n\t);\n\tvec3 Fresnel0ToIor( vec3 fresnel0 ) {\n\t\tvec3 sqrtF0 = sqrt( fresnel0 );\n\t\treturn ( vec3( 1.0 ) + sqrtF0 ) / ( vec3( 1.0 ) - sqrtF0 );\n\t}\n\tvec3 IorToFresnel0( vec3 transmittedIor, float incidentIor ) {\n\t\treturn pow2( ( transmittedIor - vec3( incidentIor ) ) / ( transmittedIor + vec3( incidentIor ) ) );\n\t}\n\tfloat IorToFresnel0( float transmittedIor, float incidentIor ) {\n\t\treturn pow2( ( transmittedIor - incidentIor ) / ( transmittedIor + incidentIor ));\n\t}\n\tvec3 evalSensitivity( float OPD, vec3 shift ) {\n\t\tfloat phase = 2.0 * PI * OPD * 1.0e-9;\n\t\tvec3 val = vec3( 5.4856e-13, 4.4201e-13, 5.2481e-13 );\n\t\tvec3 pos = vec3( 1.6810e+06, 1.7953e+06, 2.2084e+06 );\n\t\tvec3 var = vec3( 4.3278e+09, 9.3046e+09, 6.6121e+09 );\n\t\tvec3 xyz = val * sqrt( 2.0 * PI * var ) * cos( pos * phase + shift ) * exp( - pow2( phase ) * var );\n\t\txyz.x += 9.7470e-14 * sqrt( 2.0 * PI * 4.5282e+09 ) * cos( 2.2399e+06 * phase + shift[ 0 ] ) * exp( - 4.5282e+09 * pow2( phase ) );\n\t\txyz /= 1.0685e-7;\n\t\tvec3 rgb = XYZ_TO_REC709 * xyz;\n\t\treturn rgb;\n\t}\n\tvec3 evalIridescence( float outsideIOR, float eta2, float cosTheta1, float thinFilmThickness, vec3 baseF0 ) {\n\t\tvec3 I;\n\t\tfloat iridescenceIOR = mix( outsideIOR, eta2, smoothstep( 0.0, 0.03, thinFilmThickness ) );\n\t\tfloat sinTheta2Sq = pow2( outsideIOR / iridescenceIOR ) * ( 1.0 - pow2( cosTheta1 ) );\n\t\tfloat cosTheta2Sq = 1.0 - sinTheta2Sq;\n\t\tif ( cosTheta2Sq < 0.0 ) {\n\t\t\treturn vec3( 1.0 );\n\t\t}\n\t\tfloat cosTheta2 = sqrt( cosTheta2Sq );\n\t\tfloat R0 = IorToFresnel0( iridescenceIOR, outsideIOR );\n\t\tfloat R12 = F_Schlick( R0, 1.0, cosTheta1 );\n\t\tfloat T121 = 1.0 - R12;\n\t\tfloat phi12 = 0.0;\n\t\tif ( iridescenceIOR < outsideIOR ) phi12 = PI;\n\t\tfloat phi21 = PI - phi12;\n\t\tvec3 baseIOR = Fresnel0ToIor( clamp( baseF0, 0.0, 0.9999 ) );\t\tvec3 R1 = IorToFresnel0( baseIOR, iridescenceIOR );\n\t\tvec3 R23 = F_Schlick( R1, 1.0, cosTheta2 );\n\t\tvec3 phi23 = vec3( 0.0 );\n\t\tif ( baseIOR[ 0 ] < iridescenceIOR ) phi23[ 0 ] = PI;\n\t\tif ( baseIOR[ 1 ] < iridescenceIOR ) phi23[ 1 ] = PI;\n\t\tif ( baseIOR[ 2 ] < iridescenceIOR ) phi23[ 2 ] = PI;\n\t\tfloat OPD = 2.0 * iridescenceIOR * thinFilmThickness * cosTheta2;\n\t\tvec3 phi = vec3( phi21 ) + phi23;\n\t\tvec3 R123 = clamp( R12 * R23, 1e-5, 0.9999 );\n\t\tvec3 r123 = sqrt( R123 );\n\t\tvec3 Rs = pow2( T121 ) * R23 / ( vec3( 1.0 ) - R123 );\n\t\tvec3 C0 = R12 + Rs;\n\t\tI = C0;\n\t\tvec3 Cm = Rs - T121;\n\t\tfor ( int m = 1; m <= 2; ++ m ) {\n\t\t\tCm *= r123;\n\t\t\tvec3 Sm = 2.0 * evalSensitivity( float( m ) * OPD, float( m ) * phi );\n\t\t\tI += Cm * Sm;\n\t\t}\n\t\treturn max( I, vec3( 0.0 ) );\n\t}\n#endif",bumpmap_pars_fragment:"#ifdef USE_BUMPMAP\n\tuniform sampler2D bumpMap;\n\tuniform float bumpScale;\n\tvec2 dHdxy_fwd() {\n\t\tvec2 dSTdx = dFdx( vBumpMapUv );\n\t\tvec2 dSTdy = dFdy( vBumpMapUv );\n\t\tfloat Hll = bumpScale * texture2D( bumpMap, vBumpMapUv ).x;\n\t\tfloat dBx = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdx ).x - Hll;\n\t\tfloat dBy = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdy ).x - Hll;\n\t\treturn vec2( dBx, dBy );\n\t}\n\tvec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {\n\t\tvec3 vSigmaX = normalize( dFdx( surf_pos.xyz ) );\n\t\tvec3 vSigmaY = normalize( dFdy( surf_pos.xyz ) );\n\t\tvec3 vN = surf_norm;\n\t\tvec3 R1 = cross( vSigmaY, vN );\n\t\tvec3 R2 = cross( vN, vSigmaX );\n\t\tfloat fDet = dot( vSigmaX, R1 ) * faceDirection;\n\t\tvec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );\n\t\treturn normalize( abs( fDet ) * surf_norm - vGrad );\n\t}\n#endif",clipping_planes_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tvec4 plane;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {\n\t\tplane = clippingPlanes[ i ];\n\t\tif ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;\n\t}\n\t#pragma unroll_loop_end\n\t#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES\n\t\tbool clipped = true;\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {\n\t\t\tplane = clippingPlanes[ i ];\n\t\t\tclipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;\n\t\t}\n\t\t#pragma unroll_loop_end\n\t\tif ( clipped ) discard;\n\t#endif\n#endif",clipping_planes_pars_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tvarying vec3 vClipPosition;\n\tuniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];\n#endif",clipping_planes_pars_vertex:"#if NUM_CLIPPING_PLANES > 0\n\tvarying vec3 vClipPosition;\n#endif",clipping_planes_vertex:"#if NUM_CLIPPING_PLANES > 0\n\tvClipPosition = - mvPosition.xyz;\n#endif",color_fragment:"#if defined( USE_COLOR_ALPHA )\n\tdiffuseColor *= vColor;\n#elif defined( USE_COLOR )\n\tdiffuseColor.rgb *= vColor;\n#endif",color_pars_fragment:"#if defined( USE_COLOR_ALPHA )\n\tvarying vec4 vColor;\n#elif defined( USE_COLOR )\n\tvarying vec3 vColor;\n#endif",color_pars_vertex:"#if defined( USE_COLOR_ALPHA )\n\tvarying vec4 vColor;\n#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )\n\tvarying vec3 vColor;\n#endif",color_vertex:"#if defined( USE_COLOR_ALPHA )\n\tvColor = vec4( 1.0 );\n#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )\n\tvColor = vec3( 1.0 );\n#endif\n#ifdef USE_COLOR\n\tvColor *= color;\n#endif\n#ifdef USE_INSTANCING_COLOR\n\tvColor.xyz *= instanceColor.xyz;\n#endif",common:"#define PI 3.141592653589793\n#define PI2 6.283185307179586\n#define PI_HALF 1.5707963267948966\n#define RECIPROCAL_PI 0.3183098861837907\n#define RECIPROCAL_PI2 0.15915494309189535\n#define EPSILON 1e-6\n#ifndef saturate\n#define saturate( a ) clamp( a, 0.0, 1.0 )\n#endif\n#define whiteComplement( a ) ( 1.0 - saturate( a ) )\nfloat pow2( const in float x ) { return x*x; }\nvec3 pow2( const in vec3 x ) { return x*x; }\nfloat pow3( const in float x ) { return x*x*x; }\nfloat pow4( const in float x ) { float x2 = x*x; return x2*x2; }\nfloat max3( const in vec3 v ) { return max( max( v.x, v.y ), v.z ); }\nfloat average( const in vec3 v ) { return dot( v, vec3( 0.3333333 ) ); }\nhighp float rand( const in vec2 uv ) {\n\tconst highp float a = 12.9898, b = 78.233, c = 43758.5453;\n\thighp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );\n\treturn fract( sin( sn ) * c );\n}\n#ifdef HIGH_PRECISION\n\tfloat precisionSafeLength( vec3 v ) { return length( v ); }\n#else\n\tfloat precisionSafeLength( vec3 v ) {\n\t\tfloat maxComponent = max3( abs( v ) );\n\t\treturn length( v / maxComponent ) * maxComponent;\n\t}\n#endif\nstruct IncidentLight {\n\tvec3 color;\n\tvec3 direction;\n\tbool visible;\n};\nstruct ReflectedLight {\n\tvec3 directDiffuse;\n\tvec3 directSpecular;\n\tvec3 indirectDiffuse;\n\tvec3 indirectSpecular;\n};\n#ifdef USE_ALPHAHASH\n\tvarying vec3 vPosition;\n#endif\nvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n}\nvec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );\n}\nmat3 transposeMat3( const in mat3 m ) {\n\tmat3 tmp;\n\ttmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );\n\ttmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );\n\ttmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );\n\treturn tmp;\n}\nfloat luminance( const in vec3 rgb ) {\n\tconst vec3 weights = vec3( 0.2126729, 0.7151522, 0.0721750 );\n\treturn dot( weights, rgb );\n}\nbool isPerspectiveMatrix( mat4 m ) {\n\treturn m[ 2 ][ 3 ] == - 1.0;\n}\nvec2 equirectUv( in vec3 dir ) {\n\tfloat u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;\n\tfloat v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n\treturn vec2( u, v );\n}\nvec3 BRDF_Lambert( const in vec3 diffuseColor ) {\n\treturn RECIPROCAL_PI * diffuseColor;\n}\nvec3 F_Schlick( const in vec3 f0, const in float f90, const in float dotVH ) {\n\tfloat fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );\n\treturn f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );\n}\nfloat F_Schlick( const in float f0, const in float f90, const in float dotVH ) {\n\tfloat fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );\n\treturn f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );\n} // validated",cube_uv_reflection_fragment:"#ifdef ENVMAP_TYPE_CUBE_UV\n\t#define cubeUV_minMipLevel 4.0\n\t#define cubeUV_minTileSize 16.0\n\tfloat getFace( vec3 direction ) {\n\t\tvec3 absDirection = abs( direction );\n\t\tfloat face = - 1.0;\n\t\tif ( absDirection.x > absDirection.z ) {\n\t\t\tif ( absDirection.x > absDirection.y )\n\t\t\t\tface = direction.x > 0.0 ? 0.0 : 3.0;\n\t\t\telse\n\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\t\t} else {\n\t\t\tif ( absDirection.z > absDirection.y )\n\t\t\t\tface = direction.z > 0.0 ? 2.0 : 5.0;\n\t\t\telse\n\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\t\t}\n\t\treturn face;\n\t}\n\tvec2 getUV( vec3 direction, float face ) {\n\t\tvec2 uv;\n\t\tif ( face == 0.0 ) {\n\t\t\tuv = vec2( direction.z, direction.y ) / abs( direction.x );\n\t\t} else if ( face == 1.0 ) {\n\t\t\tuv = vec2( - direction.x, - direction.z ) / abs( direction.y );\n\t\t} else if ( face == 2.0 ) {\n\t\t\tuv = vec2( - direction.x, direction.y ) / abs( direction.z );\n\t\t} else if ( face == 3.0 ) {\n\t\t\tuv = vec2( - direction.z, direction.y ) / abs( direction.x );\n\t\t} else if ( face == 4.0 ) {\n\t\t\tuv = vec2( - direction.x, direction.z ) / abs( direction.y );\n\t\t} else {\n\t\t\tuv = vec2( direction.x, direction.y ) / abs( direction.z );\n\t\t}\n\t\treturn 0.5 * ( uv + 1.0 );\n\t}\n\tvec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {\n\t\tfloat face = getFace( direction );\n\t\tfloat filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );\n\t\tmipInt = max( mipInt, cubeUV_minMipLevel );\n\t\tfloat faceSize = exp2( mipInt );\n\t\thighp vec2 uv = getUV( direction, face ) * ( faceSize - 2.0 ) + 1.0;\n\t\tif ( face > 2.0 ) {\n\t\t\tuv.y += faceSize;\n\t\t\tface -= 3.0;\n\t\t}\n\t\tuv.x += face * faceSize;\n\t\tuv.x += filterInt * 3.0 * cubeUV_minTileSize;\n\t\tuv.y += 4.0 * ( exp2( CUBEUV_MAX_MIP ) - faceSize );\n\t\tuv.x *= CUBEUV_TEXEL_WIDTH;\n\t\tuv.y *= CUBEUV_TEXEL_HEIGHT;\n\t\t#ifdef texture2DGradEXT\n\t\t\treturn texture2DGradEXT( envMap, uv, vec2( 0.0 ), vec2( 0.0 ) ).rgb;\n\t\t#else\n\t\t\treturn texture2D( envMap, uv ).rgb;\n\t\t#endif\n\t}\n\t#define cubeUV_r0 1.0\n\t#define cubeUV_v0 0.339\n\t#define cubeUV_m0 - 2.0\n\t#define cubeUV_r1 0.8\n\t#define cubeUV_v1 0.276\n\t#define cubeUV_m1 - 1.0\n\t#define cubeUV_r4 0.4\n\t#define cubeUV_v4 0.046\n\t#define cubeUV_m4 2.0\n\t#define cubeUV_r5 0.305\n\t#define cubeUV_v5 0.016\n\t#define cubeUV_m5 3.0\n\t#define cubeUV_r6 0.21\n\t#define cubeUV_v6 0.0038\n\t#define cubeUV_m6 4.0\n\tfloat roughnessToMip( float roughness ) {\n\t\tfloat mip = 0.0;\n\t\tif ( roughness >= cubeUV_r1 ) {\n\t\t\tmip = ( cubeUV_r0 - roughness ) * ( cubeUV_m1 - cubeUV_m0 ) / ( cubeUV_r0 - cubeUV_r1 ) + cubeUV_m0;\n\t\t} else if ( roughness >= cubeUV_r4 ) {\n\t\t\tmip = ( cubeUV_r1 - roughness ) * ( cubeUV_m4 - cubeUV_m1 ) / ( cubeUV_r1 - cubeUV_r4 ) + cubeUV_m1;\n\t\t} else if ( roughness >= cubeUV_r5 ) {\n\t\t\tmip = ( cubeUV_r4 - roughness ) * ( cubeUV_m5 - cubeUV_m4 ) / ( cubeUV_r4 - cubeUV_r5 ) + cubeUV_m4;\n\t\t} else if ( roughness >= cubeUV_r6 ) {\n\t\t\tmip = ( cubeUV_r5 - roughness ) * ( cubeUV_m6 - cubeUV_m5 ) / ( cubeUV_r5 - cubeUV_r6 ) + cubeUV_m5;\n\t\t} else {\n\t\t\tmip = - 2.0 * log2( 1.16 * roughness );\t\t}\n\t\treturn mip;\n\t}\n\tvec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {\n\t\tfloat mip = clamp( roughnessToMip( roughness ), cubeUV_m0, CUBEUV_MAX_MIP );\n\t\tfloat mipF = fract( mip );\n\t\tfloat mipInt = floor( mip );\n\t\tvec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );\n\t\tif ( mipF == 0.0 ) {\n\t\t\treturn vec4( color0, 1.0 );\n\t\t} else {\n\t\t\tvec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );\n\t\t\treturn vec4( mix( color0, color1, mipF ), 1.0 );\n\t\t}\n\t}\n#endif",defaultnormal_vertex:"vec3 transformedNormal = objectNormal;\n#ifdef USE_INSTANCING\n\tmat3 m = mat3( instanceMatrix );\n\ttransformedNormal /= vec3( dot( m[ 0 ], m[ 0 ] ), dot( m[ 1 ], m[ 1 ] ), dot( m[ 2 ], m[ 2 ] ) );\n\ttransformedNormal = m * transformedNormal;\n#endif\ntransformedNormal = normalMatrix * transformedNormal;\n#ifdef FLIP_SIDED\n\ttransformedNormal = - transformedNormal;\n#endif\n#ifdef USE_TANGENT\n\tvec3 transformedTangent = ( modelViewMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n\t#ifdef FLIP_SIDED\n\t\ttransformedTangent = - transformedTangent;\n\t#endif\n#endif",displacementmap_pars_vertex:"#ifdef USE_DISPLACEMENTMAP\n\tuniform sampler2D displacementMap;\n\tuniform float displacementScale;\n\tuniform float displacementBias;\n#endif",displacementmap_vertex:"#ifdef USE_DISPLACEMENTMAP\n\ttransformed += normalize( objectNormal ) * ( texture2D( displacementMap, vDisplacementMapUv ).x * displacementScale + displacementBias );\n#endif",emissivemap_fragment:"#ifdef USE_EMISSIVEMAP\n\tvec4 emissiveColor = texture2D( emissiveMap, vEmissiveMapUv );\n\ttotalEmissiveRadiance *= emissiveColor.rgb;\n#endif",emissivemap_pars_fragment:"#ifdef USE_EMISSIVEMAP\n\tuniform sampler2D emissiveMap;\n#endif",colorspace_fragment:"gl_FragColor = linearToOutputTexel( gl_FragColor );",colorspace_pars_fragment:"\nconst mat3 LINEAR_SRGB_TO_LINEAR_DISPLAY_P3 = mat3(\n\tvec3( 0.8224621, 0.177538, 0.0 ),\n\tvec3( 0.0331941, 0.9668058, 0.0 ),\n\tvec3( 0.0170827, 0.0723974, 0.9105199 )\n);\nconst mat3 LINEAR_DISPLAY_P3_TO_LINEAR_SRGB = mat3(\n\tvec3( 1.2249401, - 0.2249404, 0.0 ),\n\tvec3( - 0.0420569, 1.0420571, 0.0 ),\n\tvec3( - 0.0196376, - 0.0786361, 1.0982735 )\n);\nvec4 LinearSRGBToLinearDisplayP3( in vec4 value ) {\n\treturn vec4( value.rgb * LINEAR_SRGB_TO_LINEAR_DISPLAY_P3, value.a );\n}\nvec4 LinearDisplayP3ToLinearSRGB( in vec4 value ) {\n\treturn vec4( value.rgb * LINEAR_DISPLAY_P3_TO_LINEAR_SRGB, value.a );\n}\nvec4 LinearTransferOETF( in vec4 value ) {\n\treturn value;\n}\nvec4 sRGBTransferOETF( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );\n}\nvec4 LinearToLinear( in vec4 value ) {\n\treturn value;\n}\nvec4 LinearTosRGB( in vec4 value ) {\n\treturn sRGBTransferOETF( value );\n}",envmap_fragment:"#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvec3 cameraToFrag;\n\t\tif ( isOrthographic ) {\n\t\t\tcameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t} else {\n\t\t\tcameraToFrag = normalize( vWorldPosition - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvec3 reflectVec = reflect( cameraToFrag, worldNormal );\n\t\t#else\n\t\t\tvec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );\n\t\t#endif\n\t#else\n\t\tvec3 reflectVec = vReflect;\n\t#endif\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tvec4 envColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );\n\t#else\n\t\tvec4 envColor = vec4( 0.0 );\n\t#endif\n\t#ifdef ENVMAP_BLENDING_MULTIPLY\n\t\toutgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_MIX )\n\t\toutgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_ADD )\n\t\toutgoingLight += envColor.xyz * specularStrength * reflectivity;\n\t#endif\n#endif",envmap_common_pars_fragment:"#ifdef USE_ENVMAP\n\tuniform float envMapIntensity;\n\tuniform float flipEnvMap;\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tuniform samplerCube envMap;\n\t#else\n\t\tuniform sampler2D envMap;\n\t#endif\n\t\n#endif",envmap_pars_fragment:"#ifdef USE_ENVMAP\n\tuniform float reflectivity;\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\tvarying vec3 vWorldPosition;\n\t\tuniform float refractionRatio;\n\t#else\n\t\tvarying vec3 vReflect;\n\t#endif\n#endif",envmap_pars_vertex:"#ifdef USE_ENVMAP\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\t\n\t\tvarying vec3 vWorldPosition;\n\t#else\n\t\tvarying vec3 vReflect;\n\t\tuniform float refractionRatio;\n\t#endif\n#endif",envmap_physical_pars_fragment:"#ifdef USE_ENVMAP\n\tvec3 getIBLIrradiance( const in vec3 normal ) {\n\t\t#ifdef ENVMAP_TYPE_CUBE_UV\n\t\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, worldNormal, 1.0 );\n\t\t\treturn PI * envMapColor.rgb * envMapIntensity;\n\t\t#else\n\t\t\treturn vec3( 0.0 );\n\t\t#endif\n\t}\n\tvec3 getIBLRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness ) {\n\t\t#ifdef ENVMAP_TYPE_CUBE_UV\n\t\t\tvec3 reflectVec = reflect( - viewDir, normal );\n\t\t\treflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );\n\t\t\treflectVec = inverseTransformDirection( reflectVec, viewMatrix );\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, reflectVec, roughness );\n\t\t\treturn envMapColor.rgb * envMapIntensity;\n\t\t#else\n\t\t\treturn vec3( 0.0 );\n\t\t#endif\n\t}\n\t#ifdef USE_ANISOTROPY\n\t\tvec3 getIBLAnisotropyRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness, const in vec3 bitangent, const in float anisotropy ) {\n\t\t\t#ifdef ENVMAP_TYPE_CUBE_UV\n\t\t\t\tvec3 bentNormal = cross( bitangent, viewDir );\n\t\t\t\tbentNormal = normalize( cross( bentNormal, bitangent ) );\n\t\t\t\tbentNormal = normalize( mix( bentNormal, normal, pow2( pow2( 1.0 - anisotropy * ( 1.0 - roughness ) ) ) ) );\n\t\t\t\treturn getIBLRadiance( viewDir, bentNormal, roughness );\n\t\t\t#else\n\t\t\t\treturn vec3( 0.0 );\n\t\t\t#endif\n\t\t}\n\t#endif\n#endif",envmap_vertex:"#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvWorldPosition = worldPosition.xyz;\n\t#else\n\t\tvec3 cameraToVertex;\n\t\tif ( isOrthographic ) {\n\t\t\tcameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t} else {\n\t\t\tcameraToVertex = normalize( worldPosition.xyz - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvReflect = reflect( cameraToVertex, worldNormal );\n\t\t#else\n\t\t\tvReflect = refract( cameraToVertex, worldNormal, refractionRatio );\n\t\t#endif\n\t#endif\n#endif",fog_vertex:"#ifdef USE_FOG\n\tvFogDepth = - mvPosition.z;\n#endif",fog_pars_vertex:"#ifdef USE_FOG\n\tvarying float vFogDepth;\n#endif",fog_fragment:"#ifdef USE_FOG\n\t#ifdef FOG_EXP2\n\t\tfloat fogFactor = 1.0 - exp( - fogDensity * fogDensity * vFogDepth * vFogDepth );\n\t#else\n\t\tfloat fogFactor = smoothstep( fogNear, fogFar, vFogDepth );\n\t#endif\n\tgl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );\n#endif",fog_pars_fragment:"#ifdef USE_FOG\n\tuniform vec3 fogColor;\n\tvarying float vFogDepth;\n\t#ifdef FOG_EXP2\n\t\tuniform float fogDensity;\n\t#else\n\t\tuniform float fogNear;\n\t\tuniform float fogFar;\n\t#endif\n#endif",gradientmap_pars_fragment:"#ifdef USE_GRADIENTMAP\n\tuniform sampler2D gradientMap;\n#endif\nvec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {\n\tfloat dotNL = dot( normal, lightDirection );\n\tvec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );\n\t#ifdef USE_GRADIENTMAP\n\t\treturn vec3( texture2D( gradientMap, coord ).r );\n\t#else\n\t\tvec2 fw = fwidth( coord ) * 0.5;\n\t\treturn mix( vec3( 0.7 ), vec3( 1.0 ), smoothstep( 0.7 - fw.x, 0.7 + fw.x, coord.x ) );\n\t#endif\n}",lightmap_fragment:"#ifdef USE_LIGHTMAP\n\tvec4 lightMapTexel = texture2D( lightMap, vLightMapUv );\n\tvec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;\n\treflectedLight.indirectDiffuse += lightMapIrradiance;\n#endif",lightmap_pars_fragment:"#ifdef USE_LIGHTMAP\n\tuniform sampler2D lightMap;\n\tuniform float lightMapIntensity;\n#endif",lights_lambert_fragment:"LambertMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularStrength = specularStrength;",lights_lambert_pars_fragment:"varying vec3 vViewPosition;\nstruct LambertMaterial {\n\tvec3 diffuseColor;\n\tfloat specularStrength;\n};\nvoid RE_Direct_Lambert( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometryNormal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Lambert( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_Lambert\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Lambert",lights_pars_begin:"uniform bool receiveShadow;\nuniform vec3 ambientLightColor;\n#if defined( USE_LIGHT_PROBES )\n\tuniform vec3 lightProbe[ 9 ];\n#endif\nvec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {\n\tfloat x = normal.x, y = normal.y, z = normal.z;\n\tvec3 result = shCoefficients[ 0 ] * 0.886227;\n\tresult += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;\n\tresult += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;\n\tresult += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;\n\tresult += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;\n\tresult += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;\n\tresult += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );\n\tresult += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;\n\tresult += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );\n\treturn result;\n}\nvec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in vec3 normal ) {\n\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\tvec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );\n\treturn irradiance;\n}\nvec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {\n\tvec3 irradiance = ambientLightColor;\n\treturn irradiance;\n}\nfloat getDistanceAttenuation( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {\n\t#if defined ( LEGACY_LIGHTS )\n\t\tif ( cutoffDistance > 0.0 && decayExponent > 0.0 ) {\n\t\t\treturn pow( saturate( - lightDistance / cutoffDistance + 1.0 ), decayExponent );\n\t\t}\n\t\treturn 1.0;\n\t#else\n\t\tfloat distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );\n\t\tif ( cutoffDistance > 0.0 ) {\n\t\t\tdistanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );\n\t\t}\n\t\treturn distanceFalloff;\n\t#endif\n}\nfloat getSpotAttenuation( const in float coneCosine, const in float penumbraCosine, const in float angleCosine ) {\n\treturn smoothstep( coneCosine, penumbraCosine, angleCosine );\n}\n#if NUM_DIR_LIGHTS > 0\n\tstruct DirectionalLight {\n\t\tvec3 direction;\n\t\tvec3 color;\n\t};\n\tuniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];\n\tvoid getDirectionalLightInfo( const in DirectionalLight directionalLight, out IncidentLight light ) {\n\t\tlight.color = directionalLight.color;\n\t\tlight.direction = directionalLight.direction;\n\t\tlight.visible = true;\n\t}\n#endif\n#if NUM_POINT_LIGHTS > 0\n\tstruct PointLight {\n\t\tvec3 position;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t};\n\tuniform PointLight pointLights[ NUM_POINT_LIGHTS ];\n\tvoid getPointLightInfo( const in PointLight pointLight, const in vec3 geometryPosition, out IncidentLight light ) {\n\t\tvec3 lVector = pointLight.position - geometryPosition;\n\t\tlight.direction = normalize( lVector );\n\t\tfloat lightDistance = length( lVector );\n\t\tlight.color = pointLight.color;\n\t\tlight.color *= getDistanceAttenuation( lightDistance, pointLight.distance, pointLight.decay );\n\t\tlight.visible = ( light.color != vec3( 0.0 ) );\n\t}\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\tstruct SpotLight {\n\t\tvec3 position;\n\t\tvec3 direction;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t\tfloat coneCos;\n\t\tfloat penumbraCos;\n\t};\n\tuniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];\n\tvoid getSpotLightInfo( const in SpotLight spotLight, const in vec3 geometryPosition, out IncidentLight light ) {\n\t\tvec3 lVector = spotLight.position - geometryPosition;\n\t\tlight.direction = normalize( lVector );\n\t\tfloat angleCos = dot( light.direction, spotLight.direction );\n\t\tfloat spotAttenuation = getSpotAttenuation( spotLight.coneCos, spotLight.penumbraCos, angleCos );\n\t\tif ( spotAttenuation > 0.0 ) {\n\t\t\tfloat lightDistance = length( lVector );\n\t\t\tlight.color = spotLight.color * spotAttenuation;\n\t\t\tlight.color *= getDistanceAttenuation( lightDistance, spotLight.distance, spotLight.decay );\n\t\t\tlight.visible = ( light.color != vec3( 0.0 ) );\n\t\t} else {\n\t\t\tlight.color = vec3( 0.0 );\n\t\t\tlight.visible = false;\n\t\t}\n\t}\n#endif\n#if NUM_RECT_AREA_LIGHTS > 0\n\tstruct RectAreaLight {\n\t\tvec3 color;\n\t\tvec3 position;\n\t\tvec3 halfWidth;\n\t\tvec3 halfHeight;\n\t};\n\tuniform sampler2D ltc_1;\tuniform sampler2D ltc_2;\n\tuniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\tstruct HemisphereLight {\n\t\tvec3 direction;\n\t\tvec3 skyColor;\n\t\tvec3 groundColor;\n\t};\n\tuniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];\n\tvec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in vec3 normal ) {\n\t\tfloat dotNL = dot( normal, hemiLight.direction );\n\t\tfloat hemiDiffuseWeight = 0.5 * dotNL + 0.5;\n\t\tvec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );\n\t\treturn irradiance;\n\t}\n#endif",lights_toon_fragment:"ToonMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;",lights_toon_pars_fragment:"varying vec3 vViewPosition;\nstruct ToonMaterial {\n\tvec3 diffuseColor;\n};\nvoid RE_Direct_Toon( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\tvec3 irradiance = getGradientIrradiance( geometryNormal, directLight.direction ) * directLight.color;\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_Toon\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Toon",lights_phong_fragment:"BlinnPhongMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularColor = specular;\nmaterial.specularShininess = shininess;\nmaterial.specularStrength = specularStrength;",lights_phong_pars_fragment:"varying vec3 vViewPosition;\nstruct BlinnPhongMaterial {\n\tvec3 diffuseColor;\n\tvec3 specularColor;\n\tfloat specularShininess;\n\tfloat specularStrength;\n};\nvoid RE_Direct_BlinnPhong( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometryNormal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n\treflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometryViewDir, geometryNormal, material.specularColor, material.specularShininess ) * material.specularStrength;\n}\nvoid RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_BlinnPhong\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_BlinnPhong",lights_physical_fragment:"PhysicalMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );\nvec3 dxy = max( abs( dFdx( nonPerturbedNormal ) ), abs( dFdy( nonPerturbedNormal ) ) );\nfloat geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );\nmaterial.roughness = max( roughnessFactor, 0.0525 );material.roughness += geometryRoughness;\nmaterial.roughness = min( material.roughness, 1.0 );\n#ifdef IOR\n\tmaterial.ior = ior;\n\t#ifdef USE_SPECULAR\n\t\tfloat specularIntensityFactor = specularIntensity;\n\t\tvec3 specularColorFactor = specularColor;\n\t\t#ifdef USE_SPECULAR_COLORMAP\n\t\t\tspecularColorFactor *= texture2D( specularColorMap, vSpecularColorMapUv ).rgb;\n\t\t#endif\n\t\t#ifdef USE_SPECULAR_INTENSITYMAP\n\t\t\tspecularIntensityFactor *= texture2D( specularIntensityMap, vSpecularIntensityMapUv ).a;\n\t\t#endif\n\t\tmaterial.specularF90 = mix( specularIntensityFactor, 1.0, metalnessFactor );\n\t#else\n\t\tfloat specularIntensityFactor = 1.0;\n\t\tvec3 specularColorFactor = vec3( 1.0 );\n\t\tmaterial.specularF90 = 1.0;\n\t#endif\n\tmaterial.specularColor = mix( min( pow2( ( material.ior - 1.0 ) / ( material.ior + 1.0 ) ) * specularColorFactor, vec3( 1.0 ) ) * specularIntensityFactor, diffuseColor.rgb, metalnessFactor );\n#else\n\tmaterial.specularColor = mix( vec3( 0.04 ), diffuseColor.rgb, metalnessFactor );\n\tmaterial.specularF90 = 1.0;\n#endif\n#ifdef USE_CLEARCOAT\n\tmaterial.clearcoat = clearcoat;\n\tmaterial.clearcoatRoughness = clearcoatRoughness;\n\tmaterial.clearcoatF0 = vec3( 0.04 );\n\tmaterial.clearcoatF90 = 1.0;\n\t#ifdef USE_CLEARCOATMAP\n\t\tmaterial.clearcoat *= texture2D( clearcoatMap, vClearcoatMapUv ).x;\n\t#endif\n\t#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\t\tmaterial.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vClearcoatRoughnessMapUv ).y;\n\t#endif\n\tmaterial.clearcoat = saturate( material.clearcoat );\tmaterial.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );\n\tmaterial.clearcoatRoughness += geometryRoughness;\n\tmaterial.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );\n#endif\n#ifdef USE_IRIDESCENCE\n\tmaterial.iridescence = iridescence;\n\tmaterial.iridescenceIOR = iridescenceIOR;\n\t#ifdef USE_IRIDESCENCEMAP\n\t\tmaterial.iridescence *= texture2D( iridescenceMap, vIridescenceMapUv ).r;\n\t#endif\n\t#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\t\tmaterial.iridescenceThickness = (iridescenceThicknessMaximum - iridescenceThicknessMinimum) * texture2D( iridescenceThicknessMap, vIridescenceThicknessMapUv ).g + iridescenceThicknessMinimum;\n\t#else\n\t\tmaterial.iridescenceThickness = iridescenceThicknessMaximum;\n\t#endif\n#endif\n#ifdef USE_SHEEN\n\tmaterial.sheenColor = sheenColor;\n\t#ifdef USE_SHEEN_COLORMAP\n\t\tmaterial.sheenColor *= texture2D( sheenColorMap, vSheenColorMapUv ).rgb;\n\t#endif\n\tmaterial.sheenRoughness = clamp( sheenRoughness, 0.07, 1.0 );\n\t#ifdef USE_SHEEN_ROUGHNESSMAP\n\t\tmaterial.sheenRoughness *= texture2D( sheenRoughnessMap, vSheenRoughnessMapUv ).a;\n\t#endif\n#endif\n#ifdef USE_ANISOTROPY\n\t#ifdef USE_ANISOTROPYMAP\n\t\tmat2 anisotropyMat = mat2( anisotropyVector.x, anisotropyVector.y, - anisotropyVector.y, anisotropyVector.x );\n\t\tvec3 anisotropyPolar = texture2D( anisotropyMap, vAnisotropyMapUv ).rgb;\n\t\tvec2 anisotropyV = anisotropyMat * normalize( 2.0 * anisotropyPolar.rg - vec2( 1.0 ) ) * anisotropyPolar.b;\n\t#else\n\t\tvec2 anisotropyV = anisotropyVector;\n\t#endif\n\tmaterial.anisotropy = length( anisotropyV );\n\tanisotropyV /= material.anisotropy;\n\tmaterial.anisotropy = saturate( material.anisotropy );\n\tmaterial.alphaT = mix( pow2( material.roughness ), 1.0, pow2( material.anisotropy ) );\n\tmaterial.anisotropyT = tbn[ 0 ] * anisotropyV.x - tbn[ 1 ] * anisotropyV.y;\n\tmaterial.anisotropyB = tbn[ 1 ] * anisotropyV.x + tbn[ 0 ] * anisotropyV.y;\n#endif",lights_physical_pars_fragment:"struct PhysicalMaterial {\n\tvec3 diffuseColor;\n\tfloat roughness;\n\tvec3 specularColor;\n\tfloat specularF90;\n\t#ifdef USE_CLEARCOAT\n\t\tfloat clearcoat;\n\t\tfloat clearcoatRoughness;\n\t\tvec3 clearcoatF0;\n\t\tfloat clearcoatF90;\n\t#endif\n\t#ifdef USE_IRIDESCENCE\n\t\tfloat iridescence;\n\t\tfloat iridescenceIOR;\n\t\tfloat iridescenceThickness;\n\t\tvec3 iridescenceFresnel;\n\t\tvec3 iridescenceF0;\n\t#endif\n\t#ifdef USE_SHEEN\n\t\tvec3 sheenColor;\n\t\tfloat sheenRoughness;\n\t#endif\n\t#ifdef IOR\n\t\tfloat ior;\n\t#endif\n\t#ifdef USE_TRANSMISSION\n\t\tfloat transmission;\n\t\tfloat transmissionAlpha;\n\t\tfloat thickness;\n\t\tfloat attenuationDistance;\n\t\tvec3 attenuationColor;\n\t#endif\n\t#ifdef USE_ANISOTROPY\n\t\tfloat anisotropy;\n\t\tfloat alphaT;\n\t\tvec3 anisotropyT;\n\t\tvec3 anisotropyB;\n\t#endif\n};\nvec3 clearcoatSpecularDirect = vec3( 0.0 );\nvec3 clearcoatSpecularIndirect = vec3( 0.0 );\nvec3 sheenSpecularDirect = vec3( 0.0 );\nvec3 sheenSpecularIndirect = vec3(0.0 );\nvec3 Schlick_to_F0( const in vec3 f, const in float f90, const in float dotVH ) {\n    float x = clamp( 1.0 - dotVH, 0.0, 1.0 );\n    float x2 = x * x;\n    float x5 = clamp( x * x2 * x2, 0.0, 0.9999 );\n    return ( f - vec3( f90 ) * x5 ) / ( 1.0 - x5 );\n}\nfloat V_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {\n\tfloat a2 = pow2( alpha );\n\tfloat gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\tfloat gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\treturn 0.5 / max( gv + gl, EPSILON );\n}\nfloat D_GGX( const in float alpha, const in float dotNH ) {\n\tfloat a2 = pow2( alpha );\n\tfloat denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;\n\treturn RECIPROCAL_PI * a2 / pow2( denom );\n}\n#ifdef USE_ANISOTROPY\n\tfloat V_GGX_SmithCorrelated_Anisotropic( const in float alphaT, const in float alphaB, const in float dotTV, const in float dotBV, const in float dotTL, const in float dotBL, const in float dotNV, const in float dotNL ) {\n\t\tfloat gv = dotNL * length( vec3( alphaT * dotTV, alphaB * dotBV, dotNV ) );\n\t\tfloat gl = dotNV * length( vec3( alphaT * dotTL, alphaB * dotBL, dotNL ) );\n\t\tfloat v = 0.5 / ( gv + gl );\n\t\treturn saturate(v);\n\t}\n\tfloat D_GGX_Anisotropic( const in float alphaT, const in float alphaB, const in float dotNH, const in float dotTH, const in float dotBH ) {\n\t\tfloat a2 = alphaT * alphaB;\n\t\thighp vec3 v = vec3( alphaB * dotTH, alphaT * dotBH, a2 * dotNH );\n\t\thighp float v2 = dot( v, v );\n\t\tfloat w2 = a2 / v2;\n\t\treturn RECIPROCAL_PI * a2 * pow2 ( w2 );\n\t}\n#endif\n#ifdef USE_CLEARCOAT\n\tvec3 BRDF_GGX_Clearcoat( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material) {\n\t\tvec3 f0 = material.clearcoatF0;\n\t\tfloat f90 = material.clearcoatF90;\n\t\tfloat roughness = material.clearcoatRoughness;\n\t\tfloat alpha = pow2( roughness );\n\t\tvec3 halfDir = normalize( lightDir + viewDir );\n\t\tfloat dotNL = saturate( dot( normal, lightDir ) );\n\t\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\t\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\t\tfloat dotVH = saturate( dot( viewDir, halfDir ) );\n\t\tvec3 F = F_Schlick( f0, f90, dotVH );\n\t\tfloat V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n\t\tfloat D = D_GGX( alpha, dotNH );\n\t\treturn F * ( V * D );\n\t}\n#endif\nvec3 BRDF_GGX( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material ) {\n\tvec3 f0 = material.specularColor;\n\tfloat f90 = material.specularF90;\n\tfloat roughness = material.roughness;\n\tfloat alpha = pow2( roughness );\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNL = saturate( dot( normal, lightDir ) );\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat dotVH = saturate( dot( viewDir, halfDir ) );\n\tvec3 F = F_Schlick( f0, f90, dotVH );\n\t#ifdef USE_IRIDESCENCE\n\t\tF = mix( F, material.iridescenceFresnel, material.iridescence );\n\t#endif\n\t#ifdef USE_ANISOTROPY\n\t\tfloat dotTL = dot( material.anisotropyT, lightDir );\n\t\tfloat dotTV = dot( material.anisotropyT, viewDir );\n\t\tfloat dotTH = dot( material.anisotropyT, halfDir );\n\t\tfloat dotBL = dot( material.anisotropyB, lightDir );\n\t\tfloat dotBV = dot( material.anisotropyB, viewDir );\n\t\tfloat dotBH = dot( material.anisotropyB, halfDir );\n\t\tfloat V = V_GGX_SmithCorrelated_Anisotropic( material.alphaT, alpha, dotTV, dotBV, dotTL, dotBL, dotNV, dotNL );\n\t\tfloat D = D_GGX_Anisotropic( material.alphaT, alpha, dotNH, dotTH, dotBH );\n\t#else\n\t\tfloat V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n\t\tfloat D = D_GGX( alpha, dotNH );\n\t#endif\n\treturn F * ( V * D );\n}\nvec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {\n\tconst float LUT_SIZE = 64.0;\n\tconst float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;\n\tconst float LUT_BIAS = 0.5 / LUT_SIZE;\n\tfloat dotNV = saturate( dot( N, V ) );\n\tvec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );\n\tuv = uv * LUT_SCALE + LUT_BIAS;\n\treturn uv;\n}\nfloat LTC_ClippedSphereFormFactor( const in vec3 f ) {\n\tfloat l = length( f );\n\treturn max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );\n}\nvec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {\n\tfloat x = dot( v1, v2 );\n\tfloat y = abs( x );\n\tfloat a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;\n\tfloat b = 3.4175940 + ( 4.1616724 + y ) * y;\n\tfloat v = a / b;\n\tfloat theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;\n\treturn cross( v1, v2 ) * theta_sintheta;\n}\nvec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {\n\tvec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];\n\tvec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];\n\tvec3 lightNormal = cross( v1, v2 );\n\tif( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );\n\tvec3 T1, T2;\n\tT1 = normalize( V - N * dot( V, N ) );\n\tT2 = - cross( N, T1 );\n\tmat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );\n\tvec3 coords[ 4 ];\n\tcoords[ 0 ] = mat * ( rectCoords[ 0 ] - P );\n\tcoords[ 1 ] = mat * ( rectCoords[ 1 ] - P );\n\tcoords[ 2 ] = mat * ( rectCoords[ 2 ] - P );\n\tcoords[ 3 ] = mat * ( rectCoords[ 3 ] - P );\n\tcoords[ 0 ] = normalize( coords[ 0 ] );\n\tcoords[ 1 ] = normalize( coords[ 1 ] );\n\tcoords[ 2 ] = normalize( coords[ 2 ] );\n\tcoords[ 3 ] = normalize( coords[ 3 ] );\n\tvec3 vectorFormFactor = vec3( 0.0 );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );\n\tfloat result = LTC_ClippedSphereFormFactor( vectorFormFactor );\n\treturn vec3( result );\n}\n#if defined( USE_SHEEN )\nfloat D_Charlie( float roughness, float dotNH ) {\n\tfloat alpha = pow2( roughness );\n\tfloat invAlpha = 1.0 / alpha;\n\tfloat cos2h = dotNH * dotNH;\n\tfloat sin2h = max( 1.0 - cos2h, 0.0078125 );\n\treturn ( 2.0 + invAlpha ) * pow( sin2h, invAlpha * 0.5 ) / ( 2.0 * PI );\n}\nfloat V_Neubelt( float dotNV, float dotNL ) {\n\treturn saturate( 1.0 / ( 4.0 * ( dotNL + dotNV - dotNL * dotNV ) ) );\n}\nvec3 BRDF_Sheen( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, vec3 sheenColor, const in float sheenRoughness ) {\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNL = saturate( dot( normal, lightDir ) );\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat D = D_Charlie( sheenRoughness, dotNH );\n\tfloat V = V_Neubelt( dotNV, dotNL );\n\treturn sheenColor * ( D * V );\n}\n#endif\nfloat IBLSheenBRDF( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat r2 = roughness * roughness;\n\tfloat a = roughness < 0.25 ? -339.2 * r2 + 161.4 * roughness - 25.9 : -8.48 * r2 + 14.3 * roughness - 9.95;\n\tfloat b = roughness < 0.25 ? 44.0 * r2 - 23.7 * roughness + 3.26 : 1.97 * r2 - 3.27 * roughness + 0.72;\n\tfloat DG = exp( a * dotNV + b ) + ( roughness < 0.25 ? 0.0 : 0.1 * ( roughness - 0.25 ) );\n\treturn saturate( DG * RECIPROCAL_PI );\n}\nvec2 DFGApprox( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tconst vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );\n\tconst vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );\n\tvec4 r = roughness * c0 + c1;\n\tfloat a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;\n\tvec2 fab = vec2( - 1.04, 1.04 ) * a004 + r.zw;\n\treturn fab;\n}\nvec3 EnvironmentBRDF( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness ) {\n\tvec2 fab = DFGApprox( normal, viewDir, roughness );\n\treturn specularColor * fab.x + specularF90 * fab.y;\n}\n#ifdef USE_IRIDESCENCE\nvoid computeMultiscatteringIridescence( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float iridescence, const in vec3 iridescenceF0, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {\n#else\nvoid computeMultiscattering( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {\n#endif\n\tvec2 fab = DFGApprox( normal, viewDir, roughness );\n\t#ifdef USE_IRIDESCENCE\n\t\tvec3 Fr = mix( specularColor, iridescenceF0, iridescence );\n\t#else\n\t\tvec3 Fr = specularColor;\n\t#endif\n\tvec3 FssEss = Fr * fab.x + specularF90 * fab.y;\n\tfloat Ess = fab.x + fab.y;\n\tfloat Ems = 1.0 - Ess;\n\tvec3 Favg = Fr + ( 1.0 - Fr ) * 0.047619;\tvec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );\n\tsingleScatter += FssEss;\n\tmultiScatter += Fms * Ems;\n}\n#if NUM_RECT_AREA_LIGHTS > 0\n\tvoid RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\t\tvec3 normal = geometryNormal;\n\t\tvec3 viewDir = geometryViewDir;\n\t\tvec3 position = geometryPosition;\n\t\tvec3 lightPos = rectAreaLight.position;\n\t\tvec3 halfWidth = rectAreaLight.halfWidth;\n\t\tvec3 halfHeight = rectAreaLight.halfHeight;\n\t\tvec3 lightColor = rectAreaLight.color;\n\t\tfloat roughness = material.roughness;\n\t\tvec3 rectCoords[ 4 ];\n\t\trectCoords[ 0 ] = lightPos + halfWidth - halfHeight;\t\trectCoords[ 1 ] = lightPos - halfWidth - halfHeight;\n\t\trectCoords[ 2 ] = lightPos - halfWidth + halfHeight;\n\t\trectCoords[ 3 ] = lightPos + halfWidth + halfHeight;\n\t\tvec2 uv = LTC_Uv( normal, viewDir, roughness );\n\t\tvec4 t1 = texture2D( ltc_1, uv );\n\t\tvec4 t2 = texture2D( ltc_2, uv );\n\t\tmat3 mInv = mat3(\n\t\t\tvec3( t1.x, 0, t1.y ),\n\t\t\tvec3(    0, 1,    0 ),\n\t\t\tvec3( t1.z, 0, t1.w )\n\t\t);\n\t\tvec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );\n\t\treflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );\n\t\treflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );\n\t}\n#endif\nvoid RE_Direct_Physical( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometryNormal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\t#ifdef USE_CLEARCOAT\n\t\tfloat dotNLcc = saturate( dot( geometryClearcoatNormal, directLight.direction ) );\n\t\tvec3 ccIrradiance = dotNLcc * directLight.color;\n\t\tclearcoatSpecularDirect += ccIrradiance * BRDF_GGX_Clearcoat( directLight.direction, geometryViewDir, geometryClearcoatNormal, material );\n\t#endif\n\t#ifdef USE_SHEEN\n\t\tsheenSpecularDirect += irradiance * BRDF_Sheen( directLight.direction, geometryViewDir, geometryNormal, material.sheenColor, material.sheenRoughness );\n\t#endif\n\treflectedLight.directSpecular += irradiance * BRDF_GGX( directLight.direction, geometryViewDir, geometryNormal, material );\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {\n\t#ifdef USE_CLEARCOAT\n\t\tclearcoatSpecularIndirect += clearcoatRadiance * EnvironmentBRDF( geometryClearcoatNormal, geometryViewDir, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );\n\t#endif\n\t#ifdef USE_SHEEN\n\t\tsheenSpecularIndirect += irradiance * material.sheenColor * IBLSheenBRDF( geometryNormal, geometryViewDir, material.sheenRoughness );\n\t#endif\n\tvec3 singleScattering = vec3( 0.0 );\n\tvec3 multiScattering = vec3( 0.0 );\n\tvec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;\n\t#ifdef USE_IRIDESCENCE\n\t\tcomputeMultiscatteringIridescence( geometryNormal, geometryViewDir, material.specularColor, material.specularF90, material.iridescence, material.iridescenceFresnel, material.roughness, singleScattering, multiScattering );\n\t#else\n\t\tcomputeMultiscattering( geometryNormal, geometryViewDir, material.specularColor, material.specularF90, material.roughness, singleScattering, multiScattering );\n\t#endif\n\tvec3 totalScattering = singleScattering + multiScattering;\n\tvec3 diffuse = material.diffuseColor * ( 1.0 - max( max( totalScattering.r, totalScattering.g ), totalScattering.b ) );\n\treflectedLight.indirectSpecular += radiance * singleScattering;\n\treflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;\n\treflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;\n}\n#define RE_Direct\t\t\t\tRE_Direct_Physical\n#define RE_Direct_RectArea\t\tRE_Direct_RectArea_Physical\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Physical\n#define RE_IndirectSpecular\t\tRE_IndirectSpecular_Physical\nfloat computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {\n\treturn saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );\n}",lights_fragment_begin:"\nvec3 geometryPosition = - vViewPosition;\nvec3 geometryNormal = normal;\nvec3 geometryViewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );\nvec3 geometryClearcoatNormal = vec3( 0.0 );\n#ifdef USE_CLEARCOAT\n\tgeometryClearcoatNormal = clearcoatNormal;\n#endif\n#ifdef USE_IRIDESCENCE\n\tfloat dotNVi = saturate( dot( normal, geometryViewDir ) );\n\tif ( material.iridescenceThickness == 0.0 ) {\n\t\tmaterial.iridescence = 0.0;\n\t} else {\n\t\tmaterial.iridescence = saturate( material.iridescence );\n\t}\n\tif ( material.iridescence > 0.0 ) {\n\t\tmaterial.iridescenceFresnel = evalIridescence( 1.0, material.iridescenceIOR, dotNVi, material.iridescenceThickness, material.specularColor );\n\t\tmaterial.iridescenceF0 = Schlick_to_F0( material.iridescenceFresnel, 1.0, dotNVi );\n\t}\n#endif\nIncidentLight directLight;\n#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )\n\tPointLight pointLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLightShadow pointLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tpointLight = pointLights[ i ];\n\t\tgetPointLightInfo( pointLight, geometryPosition, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )\n\t\tpointLightShadow = pointLightShadows[ i ];\n\t\tdirectLight.color *= ( directLight.visible && receiveShadow ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )\n\tSpotLight spotLight;\n\tvec4 spotColor;\n\tvec3 spotLightCoord;\n\tbool inSpotLightMap;\n\t#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLightShadow spotLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tspotLight = spotLights[ i ];\n\t\tgetSpotLightInfo( spotLight, geometryPosition, directLight );\n\t\t#if ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )\n\t\t#define SPOT_LIGHT_MAP_INDEX UNROLLED_LOOP_INDEX\n\t\t#elif ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\t#define SPOT_LIGHT_MAP_INDEX NUM_SPOT_LIGHT_MAPS\n\t\t#else\n\t\t#define SPOT_LIGHT_MAP_INDEX ( UNROLLED_LOOP_INDEX - NUM_SPOT_LIGHT_SHADOWS + NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )\n\t\t#endif\n\t\t#if ( SPOT_LIGHT_MAP_INDEX < NUM_SPOT_LIGHT_MAPS )\n\t\t\tspotLightCoord = vSpotLightCoord[ i ].xyz / vSpotLightCoord[ i ].w;\n\t\t\tinSpotLightMap = all( lessThan( abs( spotLightCoord * 2. - 1. ), vec3( 1.0 ) ) );\n\t\t\tspotColor = texture2D( spotLightMap[ SPOT_LIGHT_MAP_INDEX ], spotLightCoord.xy );\n\t\t\tdirectLight.color = inSpotLightMap ? directLight.color * spotColor.rgb : directLight.color;\n\t\t#endif\n\t\t#undef SPOT_LIGHT_MAP_INDEX\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\tspotLightShadow = spotLightShadows[ i ];\n\t\tdirectLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )\n\tDirectionalLight directionalLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tdirectionalLight = directionalLights[ i ];\n\t\tgetDirectionalLightInfo( directionalLight, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )\n\t\tdirectionalLightShadow = directionalLightShadows[ i ];\n\t\tdirectLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )\n\tRectAreaLight rectAreaLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {\n\t\trectAreaLight = rectAreaLights[ i ];\n\t\tRE_Direct_RectArea( rectAreaLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if defined( RE_IndirectDiffuse )\n\tvec3 iblIrradiance = vec3( 0.0 );\n\tvec3 irradiance = getAmbientLightIrradiance( ambientLightColor );\n\t#if defined( USE_LIGHT_PROBES )\n\t\tirradiance += getLightProbeIrradiance( lightProbe, geometryNormal );\n\t#endif\n\t#if ( NUM_HEMI_LIGHTS > 0 )\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\t\tirradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometryNormal );\n\t\t}\n\t\t#pragma unroll_loop_end\n\t#endif\n#endif\n#if defined( RE_IndirectSpecular )\n\tvec3 radiance = vec3( 0.0 );\n\tvec3 clearcoatRadiance = vec3( 0.0 );\n#endif",lights_fragment_maps:"#if defined( RE_IndirectDiffuse )\n\t#ifdef USE_LIGHTMAP\n\t\tvec4 lightMapTexel = texture2D( lightMap, vLightMapUv );\n\t\tvec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;\n\t\tirradiance += lightMapIrradiance;\n\t#endif\n\t#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )\n\t\tiblIrradiance += getIBLIrradiance( geometryNormal );\n\t#endif\n#endif\n#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )\n\t#ifdef USE_ANISOTROPY\n\t\tradiance += getIBLAnisotropyRadiance( geometryViewDir, geometryNormal, material.roughness, material.anisotropyB, material.anisotropy );\n\t#else\n\t\tradiance += getIBLRadiance( geometryViewDir, geometryNormal, material.roughness );\n\t#endif\n\t#ifdef USE_CLEARCOAT\n\t\tclearcoatRadiance += getIBLRadiance( geometryViewDir, geometryClearcoatNormal, material.clearcoatRoughness );\n\t#endif\n#endif",lights_fragment_end:"#if defined( RE_IndirectDiffuse )\n\tRE_IndirectDiffuse( irradiance, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );\n#endif\n#if defined( RE_IndirectSpecular )\n\tRE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );\n#endif",logdepthbuf_fragment:"#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\tgl_FragDepthEXT = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;\n#endif",logdepthbuf_pars_fragment:"#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\tuniform float logDepthBufFC;\n\tvarying float vFragDepth;\n\tvarying float vIsPerspective;\n#endif",logdepthbuf_pars_vertex:"#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvarying float vFragDepth;\n\t\tvarying float vIsPerspective;\n\t#else\n\t\tuniform float logDepthBufFC;\n\t#endif\n#endif",logdepthbuf_vertex:"#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvFragDepth = 1.0 + gl_Position.w;\n\t\tvIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );\n\t#else\n\t\tif ( isPerspectiveMatrix( projectionMatrix ) ) {\n\t\t\tgl_Position.z = log2( max( EPSILON, gl_Position.w + 1.0 ) ) * logDepthBufFC - 1.0;\n\t\t\tgl_Position.z *= gl_Position.w;\n\t\t}\n\t#endif\n#endif",map_fragment:"#ifdef USE_MAP\n\tvec4 sampledDiffuseColor = texture2D( map, vMapUv );\n\t#ifdef DECODE_VIDEO_TEXTURE\n\t\tsampledDiffuseColor = vec4( mix( pow( sampledDiffuseColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), sampledDiffuseColor.rgb * 0.0773993808, vec3( lessThanEqual( sampledDiffuseColor.rgb, vec3( 0.04045 ) ) ) ), sampledDiffuseColor.w );\n\t\n\t#endif\n\tdiffuseColor *= sampledDiffuseColor;\n#endif",map_pars_fragment:"#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif",map_particle_fragment:"#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\t#if defined( USE_POINTS_UV )\n\t\tvec2 uv = vUv;\n\t#else\n\t\tvec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;\n\t#endif\n#endif\n#ifdef USE_MAP\n\tdiffuseColor *= texture2D( map, uv );\n#endif\n#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, uv ).g;\n#endif",map_particle_pars_fragment:"#if defined( USE_POINTS_UV )\n\tvarying vec2 vUv;\n#else\n\t#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\t\tuniform mat3 uvTransform;\n\t#endif\n#endif\n#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif\n#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",metalnessmap_fragment:"float metalnessFactor = metalness;\n#ifdef USE_METALNESSMAP\n\tvec4 texelMetalness = texture2D( metalnessMap, vMetalnessMapUv );\n\tmetalnessFactor *= texelMetalness.b;\n#endif",metalnessmap_pars_fragment:"#ifdef USE_METALNESSMAP\n\tuniform sampler2D metalnessMap;\n#endif",morphcolor_vertex:"#if defined( USE_MORPHCOLORS ) && defined( MORPHTARGETS_TEXTURE )\n\tvColor *= morphTargetBaseInfluence;\n\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\t#if defined( USE_COLOR_ALPHA )\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ) * morphTargetInfluences[ i ];\n\t\t#elif defined( USE_COLOR )\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ).rgb * morphTargetInfluences[ i ];\n\t\t#endif\n\t}\n#endif",morphnormal_vertex:"#ifdef USE_MORPHNORMALS\n\tobjectNormal *= morphTargetBaseInfluence;\n\t#ifdef MORPHTARGETS_TEXTURE\n\t\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) objectNormal += getMorph( gl_VertexID, i, 1 ).xyz * morphTargetInfluences[ i ];\n\t\t}\n\t#else\n\t\tobjectNormal += morphNormal0 * morphTargetInfluences[ 0 ];\n\t\tobjectNormal += morphNormal1 * morphTargetInfluences[ 1 ];\n\t\tobjectNormal += morphNormal2 * morphTargetInfluences[ 2 ];\n\t\tobjectNormal += morphNormal3 * morphTargetInfluences[ 3 ];\n\t#endif\n#endif",morphtarget_pars_vertex:"#ifdef USE_MORPHTARGETS\n\tuniform float morphTargetBaseInfluence;\n\t#ifdef MORPHTARGETS_TEXTURE\n\t\tuniform float morphTargetInfluences[ MORPHTARGETS_COUNT ];\n\t\tuniform sampler2DArray morphTargetsTexture;\n\t\tuniform ivec2 morphTargetsTextureSize;\n\t\tvec4 getMorph( const in int vertexIndex, const in int morphTargetIndex, const in int offset ) {\n\t\t\tint texelIndex = vertexIndex * MORPHTARGETS_TEXTURE_STRIDE + offset;\n\t\t\tint y = texelIndex / morphTargetsTextureSize.x;\n\t\t\tint x = texelIndex - y * morphTargetsTextureSize.x;\n\t\t\tivec3 morphUV = ivec3( x, y, morphTargetIndex );\n\t\t\treturn texelFetch( morphTargetsTexture, morphUV, 0 );\n\t\t}\n\t#else\n\t\t#ifndef USE_MORPHNORMALS\n\t\t\tuniform float morphTargetInfluences[ 8 ];\n\t\t#else\n\t\t\tuniform float morphTargetInfluences[ 4 ];\n\t\t#endif\n\t#endif\n#endif",morphtarget_vertex:"#ifdef USE_MORPHTARGETS\n\ttransformed *= morphTargetBaseInfluence;\n\t#ifdef MORPHTARGETS_TEXTURE\n\t\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) transformed += getMorph( gl_VertexID, i, 0 ).xyz * morphTargetInfluences[ i ];\n\t\t}\n\t#else\n\t\ttransformed += morphTarget0 * morphTargetInfluences[ 0 ];\n\t\ttransformed += morphTarget1 * morphTargetInfluences[ 1 ];\n\t\ttransformed += morphTarget2 * morphTargetInfluences[ 2 ];\n\t\ttransformed += morphTarget3 * morphTargetInfluences[ 3 ];\n\t\t#ifndef USE_MORPHNORMALS\n\t\t\ttransformed += morphTarget4 * morphTargetInfluences[ 4 ];\n\t\t\ttransformed += morphTarget5 * morphTargetInfluences[ 5 ];\n\t\t\ttransformed += morphTarget6 * morphTargetInfluences[ 6 ];\n\t\t\ttransformed += morphTarget7 * morphTargetInfluences[ 7 ];\n\t\t#endif\n\t#endif\n#endif",normal_fragment_begin:"float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;\n#ifdef FLAT_SHADED\n\tvec3 fdx = dFdx( vViewPosition );\n\tvec3 fdy = dFdy( vViewPosition );\n\tvec3 normal = normalize( cross( fdx, fdy ) );\n#else\n\tvec3 normal = normalize( vNormal );\n\t#ifdef DOUBLE_SIDED\n\t\tnormal *= faceDirection;\n\t#endif\n#endif\n#if defined( USE_NORMALMAP_TANGENTSPACE ) || defined( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY )\n\t#ifdef USE_TANGENT\n\t\tmat3 tbn = mat3( normalize( vTangent ), normalize( vBitangent ), normal );\n\t#else\n\t\tmat3 tbn = getTangentFrame( - vViewPosition, normal,\n\t\t#if defined( USE_NORMALMAP )\n\t\t\tvNormalMapUv\n\t\t#elif defined( USE_CLEARCOAT_NORMALMAP )\n\t\t\tvClearcoatNormalMapUv\n\t\t#else\n\t\t\tvUv\n\t\t#endif\n\t\t);\n\t#endif\n\t#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )\n\t\ttbn[0] *= faceDirection;\n\t\ttbn[1] *= faceDirection;\n\t#endif\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\t#ifdef USE_TANGENT\n\t\tmat3 tbn2 = mat3( normalize( vTangent ), normalize( vBitangent ), normal );\n\t#else\n\t\tmat3 tbn2 = getTangentFrame( - vViewPosition, normal, vClearcoatNormalMapUv );\n\t#endif\n\t#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )\n\t\ttbn2[0] *= faceDirection;\n\t\ttbn2[1] *= faceDirection;\n\t#endif\n#endif\nvec3 nonPerturbedNormal = normal;",normal_fragment_maps:"#ifdef USE_NORMALMAP_OBJECTSPACE\n\tnormal = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;\n\t#ifdef FLIP_SIDED\n\t\tnormal = - normal;\n\t#endif\n\t#ifdef DOUBLE_SIDED\n\t\tnormal = normal * faceDirection;\n\t#endif\n\tnormal = normalize( normalMatrix * normal );\n#elif defined( USE_NORMALMAP_TANGENTSPACE )\n\tvec3 mapN = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;\n\tmapN.xy *= normalScale;\n\tnormal = normalize( tbn * mapN );\n#elif defined( USE_BUMPMAP )\n\tnormal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd(), faceDirection );\n#endif",normal_pars_fragment:"#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif",normal_pars_vertex:"#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif",normal_vertex:"#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n\t#ifdef USE_TANGENT\n\t\tvTangent = normalize( transformedTangent );\n\t\tvBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );\n\t#endif\n#endif",normalmap_pars_fragment:"#ifdef USE_NORMALMAP\n\tuniform sampler2D normalMap;\n\tuniform vec2 normalScale;\n#endif\n#ifdef USE_NORMALMAP_OBJECTSPACE\n\tuniform mat3 normalMatrix;\n#endif\n#if ! defined ( USE_TANGENT ) && ( defined ( USE_NORMALMAP_TANGENTSPACE ) || defined ( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY ) )\n\tmat3 getTangentFrame( vec3 eye_pos, vec3 surf_norm, vec2 uv ) {\n\t\tvec3 q0 = dFdx( eye_pos.xyz );\n\t\tvec3 q1 = dFdy( eye_pos.xyz );\n\t\tvec2 st0 = dFdx( uv.st );\n\t\tvec2 st1 = dFdy( uv.st );\n\t\tvec3 N = surf_norm;\n\t\tvec3 q1perp = cross( q1, N );\n\t\tvec3 q0perp = cross( N, q0 );\n\t\tvec3 T = q1perp * st0.x + q0perp * st1.x;\n\t\tvec3 B = q1perp * st0.y + q0perp * st1.y;\n\t\tfloat det = max( dot( T, T ), dot( B, B ) );\n\t\tfloat scale = ( det == 0.0 ) ? 0.0 : inversesqrt( det );\n\t\treturn mat3( T * scale, B * scale, N );\n\t}\n#endif",clearcoat_normal_fragment_begin:"#ifdef USE_CLEARCOAT\n\tvec3 clearcoatNormal = nonPerturbedNormal;\n#endif",clearcoat_normal_fragment_maps:"#ifdef USE_CLEARCOAT_NORMALMAP\n\tvec3 clearcoatMapN = texture2D( clearcoatNormalMap, vClearcoatNormalMapUv ).xyz * 2.0 - 1.0;\n\tclearcoatMapN.xy *= clearcoatNormalScale;\n\tclearcoatNormal = normalize( tbn2 * clearcoatMapN );\n#endif",clearcoat_pars_fragment:"#ifdef USE_CLEARCOATMAP\n\tuniform sampler2D clearcoatMap;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tuniform sampler2D clearcoatNormalMap;\n\tuniform vec2 clearcoatNormalScale;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\tuniform sampler2D clearcoatRoughnessMap;\n#endif",iridescence_pars_fragment:"#ifdef USE_IRIDESCENCEMAP\n\tuniform sampler2D iridescenceMap;\n#endif\n#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\tuniform sampler2D iridescenceThicknessMap;\n#endif",opaque_fragment:"#ifdef OPAQUE\ndiffuseColor.a = 1.0;\n#endif\n#ifdef USE_TRANSMISSION\ndiffuseColor.a *= material.transmissionAlpha;\n#endif\ngl_FragColor = vec4( outgoingLight, diffuseColor.a );",packing:"vec3 packNormalToRGB( const in vec3 normal ) {\n\treturn normalize( normal ) * 0.5 + 0.5;\n}\nvec3 unpackRGBToNormal( const in vec3 rgb ) {\n\treturn 2.0 * rgb.xyz - 1.0;\n}\nconst float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;\nconst vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256., 256. );\nconst vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );\nconst float ShiftRight8 = 1. / 256.;\nvec4 packDepthToRGBA( const in float v ) {\n\tvec4 r = vec4( fract( v * PackFactors ), v );\n\tr.yzw -= r.xyz * ShiftRight8;\treturn r * PackUpscale;\n}\nfloat unpackRGBAToDepth( const in vec4 v ) {\n\treturn dot( v, UnpackFactors );\n}\nvec2 packDepthToRG( in highp float v ) {\n\treturn packDepthToRGBA( v ).yx;\n}\nfloat unpackRGToDepth( const in highp vec2 v ) {\n\treturn unpackRGBAToDepth( vec4( v.xy, 0.0, 0.0 ) );\n}\nvec4 pack2HalfToRGBA( vec2 v ) {\n\tvec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ) );\n\treturn vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w );\n}\nvec2 unpackRGBATo2Half( vec4 v ) {\n\treturn vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );\n}\nfloat viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( viewZ + near ) / ( near - far );\n}\nfloat orthographicDepthToViewZ( const in float depth, const in float near, const in float far ) {\n\treturn depth * ( near - far ) - near;\n}\nfloat viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( ( near + viewZ ) * far ) / ( ( far - near ) * viewZ );\n}\nfloat perspectiveDepthToViewZ( const in float depth, const in float near, const in float far ) {\n\treturn ( near * far ) / ( ( far - near ) * depth - far );\n}",premultiplied_alpha_fragment:"#ifdef PREMULTIPLIED_ALPHA\n\tgl_FragColor.rgb *= gl_FragColor.a;\n#endif",project_vertex:"vec4 mvPosition = vec4( transformed, 1.0 );\n#ifdef USE_INSTANCING\n\tmvPosition = instanceMatrix * mvPosition;\n#endif\nmvPosition = modelViewMatrix * mvPosition;\ngl_Position = projectionMatrix * mvPosition;",dithering_fragment:"#ifdef DITHERING\n\tgl_FragColor.rgb = dithering( gl_FragColor.rgb );\n#endif",dithering_pars_fragment:"#ifdef DITHERING\n\tvec3 dithering( vec3 color ) {\n\t\tfloat grid_position = rand( gl_FragCoord.xy );\n\t\tvec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );\n\t\tdither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );\n\t\treturn color + dither_shift_RGB;\n\t}\n#endif",roughnessmap_fragment:"float roughnessFactor = roughness;\n#ifdef USE_ROUGHNESSMAP\n\tvec4 texelRoughness = texture2D( roughnessMap, vRoughnessMapUv );\n\troughnessFactor *= texelRoughness.g;\n#endif",roughnessmap_pars_fragment:"#ifdef USE_ROUGHNESSMAP\n\tuniform sampler2D roughnessMap;\n#endif",shadowmap_pars_fragment:"#if NUM_SPOT_LIGHT_COORDS > 0\n\tvarying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];\n#endif\n#if NUM_SPOT_LIGHT_MAPS > 0\n\tuniform sampler2D spotLightMap[ NUM_SPOT_LIGHT_MAPS ];\n#endif\n#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tstruct DirectionalLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tstruct SpotLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tstruct PointLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t\tfloat shadowCameraNear;\n\t\t\tfloat shadowCameraFar;\n\t\t};\n\t\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n\tfloat texture2DCompare( sampler2D depths, vec2 uv, float compare ) {\n\t\treturn step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );\n\t}\n\tvec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {\n\t\treturn unpackRGBATo2Half( texture2D( shadow, uv ) );\n\t}\n\tfloat VSMShadow (sampler2D shadow, vec2 uv, float compare ){\n\t\tfloat occlusion = 1.0;\n\t\tvec2 distribution = texture2DDistribution( shadow, uv );\n\t\tfloat hard_shadow = step( compare , distribution.x );\n\t\tif (hard_shadow != 1.0 ) {\n\t\t\tfloat distance = compare - distribution.x ;\n\t\t\tfloat variance = max( 0.00000, distribution.y * distribution.y );\n\t\t\tfloat softness_probability = variance / (variance + distance * distance );\t\t\tsoftness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );\t\t\tocclusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );\n\t\t}\n\t\treturn occlusion;\n\t}\n\tfloat getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {\n\t\tfloat shadow = 1.0;\n\t\tshadowCoord.xyz /= shadowCoord.w;\n\t\tshadowCoord.z += shadowBias;\n\t\tbool inFrustum = shadowCoord.x >= 0.0 && shadowCoord.x <= 1.0 && shadowCoord.y >= 0.0 && shadowCoord.y <= 1.0;\n\t\tbool frustumTest = inFrustum && shadowCoord.z <= 1.0;\n\t\tif ( frustumTest ) {\n\t\t#if defined( SHADOWMAP_TYPE_PCF )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx0 = - texelSize.x * shadowRadius;\n\t\t\tfloat dy0 = - texelSize.y * shadowRadius;\n\t\t\tfloat dx1 = + texelSize.x * shadowRadius;\n\t\t\tfloat dy1 = + texelSize.y * shadowRadius;\n\t\t\tfloat dx2 = dx0 / 2.0;\n\t\t\tfloat dy2 = dy0 / 2.0;\n\t\t\tfloat dx3 = dx1 / 2.0;\n\t\t\tfloat dy3 = dy1 / 2.0;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )\n\t\t\t) * ( 1.0 / 17.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_PCF_SOFT )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx = texelSize.x;\n\t\t\tfloat dy = texelSize.y;\n\t\t\tvec2 uv = shadowCoord.xy;\n\t\t\tvec2 f = fract( uv * shadowMapSize + 0.5 );\n\t\t\tuv -= f * texelSize;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, uv, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ),\n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ),\n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ),\n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ),\n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ),\n\t\t\t\t\t\t  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),\n\t\t\t\t\t\t  f.x ),\n\t\t\t\t\t mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t\t  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t\t  f.x ),\n\t\t\t\t\t f.y )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_VSM )\n\t\t\tshadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#else\n\t\t\tshadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#endif\n\t\t}\n\t\treturn shadow;\n\t}\n\tvec2 cubeToUV( vec3 v, float texelSizeY ) {\n\t\tvec3 absV = abs( v );\n\t\tfloat scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );\n\t\tabsV *= scaleToCube;\n\t\tv *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );\n\t\tvec2 planar = v.xy;\n\t\tfloat almostATexel = 1.5 * texelSizeY;\n\t\tfloat almostOne = 1.0 - almostATexel;\n\t\tif ( absV.z >= almostOne ) {\n\t\t\tif ( v.z > 0.0 )\n\t\t\t\tplanar.x = 4.0 - v.x;\n\t\t} else if ( absV.x >= almostOne ) {\n\t\t\tfloat signX = sign( v.x );\n\t\t\tplanar.x = v.z * signX + 2.0 * signX;\n\t\t} else if ( absV.y >= almostOne ) {\n\t\t\tfloat signY = sign( v.y );\n\t\t\tplanar.x = v.x + 2.0 * signY + 2.0;\n\t\t\tplanar.y = v.z * signY - 2.0;\n\t\t}\n\t\treturn vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );\n\t}\n\tfloat getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {\n\t\tvec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );\n\t\tvec3 lightToPosition = shadowCoord.xyz;\n\t\tfloat dp = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );\t\tdp += shadowBias;\n\t\tvec3 bd3D = normalize( lightToPosition );\n\t\t#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )\n\t\t\tvec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;\n\t\t\treturn (\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#else\n\t\t\treturn texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );\n\t\t#endif\n\t}\n#endif",shadowmap_pars_vertex:"#if NUM_SPOT_LIGHT_COORDS > 0\n\tuniform mat4 spotLightMatrix[ NUM_SPOT_LIGHT_COORDS ];\n\tvarying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];\n#endif\n#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tstruct DirectionalLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tstruct SpotLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tstruct PointLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t\tfloat shadowCameraNear;\n\t\t\tfloat shadowCameraFar;\n\t\t};\n\t\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n#endif",shadowmap_vertex:"#if ( defined( USE_SHADOWMAP ) && ( NUM_DIR_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0 ) ) || ( NUM_SPOT_LIGHT_COORDS > 0 )\n\tvec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\tvec4 shadowWorldPosition;\n#endif\n#if defined( USE_SHADOWMAP )\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );\n\t\t\tvDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;\n\t\t}\n\t\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );\n\t\t\tvPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;\n\t\t}\n\t\t#pragma unroll_loop_end\n\t#endif\n#endif\n#if NUM_SPOT_LIGHT_COORDS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_COORDS; i ++ ) {\n\t\tshadowWorldPosition = worldPosition;\n\t\t#if ( defined( USE_SHADOWMAP ) && UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\t\tshadowWorldPosition.xyz += shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias;\n\t\t#endif\n\t\tvSpotLightCoord[ i ] = spotLightMatrix[ i ] * shadowWorldPosition;\n\t}\n\t#pragma unroll_loop_end\n#endif",shadowmask_pars_fragment:"float getShadowMask() {\n\tfloat shadow = 1.0;\n\t#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\tdirectionalLight = directionalLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLightShadow spotLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {\n\t\tspotLight = spotLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLightShadow pointLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\tpointLight = pointLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#endif\n\treturn shadow;\n}",skinbase_vertex:"#ifdef USE_SKINNING\n\tmat4 boneMatX = getBoneMatrix( skinIndex.x );\n\tmat4 boneMatY = getBoneMatrix( skinIndex.y );\n\tmat4 boneMatZ = getBoneMatrix( skinIndex.z );\n\tmat4 boneMatW = getBoneMatrix( skinIndex.w );\n#endif",skinning_pars_vertex:"#ifdef USE_SKINNING\n\tuniform mat4 bindMatrix;\n\tuniform mat4 bindMatrixInverse;\n\tuniform highp sampler2D boneTexture;\n\tuniform int boneTextureSize;\n\tmat4 getBoneMatrix( const in float i ) {\n\t\tfloat j = i * 4.0;\n\t\tfloat x = mod( j, float( boneTextureSize ) );\n\t\tfloat y = floor( j / float( boneTextureSize ) );\n\t\tfloat dx = 1.0 / float( boneTextureSize );\n\t\tfloat dy = 1.0 / float( boneTextureSize );\n\t\ty = dy * ( y + 0.5 );\n\t\tvec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );\n\t\tvec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );\n\t\tvec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );\n\t\tvec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );\n\t\tmat4 bone = mat4( v1, v2, v3, v4 );\n\t\treturn bone;\n\t}\n#endif",skinning_vertex:"#ifdef USE_SKINNING\n\tvec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );\n\tvec4 skinned = vec4( 0.0 );\n\tskinned += boneMatX * skinVertex * skinWeight.x;\n\tskinned += boneMatY * skinVertex * skinWeight.y;\n\tskinned += boneMatZ * skinVertex * skinWeight.z;\n\tskinned += boneMatW * skinVertex * skinWeight.w;\n\ttransformed = ( bindMatrixInverse * skinned ).xyz;\n#endif",skinnormal_vertex:"#ifdef USE_SKINNING\n\tmat4 skinMatrix = mat4( 0.0 );\n\tskinMatrix += skinWeight.x * boneMatX;\n\tskinMatrix += skinWeight.y * boneMatY;\n\tskinMatrix += skinWeight.z * boneMatZ;\n\tskinMatrix += skinWeight.w * boneMatW;\n\tskinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;\n\tobjectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;\n\t#ifdef USE_TANGENT\n\t\tobjectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n\t#endif\n#endif",specularmap_fragment:"float specularStrength;\n#ifdef USE_SPECULARMAP\n\tvec4 texelSpecular = texture2D( specularMap, vSpecularMapUv );\n\tspecularStrength = texelSpecular.r;\n#else\n\tspecularStrength = 1.0;\n#endif",specularmap_pars_fragment:"#ifdef USE_SPECULARMAP\n\tuniform sampler2D specularMap;\n#endif",tonemapping_fragment:"#if defined( TONE_MAPPING )\n\tgl_FragColor.rgb = toneMapping( gl_FragColor.rgb );\n#endif",tonemapping_pars_fragment:"#ifndef saturate\n#define saturate( a ) clamp( a, 0.0, 1.0 )\n#endif\nuniform float toneMappingExposure;\nvec3 LinearToneMapping( vec3 color ) {\n\treturn saturate( toneMappingExposure * color );\n}\nvec3 ReinhardToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\treturn saturate( color / ( vec3( 1.0 ) + color ) );\n}\nvec3 OptimizedCineonToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\tcolor = max( vec3( 0.0 ), color - 0.004 );\n\treturn pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );\n}\nvec3 RRTAndODTFit( vec3 v ) {\n\tvec3 a = v * ( v + 0.0245786 ) - 0.000090537;\n\tvec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;\n\treturn a / b;\n}\nvec3 ACESFilmicToneMapping( vec3 color ) {\n\tconst mat3 ACESInputMat = mat3(\n\t\tvec3( 0.59719, 0.07600, 0.02840 ),\t\tvec3( 0.35458, 0.90834, 0.13383 ),\n\t\tvec3( 0.04823, 0.01566, 0.83777 )\n\t);\n\tconst mat3 ACESOutputMat = mat3(\n\t\tvec3(  1.60475, -0.10208, -0.00327 ),\t\tvec3( -0.53108,  1.10813, -0.07276 ),\n\t\tvec3( -0.07367, -0.00605,  1.07602 )\n\t);\n\tcolor *= toneMappingExposure / 0.6;\n\tcolor = ACESInputMat * color;\n\tcolor = RRTAndODTFit( color );\n\tcolor = ACESOutputMat * color;\n\treturn saturate( color );\n}\nvec3 CustomToneMapping( vec3 color ) { return color; }",transmission_fragment:"#ifdef USE_TRANSMISSION\n\tmaterial.transmission = transmission;\n\tmaterial.transmissionAlpha = 1.0;\n\tmaterial.thickness = thickness;\n\tmaterial.attenuationDistance = attenuationDistance;\n\tmaterial.attenuationColor = attenuationColor;\n\t#ifdef USE_TRANSMISSIONMAP\n\t\tmaterial.transmission *= texture2D( transmissionMap, vTransmissionMapUv ).r;\n\t#endif\n\t#ifdef USE_THICKNESSMAP\n\t\tmaterial.thickness *= texture2D( thicknessMap, vThicknessMapUv ).g;\n\t#endif\n\tvec3 pos = vWorldPosition;\n\tvec3 v = normalize( cameraPosition - pos );\n\tvec3 n = inverseTransformDirection( normal, viewMatrix );\n\tvec4 transmitted = getIBLVolumeRefraction(\n\t\tn, v, material.roughness, material.diffuseColor, material.specularColor, material.specularF90,\n\t\tpos, modelMatrix, viewMatrix, projectionMatrix, material.ior, material.thickness,\n\t\tmaterial.attenuationColor, material.attenuationDistance );\n\tmaterial.transmissionAlpha = mix( material.transmissionAlpha, transmitted.a, material.transmission );\n\ttotalDiffuse = mix( totalDiffuse, transmitted.rgb, material.transmission );\n#endif",transmission_pars_fragment:"#ifdef USE_TRANSMISSION\n\tuniform float transmission;\n\tuniform float thickness;\n\tuniform float attenuationDistance;\n\tuniform vec3 attenuationColor;\n\t#ifdef USE_TRANSMISSIONMAP\n\t\tuniform sampler2D transmissionMap;\n\t#endif\n\t#ifdef USE_THICKNESSMAP\n\t\tuniform sampler2D thicknessMap;\n\t#endif\n\tuniform vec2 transmissionSamplerSize;\n\tuniform sampler2D transmissionSamplerMap;\n\tuniform mat4 modelMatrix;\n\tuniform mat4 projectionMatrix;\n\tvarying vec3 vWorldPosition;\n\tfloat w0( float a ) {\n\t\treturn ( 1.0 / 6.0 ) * ( a * ( a * ( - a + 3.0 ) - 3.0 ) + 1.0 );\n\t}\n\tfloat w1( float a ) {\n\t\treturn ( 1.0 / 6.0 ) * ( a *  a * ( 3.0 * a - 6.0 ) + 4.0 );\n\t}\n\tfloat w2( float a ){\n\t\treturn ( 1.0 / 6.0 ) * ( a * ( a * ( - 3.0 * a + 3.0 ) + 3.0 ) + 1.0 );\n\t}\n\tfloat w3( float a ) {\n\t\treturn ( 1.0 / 6.0 ) * ( a * a * a );\n\t}\n\tfloat g0( float a ) {\n\t\treturn w0( a ) + w1( a );\n\t}\n\tfloat g1( float a ) {\n\t\treturn w2( a ) + w3( a );\n\t}\n\tfloat h0( float a ) {\n\t\treturn - 1.0 + w1( a ) / ( w0( a ) + w1( a ) );\n\t}\n\tfloat h1( float a ) {\n\t\treturn 1.0 + w3( a ) / ( w2( a ) + w3( a ) );\n\t}\n\tvec4 bicubic( sampler2D tex, vec2 uv, vec4 texelSize, float lod ) {\n\t\tuv = uv * texelSize.zw + 0.5;\n\t\tvec2 iuv = floor( uv );\n\t\tvec2 fuv = fract( uv );\n\t\tfloat g0x = g0( fuv.x );\n\t\tfloat g1x = g1( fuv.x );\n\t\tfloat h0x = h0( fuv.x );\n\t\tfloat h1x = h1( fuv.x );\n\t\tfloat h0y = h0( fuv.y );\n\t\tfloat h1y = h1( fuv.y );\n\t\tvec2 p0 = ( vec2( iuv.x + h0x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;\n\t\tvec2 p1 = ( vec2( iuv.x + h1x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;\n\t\tvec2 p2 = ( vec2( iuv.x + h0x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;\n\t\tvec2 p3 = ( vec2( iuv.x + h1x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;\n\t\treturn g0( fuv.y ) * ( g0x * textureLod( tex, p0, lod ) + g1x * textureLod( tex, p1, lod ) ) +\n\t\t\tg1( fuv.y ) * ( g0x * textureLod( tex, p2, lod ) + g1x * textureLod( tex, p3, lod ) );\n\t}\n\tvec4 textureBicubic( sampler2D sampler, vec2 uv, float lod ) {\n\t\tvec2 fLodSize = vec2( textureSize( sampler, int( lod ) ) );\n\t\tvec2 cLodSize = vec2( textureSize( sampler, int( lod + 1.0 ) ) );\n\t\tvec2 fLodSizeInv = 1.0 / fLodSize;\n\t\tvec2 cLodSizeInv = 1.0 / cLodSize;\n\t\tvec4 fSample = bicubic( sampler, uv, vec4( fLodSizeInv, fLodSize ), floor( lod ) );\n\t\tvec4 cSample = bicubic( sampler, uv, vec4( cLodSizeInv, cLodSize ), ceil( lod ) );\n\t\treturn mix( fSample, cSample, fract( lod ) );\n\t}\n\tvec3 getVolumeTransmissionRay( const in vec3 n, const in vec3 v, const in float thickness, const in float ior, const in mat4 modelMatrix ) {\n\t\tvec3 refractionVector = refract( - v, normalize( n ), 1.0 / ior );\n\t\tvec3 modelScale;\n\t\tmodelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );\n\t\tmodelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );\n\t\tmodelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );\n\t\treturn normalize( refractionVector ) * thickness * modelScale;\n\t}\n\tfloat applyIorToRoughness( const in float roughness, const in float ior ) {\n\t\treturn roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );\n\t}\n\tvec4 getTransmissionSample( const in vec2 fragCoord, const in float roughness, const in float ior ) {\n\t\tfloat lod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );\n\t\treturn textureBicubic( transmissionSamplerMap, fragCoord.xy, lod );\n\t}\n\tvec3 volumeAttenuation( const in float transmissionDistance, const in vec3 attenuationColor, const in float attenuationDistance ) {\n\t\tif ( isinf( attenuationDistance ) ) {\n\t\t\treturn vec3( 1.0 );\n\t\t} else {\n\t\t\tvec3 attenuationCoefficient = -log( attenuationColor ) / attenuationDistance;\n\t\t\tvec3 transmittance = exp( - attenuationCoefficient * transmissionDistance );\t\t\treturn transmittance;\n\t\t}\n\t}\n\tvec4 getIBLVolumeRefraction( const in vec3 n, const in vec3 v, const in float roughness, const in vec3 diffuseColor,\n\t\tconst in vec3 specularColor, const in float specularF90, const in vec3 position, const in mat4 modelMatrix,\n\t\tconst in mat4 viewMatrix, const in mat4 projMatrix, const in float ior, const in float thickness,\n\t\tconst in vec3 attenuationColor, const in float attenuationDistance ) {\n\t\tvec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );\n\t\tvec3 refractedRayExit = position + transmissionRay;\n\t\tvec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );\n\t\tvec2 refractionCoords = ndcPos.xy / ndcPos.w;\n\t\trefractionCoords += 1.0;\n\t\trefractionCoords /= 2.0;\n\t\tvec4 transmittedLight = getTransmissionSample( refractionCoords, roughness, ior );\n\t\tvec3 transmittance = diffuseColor * volumeAttenuation( length( transmissionRay ), attenuationColor, attenuationDistance );\n\t\tvec3 attenuatedColor = transmittance * transmittedLight.rgb;\n\t\tvec3 F = EnvironmentBRDF( n, v, specularColor, specularF90, roughness );\n\t\tfloat transmittanceFactor = ( transmittance.r + transmittance.g + transmittance.b ) / 3.0;\n\t\treturn vec4( ( 1.0 - F ) * attenuatedColor, 1.0 - ( 1.0 - transmittedLight.a ) * transmittanceFactor );\n\t}\n#endif",uv_pars_fragment:"#if defined( USE_UV ) || defined( USE_ANISOTROPY )\n\tvarying vec2 vUv;\n#endif\n#ifdef USE_MAP\n\tvarying vec2 vMapUv;\n#endif\n#ifdef USE_ALPHAMAP\n\tvarying vec2 vAlphaMapUv;\n#endif\n#ifdef USE_LIGHTMAP\n\tvarying vec2 vLightMapUv;\n#endif\n#ifdef USE_AOMAP\n\tvarying vec2 vAoMapUv;\n#endif\n#ifdef USE_BUMPMAP\n\tvarying vec2 vBumpMapUv;\n#endif\n#ifdef USE_NORMALMAP\n\tvarying vec2 vNormalMapUv;\n#endif\n#ifdef USE_EMISSIVEMAP\n\tvarying vec2 vEmissiveMapUv;\n#endif\n#ifdef USE_METALNESSMAP\n\tvarying vec2 vMetalnessMapUv;\n#endif\n#ifdef USE_ROUGHNESSMAP\n\tvarying vec2 vRoughnessMapUv;\n#endif\n#ifdef USE_ANISOTROPYMAP\n\tvarying vec2 vAnisotropyMapUv;\n#endif\n#ifdef USE_CLEARCOATMAP\n\tvarying vec2 vClearcoatMapUv;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tvarying vec2 vClearcoatNormalMapUv;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\tvarying vec2 vClearcoatRoughnessMapUv;\n#endif\n#ifdef USE_IRIDESCENCEMAP\n\tvarying vec2 vIridescenceMapUv;\n#endif\n#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\tvarying vec2 vIridescenceThicknessMapUv;\n#endif\n#ifdef USE_SHEEN_COLORMAP\n\tvarying vec2 vSheenColorMapUv;\n#endif\n#ifdef USE_SHEEN_ROUGHNESSMAP\n\tvarying vec2 vSheenRoughnessMapUv;\n#endif\n#ifdef USE_SPECULARMAP\n\tvarying vec2 vSpecularMapUv;\n#endif\n#ifdef USE_SPECULAR_COLORMAP\n\tvarying vec2 vSpecularColorMapUv;\n#endif\n#ifdef USE_SPECULAR_INTENSITYMAP\n\tvarying vec2 vSpecularIntensityMapUv;\n#endif\n#ifdef USE_TRANSMISSIONMAP\n\tuniform mat3 transmissionMapTransform;\n\tvarying vec2 vTransmissionMapUv;\n#endif\n#ifdef USE_THICKNESSMAP\n\tuniform mat3 thicknessMapTransform;\n\tvarying vec2 vThicknessMapUv;\n#endif",uv_pars_vertex:"#if defined( USE_UV ) || defined( USE_ANISOTROPY )\n\tvarying vec2 vUv;\n#endif\n#ifdef USE_MAP\n\tuniform mat3 mapTransform;\n\tvarying vec2 vMapUv;\n#endif\n#ifdef USE_ALPHAMAP\n\tuniform mat3 alphaMapTransform;\n\tvarying vec2 vAlphaMapUv;\n#endif\n#ifdef USE_LIGHTMAP\n\tuniform mat3 lightMapTransform;\n\tvarying vec2 vLightMapUv;\n#endif\n#ifdef USE_AOMAP\n\tuniform mat3 aoMapTransform;\n\tvarying vec2 vAoMapUv;\n#endif\n#ifdef USE_BUMPMAP\n\tuniform mat3 bumpMapTransform;\n\tvarying vec2 vBumpMapUv;\n#endif\n#ifdef USE_NORMALMAP\n\tuniform mat3 normalMapTransform;\n\tvarying vec2 vNormalMapUv;\n#endif\n#ifdef USE_DISPLACEMENTMAP\n\tuniform mat3 displacementMapTransform;\n\tvarying vec2 vDisplacementMapUv;\n#endif\n#ifdef USE_EMISSIVEMAP\n\tuniform mat3 emissiveMapTransform;\n\tvarying vec2 vEmissiveMapUv;\n#endif\n#ifdef USE_METALNESSMAP\n\tuniform mat3 metalnessMapTransform;\n\tvarying vec2 vMetalnessMapUv;\n#endif\n#ifdef USE_ROUGHNESSMAP\n\tuniform mat3 roughnessMapTransform;\n\tvarying vec2 vRoughnessMapUv;\n#endif\n#ifdef USE_ANISOTROPYMAP\n\tuniform mat3 anisotropyMapTransform;\n\tvarying vec2 vAnisotropyMapUv;\n#endif\n#ifdef USE_CLEARCOATMAP\n\tuniform mat3 clearcoatMapTransform;\n\tvarying vec2 vClearcoatMapUv;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tuniform mat3 clearcoatNormalMapTransform;\n\tvarying vec2 vClearcoatNormalMapUv;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\tuniform mat3 clearcoatRoughnessMapTransform;\n\tvarying vec2 vClearcoatRoughnessMapUv;\n#endif\n#ifdef USE_SHEEN_COLORMAP\n\tuniform mat3 sheenColorMapTransform;\n\tvarying vec2 vSheenColorMapUv;\n#endif\n#ifdef USE_SHEEN_ROUGHNESSMAP\n\tuniform mat3 sheenRoughnessMapTransform;\n\tvarying vec2 vSheenRoughnessMapUv;\n#endif\n#ifdef USE_IRIDESCENCEMAP\n\tuniform mat3 iridescenceMapTransform;\n\tvarying vec2 vIridescenceMapUv;\n#endif\n#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\tuniform mat3 iridescenceThicknessMapTransform;\n\tvarying vec2 vIridescenceThicknessMapUv;\n#endif\n#ifdef USE_SPECULARMAP\n\tuniform mat3 specularMapTransform;\n\tvarying vec2 vSpecularMapUv;\n#endif\n#ifdef USE_SPECULAR_COLORMAP\n\tuniform mat3 specularColorMapTransform;\n\tvarying vec2 vSpecularColorMapUv;\n#endif\n#ifdef USE_SPECULAR_INTENSITYMAP\n\tuniform mat3 specularIntensityMapTransform;\n\tvarying vec2 vSpecularIntensityMapUv;\n#endif\n#ifdef USE_TRANSMISSIONMAP\n\tuniform mat3 transmissionMapTransform;\n\tvarying vec2 vTransmissionMapUv;\n#endif\n#ifdef USE_THICKNESSMAP\n\tuniform mat3 thicknessMapTransform;\n\tvarying vec2 vThicknessMapUv;\n#endif",uv_vertex:"#if defined( USE_UV ) || defined( USE_ANISOTROPY )\n\tvUv = vec3( uv, 1 ).xy;\n#endif\n#ifdef USE_MAP\n\tvMapUv = ( mapTransform * vec3( MAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_ALPHAMAP\n\tvAlphaMapUv = ( alphaMapTransform * vec3( ALPHAMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_LIGHTMAP\n\tvLightMapUv = ( lightMapTransform * vec3( LIGHTMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_AOMAP\n\tvAoMapUv = ( aoMapTransform * vec3( AOMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_BUMPMAP\n\tvBumpMapUv = ( bumpMapTransform * vec3( BUMPMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_NORMALMAP\n\tvNormalMapUv = ( normalMapTransform * vec3( NORMALMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_DISPLACEMENTMAP\n\tvDisplacementMapUv = ( displacementMapTransform * vec3( DISPLACEMENTMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_EMISSIVEMAP\n\tvEmissiveMapUv = ( emissiveMapTransform * vec3( EMISSIVEMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_METALNESSMAP\n\tvMetalnessMapUv = ( metalnessMapTransform * vec3( METALNESSMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_ROUGHNESSMAP\n\tvRoughnessMapUv = ( roughnessMapTransform * vec3( ROUGHNESSMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_ANISOTROPYMAP\n\tvAnisotropyMapUv = ( anisotropyMapTransform * vec3( ANISOTROPYMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_CLEARCOATMAP\n\tvClearcoatMapUv = ( clearcoatMapTransform * vec3( CLEARCOATMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tvClearcoatNormalMapUv = ( clearcoatNormalMapTransform * vec3( CLEARCOAT_NORMALMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\tvClearcoatRoughnessMapUv = ( clearcoatRoughnessMapTransform * vec3( CLEARCOAT_ROUGHNESSMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_IRIDESCENCEMAP\n\tvIridescenceMapUv = ( iridescenceMapTransform * vec3( IRIDESCENCEMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\tvIridescenceThicknessMapUv = ( iridescenceThicknessMapTransform * vec3( IRIDESCENCE_THICKNESSMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_SHEEN_COLORMAP\n\tvSheenColorMapUv = ( sheenColorMapTransform * vec3( SHEEN_COLORMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_SHEEN_ROUGHNESSMAP\n\tvSheenRoughnessMapUv = ( sheenRoughnessMapTransform * vec3( SHEEN_ROUGHNESSMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_SPECULARMAP\n\tvSpecularMapUv = ( specularMapTransform * vec3( SPECULARMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_SPECULAR_COLORMAP\n\tvSpecularColorMapUv = ( specularColorMapTransform * vec3( SPECULAR_COLORMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_SPECULAR_INTENSITYMAP\n\tvSpecularIntensityMapUv = ( specularIntensityMapTransform * vec3( SPECULAR_INTENSITYMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_TRANSMISSIONMAP\n\tvTransmissionMapUv = ( transmissionMapTransform * vec3( TRANSMISSIONMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_THICKNESSMAP\n\tvThicknessMapUv = ( thicknessMapTransform * vec3( THICKNESSMAP_UV, 1 ) ).xy;\n#endif",worldpos_vertex:"#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP ) || defined ( USE_TRANSMISSION ) || NUM_SPOT_LIGHT_COORDS > 0\n\tvec4 worldPosition = vec4( transformed, 1.0 );\n\t#ifdef USE_INSTANCING\n\t\tworldPosition = instanceMatrix * worldPosition;\n\t#endif\n\tworldPosition = modelMatrix * worldPosition;\n#endif",background_vert:"varying vec2 vUv;\nuniform mat3 uvTransform;\nvoid main() {\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n\tgl_Position = vec4( position.xy, 1.0, 1.0 );\n}",background_frag:"uniform sampler2D t2D;\nuniform float backgroundIntensity;\nvarying vec2 vUv;\nvoid main() {\n\tvec4 texColor = texture2D( t2D, vUv );\n\t#ifdef DECODE_VIDEO_TEXTURE\n\t\ttexColor = vec4( mix( pow( texColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), texColor.rgb * 0.0773993808, vec3( lessThanEqual( texColor.rgb, vec3( 0.04045 ) ) ) ), texColor.w );\n\t#endif\n\ttexColor.rgb *= backgroundIntensity;\n\tgl_FragColor = texColor;\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n}",backgroundCube_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\tgl_Position.z = gl_Position.w;\n}",backgroundCube_frag:"#ifdef ENVMAP_TYPE_CUBE\n\tuniform samplerCube envMap;\n#elif defined( ENVMAP_TYPE_CUBE_UV )\n\tuniform sampler2D envMap;\n#endif\nuniform float flipEnvMap;\nuniform float backgroundBlurriness;\nuniform float backgroundIntensity;\nvarying vec3 vWorldDirection;\n#include <cube_uv_reflection_fragment>\nvoid main() {\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tvec4 texColor = textureCube( envMap, vec3( flipEnvMap * vWorldDirection.x, vWorldDirection.yz ) );\n\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\tvec4 texColor = textureCubeUV( envMap, vWorldDirection, backgroundBlurriness );\n\t#else\n\t\tvec4 texColor = vec4( 0.0, 0.0, 0.0, 1.0 );\n\t#endif\n\ttexColor.rgb *= backgroundIntensity;\n\tgl_FragColor = texColor;\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n}",cube_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\tgl_Position.z = gl_Position.w;\n}",cube_frag:"uniform samplerCube tCube;\nuniform float tFlip;\nuniform float opacity;\nvarying vec3 vWorldDirection;\nvoid main() {\n\tvec4 texColor = textureCube( tCube, vec3( tFlip * vWorldDirection.x, vWorldDirection.yz ) );\n\tgl_FragColor = texColor;\n\tgl_FragColor.a *= opacity;\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n}",depth_vert:"#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvHighPrecisionZW = gl_Position.zw;\n}",depth_frag:"#if DEPTH_PACKING == 3200\n\tuniform float opacity;\n#endif\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#if DEPTH_PACKING == 3200\n\t\tdiffuseColor.a = opacity;\n\t#endif\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <logdepthbuf_fragment>\n\tfloat fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;\n\t#if DEPTH_PACKING == 3200\n\t\tgl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );\n\t#elif DEPTH_PACKING == 3201\n\t\tgl_FragColor = packDepthToRGBA( fragCoordZ );\n\t#endif\n}",distanceRGBA_vert:"#define DISTANCE\nvarying vec3 vWorldPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\tvWorldPosition = worldPosition.xyz;\n}",distanceRGBA_frag:"#define DISTANCE\nuniform vec3 referencePosition;\nuniform float nearDistance;\nuniform float farDistance;\nvarying vec3 vWorldPosition;\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main () {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\tfloat dist = length( vWorldPosition - referencePosition );\n\tdist = ( dist - nearDistance ) / ( farDistance - nearDistance );\n\tdist = saturate( dist );\n\tgl_FragColor = packDepthToRGBA( dist );\n}",equirect_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n}",equirect_frag:"uniform sampler2D tEquirect;\nvarying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvec3 direction = normalize( vWorldDirection );\n\tvec2 sampleUV = equirectUv( direction );\n\tgl_FragColor = texture2D( tEquirect, sampleUV );\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n}",linedashed_vert:"uniform float scale;\nattribute float lineDistance;\nvarying float vLineDistance;\n#include <common>\n#include <uv_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\tvLineDistance = scale * lineDistance;\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}",linedashed_frag:"uniform vec3 diffuse;\nuniform float opacity;\nuniform float dashSize;\nuniform float totalSize;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tif ( mod( vLineDistance, totalSize ) > dashSize ) {\n\t\tdiscard;\n\t}\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}",meshbasic_vert:"#include <common>\n#include <uv_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#if defined ( USE_ENVMAP ) || defined ( USE_SKINNING )\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinbase_vertex>\n\t\t#include <skinnormal_vertex>\n\t\t#include <defaultnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <fog_vertex>\n}",meshbasic_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <specularmap_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\t#ifdef USE_LIGHTMAP\n\t\tvec4 lightMapTexel = texture2D( lightMap, vLightMapUv );\n\t\treflectedLight.indirectDiffuse += lightMapTexel.rgb * lightMapIntensity * RECIPROCAL_PI;\n\t#else\n\t\treflectedLight.indirectDiffuse += vec3( 1.0 );\n\t#endif\n\t#include <aomap_fragment>\n\treflectedLight.indirectDiffuse *= diffuseColor.rgb;\n\tvec3 outgoingLight = reflectedLight.indirectDiffuse;\n\t#include <envmap_fragment>\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshlambert_vert:"#define LAMBERT\nvarying vec3 vViewPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshlambert_frag:"#define LAMBERT\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_lambert_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_lambert_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshmatcap_vert:"#define MATCAP\nvarying vec3 vViewPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <color_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n\tvViewPosition = - mvPosition.xyz;\n}",meshmatcap_frag:"#define MATCAP\nuniform vec3 diffuse;\nuniform float opacity;\nuniform sampler2D matcap;\nvarying vec3 vViewPosition;\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <fog_pars_fragment>\n#include <normal_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tvec3 viewDir = normalize( vViewPosition );\n\tvec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );\n\tvec3 y = cross( viewDir, x );\n\tvec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;\n\t#ifdef USE_MATCAP\n\t\tvec4 matcapColor = texture2D( matcap, uv );\n\t#else\n\t\tvec4 matcapColor = vec4( vec3( mix( 0.2, 0.8, uv.y ) ), 1.0 );\n\t#endif\n\tvec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshnormal_vert:"#define NORMAL\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )\n\tvarying vec3 vViewPosition;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )\n\tvViewPosition = - mvPosition.xyz;\n#endif\n}",meshnormal_frag:"#define NORMAL\nuniform float opacity;\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )\n\tvarying vec3 vViewPosition;\n#endif\n#include <packing>\n#include <uv_pars_fragment>\n#include <normal_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\t#include <logdepthbuf_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tgl_FragColor = vec4( packNormalToRGB( normal ), opacity );\n\t#ifdef OPAQUE\n\t\tgl_FragColor.a = 1.0;\n\t#endif\n}",meshphong_vert:"#define PHONG\nvarying vec3 vViewPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshphong_frag:"#define PHONG\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform vec3 specular;\nuniform float shininess;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_phong_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_phong_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshphysical_vert:"#define STANDARD\nvarying vec3 vViewPosition;\n#ifdef USE_TRANSMISSION\n\tvarying vec3 vWorldPosition;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n#ifdef USE_TRANSMISSION\n\tvWorldPosition = worldPosition.xyz;\n#endif\n}",meshphysical_frag:"#define STANDARD\n#ifdef PHYSICAL\n\t#define IOR\n\t#define USE_SPECULAR\n#endif\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float roughness;\nuniform float metalness;\nuniform float opacity;\n#ifdef IOR\n\tuniform float ior;\n#endif\n#ifdef USE_SPECULAR\n\tuniform float specularIntensity;\n\tuniform vec3 specularColor;\n\t#ifdef USE_SPECULAR_COLORMAP\n\t\tuniform sampler2D specularColorMap;\n\t#endif\n\t#ifdef USE_SPECULAR_INTENSITYMAP\n\t\tuniform sampler2D specularIntensityMap;\n\t#endif\n#endif\n#ifdef USE_CLEARCOAT\n\tuniform float clearcoat;\n\tuniform float clearcoatRoughness;\n#endif\n#ifdef USE_IRIDESCENCE\n\tuniform float iridescence;\n\tuniform float iridescenceIOR;\n\tuniform float iridescenceThicknessMinimum;\n\tuniform float iridescenceThicknessMaximum;\n#endif\n#ifdef USE_SHEEN\n\tuniform vec3 sheenColor;\n\tuniform float sheenRoughness;\n\t#ifdef USE_SHEEN_COLORMAP\n\t\tuniform sampler2D sheenColorMap;\n\t#endif\n\t#ifdef USE_SHEEN_ROUGHNESSMAP\n\t\tuniform sampler2D sheenRoughnessMap;\n\t#endif\n#endif\n#ifdef USE_ANISOTROPY\n\tuniform vec2 anisotropyVector;\n\t#ifdef USE_ANISOTROPYMAP\n\t\tuniform sampler2D anisotropyMap;\n\t#endif\n#endif\nvarying vec3 vViewPosition;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <iridescence_fragment>\n#include <cube_uv_reflection_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_physical_pars_fragment>\n#include <fog_pars_fragment>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_physical_pars_fragment>\n#include <transmission_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <clearcoat_pars_fragment>\n#include <iridescence_pars_fragment>\n#include <roughnessmap_pars_fragment>\n#include <metalnessmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <roughnessmap_fragment>\n\t#include <metalnessmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <clearcoat_normal_fragment_begin>\n\t#include <clearcoat_normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_physical_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;\n\tvec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;\n\t#include <transmission_fragment>\n\tvec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;\n\t#ifdef USE_SHEEN\n\t\tfloat sheenEnergyComp = 1.0 - 0.157 * max3( material.sheenColor );\n\t\toutgoingLight = outgoingLight * sheenEnergyComp + sheenSpecularDirect + sheenSpecularIndirect;\n\t#endif\n\t#ifdef USE_CLEARCOAT\n\t\tfloat dotNVcc = saturate( dot( geometryClearcoatNormal, geometryViewDir ) );\n\t\tvec3 Fcc = F_Schlick( material.clearcoatF0, material.clearcoatF90, dotNVcc );\n\t\toutgoingLight = outgoingLight * ( 1.0 - material.clearcoat * Fcc ) + ( clearcoatSpecularDirect + clearcoatSpecularIndirect ) * material.clearcoat;\n\t#endif\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshtoon_vert:"#define TOON\nvarying vec3 vViewPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshtoon_frag:"#define TOON\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <gradientmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_toon_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_toon_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",points_vert:"uniform float size;\nuniform float scale;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\n#ifdef USE_POINTS_UV\n\tvarying vec2 vUv;\n\tuniform mat3 uvTransform;\n#endif\nvoid main() {\n\t#ifdef USE_POINTS_UV\n\t\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n\t#endif\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\tgl_PointSize = size;\n\t#ifdef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );\n\t#endif\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <fog_vertex>\n}",points_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <color_pars_fragment>\n#include <map_particle_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_particle_fragment>\n\t#include <color_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}",shadow_vert:"#include <common>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <shadowmap_pars_vertex>\nvoid main() {\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",shadow_frag:"uniform vec3 color;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <logdepthbuf_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\nvoid main() {\n\t#include <logdepthbuf_fragment>\n\tgl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n}",sprite_vert:"uniform float rotation;\nuniform vec2 center;\n#include <common>\n#include <uv_pars_vertex>\n#include <fog_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\tvec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );\n\tvec2 scale;\n\tscale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );\n\tscale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );\n\t#ifndef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) scale *= - mvPosition.z;\n\t#endif\n\tvec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;\n\tvec2 rotatedPosition;\n\trotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;\n\trotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;\n\tmvPosition.xy += rotatedPosition;\n\tgl_Position = projectionMatrix * mvPosition;\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}",sprite_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n}"},Oe={common:{diffuse:{value:new Ge(16777215)},opacity:{value:1},map:{value:null},mapTransform:{value:new Ut},alphaMap:{value:null},alphaMapTransform:{value:new Ut},alphaTest:{value:0}},specularmap:{specularMap:{value:null},specularMapTransform:{value:new Ut}},envmap:{envMap:{value:null},flipEnvMap:{value:-1},reflectivity:{value:1},ior:{value:1.5},refractionRatio:{value:.98}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1},aoMapTransform:{value:new Ut}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1},lightMapTransform:{value:new Ut}},bumpmap:{bumpMap:{value:null},bumpMapTransform:{value:new Ut},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalMapTransform:{value:new Ut},normalScale:{value:new oe(1,1)}},displacementmap:{displacementMap:{value:null},displacementMapTransform:{value:new Ut},displacementScale:{value:1},displacementBias:{value:0}},emissivemap:{emissiveMap:{value:null},emissiveMapTransform:{value:new Ut}},metalnessmap:{metalnessMap:{value:null},metalnessMapTransform:{value:new Ut}},roughnessmap:{roughnessMap:{value:null},roughnessMapTransform:{value:new Ut}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new Ge(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotLightMap:{value:[]},spotShadowMap:{value:[]},spotLightMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new Ge(16777215)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},alphaMapTransform:{value:new Ut},alphaTest:{value:0},uvTransform:{value:new Ut}},sprite:{diffuse:{value:new Ge(16777215)},opacity:{value:1},center:{value:new oe(.5,.5)},rotation:{value:0},map:{value:null},mapTransform:{value:new Ut},alphaMap:{value:null},alphaMapTransform:{value:new Ut},alphaTest:{value:0}}},No={basic:{uniforms:Oi([Oe.common,Oe.specularmap,Oe.envmap,Oe.aomap,Oe.lightmap,Oe.fog]),vertexShader:Lt.meshbasic_vert,fragmentShader:Lt.meshbasic_frag},lambert:{uniforms:Oi([Oe.common,Oe.specularmap,Oe.envmap,Oe.aomap,Oe.lightmap,Oe.emissivemap,Oe.bumpmap,Oe.normalmap,Oe.displacementmap,Oe.fog,Oe.lights,{emissive:{value:new Ge(0)}}]),vertexShader:Lt.meshlambert_vert,fragmentShader:Lt.meshlambert_frag},phong:{uniforms:Oi([Oe.common,Oe.specularmap,Oe.envmap,Oe.aomap,Oe.lightmap,Oe.emissivemap,Oe.bumpmap,Oe.normalmap,Oe.displacementmap,Oe.fog,Oe.lights,{emissive:{value:new Ge(0)},specular:{value:new Ge(1118481)},shininess:{value:30}}]),vertexShader:Lt.meshphong_vert,fragmentShader:Lt.meshphong_frag},standard:{uniforms:Oi([Oe.common,Oe.envmap,Oe.aomap,Oe.lightmap,Oe.emissivemap,Oe.bumpmap,Oe.normalmap,Oe.displacementmap,Oe.roughnessmap,Oe.metalnessmap,Oe.fog,Oe.lights,{emissive:{value:new Ge(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:Lt.meshphysical_vert,fragmentShader:Lt.meshphysical_frag},toon:{uniforms:Oi([Oe.common,Oe.aomap,Oe.lightmap,Oe.emissivemap,Oe.bumpmap,Oe.normalmap,Oe.displacementmap,Oe.gradientmap,Oe.fog,Oe.lights,{emissive:{value:new Ge(0)}}]),vertexShader:Lt.meshtoon_vert,fragmentShader:Lt.meshtoon_frag},matcap:{uniforms:Oi([Oe.common,Oe.bumpmap,Oe.normalmap,Oe.displacementmap,Oe.fog,{matcap:{value:null}}]),vertexShader:Lt.meshmatcap_vert,fragmentShader:Lt.meshmatcap_frag},points:{uniforms:Oi([Oe.points,Oe.fog]),vertexShader:Lt.points_vert,fragmentShader:Lt.points_frag},dashed:{uniforms:Oi([Oe.common,Oe.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:Lt.linedashed_vert,fragmentShader:Lt.linedashed_frag},depth:{uniforms:Oi([Oe.common,Oe.displacementmap]),vertexShader:Lt.depth_vert,fragmentShader:Lt.depth_frag},normal:{uniforms:Oi([Oe.common,Oe.bumpmap,Oe.normalmap,Oe.displacementmap,{opacity:{value:1}}]),vertexShader:Lt.meshnormal_vert,fragmentShader:Lt.meshnormal_frag},sprite:{uniforms:Oi([Oe.sprite,Oe.fog]),vertexShader:Lt.sprite_vert,fragmentShader:Lt.sprite_frag},background:{uniforms:{uvTransform:{value:new Ut},t2D:{value:null},backgroundIntensity:{value:1}},vertexShader:Lt.background_vert,fragmentShader:Lt.background_frag},backgroundCube:{uniforms:{envMap:{value:null},flipEnvMap:{value:-1},backgroundBlurriness:{value:0},backgroundIntensity:{value:1}},vertexShader:Lt.backgroundCube_vert,fragmentShader:Lt.backgroundCube_frag},cube:{uniforms:{tCube:{value:null},tFlip:{value:-1},opacity:{value:1}},vertexShader:Lt.cube_vert,fragmentShader:Lt.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:Lt.equirect_vert,fragmentShader:Lt.equirect_frag},distanceRGBA:{uniforms:Oi([Oe.common,Oe.displacementmap,{referencePosition:{value:new L},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:Lt.distanceRGBA_vert,fragmentShader:Lt.distanceRGBA_frag},shadow:{uniforms:Oi([Oe.lights,Oe.fog,{color:{value:new Ge(0)},opacity:{value:1}}]),vertexShader:Lt.shadow_vert,fragmentShader:Lt.shadow_frag}};No.physical={uniforms:Oi([No.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatMapTransform:{value:new Ut},clearcoatNormalMap:{value:null},clearcoatNormalMapTransform:{value:new Ut},clearcoatNormalScale:{value:new oe(1,1)},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatRoughnessMapTransform:{value:new Ut},iridescence:{value:0},iridescenceMap:{value:null},iridescenceMapTransform:{value:new Ut},iridescenceIOR:{value:1.3},iridescenceThicknessMinimum:{value:100},iridescenceThicknessMaximum:{value:400},iridescenceThicknessMap:{value:null},iridescenceThicknessMapTransform:{value:new Ut},sheen:{value:0},sheenColor:{value:new Ge(0)},sheenColorMap:{value:null},sheenColorMapTransform:{value:new Ut},sheenRoughness:{value:1},sheenRoughnessMap:{value:null},sheenRoughnessMapTransform:{value:new Ut},transmission:{value:0},transmissionMap:{value:null},transmissionMapTransform:{value:new Ut},transmissionSamplerSize:{value:new oe},transmissionSamplerMap:{value:null},thickness:{value:0},thicknessMap:{value:null},thicknessMapTransform:{value:new Ut},attenuationDistance:{value:0},attenuationColor:{value:new Ge(0)},specularColor:{value:new Ge(1,1,1)},specularColorMap:{value:null},specularColorMapTransform:{value:new Ut},specularIntensity:{value:1},specularIntensityMap:{value:null},specularIntensityMapTransform:{value:new Ut},anisotropyVector:{value:new oe},anisotropyMap:{value:null},anisotropyMapTransform:{value:new Ut}}]),vertexShader:Lt.meshphysical_vert,fragmentShader:Lt.meshphysical_frag};const YT={r:0,b:0,g:0};function XDe(n,e,t,r,i,s,o){const a=new Ge(0);let l,u,c=!0===s?0:1,d=null,h=0,f=null;function y(_,g){_.getRGB(YT,KX(n)),r.buffers.color.setClear(YT.r,YT.g,YT.b,g,o)}return{getClearColor:function(){return a},setClearColor:function(_,g=1){a.set(_),c=g,y(a,c)},getClearAlpha:function(){return c},setClearAlpha:function(_){c=_,y(a,c)},render:function m(_,g){let b=!1,E=!0===g.isScene?g.background:null;E&&E.isTexture&&(E=(g.backgroundBlurriness>0?t:e).get(E)),null===E?y(a,c):E&&E.isColor&&(y(E,1),b=!0);const x=n.xr.getEnvironmentBlendMode();"additive"===x?r.buffers.color.setClear(0,0,0,1,o):"alpha-blend"===x&&r.buffers.color.setClear(0,0,0,0,o),(n.autoClear||b)&&n.clear(n.autoClearColor,n.autoClearDepth,n.autoClearStencil),E&&(E.isCubeTexture||306===E.mapping)?(void 0===u&&(u=new mr(new Xf(1,1,1),new Oa({name:"BackgroundCubeMaterial",uniforms:Kf(No.backgroundCube.uniforms),vertexShader:No.backgroundCube.vertexShader,fragmentShader:No.backgroundCube.fragmentShader,side:1,depthTest:!1,depthWrite:!1,fog:!1})),u.geometry.deleteAttribute("normal"),u.geometry.deleteAttribute("uv"),u.onBeforeRender=function(M,C,w){this.matrixWorld.copyPosition(w.matrixWorld)},Object.defineProperty(u.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),i.update(u)),u.material.uniforms.envMap.value=E,u.material.uniforms.flipEnvMap.value=E.isCubeTexture&&!1===E.isRenderTargetTexture?-1:1,u.material.uniforms.backgroundBlurriness.value=g.backgroundBlurriness,u.material.uniforms.backgroundIntensity.value=g.backgroundIntensity,u.material.toneMapped=pn.getTransfer(E.colorSpace)!==On,(d!==E||h!==E.version||f!==n.toneMapping)&&(u.material.needsUpdate=!0,d=E,h=E.version,f=n.toneMapping),u.layers.enableAll(),_.unshift(u,u.geometry,u.material,0,0,null)):E&&E.isTexture&&(void 0===l&&(l=new mr(new Zf(2,2),new Oa({name:"BackgroundMaterial",uniforms:Kf(No.background.uniforms),vertexShader:No.background.vertexShader,fragmentShader:No.background.fragmentShader,side:0,depthTest:!1,depthWrite:!1,fog:!1})),l.geometry.deleteAttribute("normal"),Object.defineProperty(l.material,"map",{get:function(){return this.uniforms.t2D.value}}),i.update(l)),l.material.uniforms.t2D.value=E,l.material.uniforms.backgroundIntensity.value=g.backgroundIntensity,l.material.toneMapped=pn.getTransfer(E.colorSpace)!==On,!0===E.matrixAutoUpdate&&E.updateMatrix(),l.material.uniforms.uvTransform.value.copy(E.matrix),(d!==E||h!==E.version||f!==n.toneMapping)&&(l.material.needsUpdate=!0,d=E,h=E.version,f=n.toneMapping),l.layers.enableAll(),_.unshift(l,l.geometry,l.material,0,0,null))}}}function KDe(n,e,t,r){const i=n.getParameter(n.MAX_VERTEX_ATTRIBS),s=r.isWebGL2?null:e.get("OES_vertex_array_object"),o=r.isWebGL2||null!==s,a={},c=_(null);let l=c,u=!1;function f(H){return r.isWebGL2?n.bindVertexArray(H):s.bindVertexArrayOES(H)}function m(H){return r.isWebGL2?n.deleteVertexArray(H):s.deleteVertexArrayOES(H)}function _(H){const K=[],se=[],ne=[];for(let ye=0;ye<i;ye++)K[ye]=0,se[ye]=0,ne[ye]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:K,enabledAttributes:se,attributeDivisors:ne,object:H,attributes:{},index:null}}function E(){const H=l.newAttributes;for(let K=0,se=H.length;K<se;K++)H[K]=0}function x(H){M(H,0)}function M(H,K){const ne=l.enabledAttributes,ye=l.attributeDivisors;l.newAttributes[H]=1,0===ne[H]&&(n.enableVertexAttribArray(H),ne[H]=1),ye[H]!==K&&((r.isWebGL2?n:e.get("ANGLE_instanced_arrays"))[r.isWebGL2?"vertexAttribDivisor":"vertexAttribDivisorANGLE"](H,K),ye[H]=K)}function C(){const H=l.newAttributes,K=l.enabledAttributes;for(let se=0,ne=K.length;se<ne;se++)K[se]!==H[se]&&(n.disableVertexAttribArray(se),K[se]=0)}function w(H,K,se,ne,ye,ce,ge){!0===ge?n.vertexAttribIPointer(H,K,se,ye,ce):n.vertexAttribPointer(H,K,se,ne,ye,ce)}function F(){N(),u=!0,l!==c&&(l=c,f(l.object))}function N(){c.geometry=null,c.program=null,c.wireframe=!1}return{setup:function d(H,K,se,ne,ye){let ce=!1;if(o){const ge=function y(H,K,se){const ne=!0===se.wireframe;let ye=a[H.id];void 0===ye&&(ye={},a[H.id]=ye);let ce=ye[K.id];void 0===ce&&(ce={},ye[K.id]=ce);let ge=ce[ne];return void 0===ge&&(ge=_(function h(){return r.isWebGL2?n.createVertexArray():s.createVertexArrayOES()}()),ce[ne]=ge),ge}(ne,se,K);l!==ge&&(l=ge,f(l.object)),ce=function g(H,K,se,ne){const ye=l.attributes,ce=K.attributes;let ge=0;const G=se.getAttributes();for(const ee in G)if(G[ee].location>=0){const He=ye[ee];let Ue=ce[ee];if(void 0===Ue&&("instanceMatrix"===ee&&H.instanceMatrix&&(Ue=H.instanceMatrix),"instanceColor"===ee&&H.instanceColor&&(Ue=H.instanceColor)),void 0===He||He.attribute!==Ue||Ue&&He.data!==Ue.data)return!0;ge++}return l.attributesNum!==ge||l.index!==ne}(H,ne,se,ye),ce&&function b(H,K,se,ne){const ye={},ce=K.attributes;let ge=0;const G=se.getAttributes();for(const ee in G)if(G[ee].location>=0){let He=ce[ee];void 0===He&&("instanceMatrix"===ee&&H.instanceMatrix&&(He=H.instanceMatrix),"instanceColor"===ee&&H.instanceColor&&(He=H.instanceColor));const Ue={};Ue.attribute=He,He&&He.data&&(Ue.data=He.data),ye[ee]=Ue,ge++}l.attributes=ye,l.attributesNum=ge,l.index=ne}(H,ne,se,ye)}else{const ge=!0===K.wireframe;(l.geometry!==ne.id||l.program!==se.id||l.wireframe!==ge)&&(l.geometry=ne.id,l.program=se.id,l.wireframe=ge,ce=!0)}null!==ye&&t.update(ye,n.ELEMENT_ARRAY_BUFFER),(ce||u)&&(u=!1,function A(H,K,se,ne){if(!1===r.isWebGL2&&(H.isInstancedMesh||ne.isInstancedBufferGeometry)&&null===e.get("ANGLE_instanced_arrays"))return;E();const ye=ne.attributes,ce=se.getAttributes(),ge=K.defaultAttributeValues;for(const G in ce){const ee=ce[G];if(ee.location>=0){let Te=ye[G];if(void 0===Te&&("instanceMatrix"===G&&H.instanceMatrix&&(Te=H.instanceMatrix),"instanceColor"===G&&H.instanceColor&&(Te=H.instanceColor)),void 0!==Te){const He=Te.normalized,Ue=Te.itemSize,ut=t.get(Te);if(void 0===ut)continue;const it=ut.buffer,at=ut.type,yt=ut.bytesPerElement,Ft=!0===r.isWebGL2&&(at===n.INT||at===n.UNSIGNED_INT||1013===Te.gpuType);if(Te.isInterleavedBufferAttribute){const st=Te.data,U=st.stride,De=Te.offset;if(st.isInstancedInterleavedBuffer){for(let ie=0;ie<ee.locationSize;ie++)M(ee.location+ie,st.meshPerAttribute);!0!==H.isInstancedMesh&&void 0===ne._maxInstanceCount&&(ne._maxInstanceCount=st.meshPerAttribute*st.count)}else for(let ie=0;ie<ee.locationSize;ie++)x(ee.location+ie);n.bindBuffer(n.ARRAY_BUFFER,it);for(let ie=0;ie<ee.locationSize;ie++)w(ee.location+ie,Ue/ee.locationSize,at,He,U*yt,(De+Ue/ee.locationSize*ie)*yt,Ft)}else{if(Te.isInstancedBufferAttribute){for(let st=0;st<ee.locationSize;st++)M(ee.location+st,Te.meshPerAttribute);!0!==H.isInstancedMesh&&void 0===ne._maxInstanceCount&&(ne._maxInstanceCount=Te.meshPerAttribute*Te.count)}else for(let st=0;st<ee.locationSize;st++)x(ee.location+st);n.bindBuffer(n.ARRAY_BUFFER,it);for(let st=0;st<ee.locationSize;st++)w(ee.location+st,Ue/ee.locationSize,at,He,Ue*yt,Ue/ee.locationSize*st*yt,Ft)}}else if(void 0!==ge){const He=ge[G];if(void 0!==He)switch(He.length){case 2:n.vertexAttrib2fv(ee.location,He);break;case 3:n.vertexAttrib3fv(ee.location,He);break;case 4:n.vertexAttrib4fv(ee.location,He);break;default:n.vertexAttrib1fv(ee.location,He)}}}}C()}(H,K,se,ne),null!==ye&&n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,t.get(ye).buffer))},reset:F,resetDefaultState:N,dispose:function T(){F();for(const H in a){const K=a[H];for(const se in K){const ne=K[se];for(const ye in ne)m(ne[ye].object),delete ne[ye];delete K[se]}delete a[H]}},releaseStatesOfGeometry:function S(H){if(void 0===a[H.id])return;const K=a[H.id];for(const se in K){const ne=K[se];for(const ye in ne)m(ne[ye].object),delete ne[ye];delete K[se]}delete a[H.id]},releaseStatesOfProgram:function R(H){for(const K in a){const se=a[K];if(void 0===se[H.id])continue;const ne=se[H.id];for(const ye in ne)m(ne[ye].object),delete ne[ye];delete se[H.id]}},initAttributes:E,enableAttribute:x,disableUnusedAttributes:C}}function YDe(n,e,t,r){const i=r.isWebGL2;let s;this.setMode=function o(l){s=l},this.render=function a(l,u){n.drawArrays(s,l,u),t.update(u,s,1)},this.renderInstances=function c(l,u,d){if(0===d)return;let h,f;if(i)h=n,f="drawArraysInstanced";else if(h=e.get("ANGLE_instanced_arrays"),f="drawArraysInstancedANGLE",null===h)return void console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");h[f](s,l,u,d),t.update(u,s,d)}}function JDe(n,e,t){let r;function s(w){if("highp"===w){if(n.getShaderPrecisionFormat(n.VERTEX_SHADER,n.HIGH_FLOAT).precision>0&&n.getShaderPrecisionFormat(n.FRAGMENT_SHADER,n.HIGH_FLOAT).precision>0)return"highp";w="mediump"}return"mediump"===w&&n.getShaderPrecisionFormat(n.VERTEX_SHADER,n.MEDIUM_FLOAT).precision>0&&n.getShaderPrecisionFormat(n.FRAGMENT_SHADER,n.MEDIUM_FLOAT).precision>0?"mediump":"lowp"}const o=typeof WebGL2RenderingContext<"u"&&"WebGL2RenderingContext"===n.constructor.name;let a=void 0!==t.precision?t.precision:"highp";const c=s(a);c!==a&&(console.warn("THREE.WebGLRenderer:",a,"not supported, using",c,"instead."),a=c);const l=o||e.has("WEBGL_draw_buffers"),u=!0===t.logarithmicDepthBuffer,d=n.getParameter(n.MAX_TEXTURE_IMAGE_UNITS),h=n.getParameter(n.MAX_VERTEX_TEXTURE_IMAGE_UNITS),f=n.getParameter(n.MAX_TEXTURE_SIZE),m=n.getParameter(n.MAX_CUBE_MAP_TEXTURE_SIZE),y=n.getParameter(n.MAX_VERTEX_ATTRIBS),_=n.getParameter(n.MAX_VERTEX_UNIFORM_VECTORS),g=n.getParameter(n.MAX_VARYING_VECTORS),b=n.getParameter(n.MAX_FRAGMENT_UNIFORM_VECTORS),E=h>0,x=o||e.has("OES_texture_float");return{isWebGL2:o,drawBuffers:l,getMaxAnisotropy:function i(){if(void 0!==r)return r;if(!0===e.has("EXT_texture_filter_anisotropic")){const w=e.get("EXT_texture_filter_anisotropic");r=n.getParameter(w.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else r=0;return r},getMaxPrecision:s,precision:a,logarithmicDepthBuffer:u,maxTextures:d,maxVertexTextures:h,maxTextureSize:f,maxCubemapSize:m,maxAttributes:y,maxVertexUniforms:_,maxVaryings:g,maxFragmentUniforms:b,vertexTextures:E,floatFragmentTextures:x,floatVertexTextures:E&&x,maxSamples:o?n.getParameter(n.MAX_SAMPLES):0}}function ZDe(n){const e=this;let t=null,r=0,i=!1,s=!1;const o=new el,a=new Ut,c={value:null,needsUpdate:!1};function u(d,h,f,m){const y=null!==d?d.length:0;let _=null;if(0!==y){if(_=c.value,!0!==m||null===_){const g=f+4*y,b=h.matrixWorldInverse;a.getNormalMatrix(b),(null===_||_.length<g)&&(_=new Float32Array(g));for(let E=0,x=f;E!==y;++E,x+=4)o.copy(d[E]).applyMatrix4(b,a),o.normal.toArray(_,x),_[x+3]=o.constant}c.value=_,c.needsUpdate=!0}return e.numPlanes=y,e.numIntersection=0,_}this.uniform=c,this.numPlanes=0,this.numIntersection=0,this.init=function(d,h){const f=0!==d.length||h||0!==r||i;return i=h,r=d.length,f},this.beginShadows=function(){s=!0,u(null)},this.endShadows=function(){s=!1},this.setGlobalState=function(d,h){t=u(d,h,0)},this.setState=function(d,h,f){const m=d.clippingPlanes,y=d.clipIntersection,_=d.clipShadows,g=n.get(d);if(!i||null===m||0===m.length||s&&!_)s?u(null):function l(){c.value!==t&&(c.value=t,c.needsUpdate=r>0),e.numPlanes=r,e.numIntersection=0}();else{const b=s?0:r,E=4*b;let x=g.clippingState||null;c.value=x,x=u(m,h,E,f);for(let M=0;M!==E;++M)x[M]=t[M];g.clippingState=x,this.numIntersection=y?this.numPlanes:0,this.numPlanes+=b}}}function QDe(n){let e=new WeakMap;function t(o,a){return 303===a?o.mapping=301:304===a&&(o.mapping=302),o}function i(o){const a=o.target;a.removeEventListener("dispose",i);const c=e.get(a);void 0!==c&&(e.delete(a),c.dispose())}return{get:function r(o){if(o&&o.isTexture&&!1===o.isRenderTargetTexture){const a=o.mapping;if(303===a||304===a){if(e.has(o))return t(e.get(o).texture,o.mapping);{const c=o.image;if(c&&c.height>0){const l=new qMe(c.height/2);return l.fromEquirectangularTexture(n,o),e.set(o,l),o.addEventListener("dispose",i),t(l.texture,o.mapping)}return null}}}return o},dispose:function s(){e=new WeakMap}}}class ek extends JO{constructor(e=-1,t=1,r=1,i=-1,s=.1,o=2e3){super(),this.isOrthographicCamera=!0,this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=e,this.right=t,this.top=r,this.bottom=i,this.near=s,this.far=o,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.near=e.near,this.far=e.far,this.zoom=e.zoom,this.view=null===e.view?null:Object.assign({},e.view),this}setViewOffset(e,t,r,i,s,o){null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=r,this.view.offsetY=i,this.view.width=s,this.view.height=o,this.updateProjectionMatrix()}clearViewOffset(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=(this.right-this.left)/(2*this.zoom),t=(this.top-this.bottom)/(2*this.zoom),r=(this.right+this.left)/2,i=(this.top+this.bottom)/2;let s=r-e,o=r+e,a=i+t,c=i-t;if(null!==this.view&&this.view.enabled){const l=(this.right-this.left)/this.view.fullWidth/this.zoom,u=(this.top-this.bottom)/this.view.fullHeight/this.zoom;s+=l*this.view.offsetX,o=s+l*this.view.width,a-=u*this.view.offsetY,c=a-u*this.view.height}this.projectionMatrix.makeOrthographic(s,o,a,c,this.near,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const t=super.toJSON(e);return t.object.zoom=this.zoom,t.object.left=this.left,t.object.right=this.right,t.object.top=this.top,t.object.bottom=this.bottom,t.object.near=this.near,t.object.far=this.far,null!==this.view&&(t.object.view=Object.assign({},this.view)),t}}const JX=[.125,.215,.35,.446,.526,.582],tk=new ek,ZX=new Ge;let nk=null,rk=0,ik=0;const Wu=(1+Math.sqrt(5))/2,ep=1/Wu,QX=[new L(1,1,1),new L(-1,1,1),new L(1,1,-1),new L(-1,1,-1),new L(0,Wu,ep),new L(0,Wu,-ep),new L(ep,0,Wu),new L(-ep,0,Wu),new L(Wu,ep,0),new L(-Wu,ep,0)];class eK{constructor(e){this._renderer=e,this._pingPongRenderTarget=null,this._lodMax=0,this._cubeSize=0,this._lodPlanes=[],this._sizeLods=[],this._sigmas=[],this._blurMaterial=null,this._cubemapMaterial=null,this._equirectMaterial=null,this._compileMaterial(this._blurMaterial)}fromScene(e,t=0,r=.1,i=100){nk=this._renderer.getRenderTarget(),rk=this._renderer.getActiveCubeFace(),ik=this._renderer.getActiveMipmapLevel(),this._setSize(256);const s=this._allocateTargets();return s.depthBuffer=!0,this._sceneToCubeUV(e,r,i,s),t>0&&this._blur(s,0,0,t),this._applyPMREM(s),this._cleanup(s),s}fromEquirectangular(e,t=null){return this._fromTexture(e,t)}fromCubemap(e,t=null){return this._fromTexture(e,t)}compileCubemapShader(){null===this._cubemapMaterial&&(this._cubemapMaterial=rK(),this._compileMaterial(this._cubemapMaterial))}compileEquirectangularShader(){null===this._equirectMaterial&&(this._equirectMaterial=nK(),this._compileMaterial(this._equirectMaterial))}dispose(){this._dispose(),null!==this._cubemapMaterial&&this._cubemapMaterial.dispose(),null!==this._equirectMaterial&&this._equirectMaterial.dispose()}_setSize(e){this._lodMax=Math.floor(Math.log2(e)),this._cubeSize=Math.pow(2,this._lodMax)}_dispose(){null!==this._blurMaterial&&this._blurMaterial.dispose(),null!==this._pingPongRenderTarget&&this._pingPongRenderTarget.dispose();for(let e=0;e<this._lodPlanes.length;e++)this._lodPlanes[e].dispose()}_cleanup(e){this._renderer.setRenderTarget(nk,rk,ik),e.scissorTest=!1,JT(e,0,0,e.width,e.height)}_fromTexture(e,t){this._setSize(301===e.mapping||302===e.mapping?0===e.image.length?16:e.image[0].width||e.image[0].image.width:e.image.width/4),nk=this._renderer.getRenderTarget(),rk=this._renderer.getActiveCubeFace(),ik=this._renderer.getActiveMipmapLevel();const r=t||this._allocateTargets();return this._textureToCubeUV(e,r),this._applyPMREM(r),this._cleanup(r),r}_allocateTargets(){const e=3*Math.max(this._cubeSize,112),t=4*this._cubeSize,r={magFilter:Mr,minFilter:Mr,generateMipmaps:!1,type:S_,format:Os,colorSpace:Sa,depthBuffer:!1},i=tK(e,t,r);if(null===this._pingPongRenderTarget||this._pingPongRenderTarget.width!==e||this._pingPongRenderTarget.height!==t){null!==this._pingPongRenderTarget&&this._dispose(),this._pingPongRenderTarget=tK(e,t,r);const{_lodMax:s}=this;({sizeLods:this._sizeLods,lodPlanes:this._lodPlanes,sigmas:this._sigmas}=function eRe(n){const e=[],t=[],r=[];let i=n;const s=n-4+1+JX.length;for(let o=0;o<s;o++){const a=Math.pow(2,i);t.push(a);let c=1/a;o>n-4?c=JX[o-n+4-1]:0===o&&(c=0),r.push(c);const l=1/(a-2),u=-l,d=1+l,h=[u,u,d,u,d,d,u,u,d,d,u,d],f=6,m=6,y=3,_=2,g=1,b=new Float32Array(y*m*f),E=new Float32Array(_*m*f),x=new Float32Array(g*m*f);for(let C=0;C<f;C++){const w=C%3*2/3-1,A=C>2?0:-1;b.set([w,A,0,w+2/3,A,0,w+2/3,A+1,0,w,A,0,w+2/3,A+1,0,w,A+1,0],y*m*C),E.set(h,_*m*C),x.set([C,C,C,C,C,C],g*m*C)}const M=new Bt;M.setAttribute("position",new xn(b,y)),M.setAttribute("uv",new xn(E,_)),M.setAttribute("faceIndex",new xn(x,g)),e.push(M),i>4&&i--}return{lodPlanes:e,sizeLods:t,sigmas:r}}(s)),this._blurMaterial=function tRe(n,e,t){const r=new Float32Array(20),i=new L(0,1,0);return new Oa({name:"SphericalGaussianBlur",defines:{n:20,CUBEUV_TEXEL_WIDTH:1/e,CUBEUV_TEXEL_HEIGHT:1/t,CUBEUV_MAX_MIP:`${n}.0`},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:r},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:i}},vertexShader:"\n\n\t\tprecision mediump float;\n\t\tprecision mediump int;\n\n\t\tattribute float faceIndex;\n\n\t\tvarying vec3 vOutputDirection;\n\n\t\t// RH coordinate system; PMREM face-indexing convention\n\t\tvec3 getDirection( vec2 uv, float face ) {\n\n\t\t\tuv = 2.0 * uv - 1.0;\n\n\t\t\tvec3 direction = vec3( uv, 1.0 );\n\n\t\t\tif ( face == 0.0 ) {\n\n\t\t\t\tdirection = direction.zyx; // ( 1, v, u ) pos x\n\n\t\t\t} else if ( face == 1.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xz *= -1.0; // ( -u, 1, -v ) pos y\n\n\t\t\t} else if ( face == 2.0 ) {\n\n\t\t\t\tdirection.x *= -1.0; // ( -u, v, 1 ) pos z\n\n\t\t\t} else if ( face == 3.0 ) {\n\n\t\t\t\tdirection = direction.zyx;\n\t\t\t\tdirection.xz *= -1.0; // ( -1, v, -u ) neg x\n\n\t\t\t} else if ( face == 4.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xy *= -1.0; // ( -u, -1, v ) neg y\n\n\t\t\t} else if ( face == 5.0 ) {\n\n\t\t\t\tdirection.z *= -1.0; // ( u, v, -1 ) neg z\n\n\t\t\t}\n\n\t\t\treturn direction;\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tvOutputDirection = getDirection( uv, faceIndex );\n\t\t\tgl_Position = vec4( position, 1.0 );\n\n\t\t}\n\t",fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform sampler2D envMap;\n\t\t\tuniform int samples;\n\t\t\tuniform float weights[ n ];\n\t\t\tuniform bool latitudinal;\n\t\t\tuniform float dTheta;\n\t\t\tuniform float mipInt;\n\t\t\tuniform vec3 poleAxis;\n\n\t\t\t#define ENVMAP_TYPE_CUBE_UV\n\t\t\t#include <cube_uv_reflection_fragment>\n\n\t\t\tvec3 getSample( float theta, vec3 axis ) {\n\n\t\t\t\tfloat cosTheta = cos( theta );\n\t\t\t\t// Rodrigues' axis-angle rotation\n\t\t\t\tvec3 sampleDirection = vOutputDirection * cosTheta\n\t\t\t\t\t+ cross( axis, vOutputDirection ) * sin( theta )\n\t\t\t\t\t+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );\n\n\t\t\t\treturn bilinearCubeUV( envMap, sampleDirection, mipInt );\n\n\t\t\t}\n\n\t\t\tvoid main() {\n\n\t\t\t\tvec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );\n\n\t\t\t\tif ( all( equal( axis, vec3( 0.0 ) ) ) ) {\n\n\t\t\t\t\taxis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );\n\n\t\t\t\t}\n\n\t\t\t\taxis = normalize( axis );\n\n\t\t\t\tgl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );\n\t\t\t\tgl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );\n\n\t\t\t\tfor ( int i = 1; i < n; i++ ) {\n\n\t\t\t\t\tif ( i >= samples ) {\n\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t}\n\n\t\t\t\t\tfloat theta = dTheta * float( i );\n\t\t\t\t\tgl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );\n\t\t\t\t\tgl_FragColor.rgb += weights[ i ] * getSample( theta, axis );\n\n\t\t\t\t}\n\n\t\t\t}\n\t\t",blending:0,depthTest:!1,depthWrite:!1})}(s,e,t)}return i}_compileMaterial(e){const t=new mr(this._lodPlanes[0],e);this._renderer.compile(t,tk)}_sceneToCubeUV(e,t,r,i){const a=new Or(90,1,t,r),c=[1,-1,1,1,1,1],l=[1,1,1,-1,-1,-1],u=this._renderer,d=u.autoClear,h=u.toneMapping;u.getClearColor(ZX),u.toneMapping=0,u.autoClear=!1;const f=new eo({name:"PMREM.Background",side:1,depthWrite:!1,depthTest:!1}),m=new mr(new Xf,f);let y=!1;const _=e.background;_?_.isColor&&(f.color.copy(_),e.background=null,y=!0):(f.color.copy(ZX),y=!0);for(let g=0;g<6;g++){const b=g%3;0===b?(a.up.set(0,c[g],0),a.lookAt(l[g],0,0)):1===b?(a.up.set(0,0,c[g]),a.lookAt(0,l[g],0)):(a.up.set(0,c[g],0),a.lookAt(0,0,l[g]));const E=this._cubeSize;JT(i,b*E,g>2?E:0,E,E),u.setRenderTarget(i),y&&u.render(m,a),u.render(e,a)}m.geometry.dispose(),m.material.dispose(),u.toneMapping=h,u.autoClear=d,e.background=_}_textureToCubeUV(e,t){const r=this._renderer,i=301===e.mapping||302===e.mapping;i?(null===this._cubemapMaterial&&(this._cubemapMaterial=rK()),this._cubemapMaterial.uniforms.flipEnvMap.value=!1===e.isRenderTargetTexture?-1:1):null===this._equirectMaterial&&(this._equirectMaterial=nK());const s=i?this._cubemapMaterial:this._equirectMaterial,o=new mr(this._lodPlanes[0],s);s.uniforms.envMap.value=e;const c=this._cubeSize;JT(t,0,0,3*c,2*c),r.setRenderTarget(t),r.render(o,tk)}_applyPMREM(e){const t=this._renderer,r=t.autoClear;t.autoClear=!1;for(let i=1;i<this._lodPlanes.length;i++){const s=Math.sqrt(this._sigmas[i]*this._sigmas[i]-this._sigmas[i-1]*this._sigmas[i-1]);this._blur(e,i-1,i,s,QX[(i-1)%QX.length])}t.autoClear=r}_blur(e,t,r,i,s){const o=this._pingPongRenderTarget;this._halfBlur(e,o,t,r,i,"latitudinal",s),this._halfBlur(o,e,r,r,i,"longitudinal",s)}_halfBlur(e,t,r,i,s,o,a){const c=this._renderer,l=this._blurMaterial;"latitudinal"!==o&&"longitudinal"!==o&&console.error("blur direction must be either latitudinal or longitudinal!");const d=new mr(this._lodPlanes[i],l),h=l.uniforms,f=this._sizeLods[r]-1,m=isFinite(s)?Math.PI/(2*f):2*Math.PI/39,y=s/m,_=isFinite(s)?1+Math.floor(3*y):20;_>20&&console.warn(`sigmaRadians, ${s}, is too large and will clip, as it requested ${_} samples when the maximum is set to 20`);const g=[];let b=0;for(let w=0;w<20;++w){const A=w/y,T=Math.exp(-A*A/2);g.push(T),0===w?b+=T:w<_&&(b+=2*T)}for(let w=0;w<g.length;w++)g[w]=g[w]/b;h.envMap.value=e.texture,h.samples.value=_,h.weights.value=g,h.latitudinal.value="latitudinal"===o,a&&(h.poleAxis.value=a);const{_lodMax:E}=this;h.dTheta.value=m,h.mipInt.value=E-r;const x=this._sizeLods[i];JT(t,3*x*(i>E-4?i-E+4:0),4*(this._cubeSize-x),3*x,2*x),c.setRenderTarget(t),c.render(d,tk)}}function tK(n,e,t){const r=new Do(n,e,t);return r.texture.mapping=306,r.texture.name="PMREM.cubeUv",r.scissorTest=!0,r}function JT(n,e,t,r,i){n.viewport.set(e,t,r,i),n.scissor.set(e,t,r,i)}function nK(){return new Oa({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null}},vertexShader:"\n\n\t\tprecision mediump float;\n\t\tprecision mediump int;\n\n\t\tattribute float faceIndex;\n\n\t\tvarying vec3 vOutputDirection;\n\n\t\t// RH coordinate system; PMREM face-indexing convention\n\t\tvec3 getDirection( vec2 uv, float face ) {\n\n\t\t\tuv = 2.0 * uv - 1.0;\n\n\t\t\tvec3 direction = vec3( uv, 1.0 );\n\n\t\t\tif ( face == 0.0 ) {\n\n\t\t\t\tdirection = direction.zyx; // ( 1, v, u ) pos x\n\n\t\t\t} else if ( face == 1.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xz *= -1.0; // ( -u, 1, -v ) pos y\n\n\t\t\t} else if ( face == 2.0 ) {\n\n\t\t\t\tdirection.x *= -1.0; // ( -u, v, 1 ) pos z\n\n\t\t\t} else if ( face == 3.0 ) {\n\n\t\t\t\tdirection = direction.zyx;\n\t\t\t\tdirection.xz *= -1.0; // ( -1, v, -u ) neg x\n\n\t\t\t} else if ( face == 4.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xy *= -1.0; // ( -u, -1, v ) neg y\n\n\t\t\t} else if ( face == 5.0 ) {\n\n\t\t\t\tdirection.z *= -1.0; // ( u, v, -1 ) neg z\n\n\t\t\t}\n\n\t\t\treturn direction;\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tvOutputDirection = getDirection( uv, faceIndex );\n\t\t\tgl_Position = vec4( position, 1.0 );\n\n\t\t}\n\t",fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform sampler2D envMap;\n\n\t\t\t#include <common>\n\n\t\t\tvoid main() {\n\n\t\t\t\tvec3 outputDirection = normalize( vOutputDirection );\n\t\t\t\tvec2 uv = equirectUv( outputDirection );\n\n\t\t\t\tgl_FragColor = vec4( texture2D ( envMap, uv ).rgb, 1.0 );\n\n\t\t\t}\n\t\t",blending:0,depthTest:!1,depthWrite:!1})}function rK(){return new Oa({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},flipEnvMap:{value:-1}},vertexShader:"\n\n\t\tprecision mediump float;\n\t\tprecision mediump int;\n\n\t\tattribute float faceIndex;\n\n\t\tvarying vec3 vOutputDirection;\n\n\t\t// RH coordinate system; PMREM face-indexing convention\n\t\tvec3 getDirection( vec2 uv, float face ) {\n\n\t\t\tuv = 2.0 * uv - 1.0;\n\n\t\t\tvec3 direction = vec3( uv, 1.0 );\n\n\t\t\tif ( face == 0.0 ) {\n\n\t\t\t\tdirection = direction.zyx; // ( 1, v, u ) pos x\n\n\t\t\t} else if ( face == 1.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xz *= -1.0; // ( -u, 1, -v ) pos y\n\n\t\t\t} else if ( face == 2.0 ) {\n\n\t\t\t\tdirection.x *= -1.0; // ( -u, v, 1 ) pos z\n\n\t\t\t} else if ( face == 3.0 ) {\n\n\t\t\t\tdirection = direction.zyx;\n\t\t\t\tdirection.xz *= -1.0; // ( -1, v, -u ) neg x\n\n\t\t\t} else if ( face == 4.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xy *= -1.0; // ( -u, -1, v ) neg y\n\n\t\t\t} else if ( face == 5.0 ) {\n\n\t\t\t\tdirection.z *= -1.0; // ( u, v, -1 ) neg z\n\n\t\t\t}\n\n\t\t\treturn direction;\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tvOutputDirection = getDirection( uv, faceIndex );\n\t\t\tgl_Position = vec4( position, 1.0 );\n\n\t\t}\n\t",fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tuniform float flipEnvMap;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform samplerCube envMap;\n\n\t\t\tvoid main() {\n\n\t\t\t\tgl_FragColor = textureCube( envMap, vec3( flipEnvMap * vOutputDirection.x, vOutputDirection.yz ) );\n\n\t\t\t}\n\t\t",blending:0,depthTest:!1,depthWrite:!1})}function nRe(n){let e=new WeakMap,t=null;function s(a){const c=a.target;c.removeEventListener("dispose",s);const l=e.get(c);void 0!==l&&(e.delete(c),l.dispose())}return{get:function r(a){if(a&&a.isTexture){const c=a.mapping,l=303===c||304===c,u=301===c||302===c;if(l||u){if(a.isRenderTargetTexture&&!0===a.needsPMREMUpdate){a.needsPMREMUpdate=!1;let d=e.get(a);return null===t&&(t=new eK(n)),d=l?t.fromEquirectangular(a,d):t.fromCubemap(a,d),e.set(a,d),d.texture}if(e.has(a))return e.get(a).texture;{const d=a.image;if(l&&d&&d.height>0||u&&d&&function i(a){let c=0;for(let u=0;u<6;u++)void 0!==a[u]&&c++;return 6===c}(d)){null===t&&(t=new eK(n));const h=l?t.fromEquirectangular(a):t.fromCubemap(a);return e.set(a,h),a.addEventListener("dispose",s),h.texture}return null}}}return a},dispose:function o(){e=new WeakMap,null!==t&&(t.dispose(),t=null)}}}function rRe(n){const e={};function t(r){if(void 0!==e[r])return e[r];let i;switch(r){case"WEBGL_depth_texture":i=n.getExtension("WEBGL_depth_texture")||n.getExtension("MOZ_WEBGL_depth_texture")||n.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":i=n.getExtension("EXT_texture_filter_anisotropic")||n.getExtension("MOZ_EXT_texture_filter_anisotropic")||n.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":i=n.getExtension("WEBGL_compressed_texture_s3tc")||n.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||n.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":i=n.getExtension("WEBGL_compressed_texture_pvrtc")||n.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:i=n.getExtension(r)}return e[r]=i,i}return{has:function(r){return null!==t(r)},init:function(r){r.isWebGL2?t("EXT_color_buffer_float"):(t("WEBGL_depth_texture"),t("OES_texture_float"),t("OES_texture_half_float"),t("OES_texture_half_float_linear"),t("OES_standard_derivatives"),t("OES_element_index_uint"),t("OES_vertex_array_object"),t("ANGLE_instanced_arrays")),t("OES_texture_float_linear"),t("EXT_color_buffer_half_float"),t("WEBGL_multisampled_render_to_texture")},get:function(r){const i=t(r);return null===i&&console.warn("THREE.WebGLRenderer: "+r+" extension not supported."),i}}}function iRe(n,e,t,r){const i={},s=new WeakMap;function o(d){const h=d.target;null!==h.index&&e.remove(h.index);for(const m in h.attributes)e.remove(h.attributes[m]);for(const m in h.morphAttributes){const y=h.morphAttributes[m];for(let _=0,g=y.length;_<g;_++)e.remove(y[_])}h.removeEventListener("dispose",o),delete i[h.id];const f=s.get(h);f&&(e.remove(f),s.delete(h)),r.releaseStatesOfGeometry(h),!0===h.isInstancedBufferGeometry&&delete h._maxInstanceCount,t.memory.geometries--}function l(d){const h=[],f=d.index,m=d.attributes.position;let y=0;if(null!==f){const b=f.array;y=f.version;for(let E=0,x=b.length;E<x;E+=3){const M=b[E+0],C=b[E+1],w=b[E+2];h.push(M,C,C,w,w,M)}}else{if(void 0===m)return;y=m.version;for(let E=0,x=m.array.length/3-1;E<x;E+=3){const M=E+0,C=E+1,w=E+2;h.push(M,C,C,w,w,M)}}const _=new(AX(h)?GX:zX)(h,1);_.version=y;const g=s.get(d);g&&e.remove(g),s.set(d,_)}return{get:function a(d,h){return!0===i[h.id]||(h.addEventListener("dispose",o),i[h.id]=!0,t.memory.geometries++),h},update:function c(d){const h=d.attributes;for(const m in h)e.update(h[m],n.ARRAY_BUFFER);const f=d.morphAttributes;for(const m in f){const y=f[m];for(let _=0,g=y.length;_<g;_++)e.update(y[_],n.ARRAY_BUFFER)}},getWireframeAttribute:function u(d){const h=s.get(d);if(h){const f=d.index;null!==f&&h.version<f.version&&l(d)}else l(d);return s.get(d)}}}function sRe(n,e,t,r){const i=r.isWebGL2;let s,a,c;this.setMode=function o(h){s=h},this.setIndex=function l(h){a=h.type,c=h.bytesPerElement},this.render=function u(h,f){n.drawElements(s,f,a,h*c),t.update(f,s,1)},this.renderInstances=function d(h,f,m){if(0===m)return;let y,_;if(i)y=n,_="drawElementsInstanced";else if(y=e.get("ANGLE_instanced_arrays"),_="drawElementsInstancedANGLE",null===y)return void console.error("THREE.WebGLIndexedBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");y[_](s,f,a,h*c,m),t.update(f,s,m)}}function oRe(n){const t={frame:0,calls:0,triangles:0,points:0,lines:0};return{memory:{geometries:0,textures:0},render:t,programs:null,autoReset:!0,reset:function i(){t.calls=0,t.triangles=0,t.points=0,t.lines=0},update:function r(s,o,a){switch(t.calls++,o){case n.TRIANGLES:t.triangles+=a*(s/3);break;case n.LINES:t.lines+=a*(s/2);break;case n.LINE_STRIP:t.lines+=a*(s-1);break;case n.LINE_LOOP:t.lines+=a*s;break;case n.POINTS:t.points+=a*s;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",o)}}}}function aRe(n,e){return n[0]-e[0]}function cRe(n,e){return Math.abs(e[1])-Math.abs(n[1])}function lRe(n,e,t){const r={},i=new Float32Array(8),s=new WeakMap,o=new mn,a=[];for(let l=0;l<8;l++)a[l]=[l,0];return{update:function c(l,u,d){const h=l.morphTargetInfluences;if(!0===e.isWebGL2){const f=u.morphAttributes.position||u.morphAttributes.normal||u.morphAttributes.color,m=void 0!==f?f.length:0;let y=s.get(u);if(void 0===y||y.count!==m){let H=function(){F.dispose(),s.delete(u),u.removeEventListener("dispose",H)};void 0!==y&&y.texture.dispose();const b=void 0!==u.morphAttributes.position,E=void 0!==u.morphAttributes.normal,x=void 0!==u.morphAttributes.color,M=u.morphAttributes.position||[],C=u.morphAttributes.normal||[],w=u.morphAttributes.color||[];let A=0;!0===b&&(A=1),!0===E&&(A=2),!0===x&&(A=3);let T=u.attributes.position.count*A,S=1;T>e.maxTextureSize&&(S=Math.ceil(T/e.maxTextureSize),T=e.maxTextureSize);const R=new Float32Array(T*S*4*m),F=new LO(R,T,S,m);F.type=Ia,F.needsUpdate=!0;const N=4*A;for(let K=0;K<m;K++){const se=M[K],ne=C[K],ye=w[K],ce=T*S*4*K;for(let ge=0;ge<se.count;ge++){const G=ge*N;!0===b&&(o.fromBufferAttribute(se,ge),R[ce+G+0]=o.x,R[ce+G+1]=o.y,R[ce+G+2]=o.z,R[ce+G+3]=0),!0===E&&(o.fromBufferAttribute(ne,ge),R[ce+G+4]=o.x,R[ce+G+5]=o.y,R[ce+G+6]=o.z,R[ce+G+7]=0),!0===x&&(o.fromBufferAttribute(ye,ge),R[ce+G+8]=o.x,R[ce+G+9]=o.y,R[ce+G+10]=o.z,R[ce+G+11]=4===ye.itemSize?o.w:1)}}y={count:m,texture:F,size:new oe(T,S)},s.set(u,y),u.addEventListener("dispose",H)}let _=0;for(let b=0;b<h.length;b++)_+=h[b];const g=u.morphTargetsRelative?1:1-_;d.getUniforms().setValue(n,"morphTargetBaseInfluence",g),d.getUniforms().setValue(n,"morphTargetInfluences",h),d.getUniforms().setValue(n,"morphTargetsTexture",y.texture,t),d.getUniforms().setValue(n,"morphTargetsTextureSize",y.size)}else{const f=void 0===h?0:h.length;let m=r[u.id];if(void 0===m||m.length!==f){m=[];for(let E=0;E<f;E++)m[E]=[E,0];r[u.id]=m}for(let E=0;E<f;E++){const x=m[E];x[0]=E,x[1]=h[E]}m.sort(cRe);for(let E=0;E<8;E++)E<f&&m[E][1]?(a[E][0]=m[E][0],a[E][1]=m[E][1]):(a[E][0]=Number.MAX_SAFE_INTEGER,a[E][1]=0);a.sort(aRe);const y=u.morphAttributes.position,_=u.morphAttributes.normal;let g=0;for(let E=0;E<8;E++){const x=a[E],M=x[0],C=x[1];M!==Number.MAX_SAFE_INTEGER&&C?(y&&u.getAttribute("morphTarget"+E)!==y[M]&&u.setAttribute("morphTarget"+E,y[M]),_&&u.getAttribute("morphNormal"+E)!==_[M]&&u.setAttribute("morphNormal"+E,_[M]),i[E]=C,g+=C):(y&&!0===u.hasAttribute("morphTarget"+E)&&u.deleteAttribute("morphTarget"+E),_&&!0===u.hasAttribute("morphNormal"+E)&&u.deleteAttribute("morphNormal"+E),i[E]=0)}const b=u.morphTargetsRelative?1:1-g;d.getUniforms().setValue(n,"morphTargetBaseInfluence",b),d.getUniforms().setValue(n,"morphTargetInfluences",i)}}}}function uRe(n,e,t,r){let i=new WeakMap;function a(c){const l=c.target;l.removeEventListener("dispose",a),t.remove(l.instanceMatrix),null!==l.instanceColor&&t.remove(l.instanceColor)}return{update:function s(c){const l=r.render.frame,d=e.get(c,c.geometry);if(i.get(d)!==l&&(e.update(d),i.set(d,l)),c.isInstancedMesh&&(!1===c.hasEventListener("dispose",a)&&c.addEventListener("dispose",a),i.get(c)!==l&&(t.update(c.instanceMatrix,n.ARRAY_BUFFER),null!==c.instanceColor&&t.update(c.instanceColor,n.ARRAY_BUFFER),i.set(c,l))),c.isSkinnedMesh){const h=c.skeleton;i.get(h)!==l&&(h.update(),i.set(h,l))}return d},dispose:function o(){i=new WeakMap}}}const iK=new gs,sK=new LO,oK=new PX,aK=new XT,cK=[],lK=[],uK=new Float32Array(16),dK=new Float32Array(9),hK=new Float32Array(4);function tp(n,e,t){const r=n[0];if(r<=0||r>0)return n;const i=e*t;let s=cK[i];if(void 0===s&&(s=new Float32Array(i),cK[i]=s),0!==e){r.toArray(s,0);for(let o=1,a=0;o!==e;++o)a+=t,n[o].toArray(s,a)}return s}function kr(n,e){if(n.length!==e.length)return!1;for(let t=0,r=n.length;t<r;t++)if(n[t]!==e[t])return!1;return!0}function Lr(n,e){for(let t=0,r=e.length;t<r;t++)n[t]=e[t]}function ZT(n,e){let t=lK[e];void 0===t&&(t=new Int32Array(e),lK[e]=t);for(let r=0;r!==e;++r)t[r]=n.allocateTextureUnit();return t}function dRe(n,e){const t=this.cache;t[0]!==e&&(n.uniform1f(this.addr,e),t[0]=e)}function hRe(n,e){const t=this.cache;if(void 0!==e.x)(t[0]!==e.x||t[1]!==e.y)&&(n.uniform2f(this.addr,e.x,e.y),t[0]=e.x,t[1]=e.y);else{if(kr(t,e))return;n.uniform2fv(this.addr,e),Lr(t,e)}}function fRe(n,e){const t=this.cache;if(void 0!==e.x)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z)&&(n.uniform3f(this.addr,e.x,e.y,e.z),t[0]=e.x,t[1]=e.y,t[2]=e.z);else if(void 0!==e.r)(t[0]!==e.r||t[1]!==e.g||t[2]!==e.b)&&(n.uniform3f(this.addr,e.r,e.g,e.b),t[0]=e.r,t[1]=e.g,t[2]=e.b);else{if(kr(t,e))return;n.uniform3fv(this.addr,e),Lr(t,e)}}function pRe(n,e){const t=this.cache;if(void 0!==e.x)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z||t[3]!==e.w)&&(n.uniform4f(this.addr,e.x,e.y,e.z,e.w),t[0]=e.x,t[1]=e.y,t[2]=e.z,t[3]=e.w);else{if(kr(t,e))return;n.uniform4fv(this.addr,e),Lr(t,e)}}function mRe(n,e){const t=this.cache,r=e.elements;if(void 0===r){if(kr(t,e))return;n.uniformMatrix2fv(this.addr,!1,e),Lr(t,e)}else{if(kr(t,r))return;hK.set(r),n.uniformMatrix2fv(this.addr,!1,hK),Lr(t,r)}}function gRe(n,e){const t=this.cache,r=e.elements;if(void 0===r){if(kr(t,e))return;n.uniformMatrix3fv(this.addr,!1,e),Lr(t,e)}else{if(kr(t,r))return;dK.set(r),n.uniformMatrix3fv(this.addr,!1,dK),Lr(t,r)}}function _Re(n,e){const t=this.cache,r=e.elements;if(void 0===r){if(kr(t,e))return;n.uniformMatrix4fv(this.addr,!1,e),Lr(t,e)}else{if(kr(t,r))return;uK.set(r),n.uniformMatrix4fv(this.addr,!1,uK),Lr(t,r)}}function yRe(n,e){const t=this.cache;t[0]!==e&&(n.uniform1i(this.addr,e),t[0]=e)}function vRe(n,e){const t=this.cache;if(void 0!==e.x)(t[0]!==e.x||t[1]!==e.y)&&(n.uniform2i(this.addr,e.x,e.y),t[0]=e.x,t[1]=e.y);else{if(kr(t,e))return;n.uniform2iv(this.addr,e),Lr(t,e)}}function ERe(n,e){const t=this.cache;if(void 0!==e.x)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z)&&(n.uniform3i(this.addr,e.x,e.y,e.z),t[0]=e.x,t[1]=e.y,t[2]=e.z);else{if(kr(t,e))return;n.uniform3iv(this.addr,e),Lr(t,e)}}function bRe(n,e){const t=this.cache;if(void 0!==e.x)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z||t[3]!==e.w)&&(n.uniform4i(this.addr,e.x,e.y,e.z,e.w),t[0]=e.x,t[1]=e.y,t[2]=e.z,t[3]=e.w);else{if(kr(t,e))return;n.uniform4iv(this.addr,e),Lr(t,e)}}function TRe(n,e){const t=this.cache;t[0]!==e&&(n.uniform1ui(this.addr,e),t[0]=e)}function wRe(n,e){const t=this.cache;if(void 0!==e.x)(t[0]!==e.x||t[1]!==e.y)&&(n.uniform2ui(this.addr,e.x,e.y),t[0]=e.x,t[1]=e.y);else{if(kr(t,e))return;n.uniform2uiv(this.addr,e),Lr(t,e)}}function IRe(n,e){const t=this.cache;if(void 0!==e.x)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z)&&(n.uniform3ui(this.addr,e.x,e.y,e.z),t[0]=e.x,t[1]=e.y,t[2]=e.z);else{if(kr(t,e))return;n.uniform3uiv(this.addr,e),Lr(t,e)}}function SRe(n,e){const t=this.cache;if(void 0!==e.x)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z||t[3]!==e.w)&&(n.uniform4ui(this.addr,e.x,e.y,e.z,e.w),t[0]=e.x,t[1]=e.y,t[2]=e.z,t[3]=e.w);else{if(kr(t,e))return;n.uniform4uiv(this.addr,e),Lr(t,e)}}function xRe(n,e,t){const r=this.cache,i=t.allocateTextureUnit();r[0]!==i&&(n.uniform1i(this.addr,i),r[0]=i),t.setTexture2D(e||iK,i)}function ARe(n,e,t){const r=this.cache,i=t.allocateTextureUnit();r[0]!==i&&(n.uniform1i(this.addr,i),r[0]=i),t.setTexture3D(e||oK,i)}function MRe(n,e,t){const r=this.cache,i=t.allocateTextureUnit();r[0]!==i&&(n.uniform1i(this.addr,i),r[0]=i),t.setTextureCube(e||aK,i)}function CRe(n,e,t){const r=this.cache,i=t.allocateTextureUnit();r[0]!==i&&(n.uniform1i(this.addr,i),r[0]=i),t.setTexture2DArray(e||sK,i)}function RRe(n,e){n.uniform1fv(this.addr,e)}function PRe(n,e){const t=tp(e,this.size,2);n.uniform2fv(this.addr,t)}function NRe(n,e){const t=tp(e,this.size,3);n.uniform3fv(this.addr,t)}function ORe(n,e){const t=tp(e,this.size,4);n.uniform4fv(this.addr,t)}function kRe(n,e){const t=tp(e,this.size,4);n.uniformMatrix2fv(this.addr,!1,t)}function LRe(n,e){const t=tp(e,this.size,9);n.uniformMatrix3fv(this.addr,!1,t)}function FRe(n,e){const t=tp(e,this.size,16);n.uniformMatrix4fv(this.addr,!1,t)}function VRe(n,e){n.uniform1iv(this.addr,e)}function URe(n,e){n.uniform2iv(this.addr,e)}function BRe(n,e){n.uniform3iv(this.addr,e)}function HRe(n,e){n.uniform4iv(this.addr,e)}function zRe(n,e){n.uniform1uiv(this.addr,e)}function GRe(n,e){n.uniform2uiv(this.addr,e)}function WRe(n,e){n.uniform3uiv(this.addr,e)}function jRe(n,e){n.uniform4uiv(this.addr,e)}function $Re(n,e,t){const r=this.cache,i=e.length,s=ZT(t,i);kr(r,s)||(n.uniform1iv(this.addr,s),Lr(r,s));for(let o=0;o!==i;++o)t.setTexture2D(e[o]||iK,s[o])}function qRe(n,e,t){const r=this.cache,i=e.length,s=ZT(t,i);kr(r,s)||(n.uniform1iv(this.addr,s),Lr(r,s));for(let o=0;o!==i;++o)t.setTexture3D(e[o]||oK,s[o])}function XRe(n,e,t){const r=this.cache,i=e.length,s=ZT(t,i);kr(r,s)||(n.uniform1iv(this.addr,s),Lr(r,s));for(let o=0;o!==i;++o)t.setTextureCube(e[o]||aK,s[o])}function KRe(n,e,t){const r=this.cache,i=e.length,s=ZT(t,i);kr(r,s)||(n.uniform1iv(this.addr,s),Lr(r,s));for(let o=0;o!==i;++o)t.setTexture2DArray(e[o]||sK,s[o])}class JRe{constructor(e,t,r){this.id=e,this.addr=r,this.cache=[],this.setValue=function DRe(n){switch(n){case 5126:return dRe;case 35664:return hRe;case 35665:return fRe;case 35666:return pRe;case 35674:return mRe;case 35675:return gRe;case 35676:return _Re;case 5124:case 35670:return yRe;case 35667:case 35671:return vRe;case 35668:case 35672:return ERe;case 35669:case 35673:return bRe;case 5125:return TRe;case 36294:return wRe;case 36295:return IRe;case 36296:return SRe;case 35678:case 36198:case 36298:case 36306:case 35682:return xRe;case 35679:case 36299:case 36307:return ARe;case 35680:case 36300:case 36308:case 36293:return MRe;case 36289:case 36303:case 36311:case 36292:return CRe}}(t.type)}}class ZRe{constructor(e,t,r){this.id=e,this.addr=r,this.cache=[],this.size=t.size,this.setValue=function YRe(n){switch(n){case 5126:return RRe;case 35664:return PRe;case 35665:return NRe;case 35666:return ORe;case 35674:return kRe;case 35675:return LRe;case 35676:return FRe;case 5124:case 35670:return VRe;case 35667:case 35671:return URe;case 35668:case 35672:return BRe;case 35669:case 35673:return HRe;case 5125:return zRe;case 36294:return GRe;case 36295:return WRe;case 36296:return jRe;case 35678:case 36198:case 36298:case 36306:case 35682:return $Re;case 35679:case 36299:case 36307:return qRe;case 35680:case 36300:case 36308:case 36293:return XRe;case 36289:case 36303:case 36311:case 36292:return KRe}}(t.type)}}class QRe{constructor(e){this.id=e,this.seq=[],this.map={}}setValue(e,t,r){const i=this.seq;for(let s=0,o=i.length;s!==o;++s){const a=i[s];a.setValue(e,t[a.id],r)}}}const ok=/(\w+)(\])?(\[|\.)?/g;function fK(n,e){n.seq.push(e),n.map[e.id]=e}function e1e(n,e,t){const r=n.name,i=r.length;for(ok.lastIndex=0;;){const s=ok.exec(r);let a=s[1];const l=s[3];if("]"===s[2]&&(a|=0),void 0===l||"["===l&&ok.lastIndex+2===i){fK(t,void 0===l?new JRe(a,n,e):new ZRe(a,n,e));break}{let d=t.map[a];void 0===d&&(d=new QRe(a),fK(t,d)),t=d}}}class QT{constructor(e,t){this.seq=[],this.map={};const r=e.getProgramParameter(t,e.ACTIVE_UNIFORMS);for(let i=0;i<r;++i){const s=e.getActiveUniform(t,i);e1e(s,e.getUniformLocation(t,s.name),this)}}setValue(e,t,r,i){const s=this.map[t];void 0!==s&&s.setValue(e,r,i)}setOptional(e,t,r){const i=t[r];void 0!==i&&this.setValue(e,r,i)}static upload(e,t,r,i){for(let s=0,o=t.length;s!==o;++s){const a=t[s],c=r[a.id];!1!==c.needsUpdate&&a.setValue(e,c.value,i)}}static seqWithValue(e,t){const r=[];for(let i=0,s=e.length;i!==s;++i){const o=e[i];o.id in t&&r.push(o)}return r}}function pK(n,e,t){const r=n.createShader(e);return n.shaderSource(r,t),n.compileShader(r),r}let n1e=0;function mK(n,e,t){const r=n.getShaderParameter(e,n.COMPILE_STATUS),i=n.getShaderInfoLog(e).trim();if(r&&""===i)return"";const s=/ERROR: 0:(\d+)/.exec(i);if(s){const o=parseInt(s[1]);return t.toUpperCase()+"\n\n"+i+"\n\n"+function r1e(n,e){const t=n.split("\n"),r=[],i=Math.max(e-6,0),s=Math.min(e+6,t.length);for(let o=i;o<s;o++){const a=o+1;r.push(`${a===e?">":" "} ${a}: ${t[o]}`)}return r.join("\n")}(n.getShaderSource(e),o)}return i}function s1e(n,e){const t=function i1e(n){const e=pn.getPrimaries(pn.workingColorSpace),t=pn.getPrimaries(n);let r;switch(e===t?r="":"p3"===e&&t===IT?r="LinearDisplayP3ToLinearSRGB":e===IT&&"p3"===t&&(r="LinearSRGBToLinearDisplayP3"),n){case Sa:case TT:return[r,"LinearTransferOETF"];case jr:case CO:return[r,"sRGBTransferOETF"];default:return console.warn("THREE.WebGLProgram: Unsupported color space:",n),[r,"LinearTransferOETF"]}}(e);return`vec4 ${n}( vec4 value ) { return ${t[0]}( ${t[1]}( value ) ); }`}function o1e(n,e){let t;switch(e){case 1:t="Linear";break;case 2:t="Reinhard";break;case 3:t="OptimizedCineon";break;case 4:t="ACESFilmic";break;case 5:t="Custom";break;default:console.warn("THREE.WebGLProgram: Unsupported toneMapping:",e),t="Linear"}return"vec3 "+n+"( vec3 color ) { return "+t+"ToneMapping( color ); }"}function O_(n){return""!==n}function gK(n,e){const t=e.numSpotLightShadows+e.numSpotLightMaps-e.numSpotLightShadowsWithMaps;return n.replace(/NUM_DIR_LIGHTS/g,e.numDirLights).replace(/NUM_SPOT_LIGHTS/g,e.numSpotLights).replace(/NUM_SPOT_LIGHT_MAPS/g,e.numSpotLightMaps).replace(/NUM_SPOT_LIGHT_COORDS/g,t).replace(/NUM_RECT_AREA_LIGHTS/g,e.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,e.numPointLights).replace(/NUM_HEMI_LIGHTS/g,e.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,e.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS/g,e.numSpotLightShadowsWithMaps).replace(/NUM_SPOT_LIGHT_SHADOWS/g,e.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,e.numPointLightShadows)}function _K(n,e){return n.replace(/NUM_CLIPPING_PLANES/g,e.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,e.numClippingPlanes-e.numClipIntersection)}const u1e=/^[ \t]*#include +<([\w\d./]+)>/gm;function ak(n){return n.replace(u1e,h1e)}const d1e=new Map([["encodings_fragment","colorspace_fragment"],["encodings_pars_fragment","colorspace_pars_fragment"],["output_fragment","opaque_fragment"]]);function h1e(n,e){let t=Lt[e];if(void 0===t){const r=d1e.get(e);if(void 0===r)throw new Error("Can not resolve #include <"+e+">");t=Lt[r],console.warn('THREE.WebGLRenderer: Shader chunk "%s" has been deprecated. Use "%s" instead.',e,r)}return ak(t)}const f1e=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function yK(n){return n.replace(f1e,p1e)}function p1e(n,e,t,r){let i="";for(let s=parseInt(e);s<parseInt(t);s++)i+=r.replace(/\[\s*i\s*\]/g,"[ "+s+" ]").replace(/UNROLLED_LOOP_INDEX/g,s);return i}function vK(n){let e="precision "+n.precision+" float;\nprecision "+n.precision+" int;";return"highp"===n.precision?e+="\n#define HIGH_PRECISION":"mediump"===n.precision?e+="\n#define MEDIUM_PRECISION":"lowp"===n.precision&&(e+="\n#define LOW_PRECISION"),e}function E1e(n,e,t,r){const i=n.getContext(),s=t.defines;let o=t.vertexShader,a=t.fragmentShader;const c=function m1e(n){let e="SHADOWMAP_TYPE_BASIC";return 1===n.shadowMapType?e="SHADOWMAP_TYPE_PCF":2===n.shadowMapType?e="SHADOWMAP_TYPE_PCF_SOFT":3===n.shadowMapType&&(e="SHADOWMAP_TYPE_VSM"),e}(t),l=function g1e(n){let e="ENVMAP_TYPE_CUBE";if(n.envMap)switch(n.envMapMode){case 301:case 302:e="ENVMAP_TYPE_CUBE";break;case 306:e="ENVMAP_TYPE_CUBE_UV"}return e}(t),u=function _1e(n){let e="ENVMAP_MODE_REFLECTION";return n.envMap&&302===n.envMapMode&&(e="ENVMAP_MODE_REFRACTION"),e}(t),d=function y1e(n){let e="ENVMAP_BLENDING_NONE";if(n.envMap)switch(n.combine){case 0:e="ENVMAP_BLENDING_MULTIPLY";break;case 1:e="ENVMAP_BLENDING_MIX";break;case 2:e="ENVMAP_BLENDING_ADD"}return e}(t),h=function v1e(n){const e=n.envMapCubeUVHeight;if(null===e)return null;const t=Math.log2(e)-2,r=1/e;return{texelWidth:1/(3*Math.max(Math.pow(2,t),112)),texelHeight:r,maxMip:t}}(t),f=t.isWebGL2?"":function a1e(n){return[n.extensionDerivatives||n.envMapCubeUVHeight||n.bumpMap||n.normalMapTangentSpace||n.clearcoatNormalMap||n.flatShading||"physical"===n.shaderID?"#extension GL_OES_standard_derivatives : enable":"",(n.extensionFragDepth||n.logarithmicDepthBuffer)&&n.rendererExtensionFragDepth?"#extension GL_EXT_frag_depth : enable":"",n.extensionDrawBuffers&&n.rendererExtensionDrawBuffers?"#extension GL_EXT_draw_buffers : require":"",(n.extensionShaderTextureLOD||n.envMap||n.transmission)&&n.rendererExtensionShaderTextureLod?"#extension GL_EXT_shader_texture_lod : enable":""].filter(O_).join("\n")}(t),m=function c1e(n){const e=[];for(const t in n){const r=n[t];!1!==r&&e.push("#define "+t+" "+r)}return e.join("\n")}(s),y=i.createProgram();let _,g,b=t.glslVersion?"#version "+t.glslVersion+"\n":"";t.isRawShaderMaterial?(_=["#define SHADER_TYPE "+t.shaderType,"#define SHADER_NAME "+t.shaderName,m].filter(O_).join("\n"),_.length>0&&(_+="\n"),g=[f,"#define SHADER_TYPE "+t.shaderType,"#define SHADER_NAME "+t.shaderName,m].filter(O_).join("\n"),g.length>0&&(g+="\n")):(_=[vK(t),"#define SHADER_TYPE "+t.shaderType,"#define SHADER_NAME "+t.shaderName,m,t.instancing?"#define USE_INSTANCING":"",t.instancingColor?"#define USE_INSTANCING_COLOR":"",t.useFog&&t.fog?"#define USE_FOG":"",t.useFog&&t.fogExp2?"#define FOG_EXP2":"",t.map?"#define USE_MAP":"",t.envMap?"#define USE_ENVMAP":"",t.envMap?"#define "+u:"",t.lightMap?"#define USE_LIGHTMAP":"",t.aoMap?"#define USE_AOMAP":"",t.bumpMap?"#define USE_BUMPMAP":"",t.normalMap?"#define USE_NORMALMAP":"",t.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",t.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",t.displacementMap?"#define USE_DISPLACEMENTMAP":"",t.emissiveMap?"#define USE_EMISSIVEMAP":"",t.anisotropy?"#define USE_ANISOTROPY":"",t.anisotropyMap?"#define USE_ANISOTROPYMAP":"",t.clearcoatMap?"#define USE_CLEARCOATMAP":"",t.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",t.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",t.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",t.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",t.specularMap?"#define USE_SPECULARMAP":"",t.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",t.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",t.roughnessMap?"#define USE_ROUGHNESSMAP":"",t.metalnessMap?"#define USE_METALNESSMAP":"",t.alphaMap?"#define USE_ALPHAMAP":"",t.alphaHash?"#define USE_ALPHAHASH":"",t.transmission?"#define USE_TRANSMISSION":"",t.transmissionMap?"#define USE_TRANSMISSIONMAP":"",t.thicknessMap?"#define USE_THICKNESSMAP":"",t.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",t.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",t.mapUv?"#define MAP_UV "+t.mapUv:"",t.alphaMapUv?"#define ALPHAMAP_UV "+t.alphaMapUv:"",t.lightMapUv?"#define LIGHTMAP_UV "+t.lightMapUv:"",t.aoMapUv?"#define AOMAP_UV "+t.aoMapUv:"",t.emissiveMapUv?"#define EMISSIVEMAP_UV "+t.emissiveMapUv:"",t.bumpMapUv?"#define BUMPMAP_UV "+t.bumpMapUv:"",t.normalMapUv?"#define NORMALMAP_UV "+t.normalMapUv:"",t.displacementMapUv?"#define DISPLACEMENTMAP_UV "+t.displacementMapUv:"",t.metalnessMapUv?"#define METALNESSMAP_UV "+t.metalnessMapUv:"",t.roughnessMapUv?"#define ROUGHNESSMAP_UV "+t.roughnessMapUv:"",t.anisotropyMapUv?"#define ANISOTROPYMAP_UV "+t.anisotropyMapUv:"",t.clearcoatMapUv?"#define CLEARCOATMAP_UV "+t.clearcoatMapUv:"",t.clearcoatNormalMapUv?"#define CLEARCOAT_NORMALMAP_UV "+t.clearcoatNormalMapUv:"",t.clearcoatRoughnessMapUv?"#define CLEARCOAT_ROUGHNESSMAP_UV "+t.clearcoatRoughnessMapUv:"",t.iridescenceMapUv?"#define IRIDESCENCEMAP_UV "+t.iridescenceMapUv:"",t.iridescenceThicknessMapUv?"#define IRIDESCENCE_THICKNESSMAP_UV "+t.iridescenceThicknessMapUv:"",t.sheenColorMapUv?"#define SHEEN_COLORMAP_UV "+t.sheenColorMapUv:"",t.sheenRoughnessMapUv?"#define SHEEN_ROUGHNESSMAP_UV "+t.sheenRoughnessMapUv:"",t.specularMapUv?"#define SPECULARMAP_UV "+t.specularMapUv:"",t.specularColorMapUv?"#define SPECULAR_COLORMAP_UV "+t.specularColorMapUv:"",t.specularIntensityMapUv?"#define SPECULAR_INTENSITYMAP_UV "+t.specularIntensityMapUv:"",t.transmissionMapUv?"#define TRANSMISSIONMAP_UV "+t.transmissionMapUv:"",t.thicknessMapUv?"#define THICKNESSMAP_UV "+t.thicknessMapUv:"",t.vertexTangents&&!1===t.flatShading?"#define USE_TANGENT":"",t.vertexColors?"#define USE_COLOR":"",t.vertexAlphas?"#define USE_COLOR_ALPHA":"",t.vertexUv1s?"#define USE_UV1":"",t.vertexUv2s?"#define USE_UV2":"",t.vertexUv3s?"#define USE_UV3":"",t.pointsUvs?"#define USE_POINTS_UV":"",t.flatShading?"#define FLAT_SHADED":"",t.skinning?"#define USE_SKINNING":"",t.morphTargets?"#define USE_MORPHTARGETS":"",t.morphNormals&&!1===t.flatShading?"#define USE_MORPHNORMALS":"",t.morphColors&&t.isWebGL2?"#define USE_MORPHCOLORS":"",t.morphTargetsCount>0&&t.isWebGL2?"#define MORPHTARGETS_TEXTURE":"",t.morphTargetsCount>0&&t.isWebGL2?"#define MORPHTARGETS_TEXTURE_STRIDE "+t.morphTextureStride:"",t.morphTargetsCount>0&&t.isWebGL2?"#define MORPHTARGETS_COUNT "+t.morphTargetsCount:"",t.doubleSided?"#define DOUBLE_SIDED":"",t.flipSided?"#define FLIP_SIDED":"",t.shadowMapEnabled?"#define USE_SHADOWMAP":"",t.shadowMapEnabled?"#define "+c:"",t.sizeAttenuation?"#define USE_SIZEATTENUATION":"",t.numLightProbes>0?"#define USE_LIGHT_PROBES":"",t.useLegacyLights?"#define LEGACY_LIGHTS":"",t.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",t.logarithmicDepthBuffer&&t.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","\tattribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","\tattribute vec3 instanceColor;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_UV1","\tattribute vec2 uv1;","#endif","#ifdef USE_UV2","\tattribute vec2 uv2;","#endif","#ifdef USE_UV3","\tattribute vec2 uv3;","#endif","#ifdef USE_TANGENT","\tattribute vec4 tangent;","#endif","#if defined( USE_COLOR_ALPHA )","\tattribute vec4 color;","#elif defined( USE_COLOR )","\tattribute vec3 color;","#endif","#if ( defined( USE_MORPHTARGETS ) && ! defined( MORPHTARGETS_TEXTURE ) )","\tattribute vec3 morphTarget0;","\tattribute vec3 morphTarget1;","\tattribute vec3 morphTarget2;","\tattribute vec3 morphTarget3;","\t#ifdef USE_MORPHNORMALS","\t\tattribute vec3 morphNormal0;","\t\tattribute vec3 morphNormal1;","\t\tattribute vec3 morphNormal2;","\t\tattribute vec3 morphNormal3;","\t#else","\t\tattribute vec3 morphTarget4;","\t\tattribute vec3 morphTarget5;","\t\tattribute vec3 morphTarget6;","\t\tattribute vec3 morphTarget7;","\t#endif","#endif","#ifdef USE_SKINNING","\tattribute vec4 skinIndex;","\tattribute vec4 skinWeight;","#endif","\n"].filter(O_).join("\n"),g=[f,vK(t),"#define SHADER_TYPE "+t.shaderType,"#define SHADER_NAME "+t.shaderName,m,t.useFog&&t.fog?"#define USE_FOG":"",t.useFog&&t.fogExp2?"#define FOG_EXP2":"",t.map?"#define USE_MAP":"",t.matcap?"#define USE_MATCAP":"",t.envMap?"#define USE_ENVMAP":"",t.envMap?"#define "+l:"",t.envMap?"#define "+u:"",t.envMap?"#define "+d:"",h?"#define CUBEUV_TEXEL_WIDTH "+h.texelWidth:"",h?"#define CUBEUV_TEXEL_HEIGHT "+h.texelHeight:"",h?"#define CUBEUV_MAX_MIP "+h.maxMip+".0":"",t.lightMap?"#define USE_LIGHTMAP":"",t.aoMap?"#define USE_AOMAP":"",t.bumpMap?"#define USE_BUMPMAP":"",t.normalMap?"#define USE_NORMALMAP":"",t.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",t.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",t.emissiveMap?"#define USE_EMISSIVEMAP":"",t.anisotropy?"#define USE_ANISOTROPY":"",t.anisotropyMap?"#define USE_ANISOTROPYMAP":"",t.clearcoat?"#define USE_CLEARCOAT":"",t.clearcoatMap?"#define USE_CLEARCOATMAP":"",t.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",t.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",t.iridescence?"#define USE_IRIDESCENCE":"",t.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",t.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",t.specularMap?"#define USE_SPECULARMAP":"",t.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",t.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",t.roughnessMap?"#define USE_ROUGHNESSMAP":"",t.metalnessMap?"#define USE_METALNESSMAP":"",t.alphaMap?"#define USE_ALPHAMAP":"",t.alphaTest?"#define USE_ALPHATEST":"",t.alphaHash?"#define USE_ALPHAHASH":"",t.sheen?"#define USE_SHEEN":"",t.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",t.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",t.transmission?"#define USE_TRANSMISSION":"",t.transmissionMap?"#define USE_TRANSMISSIONMAP":"",t.thicknessMap?"#define USE_THICKNESSMAP":"",t.vertexTangents&&!1===t.flatShading?"#define USE_TANGENT":"",t.vertexColors||t.instancingColor?"#define USE_COLOR":"",t.vertexAlphas?"#define USE_COLOR_ALPHA":"",t.vertexUv1s?"#define USE_UV1":"",t.vertexUv2s?"#define USE_UV2":"",t.vertexUv3s?"#define USE_UV3":"",t.pointsUvs?"#define USE_POINTS_UV":"",t.gradientMap?"#define USE_GRADIENTMAP":"",t.flatShading?"#define FLAT_SHADED":"",t.doubleSided?"#define DOUBLE_SIDED":"",t.flipSided?"#define FLIP_SIDED":"",t.shadowMapEnabled?"#define USE_SHADOWMAP":"",t.shadowMapEnabled?"#define "+c:"",t.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",t.numLightProbes>0?"#define USE_LIGHT_PROBES":"",t.useLegacyLights?"#define LEGACY_LIGHTS":"",t.decodeVideoTexture?"#define DECODE_VIDEO_TEXTURE":"",t.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",t.logarithmicDepthBuffer&&t.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",0!==t.toneMapping?"#define TONE_MAPPING":"",0!==t.toneMapping?Lt.tonemapping_pars_fragment:"",0!==t.toneMapping?o1e("toneMapping",t.toneMapping):"",t.dithering?"#define DITHERING":"",t.opaque?"#define OPAQUE":"",Lt.colorspace_pars_fragment,s1e("linearToOutputTexel",t.outputColorSpace),t.useDepthPacking?"#define DEPTH_PACKING "+t.depthPacking:"","\n"].filter(O_).join("\n")),o=ak(o),o=gK(o,t),o=_K(o,t),a=ak(a),a=gK(a,t),a=_K(a,t),o=yK(o),a=yK(a),t.isWebGL2&&!0!==t.isRawShaderMaterial&&(b="#version 300 es\n",_=["precision mediump sampler2DArray;","#define attribute in","#define varying out","#define texture2D texture"].join("\n")+"\n"+_,g=["precision mediump sampler2DArray;","#define varying in","300 es"===t.glslVersion?"":"layout(location = 0) out highp vec4 pc_fragColor;","300 es"===t.glslVersion?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join("\n")+"\n"+g);const x=b+g+a,M=pK(i,i.VERTEX_SHADER,b+_+o),C=pK(i,i.FRAGMENT_SHADER,x);function w(R){if(n.debug.checkShaderErrors){const F=i.getProgramInfoLog(y).trim(),N=i.getShaderInfoLog(M).trim(),H=i.getShaderInfoLog(C).trim();let K=!0,se=!0;if(!1===i.getProgramParameter(y,i.LINK_STATUS))if(K=!1,"function"==typeof n.debug.onShaderError)n.debug.onShaderError(i,y,M,C);else{const ne=mK(i,M,"vertex"),ye=mK(i,C,"fragment");console.error("THREE.WebGLProgram: Shader Error "+i.getError()+" - VALIDATE_STATUS "+i.getProgramParameter(y,i.VALIDATE_STATUS)+"\n\nProgram Info Log: "+F+"\n"+ne+"\n"+ye)}else""!==F?console.warn("THREE.WebGLProgram: Program Info Log:",F):(""===N||""===H)&&(se=!1);se&&(R.diagnostics={runnable:K,programLog:F,vertexShader:{log:N,prefix:_},fragmentShader:{log:H,prefix:g}})}i.deleteShader(M),i.deleteShader(C),A=new QT(i,y),T=function l1e(n,e){const t={},r=n.getProgramParameter(e,n.ACTIVE_ATTRIBUTES);for(let i=0;i<r;i++){const s=n.getActiveAttrib(e,i),o=s.name;let a=1;s.type===n.FLOAT_MAT2&&(a=2),s.type===n.FLOAT_MAT3&&(a=3),s.type===n.FLOAT_MAT4&&(a=4),t[o]={type:s.type,location:n.getAttribLocation(e,o),locationSize:a}}return t}(i,y)}let A,T;i.attachShader(y,M),i.attachShader(y,C),void 0!==t.index0AttributeName?i.bindAttribLocation(y,0,t.index0AttributeName):!0===t.morphTargets&&i.bindAttribLocation(y,0,"position"),i.linkProgram(y),this.getUniforms=function(){return void 0===A&&w(this),A},this.getAttributes=function(){return void 0===T&&w(this),T};let S=!1===t.rendererExtensionParallelShaderCompile;return this.isReady=function(){return!1===S&&(S=i.getProgramParameter(y,37297)),S},this.destroy=function(){r.releaseStatesOfProgram(this),i.deleteProgram(y),this.program=void 0},this.type=t.shaderType,this.name=t.shaderName,this.id=n1e++,this.cacheKey=e,this.usedTimes=1,this.program=y,this.vertexShader=M,this.fragmentShader=C,this}let b1e=0;class T1e{constructor(){this.shaderCache=new Map,this.materialCache=new Map}update(e){const r=e.fragmentShader,i=this._getShaderStage(e.vertexShader),s=this._getShaderStage(r),o=this._getShaderCacheForMaterial(e);return!1===o.has(i)&&(o.add(i),i.usedTimes++),!1===o.has(s)&&(o.add(s),s.usedTimes++),this}remove(e){const t=this.materialCache.get(e);for(const r of t)r.usedTimes--,0===r.usedTimes&&this.shaderCache.delete(r.code);return this.materialCache.delete(e),this}getVertexShaderID(e){return this._getShaderStage(e.vertexShader).id}getFragmentShaderID(e){return this._getShaderStage(e.fragmentShader).id}dispose(){this.shaderCache.clear(),this.materialCache.clear()}_getShaderCacheForMaterial(e){const t=this.materialCache;let r=t.get(e);return void 0===r&&(r=new Set,t.set(e,r)),r}_getShaderStage(e){const t=this.shaderCache;let r=t.get(e);return void 0===r&&(r=new w1e(e),t.set(e,r)),r}}class w1e{constructor(e){this.id=b1e++,this.code=e,this.usedTimes=0}}function I1e(n,e,t,r,i,s,o){const a=new GO,c=new T1e,l=[],u=i.isWebGL2,d=i.logarithmicDepthBuffer,h=i.vertexTextures;let f=i.precision;const m={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"};function y(T){return 0===T?"uv":`uv${T}`}return{getParameters:function _(T,S,R,F,N){const H=F.fog,K=N.geometry,ne=(T.isMeshStandardMaterial?t:e).get(T.envMap||(T.isMeshStandardMaterial?F.environment:null)),ye=ne&&306===ne.mapping?ne.image.height:null,ce=m[T.type];null!==T.precision&&(f=i.getMaxPrecision(T.precision),f!==T.precision&&console.warn("THREE.WebGLProgram.getParameters:",T.precision,"not supported, using",f,"instead."));const ge=K.morphAttributes.position||K.morphAttributes.normal||K.morphAttributes.color,G=void 0!==ge?ge.length:0;let Te,He,Ue,ut,ee=0;if(void 0!==K.morphAttributes.position&&(ee=1),void 0!==K.morphAttributes.normal&&(ee=2),void 0!==K.morphAttributes.color&&(ee=3),ce){const Jn=No[ce];Te=Jn.vertexShader,He=Jn.fragmentShader}else Te=T.vertexShader,He=T.fragmentShader,c.update(T),Ue=c.getVertexShaderID(T),ut=c.getFragmentShaderID(T);const it=n.getRenderTarget(),at=!0===N.isInstancedMesh,yt=!!T.map,st=!!ne,U=!!T.aoMap,De=!!T.lightMap,ie=!!T.bumpMap,ve=!!T.normalMap,he=!!T.displacementMap,Qe=!!T.emissiveMap,Le=!!T.metalnessMap,je=!!T.roughnessMap,dt=T.anisotropy>0,Nt=T.clearcoat>0,yn=T.iridescence>0,V=T.sheen>0,D=T.transmission>0,X=dt&&!!T.anisotropyMap,be=Nt&&!!T.clearcoatMap,le=Nt&&!!T.clearcoatNormalMap,pe=Nt&&!!T.clearcoatRoughnessMap,qe=yn&&!!T.iridescenceMap,xe=yn&&!!T.iridescenceThicknessMap,ke=V&&!!T.sheenColorMap,B=V&&!!T.sheenRoughnessMap,we=!!T.specularMap,de=!!T.specularColorMap,ht=!!T.specularIntensityMap,Ke=D&&!!T.transmissionMap,ot=D&&!!T.thicknessMap,We=!!T.alphaMap,Ce=!!T.extensions,_e=!!K.attributes.uv1,te=!!K.attributes.uv2,Ee=!!K.attributes.uv3;let nt=0;return T.toneMapped&&(null===it||!0===it.isXRRenderTarget)&&(nt=n.toneMapping),{isWebGL2:u,shaderID:ce,shaderType:T.type,shaderName:T.name,vertexShader:Te,fragmentShader:He,defines:T.defines,customVertexShaderID:Ue,customFragmentShaderID:ut,isRawShaderMaterial:!0===T.isRawShaderMaterial,glslVersion:T.glslVersion,precision:f,instancing:at,instancingColor:at&&null!==N.instanceColor,supportsVertexTextures:h,outputColorSpace:null===it?n.outputColorSpace:!0===it.isXRRenderTarget?it.texture.colorSpace:Sa,map:yt,matcap:!!T.matcap,envMap:st,envMapMode:st&&ne.mapping,envMapCubeUVHeight:ye,aoMap:U,lightMap:De,bumpMap:ie,normalMap:ve,displacementMap:h&&he,emissiveMap:Qe,normalMapObjectSpace:ve&&1===T.normalMapType,normalMapTangentSpace:ve&&0===T.normalMapType,metalnessMap:Le,roughnessMap:je,anisotropy:dt,anisotropyMap:X,clearcoat:Nt,clearcoatMap:be,clearcoatNormalMap:le,clearcoatRoughnessMap:pe,iridescence:yn,iridescenceMap:qe,iridescenceThicknessMap:xe,sheen:V,sheenColorMap:ke,sheenRoughnessMap:B,specularMap:we,specularColorMap:de,specularIntensityMap:ht,transmission:D,transmissionMap:Ke,thicknessMap:ot,gradientMap:!!T.gradientMap,opaque:!1===T.transparent&&1===T.blending,alphaMap:We,alphaTest:T.alphaTest>0,alphaHash:!!T.alphaHash,combine:T.combine,mapUv:yt&&y(T.map.channel),aoMapUv:U&&y(T.aoMap.channel),lightMapUv:De&&y(T.lightMap.channel),bumpMapUv:ie&&y(T.bumpMap.channel),normalMapUv:ve&&y(T.normalMap.channel),displacementMapUv:he&&y(T.displacementMap.channel),emissiveMapUv:Qe&&y(T.emissiveMap.channel),metalnessMapUv:Le&&y(T.metalnessMap.channel),roughnessMapUv:je&&y(T.roughnessMap.channel),anisotropyMapUv:X&&y(T.anisotropyMap.channel),clearcoatMapUv:be&&y(T.clearcoatMap.channel),clearcoatNormalMapUv:le&&y(T.clearcoatNormalMap.channel),clearcoatRoughnessMapUv:pe&&y(T.clearcoatRoughnessMap.channel),iridescenceMapUv:qe&&y(T.iridescenceMap.channel),iridescenceThicknessMapUv:xe&&y(T.iridescenceThicknessMap.channel),sheenColorMapUv:ke&&y(T.sheenColorMap.channel),sheenRoughnessMapUv:B&&y(T.sheenRoughnessMap.channel),specularMapUv:we&&y(T.specularMap.channel),specularColorMapUv:de&&y(T.specularColorMap.channel),specularIntensityMapUv:ht&&y(T.specularIntensityMap.channel),transmissionMapUv:Ke&&y(T.transmissionMap.channel),thicknessMapUv:ot&&y(T.thicknessMap.channel),alphaMapUv:We&&y(T.alphaMap.channel),vertexTangents:!!K.attributes.tangent&&(ve||dt),vertexColors:T.vertexColors,vertexAlphas:!0===T.vertexColors&&!!K.attributes.color&&4===K.attributes.color.itemSize,vertexUv1s:_e,vertexUv2s:te,vertexUv3s:Ee,pointsUvs:!0===N.isPoints&&!!K.attributes.uv&&(yt||We),fog:!!H,useFog:!0===T.fog,fogExp2:H&&H.isFogExp2,flatShading:!0===T.flatShading,sizeAttenuation:!0===T.sizeAttenuation,logarithmicDepthBuffer:d,skinning:!0===N.isSkinnedMesh,morphTargets:void 0!==K.morphAttributes.position,morphNormals:void 0!==K.morphAttributes.normal,morphColors:void 0!==K.morphAttributes.color,morphTargetsCount:G,morphTextureStride:ee,numDirLights:S.directional.length,numPointLights:S.point.length,numSpotLights:S.spot.length,numSpotLightMaps:S.spotLightMap.length,numRectAreaLights:S.rectArea.length,numHemiLights:S.hemi.length,numDirLightShadows:S.directionalShadowMap.length,numPointLightShadows:S.pointShadowMap.length,numSpotLightShadows:S.spotShadowMap.length,numSpotLightShadowsWithMaps:S.numSpotLightShadowsWithMaps,numLightProbes:S.numLightProbes,numClippingPlanes:o.numPlanes,numClipIntersection:o.numIntersection,dithering:T.dithering,shadowMapEnabled:n.shadowMap.enabled&&R.length>0,shadowMapType:n.shadowMap.type,toneMapping:nt,useLegacyLights:n._useLegacyLights,decodeVideoTexture:yt&&!0===T.map.isVideoTexture&&pn.getTransfer(T.map.colorSpace)===On,premultipliedAlpha:T.premultipliedAlpha,doubleSided:2===T.side,flipSided:1===T.side,useDepthPacking:T.depthPacking>=0,depthPacking:T.depthPacking||0,index0AttributeName:T.index0AttributeName,extensionDerivatives:Ce&&!0===T.extensions.derivatives,extensionFragDepth:Ce&&!0===T.extensions.fragDepth,extensionDrawBuffers:Ce&&!0===T.extensions.drawBuffers,extensionShaderTextureLOD:Ce&&!0===T.extensions.shaderTextureLOD,rendererExtensionFragDepth:u||r.has("EXT_frag_depth"),rendererExtensionDrawBuffers:u||r.has("WEBGL_draw_buffers"),rendererExtensionShaderTextureLod:u||r.has("EXT_shader_texture_lod"),rendererExtensionParallelShaderCompile:r.has("KHR_parallel_shader_compile"),customProgramCacheKey:T.customProgramCacheKey()}},getProgramCacheKey:function g(T){const S=[];if(T.shaderID?S.push(T.shaderID):(S.push(T.customVertexShaderID),S.push(T.customFragmentShaderID)),void 0!==T.defines)for(const R in T.defines)S.push(R),S.push(T.defines[R]);return!1===T.isRawShaderMaterial&&(function b(T,S){T.push(S.precision),T.push(S.outputColorSpace),T.push(S.envMapMode),T.push(S.envMapCubeUVHeight),T.push(S.mapUv),T.push(S.alphaMapUv),T.push(S.lightMapUv),T.push(S.aoMapUv),T.push(S.bumpMapUv),T.push(S.normalMapUv),T.push(S.displacementMapUv),T.push(S.emissiveMapUv),T.push(S.metalnessMapUv),T.push(S.roughnessMapUv),T.push(S.anisotropyMapUv),T.push(S.clearcoatMapUv),T.push(S.clearcoatNormalMapUv),T.push(S.clearcoatRoughnessMapUv),T.push(S.iridescenceMapUv),T.push(S.iridescenceThicknessMapUv),T.push(S.sheenColorMapUv),T.push(S.sheenRoughnessMapUv),T.push(S.specularMapUv),T.push(S.specularColorMapUv),T.push(S.specularIntensityMapUv),T.push(S.transmissionMapUv),T.push(S.thicknessMapUv),T.push(S.combine),T.push(S.fogExp2),T.push(S.sizeAttenuation),T.push(S.morphTargetsCount),T.push(S.morphAttributeCount),T.push(S.numDirLights),T.push(S.numPointLights),T.push(S.numSpotLights),T.push(S.numSpotLightMaps),T.push(S.numHemiLights),T.push(S.numRectAreaLights),T.push(S.numDirLightShadows),T.push(S.numPointLightShadows),T.push(S.numSpotLightShadows),T.push(S.numSpotLightShadowsWithMaps),T.push(S.numLightProbes),T.push(S.shadowMapType),T.push(S.toneMapping),T.push(S.numClippingPlanes),T.push(S.numClipIntersection),T.push(S.depthPacking)}(S,T),function E(T,S){a.disableAll(),S.isWebGL2&&a.enable(0),S.supportsVertexTextures&&a.enable(1),S.instancing&&a.enable(2),S.instancingColor&&a.enable(3),S.matcap&&a.enable(4),S.envMap&&a.enable(5),S.normalMapObjectSpace&&a.enable(6),S.normalMapTangentSpace&&a.enable(7),S.clearcoat&&a.enable(8),S.iridescence&&a.enable(9),S.alphaTest&&a.enable(10),S.vertexColors&&a.enable(11),S.vertexAlphas&&a.enable(12),S.vertexUv1s&&a.enable(13),S.vertexUv2s&&a.enable(14),S.vertexUv3s&&a.enable(15),S.vertexTangents&&a.enable(16),S.anisotropy&&a.enable(17),S.alphaHash&&a.enable(18),T.push(a.mask),a.disableAll(),S.fog&&a.enable(0),S.useFog&&a.enable(1),S.flatShading&&a.enable(2),S.logarithmicDepthBuffer&&a.enable(3),S.skinning&&a.enable(4),S.morphTargets&&a.enable(5),S.morphNormals&&a.enable(6),S.morphColors&&a.enable(7),S.premultipliedAlpha&&a.enable(8),S.shadowMapEnabled&&a.enable(9),S.useLegacyLights&&a.enable(10),S.doubleSided&&a.enable(11),S.flipSided&&a.enable(12),S.useDepthPacking&&a.enable(13),S.dithering&&a.enable(14),S.transmission&&a.enable(15),S.sheen&&a.enable(16),S.opaque&&a.enable(17),S.pointsUvs&&a.enable(18),S.decodeVideoTexture&&a.enable(19),T.push(a.mask)}(S,T),S.push(n.outputColorSpace)),S.push(T.customProgramCacheKey),S.join()},getUniforms:function x(T){const S=m[T.type];let R;return R=S?GMe.clone(No[S].uniforms):T.uniforms,R},acquireProgram:function M(T,S){let R;for(let F=0,N=l.length;F<N;F++){const H=l[F];if(H.cacheKey===S){R=H,++R.usedTimes;break}}return void 0===R&&(R=new E1e(n,S,T,s),l.push(R)),R},releaseProgram:function C(T){if(0===--T.usedTimes){const S=l.indexOf(T);l[S]=l[l.length-1],l.pop(),T.destroy()}},releaseShaderCache:function w(T){c.remove(T)},programs:l,dispose:function A(){c.dispose()}}}function S1e(){let n=new WeakMap;return{get:function e(s){let o=n.get(s);return void 0===o&&(o={},n.set(s,o)),o},remove:function t(s){n.delete(s)},update:function r(s,o,a){n.get(s)[o]=a},dispose:function i(){n=new WeakMap}}}function x1e(n,e){return n.groupOrder!==e.groupOrder?n.groupOrder-e.groupOrder:n.renderOrder!==e.renderOrder?n.renderOrder-e.renderOrder:n.material.id!==e.material.id?n.material.id-e.material.id:n.z!==e.z?n.z-e.z:n.id-e.id}function EK(n,e){return n.groupOrder!==e.groupOrder?n.groupOrder-e.groupOrder:n.renderOrder!==e.renderOrder?n.renderOrder-e.renderOrder:n.z!==e.z?e.z-n.z:n.id-e.id}function bK(){const n=[];let e=0;const t=[],r=[],i=[];function o(d,h,f,m,y,_){let g=n[e];return void 0===g?(g={id:d.id,object:d,geometry:h,material:f,groupOrder:m,renderOrder:d.renderOrder,z:y,group:_},n[e]=g):(g.id=d.id,g.object=d,g.geometry=h,g.material=f,g.groupOrder=m,g.renderOrder=d.renderOrder,g.z=y,g.group=_),e++,g}return{opaque:t,transmissive:r,transparent:i,init:function s(){e=0,t.length=0,r.length=0,i.length=0},push:function a(d,h,f,m,y,_){const g=o(d,h,f,m,y,_);f.transmission>0?r.push(g):!0===f.transparent?i.push(g):t.push(g)},unshift:function c(d,h,f,m,y,_){const g=o(d,h,f,m,y,_);f.transmission>0?r.unshift(g):!0===f.transparent?i.unshift(g):t.unshift(g)},finish:function u(){for(let d=e,h=n.length;d<h;d++){const f=n[d];if(null===f.id)break;f.id=null,f.object=null,f.geometry=null,f.material=null,f.group=null}},sort:function l(d,h){t.length>1&&t.sort(d||x1e),r.length>1&&r.sort(h||EK),i.length>1&&i.sort(h||EK)}}}function A1e(){let n=new WeakMap;return{get:function e(r,i){const s=n.get(r);let o;return void 0===s?(o=new bK,n.set(r,[o])):i>=s.length?(o=new bK,s.push(o)):o=s[i],o},dispose:function t(){n=new WeakMap}}}function M1e(){const n={};return{get:function(e){if(void 0!==n[e.id])return n[e.id];let t;switch(e.type){case"DirectionalLight":t={direction:new L,color:new Ge};break;case"SpotLight":t={position:new L,direction:new L,color:new Ge,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":t={position:new L,color:new Ge,distance:0,decay:0};break;case"HemisphereLight":t={direction:new L,skyColor:new Ge,groundColor:new Ge};break;case"RectAreaLight":t={color:new Ge,position:new L,halfWidth:new L,halfHeight:new L}}return n[e.id]=t,t}}}let D1e=0;function R1e(n,e){return(e.castShadow?2:0)-(n.castShadow?2:0)+(e.map?1:0)-(n.map?1:0)}function P1e(n,e){const t=new M1e,r=function C1e(){const n={};return{get:function(e){if(void 0!==n[e.id])return n[e.id];let t;switch(e.type){case"DirectionalLight":case"SpotLight":t={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new oe};break;case"PointLight":t={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new oe,shadowCameraNear:1,shadowCameraFar:1e3}}return n[e.id]=t,t}}}(),i={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1,numSpotMaps:-1,numLightProbes:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotLightMap:[],spotShadow:[],spotShadowMap:[],spotLightMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[],numSpotLightShadowsWithMaps:0,numLightProbes:0};for(let u=0;u<9;u++)i.probe.push(new L);const s=new L,o=new Pt,a=new Pt;return{setup:function c(u,d){let h=0,f=0,m=0;for(let F=0;F<9;F++)i.probe[F].set(0,0,0);let y=0,_=0,g=0,b=0,E=0,x=0,M=0,C=0,w=0,A=0,T=0;u.sort(R1e);const S=!0===d?Math.PI:1;for(let F=0,N=u.length;F<N;F++){const H=u[F],K=H.color,se=H.intensity,ne=H.distance,ye=H.shadow&&H.shadow.map?H.shadow.map.texture:null;if(H.isAmbientLight)h+=K.r*se*S,f+=K.g*se*S,m+=K.b*se*S;else if(H.isLightProbe){for(let ce=0;ce<9;ce++)i.probe[ce].addScaledVector(H.sh.coefficients[ce],se);T++}else if(H.isDirectionalLight){const ce=t.get(H);if(ce.color.copy(H.color).multiplyScalar(H.intensity*S),H.castShadow){const ge=H.shadow,G=r.get(H);G.shadowBias=ge.bias,G.shadowNormalBias=ge.normalBias,G.shadowRadius=ge.radius,G.shadowMapSize=ge.mapSize,i.directionalShadow[y]=G,i.directionalShadowMap[y]=ye,i.directionalShadowMatrix[y]=H.shadow.matrix,x++}i.directional[y]=ce,y++}else if(H.isSpotLight){const ce=t.get(H);ce.position.setFromMatrixPosition(H.matrixWorld),ce.color.copy(K).multiplyScalar(se*S),ce.distance=ne,ce.coneCos=Math.cos(H.angle),ce.penumbraCos=Math.cos(H.angle*(1-H.penumbra)),ce.decay=H.decay,i.spot[g]=ce;const ge=H.shadow;if(H.map&&(i.spotLightMap[w]=H.map,w++,ge.updateMatrices(H),H.castShadow&&A++),i.spotLightMatrix[g]=ge.matrix,H.castShadow){const G=r.get(H);G.shadowBias=ge.bias,G.shadowNormalBias=ge.normalBias,G.shadowRadius=ge.radius,G.shadowMapSize=ge.mapSize,i.spotShadow[g]=G,i.spotShadowMap[g]=ye,C++}g++}else if(H.isRectAreaLight){const ce=t.get(H);ce.color.copy(K).multiplyScalar(se),ce.halfWidth.set(.5*H.width,0,0),ce.halfHeight.set(0,.5*H.height,0),i.rectArea[b]=ce,b++}else if(H.isPointLight){const ce=t.get(H);if(ce.color.copy(H.color).multiplyScalar(H.intensity*S),ce.distance=H.distance,ce.decay=H.decay,H.castShadow){const ge=H.shadow,G=r.get(H);G.shadowBias=ge.bias,G.shadowNormalBias=ge.normalBias,G.shadowRadius=ge.radius,G.shadowMapSize=ge.mapSize,G.shadowCameraNear=ge.camera.near,G.shadowCameraFar=ge.camera.far,i.pointShadow[_]=G,i.pointShadowMap[_]=ye,i.pointShadowMatrix[_]=H.shadow.matrix,M++}i.point[_]=ce,_++}else if(H.isHemisphereLight){const ce=t.get(H);ce.skyColor.copy(H.color).multiplyScalar(se*S),ce.groundColor.copy(H.groundColor).multiplyScalar(se*S),i.hemi[E]=ce,E++}}b>0&&(e.isWebGL2||!0===n.has("OES_texture_float_linear")?(i.rectAreaLTC1=Oe.LTC_FLOAT_1,i.rectAreaLTC2=Oe.LTC_FLOAT_2):!0===n.has("OES_texture_half_float_linear")?(i.rectAreaLTC1=Oe.LTC_HALF_1,i.rectAreaLTC2=Oe.LTC_HALF_2):console.error("THREE.WebGLRenderer: Unable to use RectAreaLight. Missing WebGL extensions.")),i.ambient[0]=h,i.ambient[1]=f,i.ambient[2]=m;const R=i.hash;(R.directionalLength!==y||R.pointLength!==_||R.spotLength!==g||R.rectAreaLength!==b||R.hemiLength!==E||R.numDirectionalShadows!==x||R.numPointShadows!==M||R.numSpotShadows!==C||R.numSpotMaps!==w||R.numLightProbes!==T)&&(i.directional.length=y,i.spot.length=g,i.rectArea.length=b,i.point.length=_,i.hemi.length=E,i.directionalShadow.length=x,i.directionalShadowMap.length=x,i.pointShadow.length=M,i.pointShadowMap.length=M,i.spotShadow.length=C,i.spotShadowMap.length=C,i.directionalShadowMatrix.length=x,i.pointShadowMatrix.length=M,i.spotLightMatrix.length=C+w-A,i.spotLightMap.length=w,i.numSpotLightShadowsWithMaps=A,i.numLightProbes=T,R.directionalLength=y,R.pointLength=_,R.spotLength=g,R.rectAreaLength=b,R.hemiLength=E,R.numDirectionalShadows=x,R.numPointShadows=M,R.numSpotShadows=C,R.numSpotMaps=w,R.numLightProbes=T,i.version=D1e++)},setupView:function l(u,d){let h=0,f=0,m=0,y=0,_=0;const g=d.matrixWorldInverse;for(let b=0,E=u.length;b<E;b++){const x=u[b];if(x.isDirectionalLight){const M=i.directional[h];M.direction.setFromMatrixPosition(x.matrixWorld),s.setFromMatrixPosition(x.target.matrixWorld),M.direction.sub(s),M.direction.transformDirection(g),h++}else if(x.isSpotLight){const M=i.spot[m];M.position.setFromMatrixPosition(x.matrixWorld),M.position.applyMatrix4(g),M.direction.setFromMatrixPosition(x.matrixWorld),s.setFromMatrixPosition(x.target.matrixWorld),M.direction.sub(s),M.direction.transformDirection(g),m++}else if(x.isRectAreaLight){const M=i.rectArea[y];M.position.setFromMatrixPosition(x.matrixWorld),M.position.applyMatrix4(g),a.identity(),o.copy(x.matrixWorld),o.premultiply(g),a.extractRotation(o),M.halfWidth.set(.5*x.width,0,0),M.halfHeight.set(0,.5*x.height,0),M.halfWidth.applyMatrix4(a),M.halfHeight.applyMatrix4(a),y++}else if(x.isPointLight){const M=i.point[f];M.position.setFromMatrixPosition(x.matrixWorld),M.position.applyMatrix4(g),f++}else if(x.isHemisphereLight){const M=i.hemi[_];M.direction.setFromMatrixPosition(x.matrixWorld),M.direction.transformDirection(g),_++}}},state:i}}function TK(n,e){const t=new P1e(n,e),r=[],i=[];return{init:function s(){r.length=0,i.length=0},state:{lightsArray:r,shadowsArray:i,lights:t},setupLights:function c(d){t.setup(r,d)},setupLightsView:function l(d){t.setupView(r,d)},pushLight:function o(d){r.push(d)},pushShadow:function a(d){i.push(d)}}}function N1e(n,e){let t=new WeakMap;return{get:function r(s,o=0){const a=t.get(s);let c;return void 0===a?(c=new TK(n,e),t.set(s,[c])):o>=a.length?(c=new TK(n,e),a.push(c)):c=a[o],c},dispose:function i(){t=new WeakMap}}}class wK extends Ni{constructor(e){super(),this.isMeshDepthMaterial=!0,this.type="MeshDepthMaterial",this.depthPacking=3200,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.setValues(e)}copy(e){return super.copy(e),this.depthPacking=e.depthPacking,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this}}class IK extends Ni{constructor(e){super(),this.isMeshDistanceMaterial=!0,this.type="MeshDistanceMaterial",this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.setValues(e)}copy(e){return super.copy(e),this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this}}function L1e(n,e,t){let r=new QO;const i=new oe,s=new oe,o=new mn,a=new wK({depthPacking:3201}),c=new IK,l={},u=t.maxTextureSize,d={[Gc]:1,[Zi]:0,[wa]:2},h=new Oa({defines:{VSM_SAMPLES:8},uniforms:{shadow_pass:{value:null},resolution:{value:new oe},radius:{value:4}},vertexShader:"void main() {\n\tgl_Position = vec4( position, 1.0 );\n}",fragmentShader:"uniform sampler2D shadow_pass;\nuniform vec2 resolution;\nuniform float radius;\n#include <packing>\nvoid main() {\n\tconst float samples = float( VSM_SAMPLES );\n\tfloat mean = 0.0;\n\tfloat squared_mean = 0.0;\n\tfloat uvStride = samples <= 1.0 ? 0.0 : 2.0 / ( samples - 1.0 );\n\tfloat uvStart = samples <= 1.0 ? 0.0 : - 1.0;\n\tfor ( float i = 0.0; i < samples; i ++ ) {\n\t\tfloat uvOffset = uvStart + i * uvStride;\n\t\t#ifdef HORIZONTAL_PASS\n\t\t\tvec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( uvOffset, 0.0 ) * radius ) / resolution ) );\n\t\t\tmean += distribution.x;\n\t\t\tsquared_mean += distribution.y * distribution.y + distribution.x * distribution.x;\n\t\t#else\n\t\t\tfloat depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, uvOffset ) * radius ) / resolution ) );\n\t\t\tmean += depth;\n\t\t\tsquared_mean += depth * depth;\n\t\t#endif\n\t}\n\tmean = mean / samples;\n\tsquared_mean = squared_mean / samples;\n\tfloat std_dev = sqrt( squared_mean - mean * mean );\n\tgl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );\n}"}),f=h.clone();f.defines.HORIZONTAL_PASS=1;const m=new Bt;m.setAttribute("position",new xn(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));const y=new mr(m,h),_=this;this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=1;let g=this.type;function b(M,C){const w=e.update(y);h.defines.VSM_SAMPLES!==M.blurSamples&&(h.defines.VSM_SAMPLES=M.blurSamples,f.defines.VSM_SAMPLES=M.blurSamples,h.needsUpdate=!0,f.needsUpdate=!0),null===M.mapPass&&(M.mapPass=new Do(i.x,i.y)),h.uniforms.shadow_pass.value=M.map.texture,h.uniforms.resolution.value=M.mapSize,h.uniforms.radius.value=M.radius,n.setRenderTarget(M.mapPass),n.clear(),n.renderBufferDirect(C,null,w,h,y,null),f.uniforms.shadow_pass.value=M.mapPass.texture,f.uniforms.resolution.value=M.mapSize,f.uniforms.radius.value=M.radius,n.setRenderTarget(M.map),n.clear(),n.renderBufferDirect(C,null,w,f,y,null)}function E(M,C,w,A){let T=null;const S=!0===w.isPointLight?M.customDistanceMaterial:M.customDepthMaterial;if(void 0!==S)T=S;else if(T=!0===w.isPointLight?c:a,n.localClippingEnabled&&!0===C.clipShadows&&Array.isArray(C.clippingPlanes)&&0!==C.clippingPlanes.length||C.displacementMap&&0!==C.displacementScale||C.alphaMap&&C.alphaTest>0||C.map&&C.alphaTest>0){const R=T.uuid,F=C.uuid;let N=l[R];void 0===N&&(N={},l[R]=N);let H=N[F];void 0===H&&(H=T.clone(),N[F]=H),T=H}return T.visible=C.visible,T.wireframe=C.wireframe,T.side=3===A?null!==C.shadowSide?C.shadowSide:C.side:null!==C.shadowSide?C.shadowSide:d[C.side],T.alphaMap=C.alphaMap,T.alphaTest=C.alphaTest,T.map=C.map,T.clipShadows=C.clipShadows,T.clippingPlanes=C.clippingPlanes,T.clipIntersection=C.clipIntersection,T.displacementMap=C.displacementMap,T.displacementScale=C.displacementScale,T.displacementBias=C.displacementBias,T.wireframeLinewidth=C.wireframeLinewidth,T.linewidth=C.linewidth,!0===w.isPointLight&&!0===T.isMeshDistanceMaterial&&(n.properties.get(T).light=w),T}function x(M,C,w,A,T){if(!1===M.visible)return;if(M.layers.test(C.layers)&&(M.isMesh||M.isLine||M.isPoints)&&(M.castShadow||M.receiveShadow&&3===T)&&(!M.frustumCulled||r.intersectsObject(M))){M.modelViewMatrix.multiplyMatrices(w.matrixWorldInverse,M.matrixWorld);const F=e.update(M),N=M.material;if(Array.isArray(N)){const H=F.groups;for(let K=0,se=H.length;K<se;K++){const ne=H[K],ye=N[ne.materialIndex];if(ye&&ye.visible){const ce=E(M,ye,A,T);n.renderBufferDirect(w,null,F,ce,M,ne)}}}else if(N.visible){const H=E(M,N,A,T);n.renderBufferDirect(w,null,F,H,M,null)}}const R=M.children;for(let F=0,N=R.length;F<N;F++)x(R[F],C,w,A,T)}this.render=function(M,C,w){if(!1===_.enabled||!1===_.autoUpdate&&!1===_.needsUpdate||0===M.length)return;const A=n.getRenderTarget(),T=n.getActiveCubeFace(),S=n.getActiveMipmapLevel(),R=n.state;R.setBlending(0),R.buffers.color.setClear(1,1,1,1),R.buffers.depth.setTest(!0),R.setScissorTest(!1);const F=3!==g&&3===this.type,N=3===g&&3!==this.type;for(let H=0,K=M.length;H<K;H++){const se=M[H],ne=se.shadow;if(void 0===ne){console.warn("THREE.WebGLShadowMap:",se,"has no shadow.");continue}if(!1===ne.autoUpdate&&!1===ne.needsUpdate)continue;i.copy(ne.mapSize);const ye=ne.getFrameExtents();if(i.multiply(ye),s.copy(ne.mapSize),(i.x>u||i.y>u)&&(i.x>u&&(s.x=Math.floor(u/ye.x),i.x=s.x*ye.x,ne.mapSize.x=s.x),i.y>u&&(s.y=Math.floor(u/ye.y),i.y=s.y*ye.y,ne.mapSize.y=s.y)),null===ne.map||!0===F||!0===N){const ge=3!==this.type?{minFilter:Ar,magFilter:Ar}:{};null!==ne.map&&ne.map.dispose(),ne.map=new Do(i.x,i.y,ge),ne.map.texture.name=se.name+".shadowMap",ne.camera.updateProjectionMatrix()}n.setRenderTarget(ne.map),n.clear();const ce=ne.getViewportCount();for(let ge=0;ge<ce;ge++){const G=ne.getViewport(ge);o.set(s.x*G.x,s.y*G.y,s.x*G.z,s.y*G.w),R.viewport(o),ne.updateMatrices(se,ge),r=ne.getFrustum(),x(C,w,ne.camera,se,this.type)}!0!==ne.isPointLightShadow&&3===this.type&&b(ne,w),ne.needsUpdate=!1}g=this.type,_.needsUpdate=!1,n.setRenderTarget(A,T,S)}}function F1e(n,e,t){const r=t.isWebGL2,a=new function i(){let z=!1;const Ce=new mn;let _e=null;const te=new mn(0,0,0,0);return{setMask:function(Ee){_e!==Ee&&!z&&(n.colorMask(Ee,Ee,Ee,Ee),_e=Ee)},setLocked:function(Ee){z=Ee},setClear:function(Ee,nt,kt,Jn,qr){!0===qr&&(Ee*=Jn,nt*=Jn,kt*=Jn),Ce.set(Ee,nt,kt,Jn),!1===te.equals(Ce)&&(n.clearColor(Ee,nt,kt,Jn),te.copy(Ce))},reset:function(){z=!1,_e=null,te.set(-1,0,0,0)}}},c=new function s(){let z=!1,Ce=null,_e=null,te=null;return{setTest:function(Ee){Ee?yt(n.DEPTH_TEST):Ft(n.DEPTH_TEST)},setMask:function(Ee){Ce!==Ee&&!z&&(n.depthMask(Ee),Ce=Ee)},setFunc:function(Ee){if(_e!==Ee){switch(Ee){case 0:n.depthFunc(n.NEVER);break;case 1:n.depthFunc(n.ALWAYS);break;case 2:n.depthFunc(n.LESS);break;case 3:default:n.depthFunc(n.LEQUAL);break;case 4:n.depthFunc(n.EQUAL);break;case 5:n.depthFunc(n.GEQUAL);break;case 6:n.depthFunc(n.GREATER);break;case 7:n.depthFunc(n.NOTEQUAL)}_e=Ee}},setLocked:function(Ee){z=Ee},setClear:function(Ee){te!==Ee&&(n.clearDepth(Ee),te=Ee)},reset:function(){z=!1,Ce=null,_e=null,te=null}}},l=new function o(){let z=!1,Ce=null,_e=null,te=null,Ee=null,nt=null,kt=null,Jn=null,qr=null;return{setTest:function(cn){z||(cn?yt(n.STENCIL_TEST):Ft(n.STENCIL_TEST))},setMask:function(cn){Ce!==cn&&!z&&(n.stencilMask(cn),Ce=cn)},setFunc:function(cn,en,bs){(_e!==cn||te!==en||Ee!==bs)&&(n.stencilFunc(cn,en,bs),_e=cn,te=en,Ee=bs)},setOp:function(cn,en,bs){(nt!==cn||kt!==en||Jn!==bs)&&(n.stencilOp(cn,en,bs),nt=cn,kt=en,Jn=bs)},setLocked:function(cn){z=cn},setClear:function(cn){qr!==cn&&(n.clearStencil(cn),qr=cn)},reset:function(){z=!1,Ce=null,_e=null,te=null,Ee=null,nt=null,kt=null,Jn=null,qr=null}}},u=new WeakMap,d=new WeakMap;let h={},f={},m=new WeakMap,y=[],_=null,g=!1,b=null,E=null,x=null,M=null,C=null,w=null,A=null,T=new Ge(0,0,0),S=0,R=!1,F=null,N=null,H=null,K=null,se=null;const ne=n.getParameter(n.MAX_COMBINED_TEXTURE_IMAGE_UNITS);let ye=!1,ce=0;const ge=n.getParameter(n.VERSION);-1!==ge.indexOf("WebGL")?(ce=parseFloat(/^WebGL (\d)/.exec(ge)[1]),ye=ce>=1):-1!==ge.indexOf("OpenGL ES")&&(ce=parseFloat(/^OpenGL ES (\d)/.exec(ge)[1]),ye=ce>=2);let G=null,ee={};const Te=n.getParameter(n.SCISSOR_BOX),He=n.getParameter(n.VIEWPORT),Ue=(new mn).fromArray(Te),ut=(new mn).fromArray(He);function it(z,Ce,_e,te){const Ee=new Uint8Array(4),nt=n.createTexture();n.bindTexture(z,nt),n.texParameteri(z,n.TEXTURE_MIN_FILTER,n.NEAREST),n.texParameteri(z,n.TEXTURE_MAG_FILTER,n.NEAREST);for(let kt=0;kt<_e;kt++)!r||z!==n.TEXTURE_3D&&z!==n.TEXTURE_2D_ARRAY?n.texImage2D(Ce+kt,0,n.RGBA,1,1,0,n.RGBA,n.UNSIGNED_BYTE,Ee):n.texImage3D(Ce,0,n.RGBA,1,1,te,0,n.RGBA,n.UNSIGNED_BYTE,Ee);return nt}const at={};function yt(z){!0!==h[z]&&(n.enable(z),h[z]=!0)}function Ft(z){!1!==h[z]&&(n.disable(z),h[z]=!1)}at[n.TEXTURE_2D]=it(n.TEXTURE_2D,n.TEXTURE_2D,1),at[n.TEXTURE_CUBE_MAP]=it(n.TEXTURE_CUBE_MAP,n.TEXTURE_CUBE_MAP_POSITIVE_X,6),r&&(at[n.TEXTURE_2D_ARRAY]=it(n.TEXTURE_2D_ARRAY,n.TEXTURE_2D_ARRAY,1,1),at[n.TEXTURE_3D]=it(n.TEXTURE_3D,n.TEXTURE_3D,1,1)),a.setClear(0,0,0,1),c.setClear(1),l.setClear(0),yt(n.DEPTH_TEST),c.setFunc(3),Le(!1),je(1),yt(n.CULL_FACE),he(0);const ie={[Ru]:n.FUNC_ADD,[uAe]:n.FUNC_SUBTRACT,[dAe]:n.FUNC_REVERSE_SUBTRACT};if(r)ie[103]=n.MIN,ie[104]=n.MAX;else{const z=e.get("EXT_blend_minmax");null!==z&&(ie[103]=z.MIN_EXT,ie[104]=z.MAX_EXT)}const ve={[hAe]:n.ZERO,[fAe]:n.ONE,[pAe]:n.SRC_COLOR,[_O]:n.SRC_ALPHA,[EAe]:n.SRC_ALPHA_SATURATE,[yAe]:n.DST_COLOR,[gAe]:n.DST_ALPHA,[mAe]:n.ONE_MINUS_SRC_COLOR,[yO]:n.ONE_MINUS_SRC_ALPHA,[vAe]:n.ONE_MINUS_DST_COLOR,[_Ae]:n.ONE_MINUS_DST_ALPHA,[bAe]:n.CONSTANT_COLOR,[TAe]:n.ONE_MINUS_CONSTANT_COLOR,[wAe]:n.CONSTANT_ALPHA,[IAe]:n.ONE_MINUS_CONSTANT_ALPHA};function he(z,Ce,_e,te,Ee,nt,kt,Jn,qr,cn){if(0!==z){if(!1===g&&(yt(n.BLEND),g=!0),5===z)Ee=Ee||Ce,nt=nt||_e,kt=kt||te,(Ce!==E||Ee!==C)&&(n.blendEquationSeparate(ie[Ce],ie[Ee]),E=Ce,C=Ee),(_e!==x||te!==M||nt!==w||kt!==A)&&(n.blendFuncSeparate(ve[_e],ve[te],ve[nt],ve[kt]),x=_e,M=te,w=nt,A=kt),(!1===Jn.equals(T)||qr!==S)&&(n.blendColor(Jn.r,Jn.g,Jn.b,qr),T.copy(Jn),S=qr),b=z,R=!1;else if(z!==b||cn!==R){if((100!==E||100!==C)&&(n.blendEquation(n.FUNC_ADD),E=100,C=100),cn)switch(z){case 1:n.blendFuncSeparate(n.ONE,n.ONE_MINUS_SRC_ALPHA,n.ONE,n.ONE_MINUS_SRC_ALPHA);break;case 2:n.blendFunc(n.ONE,n.ONE);break;case 3:n.blendFuncSeparate(n.ZERO,n.ONE_MINUS_SRC_COLOR,n.ZERO,n.ONE);break;case 4:n.blendFuncSeparate(n.ZERO,n.SRC_COLOR,n.ZERO,n.SRC_ALPHA);break;default:console.error("THREE.WebGLState: Invalid blending: ",z)}else switch(z){case 1:n.blendFuncSeparate(n.SRC_ALPHA,n.ONE_MINUS_SRC_ALPHA,n.ONE,n.ONE_MINUS_SRC_ALPHA);break;case 2:n.blendFunc(n.SRC_ALPHA,n.ONE);break;case 3:n.blendFuncSeparate(n.ZERO,n.ONE_MINUS_SRC_COLOR,n.ZERO,n.ONE);break;case 4:n.blendFunc(n.ZERO,n.SRC_COLOR);break;default:console.error("THREE.WebGLState: Invalid blending: ",z)}x=null,M=null,w=null,A=null,T.set(0,0,0),S=0,b=z,R=cn}}else!0===g&&(Ft(n.BLEND),g=!1)}function Le(z){F!==z&&(n.frontFace(z?n.CW:n.CCW),F=z)}function je(z){0!==z?(yt(n.CULL_FACE),z!==N&&n.cullFace(1===z?n.BACK:2===z?n.FRONT:n.FRONT_AND_BACK)):Ft(n.CULL_FACE),N=z}function Nt(z,Ce,_e){z?(yt(n.POLYGON_OFFSET_FILL),(K!==Ce||se!==_e)&&(n.polygonOffset(Ce,_e),K=Ce,se=_e)):Ft(n.POLYGON_OFFSET_FILL)}return{buffers:{color:a,depth:c,stencil:l},enable:yt,disable:Ft,bindFramebuffer:function st(z,Ce){return f[z]!==Ce&&(n.bindFramebuffer(z,Ce),f[z]=Ce,r&&(z===n.DRAW_FRAMEBUFFER&&(f[n.FRAMEBUFFER]=Ce),z===n.FRAMEBUFFER&&(f[n.DRAW_FRAMEBUFFER]=Ce)),!0)},drawBuffers:function U(z,Ce){let _e=y,te=!1;if(z)if(_e=m.get(Ce),void 0===_e&&(_e=[],m.set(Ce,_e)),z.isWebGLMultipleRenderTargets){const Ee=z.texture;if(_e.length!==Ee.length||_e[0]!==n.COLOR_ATTACHMENT0){for(let nt=0,kt=Ee.length;nt<kt;nt++)_e[nt]=n.COLOR_ATTACHMENT0+nt;_e.length=Ee.length,te=!0}}else _e[0]!==n.COLOR_ATTACHMENT0&&(_e[0]=n.COLOR_ATTACHMENT0,te=!0);else _e[0]!==n.BACK&&(_e[0]=n.BACK,te=!0);te&&(t.isWebGL2?n.drawBuffers(_e):e.get("WEBGL_draw_buffers").drawBuffersWEBGL(_e))},useProgram:function De(z){return _!==z&&(n.useProgram(z),_=z,!0)},setBlending:he,setMaterial:function Qe(z,Ce){2===z.side?Ft(n.CULL_FACE):yt(n.CULL_FACE);let _e=1===z.side;Ce&&(_e=!_e),Le(_e),1===z.blending&&!1===z.transparent?he(0):he(z.blending,z.blendEquation,z.blendSrc,z.blendDst,z.blendEquationAlpha,z.blendSrcAlpha,z.blendDstAlpha,z.blendColor,z.blendAlpha,z.premultipliedAlpha),c.setFunc(z.depthFunc),c.setTest(z.depthTest),c.setMask(z.depthWrite),a.setMask(z.colorWrite);const te=z.stencilWrite;l.setTest(te),te&&(l.setMask(z.stencilWriteMask),l.setFunc(z.stencilFunc,z.stencilRef,z.stencilFuncMask),l.setOp(z.stencilFail,z.stencilZFail,z.stencilZPass)),Nt(z.polygonOffset,z.polygonOffsetFactor,z.polygonOffsetUnits),!0===z.alphaToCoverage?yt(n.SAMPLE_ALPHA_TO_COVERAGE):Ft(n.SAMPLE_ALPHA_TO_COVERAGE)},setFlipSided:Le,setCullFace:je,setLineWidth:function dt(z){z!==H&&(ye&&n.lineWidth(z),H=z)},setPolygonOffset:Nt,setScissorTest:function yn(z){z?yt(n.SCISSOR_TEST):Ft(n.SCISSOR_TEST)},activeTexture:function V(z){void 0===z&&(z=n.TEXTURE0+ne-1),G!==z&&(n.activeTexture(z),G=z)},bindTexture:function D(z,Ce,_e){void 0===_e&&(_e=null===G?n.TEXTURE0+ne-1:G);let te=ee[_e];void 0===te&&(te={type:void 0,texture:void 0},ee[_e]=te),(te.type!==z||te.texture!==Ce)&&(G!==_e&&(n.activeTexture(_e),G=_e),n.bindTexture(z,Ce||at[z]),te.type=z,te.texture=Ce)},unbindTexture:function X(){const z=ee[G];void 0!==z&&void 0!==z.type&&(n.bindTexture(z.type,null),z.type=void 0,z.texture=void 0)},compressedTexImage2D:function be(){try{n.compressedTexImage2D.apply(n,arguments)}catch(z){console.error("THREE.WebGLState:",z)}},compressedTexImage3D:function le(){try{n.compressedTexImage3D.apply(n,arguments)}catch(z){console.error("THREE.WebGLState:",z)}},texImage2D:function de(){try{n.texImage2D.apply(n,arguments)}catch(z){console.error("THREE.WebGLState:",z)}},texImage3D:function ht(){try{n.texImage3D.apply(n,arguments)}catch(z){console.error("THREE.WebGLState:",z)}},updateUBOMapping:function Ye(z,Ce){let _e=d.get(Ce);void 0===_e&&(_e=new WeakMap,d.set(Ce,_e));let te=_e.get(z);void 0===te&&(te=n.getUniformBlockIndex(Ce,z.name),_e.set(z,te))},uniformBlockBinding:function We(z,Ce){const te=d.get(Ce).get(z);u.get(Ce)!==te&&(n.uniformBlockBinding(Ce,te,z.__bindingPointIndex),u.set(Ce,te))},texStorage2D:function B(){try{n.texStorage2D.apply(n,arguments)}catch(z){console.error("THREE.WebGLState:",z)}},texStorage3D:function we(){try{n.texStorage3D.apply(n,arguments)}catch(z){console.error("THREE.WebGLState:",z)}},texSubImage2D:function pe(){try{n.texSubImage2D.apply(n,arguments)}catch(z){console.error("THREE.WebGLState:",z)}},texSubImage3D:function qe(){try{n.texSubImage3D.apply(n,arguments)}catch(z){console.error("THREE.WebGLState:",z)}},compressedTexSubImage2D:function xe(){try{n.compressedTexSubImage2D.apply(n,arguments)}catch(z){console.error("THREE.WebGLState:",z)}},compressedTexSubImage3D:function ke(){try{n.compressedTexSubImage3D.apply(n,arguments)}catch(z){console.error("THREE.WebGLState:",z)}},scissor:function Ke(z){!1===Ue.equals(z)&&(n.scissor(z.x,z.y,z.z,z.w),Ue.copy(z))},viewport:function ot(z){!1===ut.equals(z)&&(n.viewport(z.x,z.y,z.z,z.w),ut.copy(z))},reset:function Ht(){n.disable(n.BLEND),n.disable(n.CULL_FACE),n.disable(n.DEPTH_TEST),n.disable(n.POLYGON_OFFSET_FILL),n.disable(n.SCISSOR_TEST),n.disable(n.STENCIL_TEST),n.disable(n.SAMPLE_ALPHA_TO_COVERAGE),n.blendEquation(n.FUNC_ADD),n.blendFunc(n.ONE,n.ZERO),n.blendFuncSeparate(n.ONE,n.ZERO,n.ONE,n.ZERO),n.blendColor(0,0,0,0),n.colorMask(!0,!0,!0,!0),n.clearColor(0,0,0,0),n.depthMask(!0),n.depthFunc(n.LESS),n.clearDepth(1),n.stencilMask(4294967295),n.stencilFunc(n.ALWAYS,0,4294967295),n.stencilOp(n.KEEP,n.KEEP,n.KEEP),n.clearStencil(0),n.cullFace(n.BACK),n.frontFace(n.CCW),n.polygonOffset(0,0),n.activeTexture(n.TEXTURE0),n.bindFramebuffer(n.FRAMEBUFFER,null),!0===r&&(n.bindFramebuffer(n.DRAW_FRAMEBUFFER,null),n.bindFramebuffer(n.READ_FRAMEBUFFER,null)),n.useProgram(null),n.lineWidth(1),n.scissor(0,0,n.canvas.width,n.canvas.height),n.viewport(0,0,n.canvas.width,n.canvas.height),h={},G=null,ee={},f={},m=new WeakMap,y=[],_=null,g=!1,b=null,E=null,x=null,M=null,C=null,w=null,A=null,T=new Ge(0,0,0),S=0,R=!1,F=null,N=null,H=null,K=null,se=null,Ue.set(0,0,n.canvas.width,n.canvas.height),ut.set(0,0,n.canvas.width,n.canvas.height),a.reset(),c.reset(),l.reset()}}}function V1e(n,e,t,r,i,s,o){const a=i.isWebGL2,c=i.maxTextures,l=i.maxCubemapSize,u=i.maxTextureSize,d=i.maxSamples,h=e.has("WEBGL_multisampled_render_to_texture")?e.get("WEBGL_multisampled_render_to_texture"):null,f=!(typeof navigator>"u")&&/OculusBrowser/g.test(navigator.userAgent),m=new WeakMap;let y;const _=new WeakMap;let g=!1;try{g=typeof OffscreenCanvas<"u"&&null!==new OffscreenCanvas(1,1).getContext("2d")}catch{}function b(V,D){return g?new OffscreenCanvas(V,D):A_("canvas")}function E(V,D,X,be){let le=1;if((V.width>be||V.height>be)&&(le=be/Math.max(V.width,V.height)),le<1||!0===D){if(typeof HTMLImageElement<"u"&&V instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&V instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&V instanceof ImageBitmap){const pe=D?MT:Math.floor,qe=pe(le*V.width),xe=pe(le*V.height);void 0===y&&(y=b(qe,xe));const ke=X?b(qe,xe):y;return ke.width=qe,ke.height=xe,ke.getContext("2d").drawImage(V,0,0,qe,xe),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+V.width+"x"+V.height+") to ("+qe+"x"+xe+")."),ke}return"data"in V&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+V.width+"x"+V.height+")."),V}return V}function x(V){return PO(V.width)&&PO(V.height)}function C(V,D){return V.generateMipmaps&&D&&V.minFilter!==Ar&&V.minFilter!==Mr}function w(V){n.generateMipmap(V)}function A(V,D,X,be,le=!1){if(!1===a)return D;if(null!==V){if(void 0!==n[V])return n[V];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+V+"'")}let pe=D;if(D===n.RED&&(X===n.FLOAT&&(pe=n.R32F),X===n.HALF_FLOAT&&(pe=n.R16F),X===n.UNSIGNED_BYTE&&(pe=n.R8)),D===n.RED_INTEGER&&(X===n.UNSIGNED_BYTE&&(pe=n.R8UI),X===n.UNSIGNED_SHORT&&(pe=n.R16UI),X===n.UNSIGNED_INT&&(pe=n.R32UI),X===n.BYTE&&(pe=n.R8I),X===n.SHORT&&(pe=n.R16I),X===n.INT&&(pe=n.R32I)),D===n.RG&&(X===n.FLOAT&&(pe=n.RG32F),X===n.HALF_FLOAT&&(pe=n.RG16F),X===n.UNSIGNED_BYTE&&(pe=n.RG8)),D===n.RGBA){const qe=le?wT:pn.getTransfer(be);X===n.FLOAT&&(pe=n.RGBA32F),X===n.HALF_FLOAT&&(pe=n.RGBA16F),X===n.UNSIGNED_BYTE&&(pe=qe===On?n.SRGB8_ALPHA8:n.RGBA8),X===n.UNSIGNED_SHORT_4_4_4_4&&(pe=n.RGBA4),X===n.UNSIGNED_SHORT_5_5_5_1&&(pe=n.RGB5_A1)}return(pe===n.R16F||pe===n.R32F||pe===n.RG16F||pe===n.RG32F||pe===n.RGBA16F||pe===n.RGBA32F)&&e.get("EXT_color_buffer_float"),pe}function T(V,D,X){return!0===C(V,X)||V.isFramebufferTexture&&V.minFilter!==Ar&&V.minFilter!==Mr?Math.log2(Math.max(D.width,D.height))+1:void 0!==V.mipmaps&&V.mipmaps.length>0?V.mipmaps.length:V.isCompressedTexture&&Array.isArray(V.image)?D.mipmaps.length:1}function S(V){return V===Ar||1004===V||1005===V?n.NEAREST:n.LINEAR}function R(V){const D=V.target;D.removeEventListener("dispose",R),function N(V){const D=r.get(V);if(void 0===D.__webglInit)return;const X=V.source,be=_.get(X);if(be){const le=be[D.__cacheKey];le.usedTimes--,0===le.usedTimes&&H(V),0===Object.keys(be).length&&_.delete(X)}r.remove(V)}(D),D.isVideoTexture&&m.delete(D)}function F(V){const D=V.target;D.removeEventListener("dispose",F),function K(V){const D=V.texture,X=r.get(V),be=r.get(D);if(void 0!==be.__webglTexture&&(n.deleteTexture(be.__webglTexture),o.memory.textures--),V.depthTexture&&V.depthTexture.dispose(),V.isWebGLCubeRenderTarget)for(let le=0;le<6;le++){if(Array.isArray(X.__webglFramebuffer[le]))for(let pe=0;pe<X.__webglFramebuffer[le].length;pe++)n.deleteFramebuffer(X.__webglFramebuffer[le][pe]);else n.deleteFramebuffer(X.__webglFramebuffer[le]);X.__webglDepthbuffer&&n.deleteRenderbuffer(X.__webglDepthbuffer[le])}else{if(Array.isArray(X.__webglFramebuffer))for(let le=0;le<X.__webglFramebuffer.length;le++)n.deleteFramebuffer(X.__webglFramebuffer[le]);else n.deleteFramebuffer(X.__webglFramebuffer);if(X.__webglDepthbuffer&&n.deleteRenderbuffer(X.__webglDepthbuffer),X.__webglMultisampledFramebuffer&&n.deleteFramebuffer(X.__webglMultisampledFramebuffer),X.__webglColorRenderbuffer)for(let le=0;le<X.__webglColorRenderbuffer.length;le++)X.__webglColorRenderbuffer[le]&&n.deleteRenderbuffer(X.__webglColorRenderbuffer[le]);X.__webglDepthRenderbuffer&&n.deleteRenderbuffer(X.__webglDepthRenderbuffer)}if(V.isWebGLMultipleRenderTargets)for(let le=0,pe=D.length;le<pe;le++){const qe=r.get(D[le]);qe.__webglTexture&&(n.deleteTexture(qe.__webglTexture),o.memory.textures--),r.remove(D[le])}r.remove(D),r.remove(V)}(D)}function H(V){const D=r.get(V);n.deleteTexture(D.__webglTexture),delete _.get(V.source)[D.__cacheKey],o.memory.textures--}let se=0;function ge(V,D){const X=r.get(V);if(V.isVideoTexture&&function Nt(V){const D=o.render.frame;m.get(V)!==D&&(m.set(V,D),V.update())}(V),!1===V.isRenderTargetTexture&&V.version>0&&X.__version!==V.version){const be=V.image;if(null===be)console.warn("THREE.WebGLRenderer: Texture marked for update but no image data found.");else{if(!1!==be.complete)return void yt(X,V,D);console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete")}}t.bindTexture(n.TEXTURE_2D,X.__webglTexture,n.TEXTURE0+D)}const He={[gT]:n.REPEAT,[Ri]:n.CLAMP_TO_EDGE,[_T]:n.MIRRORED_REPEAT},Ue={[Ar]:n.NEAREST,[EO]:n.NEAREST_MIPMAP_NEAREST,[yT]:n.NEAREST_MIPMAP_LINEAR,[Mr]:n.LINEAR,[G7]:n.LINEAR_MIPMAP_NEAREST,[Nu]:n.LINEAR_MIPMAP_LINEAR},ut={[tMe]:n.NEVER,[cMe]:n.ALWAYS,[nMe]:n.LESS,[iMe]:n.LEQUAL,[rMe]:n.EQUAL,[aMe]:n.GEQUAL,[sMe]:n.GREATER,[oMe]:n.NOTEQUAL};function it(V,D,X){if(X?(n.texParameteri(V,n.TEXTURE_WRAP_S,He[D.wrapS]),n.texParameteri(V,n.TEXTURE_WRAP_T,He[D.wrapT]),(V===n.TEXTURE_3D||V===n.TEXTURE_2D_ARRAY)&&n.texParameteri(V,n.TEXTURE_WRAP_R,He[D.wrapR]),n.texParameteri(V,n.TEXTURE_MAG_FILTER,Ue[D.magFilter]),n.texParameteri(V,n.TEXTURE_MIN_FILTER,Ue[D.minFilter])):(n.texParameteri(V,n.TEXTURE_WRAP_S,n.CLAMP_TO_EDGE),n.texParameteri(V,n.TEXTURE_WRAP_T,n.CLAMP_TO_EDGE),(V===n.TEXTURE_3D||V===n.TEXTURE_2D_ARRAY)&&n.texParameteri(V,n.TEXTURE_WRAP_R,n.CLAMP_TO_EDGE),(D.wrapS!==Ri||D.wrapT!==Ri)&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping."),n.texParameteri(V,n.TEXTURE_MAG_FILTER,S(D.magFilter)),n.texParameteri(V,n.TEXTURE_MIN_FILTER,S(D.minFilter)),D.minFilter!==Ar&&D.minFilter!==Mr&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter.")),D.compareFunction&&(n.texParameteri(V,n.TEXTURE_COMPARE_MODE,n.COMPARE_REF_TO_TEXTURE),n.texParameteri(V,n.TEXTURE_COMPARE_FUNC,ut[D.compareFunction])),!0===e.has("EXT_texture_filter_anisotropic")){const be=e.get("EXT_texture_filter_anisotropic");if(D.magFilter===Ar||1005!==D.minFilter&&D.minFilter!==Nu||D.type===Ia&&!1===e.has("OES_texture_float_linear")||!1===a&&D.type===S_&&!1===e.has("OES_texture_half_float_linear"))return;(D.anisotropy>1||r.get(D).__currentAnisotropy)&&(n.texParameterf(V,be.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(D.anisotropy,i.getMaxAnisotropy())),r.get(D).__currentAnisotropy=D.anisotropy)}}function at(V,D){let X=!1;void 0===V.__webglInit&&(V.__webglInit=!0,D.addEventListener("dispose",R));const be=D.source;let le=_.get(be);void 0===le&&(le={},_.set(be,le));const pe=function ce(V){const D=[];return D.push(V.wrapS),D.push(V.wrapT),D.push(V.wrapR||0),D.push(V.magFilter),D.push(V.minFilter),D.push(V.anisotropy),D.push(V.internalFormat),D.push(V.format),D.push(V.type),D.push(V.generateMipmaps),D.push(V.premultiplyAlpha),D.push(V.flipY),D.push(V.unpackAlignment),D.push(V.colorSpace),D.join()}(D);if(pe!==V.__cacheKey){void 0===le[pe]&&(le[pe]={texture:n.createTexture(),usedTimes:0},o.memory.textures++,X=!0),le[pe].usedTimes++;const qe=le[V.__cacheKey];void 0!==qe&&(le[V.__cacheKey].usedTimes--,0===qe.usedTimes&&H(D)),V.__cacheKey=pe,V.__webglTexture=le[pe].texture}return X}function yt(V,D,X){let be=n.TEXTURE_2D;(D.isDataArrayTexture||D.isCompressedArrayTexture)&&(be=n.TEXTURE_2D_ARRAY),D.isData3DTexture&&(be=n.TEXTURE_3D);const le=at(V,D),pe=D.source;t.bindTexture(be,V.__webglTexture,n.TEXTURE0+X);const qe=r.get(pe);if(pe.version!==qe.__version||!0===le){t.activeTexture(n.TEXTURE0+X);const xe=pn.getPrimaries(pn.workingColorSpace),ke=""===D.colorSpace?null:pn.getPrimaries(D.colorSpace),B=""===D.colorSpace||xe===ke?n.NONE:n.BROWSER_DEFAULT_WEBGL;n.pixelStorei(n.UNPACK_FLIP_Y_WEBGL,D.flipY),n.pixelStorei(n.UNPACK_PREMULTIPLY_ALPHA_WEBGL,D.premultiplyAlpha),n.pixelStorei(n.UNPACK_ALIGNMENT,D.unpackAlignment),n.pixelStorei(n.UNPACK_COLORSPACE_CONVERSION_WEBGL,B);const we=function M(V){return!a&&(V.wrapS!==Ri||V.wrapT!==Ri||V.minFilter!==Ar&&V.minFilter!==Mr)}(D)&&!1===x(D.image);let de=E(D.image,we,!1,u);de=yn(D,de);const ht=x(de)||a,Ke=s.convert(D.format,D.colorSpace);let We,ot=s.convert(D.type),Ye=A(D.internalFormat,Ke,ot,D.colorSpace,D.isVideoTexture);it(be,D,ht);const Ht=D.mipmaps,z=a&&!0!==D.isVideoTexture,Ce=void 0===qe.__version||!0===le,_e=T(D,de,ht);if(D.isDepthTexture)Ye=n.DEPTH_COMPONENT,a?Ye=D.type===Ia?n.DEPTH_COMPONENT32F:D.type===Xc?n.DEPTH_COMPONENT24:D.type===Ou?n.DEPTH24_STENCIL8:n.DEPTH_COMPONENT16:D.type===Ia&&console.error("WebGLRenderer: Floating point depth texture requires WebGL2."),D.format===ku&&Ye===n.DEPTH_COMPONENT&&1012!==D.type&&D.type!==Xc&&(console.warn("THREE.WebGLRenderer: Use UnsignedShortType or UnsignedIntType for DepthFormat DepthTexture."),D.type=Xc,ot=s.convert(D.type)),D.format===Af&&Ye===n.DEPTH_COMPONENT&&(Ye=n.DEPTH_STENCIL,D.type!==Ou&&(console.warn("THREE.WebGLRenderer: Use UnsignedInt248Type for DepthStencilFormat DepthTexture."),D.type=Ou,ot=s.convert(D.type))),Ce&&(z?t.texStorage2D(n.TEXTURE_2D,1,Ye,de.width,de.height):t.texImage2D(n.TEXTURE_2D,0,Ye,de.width,de.height,0,Ke,ot,null));else if(D.isDataTexture)if(Ht.length>0&&ht){z&&Ce&&t.texStorage2D(n.TEXTURE_2D,_e,Ye,Ht[0].width,Ht[0].height);for(let te=0,Ee=Ht.length;te<Ee;te++)We=Ht[te],z?t.texSubImage2D(n.TEXTURE_2D,te,0,0,We.width,We.height,Ke,ot,We.data):t.texImage2D(n.TEXTURE_2D,te,Ye,We.width,We.height,0,Ke,ot,We.data);D.generateMipmaps=!1}else z?(Ce&&t.texStorage2D(n.TEXTURE_2D,_e,Ye,de.width,de.height),t.texSubImage2D(n.TEXTURE_2D,0,0,0,de.width,de.height,Ke,ot,de.data)):t.texImage2D(n.TEXTURE_2D,0,Ye,de.width,de.height,0,Ke,ot,de.data);else if(D.isCompressedTexture)if(D.isCompressedArrayTexture){z&&Ce&&t.texStorage3D(n.TEXTURE_2D_ARRAY,_e,Ye,Ht[0].width,Ht[0].height,de.depth);for(let te=0,Ee=Ht.length;te<Ee;te++)We=Ht[te],D.format!==Os?null!==Ke?z?t.compressedTexSubImage3D(n.TEXTURE_2D_ARRAY,te,0,0,0,We.width,We.height,de.depth,Ke,We.data,0,0):t.compressedTexImage3D(n.TEXTURE_2D_ARRAY,te,Ye,We.width,We.height,de.depth,0,We.data,0,0):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):z?t.texSubImage3D(n.TEXTURE_2D_ARRAY,te,0,0,0,We.width,We.height,de.depth,Ke,ot,We.data):t.texImage3D(n.TEXTURE_2D_ARRAY,te,Ye,We.width,We.height,de.depth,0,Ke,ot,We.data)}else{z&&Ce&&t.texStorage2D(n.TEXTURE_2D,_e,Ye,Ht[0].width,Ht[0].height);for(let te=0,Ee=Ht.length;te<Ee;te++)We=Ht[te],D.format!==Os?null!==Ke?z?t.compressedTexSubImage2D(n.TEXTURE_2D,te,0,0,We.width,We.height,Ke,We.data):t.compressedTexImage2D(n.TEXTURE_2D,te,Ye,We.width,We.height,0,We.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):z?t.texSubImage2D(n.TEXTURE_2D,te,0,0,We.width,We.height,Ke,ot,We.data):t.texImage2D(n.TEXTURE_2D,te,Ye,We.width,We.height,0,Ke,ot,We.data)}else if(D.isDataArrayTexture)z?(Ce&&t.texStorage3D(n.TEXTURE_2D_ARRAY,_e,Ye,de.width,de.height,de.depth),t.texSubImage3D(n.TEXTURE_2D_ARRAY,0,0,0,0,de.width,de.height,de.depth,Ke,ot,de.data)):t.texImage3D(n.TEXTURE_2D_ARRAY,0,Ye,de.width,de.height,de.depth,0,Ke,ot,de.data);else if(D.isData3DTexture)z?(Ce&&t.texStorage3D(n.TEXTURE_3D,_e,Ye,de.width,de.height,de.depth),t.texSubImage3D(n.TEXTURE_3D,0,0,0,0,de.width,de.height,de.depth,Ke,ot,de.data)):t.texImage3D(n.TEXTURE_3D,0,Ye,de.width,de.height,de.depth,0,Ke,ot,de.data);else if(D.isFramebufferTexture){if(Ce)if(z)t.texStorage2D(n.TEXTURE_2D,_e,Ye,de.width,de.height);else{let te=de.width,Ee=de.height;for(let nt=0;nt<_e;nt++)t.texImage2D(n.TEXTURE_2D,nt,Ye,te,Ee,0,Ke,ot,null),te>>=1,Ee>>=1}}else if(Ht.length>0&&ht){z&&Ce&&t.texStorage2D(n.TEXTURE_2D,_e,Ye,Ht[0].width,Ht[0].height);for(let te=0,Ee=Ht.length;te<Ee;te++)We=Ht[te],z?t.texSubImage2D(n.TEXTURE_2D,te,0,0,Ke,ot,We):t.texImage2D(n.TEXTURE_2D,te,Ye,Ke,ot,We);D.generateMipmaps=!1}else z?(Ce&&t.texStorage2D(n.TEXTURE_2D,_e,Ye,de.width,de.height),t.texSubImage2D(n.TEXTURE_2D,0,0,0,Ke,ot,de)):t.texImage2D(n.TEXTURE_2D,0,Ye,Ke,ot,de);C(D,ht)&&w(be),qe.__version=pe.version,D.onUpdate&&D.onUpdate(D)}V.__version=D.version}function st(V,D,X,be,le,pe){const qe=s.convert(X.format,X.colorSpace),xe=s.convert(X.type),ke=A(X.internalFormat,qe,xe,X.colorSpace);if(!r.get(D).__hasExternalTextures){const we=Math.max(1,D.width>>pe),de=Math.max(1,D.height>>pe);le===n.TEXTURE_3D||le===n.TEXTURE_2D_ARRAY?t.texImage3D(le,pe,ke,we,de,D.depth,0,qe,xe,null):t.texImage2D(le,pe,ke,we,de,0,qe,xe,null)}t.bindFramebuffer(n.FRAMEBUFFER,V),dt(D)?h.framebufferTexture2DMultisampleEXT(n.FRAMEBUFFER,be,le,r.get(X).__webglTexture,0,je(D)):(le===n.TEXTURE_2D||le>=n.TEXTURE_CUBE_MAP_POSITIVE_X&&le<=n.TEXTURE_CUBE_MAP_NEGATIVE_Z)&&n.framebufferTexture2D(n.FRAMEBUFFER,be,le,r.get(X).__webglTexture,pe),t.bindFramebuffer(n.FRAMEBUFFER,null)}function U(V,D,X){if(n.bindRenderbuffer(n.RENDERBUFFER,V),D.depthBuffer&&!D.stencilBuffer){let be=!0===a?n.DEPTH_COMPONENT24:n.DEPTH_COMPONENT16;if(X||dt(D)){const le=D.depthTexture;le&&le.isDepthTexture&&(le.type===Ia?be=n.DEPTH_COMPONENT32F:le.type===Xc&&(be=n.DEPTH_COMPONENT24));const pe=je(D);dt(D)?h.renderbufferStorageMultisampleEXT(n.RENDERBUFFER,pe,be,D.width,D.height):n.renderbufferStorageMultisample(n.RENDERBUFFER,pe,be,D.width,D.height)}else n.renderbufferStorage(n.RENDERBUFFER,be,D.width,D.height);n.framebufferRenderbuffer(n.FRAMEBUFFER,n.DEPTH_ATTACHMENT,n.RENDERBUFFER,V)}else if(D.depthBuffer&&D.stencilBuffer){const be=je(D);X&&!1===dt(D)?n.renderbufferStorageMultisample(n.RENDERBUFFER,be,n.DEPTH24_STENCIL8,D.width,D.height):dt(D)?h.renderbufferStorageMultisampleEXT(n.RENDERBUFFER,be,n.DEPTH24_STENCIL8,D.width,D.height):n.renderbufferStorage(n.RENDERBUFFER,n.DEPTH_STENCIL,D.width,D.height),n.framebufferRenderbuffer(n.FRAMEBUFFER,n.DEPTH_STENCIL_ATTACHMENT,n.RENDERBUFFER,V)}else{const be=!0===D.isWebGLMultipleRenderTargets?D.texture:[D.texture];for(let le=0;le<be.length;le++){const pe=be[le],qe=s.convert(pe.format,pe.colorSpace),xe=s.convert(pe.type),ke=A(pe.internalFormat,qe,xe,pe.colorSpace),B=je(D);X&&!1===dt(D)?n.renderbufferStorageMultisample(n.RENDERBUFFER,B,ke,D.width,D.height):dt(D)?h.renderbufferStorageMultisampleEXT(n.RENDERBUFFER,B,ke,D.width,D.height):n.renderbufferStorage(n.RENDERBUFFER,ke,D.width,D.height)}}n.bindRenderbuffer(n.RENDERBUFFER,null)}function ie(V){const D=r.get(V),X=!0===V.isWebGLCubeRenderTarget;if(V.depthTexture&&!D.__autoAllocateDepthBuffer){if(X)throw new Error("target.depthTexture not supported in Cube render targets");!function De(V,D){if(D&&D.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(t.bindFramebuffer(n.FRAMEBUFFER,V),!D.depthTexture||!D.depthTexture.isDepthTexture)throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");(!r.get(D.depthTexture).__webglTexture||D.depthTexture.image.width!==D.width||D.depthTexture.image.height!==D.height)&&(D.depthTexture.image.width=D.width,D.depthTexture.image.height=D.height,D.depthTexture.needsUpdate=!0),ge(D.depthTexture,0);const be=r.get(D.depthTexture).__webglTexture,le=je(D);if(D.depthTexture.format===ku)dt(D)?h.framebufferTexture2DMultisampleEXT(n.FRAMEBUFFER,n.DEPTH_ATTACHMENT,n.TEXTURE_2D,be,0,le):n.framebufferTexture2D(n.FRAMEBUFFER,n.DEPTH_ATTACHMENT,n.TEXTURE_2D,be,0);else{if(D.depthTexture.format!==Af)throw new Error("Unknown depthTexture format");dt(D)?h.framebufferTexture2DMultisampleEXT(n.FRAMEBUFFER,n.DEPTH_STENCIL_ATTACHMENT,n.TEXTURE_2D,be,0,le):n.framebufferTexture2D(n.FRAMEBUFFER,n.DEPTH_STENCIL_ATTACHMENT,n.TEXTURE_2D,be,0)}}(D.__webglFramebuffer,V)}else if(X){D.__webglDepthbuffer=[];for(let be=0;be<6;be++)t.bindFramebuffer(n.FRAMEBUFFER,D.__webglFramebuffer[be]),D.__webglDepthbuffer[be]=n.createRenderbuffer(),U(D.__webglDepthbuffer[be],V,!1)}else t.bindFramebuffer(n.FRAMEBUFFER,D.__webglFramebuffer),D.__webglDepthbuffer=n.createRenderbuffer(),U(D.__webglDepthbuffer,V,!1);t.bindFramebuffer(n.FRAMEBUFFER,null)}function je(V){return Math.min(d,V.samples)}function dt(V){const D=r.get(V);return a&&V.samples>0&&!0===e.has("WEBGL_multisampled_render_to_texture")&&!1!==D.__useRenderToTexture}function yn(V,D){const X=V.colorSpace,be=V.format,le=V.type;return!0===V.isCompressedTexture||!0===V.isVideoTexture||1035===V.format||X!==Sa&&""!==X&&(pn.getTransfer(X)===On?!1===a?!0===e.has("EXT_sRGB")&&be===Os?(V.format=1035,V.minFilter=Mr,V.generateMipmaps=!1):D=RX.sRGBToLinear(D):(be!==Os||le!==qc)&&console.warn("THREE.WebGLTextures: sRGB encoded textures have to use RGBAFormat and UnsignedByteType."):console.error("THREE.WebGLTextures: Unsupported texture color space:",X)),D}this.allocateTextureUnit=function ye(){const V=se;return V>=c&&console.warn("THREE.WebGLTextures: Trying to use "+V+" texture units while this GPU supports only "+c),se+=1,V},this.resetTextureUnits=function ne(){se=0},this.setTexture2D=ge,this.setTexture2DArray=function G(V,D){const X=r.get(V);V.version>0&&X.__version!==V.version?yt(X,V,D):t.bindTexture(n.TEXTURE_2D_ARRAY,X.__webglTexture,n.TEXTURE0+D)},this.setTexture3D=function ee(V,D){const X=r.get(V);V.version>0&&X.__version!==V.version?yt(X,V,D):t.bindTexture(n.TEXTURE_3D,X.__webglTexture,n.TEXTURE0+D)},this.setTextureCube=function Te(V,D){const X=r.get(V);V.version>0&&X.__version!==V.version?function Ft(V,D,X){if(6!==D.image.length)return;const be=at(V,D),le=D.source;t.bindTexture(n.TEXTURE_CUBE_MAP,V.__webglTexture,n.TEXTURE0+X);const pe=r.get(le);if(le.version!==pe.__version||!0===be){t.activeTexture(n.TEXTURE0+X);const qe=pn.getPrimaries(pn.workingColorSpace),xe=""===D.colorSpace?null:pn.getPrimaries(D.colorSpace),ke=""===D.colorSpace||qe===xe?n.NONE:n.BROWSER_DEFAULT_WEBGL;n.pixelStorei(n.UNPACK_FLIP_Y_WEBGL,D.flipY),n.pixelStorei(n.UNPACK_PREMULTIPLY_ALPHA_WEBGL,D.premultiplyAlpha),n.pixelStorei(n.UNPACK_ALIGNMENT,D.unpackAlignment),n.pixelStorei(n.UNPACK_COLORSPACE_CONVERSION_WEBGL,ke);const B=D.isCompressedTexture||D.image[0].isCompressedTexture,we=D.image[0]&&D.image[0].isDataTexture,de=[];for(let te=0;te<6;te++)de[te]=B||we?we?D.image[te].image:D.image[te]:E(D.image[te],!1,!0,l),de[te]=yn(D,de[te]);const ht=de[0],Ke=x(ht)||a,ot=s.convert(D.format,D.colorSpace),Ye=s.convert(D.type),We=A(D.internalFormat,ot,Ye,D.colorSpace),Ht=a&&!0!==D.isVideoTexture,z=void 0===pe.__version||!0===be;let _e,Ce=T(D,ht,Ke);if(it(n.TEXTURE_CUBE_MAP,D,Ke),B){Ht&&z&&t.texStorage2D(n.TEXTURE_CUBE_MAP,Ce,We,ht.width,ht.height);for(let te=0;te<6;te++){_e=de[te].mipmaps;for(let Ee=0;Ee<_e.length;Ee++){const nt=_e[Ee];D.format!==Os?null!==ot?Ht?t.compressedTexSubImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+te,Ee,0,0,nt.width,nt.height,ot,nt.data):t.compressedTexImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+te,Ee,We,nt.width,nt.height,0,nt.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):Ht?t.texSubImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+te,Ee,0,0,nt.width,nt.height,ot,Ye,nt.data):t.texImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+te,Ee,We,nt.width,nt.height,0,ot,Ye,nt.data)}}}else{_e=D.mipmaps,Ht&&z&&(_e.length>0&&Ce++,t.texStorage2D(n.TEXTURE_CUBE_MAP,Ce,We,de[0].width,de[0].height));for(let te=0;te<6;te++)if(we){Ht?t.texSubImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+te,0,0,0,de[te].width,de[te].height,ot,Ye,de[te].data):t.texImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+te,0,We,de[te].width,de[te].height,0,ot,Ye,de[te].data);for(let Ee=0;Ee<_e.length;Ee++){const kt=_e[Ee].image[te].image;Ht?t.texSubImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+te,Ee+1,0,0,kt.width,kt.height,ot,Ye,kt.data):t.texImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+te,Ee+1,We,kt.width,kt.height,0,ot,Ye,kt.data)}}else{Ht?t.texSubImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+te,0,0,0,ot,Ye,de[te]):t.texImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+te,0,We,ot,Ye,de[te]);for(let Ee=0;Ee<_e.length;Ee++){const nt=_e[Ee];Ht?t.texSubImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+te,Ee+1,0,0,ot,Ye,nt.image[te]):t.texImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+te,Ee+1,We,ot,Ye,nt.image[te])}}}C(D,Ke)&&w(n.TEXTURE_CUBE_MAP),pe.__version=le.version,D.onUpdate&&D.onUpdate(D)}V.__version=D.version}(X,V,D):t.bindTexture(n.TEXTURE_CUBE_MAP,X.__webglTexture,n.TEXTURE0+D)},this.rebindTextures=function ve(V,D,X){const be=r.get(V);void 0!==D&&st(be.__webglFramebuffer,V,V.texture,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,0),void 0!==X&&ie(V)},this.setupRenderTarget=function he(V){const D=V.texture,X=r.get(V),be=r.get(D);V.addEventListener("dispose",F),!0!==V.isWebGLMultipleRenderTargets&&(void 0===be.__webglTexture&&(be.__webglTexture=n.createTexture()),be.__version=D.version,o.memory.textures++);const le=!0===V.isWebGLCubeRenderTarget,pe=!0===V.isWebGLMultipleRenderTargets,qe=x(V)||a;if(le){X.__webglFramebuffer=[];for(let xe=0;xe<6;xe++)if(a&&D.mipmaps&&D.mipmaps.length>0){X.__webglFramebuffer[xe]=[];for(let ke=0;ke<D.mipmaps.length;ke++)X.__webglFramebuffer[xe][ke]=n.createFramebuffer()}else X.__webglFramebuffer[xe]=n.createFramebuffer()}else{if(a&&D.mipmaps&&D.mipmaps.length>0){X.__webglFramebuffer=[];for(let xe=0;xe<D.mipmaps.length;xe++)X.__webglFramebuffer[xe]=n.createFramebuffer()}else X.__webglFramebuffer=n.createFramebuffer();if(pe)if(i.drawBuffers){const xe=V.texture;for(let ke=0,B=xe.length;ke<B;ke++){const we=r.get(xe[ke]);void 0===we.__webglTexture&&(we.__webglTexture=n.createTexture(),o.memory.textures++)}}else console.warn("THREE.WebGLRenderer: WebGLMultipleRenderTargets can only be used with WebGL2 or WEBGL_draw_buffers extension.");if(a&&V.samples>0&&!1===dt(V)){const xe=pe?D:[D];X.__webglMultisampledFramebuffer=n.createFramebuffer(),X.__webglColorRenderbuffer=[],t.bindFramebuffer(n.FRAMEBUFFER,X.__webglMultisampledFramebuffer);for(let ke=0;ke<xe.length;ke++){const B=xe[ke];X.__webglColorRenderbuffer[ke]=n.createRenderbuffer(),n.bindRenderbuffer(n.RENDERBUFFER,X.__webglColorRenderbuffer[ke]);const we=s.convert(B.format,B.colorSpace),de=s.convert(B.type),ht=A(B.internalFormat,we,de,B.colorSpace,!0===V.isXRRenderTarget),Ke=je(V);n.renderbufferStorageMultisample(n.RENDERBUFFER,Ke,ht,V.width,V.height),n.framebufferRenderbuffer(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0+ke,n.RENDERBUFFER,X.__webglColorRenderbuffer[ke])}n.bindRenderbuffer(n.RENDERBUFFER,null),V.depthBuffer&&(X.__webglDepthRenderbuffer=n.createRenderbuffer(),U(X.__webglDepthRenderbuffer,V,!0)),t.bindFramebuffer(n.FRAMEBUFFER,null)}}if(le){t.bindTexture(n.TEXTURE_CUBE_MAP,be.__webglTexture),it(n.TEXTURE_CUBE_MAP,D,qe);for(let xe=0;xe<6;xe++)if(a&&D.mipmaps&&D.mipmaps.length>0)for(let ke=0;ke<D.mipmaps.length;ke++)st(X.__webglFramebuffer[xe][ke],V,D,n.COLOR_ATTACHMENT0,n.TEXTURE_CUBE_MAP_POSITIVE_X+xe,ke);else st(X.__webglFramebuffer[xe],V,D,n.COLOR_ATTACHMENT0,n.TEXTURE_CUBE_MAP_POSITIVE_X+xe,0);C(D,qe)&&w(n.TEXTURE_CUBE_MAP),t.unbindTexture()}else if(pe){const xe=V.texture;for(let ke=0,B=xe.length;ke<B;ke++){const we=xe[ke],de=r.get(we);t.bindTexture(n.TEXTURE_2D,de.__webglTexture),it(n.TEXTURE_2D,we,qe),st(X.__webglFramebuffer,V,we,n.COLOR_ATTACHMENT0+ke,n.TEXTURE_2D,0),C(we,qe)&&w(n.TEXTURE_2D)}t.unbindTexture()}else{let xe=n.TEXTURE_2D;if((V.isWebGL3DRenderTarget||V.isWebGLArrayRenderTarget)&&(a?xe=V.isWebGL3DRenderTarget?n.TEXTURE_3D:n.TEXTURE_2D_ARRAY:console.error("THREE.WebGLTextures: THREE.Data3DTexture and THREE.DataArrayTexture only supported with WebGL2.")),t.bindTexture(xe,be.__webglTexture),it(xe,D,qe),a&&D.mipmaps&&D.mipmaps.length>0)for(let ke=0;ke<D.mipmaps.length;ke++)st(X.__webglFramebuffer[ke],V,D,n.COLOR_ATTACHMENT0,xe,ke);else st(X.__webglFramebuffer,V,D,n.COLOR_ATTACHMENT0,xe,0);C(D,qe)&&w(xe),t.unbindTexture()}V.depthBuffer&&ie(V)},this.updateRenderTargetMipmap=function Qe(V){const D=x(V)||a,X=!0===V.isWebGLMultipleRenderTargets?V.texture:[V.texture];for(let be=0,le=X.length;be<le;be++){const pe=X[be];if(C(pe,D)){const qe=V.isWebGLCubeRenderTarget?n.TEXTURE_CUBE_MAP:n.TEXTURE_2D,xe=r.get(pe).__webglTexture;t.bindTexture(qe,xe),w(qe),t.unbindTexture()}}},this.updateMultisampleRenderTarget=function Le(V){if(a&&V.samples>0&&!1===dt(V)){const D=V.isWebGLMultipleRenderTargets?V.texture:[V.texture],X=V.width,be=V.height;let le=n.COLOR_BUFFER_BIT;const pe=[],qe=V.stencilBuffer?n.DEPTH_STENCIL_ATTACHMENT:n.DEPTH_ATTACHMENT,xe=r.get(V),ke=!0===V.isWebGLMultipleRenderTargets;if(ke)for(let B=0;B<D.length;B++)t.bindFramebuffer(n.FRAMEBUFFER,xe.__webglMultisampledFramebuffer),n.framebufferRenderbuffer(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0+B,n.RENDERBUFFER,null),t.bindFramebuffer(n.FRAMEBUFFER,xe.__webglFramebuffer),n.framebufferTexture2D(n.DRAW_FRAMEBUFFER,n.COLOR_ATTACHMENT0+B,n.TEXTURE_2D,null,0);t.bindFramebuffer(n.READ_FRAMEBUFFER,xe.__webglMultisampledFramebuffer),t.bindFramebuffer(n.DRAW_FRAMEBUFFER,xe.__webglFramebuffer);for(let B=0;B<D.length;B++){pe.push(n.COLOR_ATTACHMENT0+B),V.depthBuffer&&pe.push(qe);const we=void 0!==xe.__ignoreDepthValues&&xe.__ignoreDepthValues;if(!1===we&&(V.depthBuffer&&(le|=n.DEPTH_BUFFER_BIT),V.stencilBuffer&&(le|=n.STENCIL_BUFFER_BIT)),ke&&n.framebufferRenderbuffer(n.READ_FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.RENDERBUFFER,xe.__webglColorRenderbuffer[B]),!0===we&&(n.invalidateFramebuffer(n.READ_FRAMEBUFFER,[qe]),n.invalidateFramebuffer(n.DRAW_FRAMEBUFFER,[qe])),ke){const de=r.get(D[B]).__webglTexture;n.framebufferTexture2D(n.DRAW_FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,de,0)}n.blitFramebuffer(0,0,X,be,0,0,X,be,le,n.NEAREST),f&&n.invalidateFramebuffer(n.READ_FRAMEBUFFER,pe)}if(t.bindFramebuffer(n.READ_FRAMEBUFFER,null),t.bindFramebuffer(n.DRAW_FRAMEBUFFER,null),ke)for(let B=0;B<D.length;B++){t.bindFramebuffer(n.FRAMEBUFFER,xe.__webglMultisampledFramebuffer),n.framebufferRenderbuffer(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0+B,n.RENDERBUFFER,xe.__webglColorRenderbuffer[B]);const we=r.get(D[B]).__webglTexture;t.bindFramebuffer(n.FRAMEBUFFER,xe.__webglFramebuffer),n.framebufferTexture2D(n.DRAW_FRAMEBUFFER,n.COLOR_ATTACHMENT0+B,n.TEXTURE_2D,we,0)}t.bindFramebuffer(n.DRAW_FRAMEBUFFER,xe.__webglMultisampledFramebuffer)}},this.setupDepthRenderbuffer=ie,this.setupFrameBufferTexture=st,this.useMultisampledRTT=dt}function U1e(n,e,t){const r=t.isWebGL2;return{convert:function i(s,o=""){let a;const c=pn.getTransfer(o);if(s===qc)return n.UNSIGNED_BYTE;if(1017===s)return n.UNSIGNED_SHORT_4_4_4_4;if(1018===s)return n.UNSIGNED_SHORT_5_5_5_1;if(1010===s)return n.BYTE;if(1011===s)return n.SHORT;if(1012===s)return n.UNSIGNED_SHORT;if(1013===s)return n.INT;if(s===Xc)return n.UNSIGNED_INT;if(s===Ia)return n.FLOAT;if(s===S_)return r?n.HALF_FLOAT:(a=e.get("OES_texture_half_float"),null!==a?a.HALF_FLOAT_OES:null);if(1021===s)return n.ALPHA;if(s===Os)return n.RGBA;if(1024===s)return n.LUMINANCE;if(1025===s)return n.LUMINANCE_ALPHA;if(s===ku)return n.DEPTH_COMPONENT;if(s===Af)return n.DEPTH_STENCIL;if(1035===s)return a=e.get("EXT_sRGB"),null!==a?a.SRGB_ALPHA_EXT:null;if(1028===s)return n.RED;if(1029===s)return n.RED_INTEGER;if(1030===s)return n.RG;if(1031===s)return n.RG_INTEGER;if(1033===s)return n.RGBA_INTEGER;if(33776===s||33777===s||33778===s||33779===s)if(c===On){if(a=e.get("WEBGL_compressed_texture_s3tc_srgb"),null===a)return null;if(33776===s)return a.COMPRESSED_SRGB_S3TC_DXT1_EXT;if(33777===s)return a.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;if(33778===s)return a.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;if(33779===s)return a.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT}else{if(a=e.get("WEBGL_compressed_texture_s3tc"),null===a)return null;if(33776===s)return a.COMPRESSED_RGB_S3TC_DXT1_EXT;if(33777===s)return a.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(33778===s)return a.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(33779===s)return a.COMPRESSED_RGBA_S3TC_DXT5_EXT}if(35840===s||35841===s||35842===s||35843===s){if(a=e.get("WEBGL_compressed_texture_pvrtc"),null===a)return null;if(35840===s)return a.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(35841===s)return a.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(35842===s)return a.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(35843===s)return a.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}if(36196===s)return a=e.get("WEBGL_compressed_texture_etc1"),null!==a?a.COMPRESSED_RGB_ETC1_WEBGL:null;if(37492===s||37496===s){if(a=e.get("WEBGL_compressed_texture_etc"),null===a)return null;if(37492===s)return c===On?a.COMPRESSED_SRGB8_ETC2:a.COMPRESSED_RGB8_ETC2;if(37496===s)return c===On?a.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:a.COMPRESSED_RGBA8_ETC2_EAC}if(37808===s||37809===s||37810===s||37811===s||37812===s||37813===s||37814===s||37815===s||37816===s||37817===s||37818===s||37819===s||37820===s||37821===s){if(a=e.get("WEBGL_compressed_texture_astc"),null===a)return null;if(37808===s)return c===On?a.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:a.COMPRESSED_RGBA_ASTC_4x4_KHR;if(37809===s)return c===On?a.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:a.COMPRESSED_RGBA_ASTC_5x4_KHR;if(37810===s)return c===On?a.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:a.COMPRESSED_RGBA_ASTC_5x5_KHR;if(37811===s)return c===On?a.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:a.COMPRESSED_RGBA_ASTC_6x5_KHR;if(37812===s)return c===On?a.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:a.COMPRESSED_RGBA_ASTC_6x6_KHR;if(37813===s)return c===On?a.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:a.COMPRESSED_RGBA_ASTC_8x5_KHR;if(37814===s)return c===On?a.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:a.COMPRESSED_RGBA_ASTC_8x6_KHR;if(37815===s)return c===On?a.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:a.COMPRESSED_RGBA_ASTC_8x8_KHR;if(37816===s)return c===On?a.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:a.COMPRESSED_RGBA_ASTC_10x5_KHR;if(37817===s)return c===On?a.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:a.COMPRESSED_RGBA_ASTC_10x6_KHR;if(37818===s)return c===On?a.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:a.COMPRESSED_RGBA_ASTC_10x8_KHR;if(37819===s)return c===On?a.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:a.COMPRESSED_RGBA_ASTC_10x10_KHR;if(37820===s)return c===On?a.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:a.COMPRESSED_RGBA_ASTC_12x10_KHR;if(37821===s)return c===On?a.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:a.COMPRESSED_RGBA_ASTC_12x12_KHR}if(36492===s||36494===s||36495===s){if(a=e.get("EXT_texture_compression_bptc"),null===a)return null;if(36492===s)return c===On?a.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT:a.COMPRESSED_RGBA_BPTC_UNORM_EXT;if(36494===s)return a.COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT;if(36495===s)return a.COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT}if(36283===s||36284===s||36285===s||36286===s){if(a=e.get("EXT_texture_compression_rgtc"),null===a)return null;if(36492===s)return a.COMPRESSED_RED_RGTC1_EXT;if(36284===s)return a.COMPRESSED_SIGNED_RED_RGTC1_EXT;if(36285===s)return a.COMPRESSED_RED_GREEN_RGTC2_EXT;if(36286===s)return a.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT}return s===Ou?r?n.UNSIGNED_INT_24_8:(a=e.get("WEBGL_depth_texture"),null!==a?a.UNSIGNED_INT_24_8_WEBGL:null):void 0!==n[s]?n[s]:null}}}class B1e extends Or{constructor(e=[]){super(),this.isArrayCamera=!0,this.cameras=e}}class k_ extends Gn{constructor(){super(),this.isGroup=!0,this.type="Group"}}const H1e={type:"move"};class ck{constructor(){this._targetRay=null,this._grip=null,this._hand=null}getHandSpace(){return null===this._hand&&(this._hand=new k_,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand}getTargetRaySpace(){return null===this._targetRay&&(this._targetRay=new k_,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1,this._targetRay.hasLinearVelocity=!1,this._targetRay.linearVelocity=new L,this._targetRay.hasAngularVelocity=!1,this._targetRay.angularVelocity=new L),this._targetRay}getGripSpace(){return null===this._grip&&(this._grip=new k_,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1,this._grip.hasLinearVelocity=!1,this._grip.linearVelocity=new L,this._grip.hasAngularVelocity=!1,this._grip.angularVelocity=new L),this._grip}dispatchEvent(e){return null!==this._targetRay&&this._targetRay.dispatchEvent(e),null!==this._grip&&this._grip.dispatchEvent(e),null!==this._hand&&this._hand.dispatchEvent(e),this}connect(e){if(e&&e.hand){const t=this._hand;if(t)for(const r of e.hand.values())this._getHandJoint(t,r)}return this.dispatchEvent({type:"connected",data:e}),this}disconnect(e){return this.dispatchEvent({type:"disconnected",data:e}),null!==this._targetRay&&(this._targetRay.visible=!1),null!==this._grip&&(this._grip.visible=!1),null!==this._hand&&(this._hand.visible=!1),this}update(e,t,r){let i=null,s=null,o=null;const a=this._targetRay,c=this._grip,l=this._hand;if(e&&"visible-blurred"!==t.session.visibilityState){if(l&&e.hand){o=!0;for(const y of e.hand.values()){const _=t.getJointPose(y,r),g=this._getHandJoint(l,y);null!==_&&(g.matrix.fromArray(_.transform.matrix),g.matrix.decompose(g.position,g.rotation,g.scale),g.matrixWorldNeedsUpdate=!0,g.jointRadius=_.radius),g.visible=null!==_}const h=l.joints["index-finger-tip"].position.distanceTo(l.joints["thumb-tip"].position),f=.02,m=.005;l.inputState.pinching&&h>f+m?(l.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:e.handedness,target:this})):!l.inputState.pinching&&h<=f-m&&(l.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:e.handedness,target:this}))}else null!==c&&e.gripSpace&&(s=t.getPose(e.gripSpace,r),null!==s&&(c.matrix.fromArray(s.transform.matrix),c.matrix.decompose(c.position,c.rotation,c.scale),c.matrixWorldNeedsUpdate=!0,s.linearVelocity?(c.hasLinearVelocity=!0,c.linearVelocity.copy(s.linearVelocity)):c.hasLinearVelocity=!1,s.angularVelocity?(c.hasAngularVelocity=!0,c.angularVelocity.copy(s.angularVelocity)):c.hasAngularVelocity=!1));null!==a&&(i=t.getPose(e.targetRaySpace,r),null===i&&null!==s&&(i=s),null!==i&&(a.matrix.fromArray(i.transform.matrix),a.matrix.decompose(a.position,a.rotation,a.scale),a.matrixWorldNeedsUpdate=!0,i.linearVelocity?(a.hasLinearVelocity=!0,a.linearVelocity.copy(i.linearVelocity)):a.hasLinearVelocity=!1,i.angularVelocity?(a.hasAngularVelocity=!0,a.angularVelocity.copy(i.angularVelocity)):a.hasAngularVelocity=!1,this.dispatchEvent(H1e)))}return null!==a&&(a.visible=null!==i),null!==c&&(c.visible=null!==s),null!==l&&(l.visible=null!==o),this}_getHandJoint(e,t){if(void 0===e.joints[t.jointName]){const r=new k_;r.matrixAutoUpdate=!1,r.visible=!1,e.joints[t.jointName]=r,e.add(r)}return e.joints[t.jointName]}}class z1e extends gs{constructor(e,t,r,i,s,o,a,c,l,u){if((u=void 0!==u?u:ku)!==ku&&u!==Af)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");void 0===r&&u===ku&&(r=Xc),void 0===r&&u===Af&&(r=Ou),super(null,i,s,o,a,c,u,r,l),this.isDepthTexture=!0,this.image={width:e,height:t},this.magFilter=void 0!==a?a:Ar,this.minFilter=void 0!==c?c:Ar,this.flipY=!1,this.generateMipmaps=!1,this.compareFunction=null}copy(e){return super.copy(e),this.compareFunction=e.compareFunction,this}toJSON(e){const t=super.toJSON(e);return null!==this.compareFunction&&(t.compareFunction=this.compareFunction),t}}class G1e extends Aa{constructor(e,t){super();const r=this;let i=null,s=1,o=null,a="local-floor",c=1,l=null,u=null,d=null,h=null,f=null,m=null;const y=t.getContextAttributes();let _=null,g=null;const b=[],E=[],x=new Or;x.layers.enable(1),x.viewport=new mn;const M=new Or;M.layers.enable(2),M.viewport=new mn;const C=[x,M],w=new B1e;w.layers.enable(1),w.layers.enable(2);let A=null,T=null;function S(G){const ee=E.indexOf(G.inputSource);if(-1===ee)return;const Te=b[ee];void 0!==Te&&(Te.update(G.inputSource,G.frame,l||o),Te.dispatchEvent({type:G.type,data:G.inputSource}))}function R(){i.removeEventListener("select",S),i.removeEventListener("selectstart",S),i.removeEventListener("selectend",S),i.removeEventListener("squeeze",S),i.removeEventListener("squeezestart",S),i.removeEventListener("squeezeend",S),i.removeEventListener("end",R),i.removeEventListener("inputsourceschange",F);for(let G=0;G<b.length;G++){const ee=E[G];null!==ee&&(E[G]=null,b[G].disconnect(ee))}A=null,T=null,e.setRenderTarget(_),f=null,h=null,d=null,i=null,g=null,ge.stop(),r.isPresenting=!1,r.dispatchEvent({type:"sessionend"})}function F(G){for(let ee=0;ee<G.removed.length;ee++){const Te=G.removed[ee],He=E.indexOf(Te);He>=0&&(E[He]=null,b[He].disconnect(Te))}for(let ee=0;ee<G.added.length;ee++){const Te=G.added[ee];let He=E.indexOf(Te);if(-1===He){for(let ut=0;ut<b.length;ut++){if(ut>=E.length){E.push(Te),He=ut;break}if(null===E[ut]){E[ut]=Te,He=ut;break}}if(-1===He)break}const Ue=b[He];Ue&&Ue.connect(Te)}}this.cameraAutoUpdate=!0,this.enabled=!1,this.isPresenting=!1,this.getController=function(G){let ee=b[G];return void 0===ee&&(ee=new ck,b[G]=ee),ee.getTargetRaySpace()},this.getControllerGrip=function(G){let ee=b[G];return void 0===ee&&(ee=new ck,b[G]=ee),ee.getGripSpace()},this.getHand=function(G){let ee=b[G];return void 0===ee&&(ee=new ck,b[G]=ee),ee.getHandSpace()},this.setFramebufferScaleFactor=function(G){s=G,!0===r.isPresenting&&console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function(G){a=G,!0===r.isPresenting&&console.warn("THREE.WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){return l||o},this.setReferenceSpace=function(G){l=G},this.getBaseLayer=function(){return null!==h?h:f},this.getBinding=function(){return d},this.getFrame=function(){return m},this.getSession=function(){return i},this.setSession=function(){var G=O(function*(ee){if(i=ee,null!==i){if(_=e.getRenderTarget(),i.addEventListener("select",S),i.addEventListener("selectstart",S),i.addEventListener("selectend",S),i.addEventListener("squeeze",S),i.addEventListener("squeezestart",S),i.addEventListener("squeezeend",S),i.addEventListener("end",R),i.addEventListener("inputsourceschange",F),!0!==y.xrCompatible&&(yield t.makeXRCompatible()),void 0===i.renderState.layers||!1===e.capabilities.isWebGL2)f=new XRWebGLLayer(i,t,{antialias:void 0!==i.renderState.layers||y.antialias,alpha:!0,depth:y.depth,stencil:y.stencil,framebufferScaleFactor:s}),i.updateRenderState({baseLayer:f}),g=new Do(f.framebufferWidth,f.framebufferHeight,{format:Os,type:qc,colorSpace:e.outputColorSpace,stencilBuffer:y.stencil});else{let Te=null,He=null,Ue=null;y.depth&&(Ue=y.stencil?t.DEPTH24_STENCIL8:t.DEPTH_COMPONENT24,Te=y.stencil?Af:ku,He=y.stencil?Ou:Xc);const ut={colorFormat:t.RGBA8,depthFormat:Ue,scaleFactor:s};d=new XRWebGLBinding(i,t),h=d.createProjectionLayer(ut),i.updateRenderState({layers:[h]}),g=new Do(h.textureWidth,h.textureHeight,{format:Os,type:qc,depthTexture:new z1e(h.textureWidth,h.textureHeight,He,void 0,void 0,void 0,void 0,void 0,void 0,Te),stencilBuffer:y.stencil,colorSpace:e.outputColorSpace,samples:y.antialias?4:0}),e.properties.get(g).__ignoreDepthValues=h.ignoreDepthValues}g.isXRRenderTarget=!0,this.setFoveation(c),l=null,o=yield i.requestReferenceSpace(a),ge.setContext(i),ge.start(),r.isPresenting=!0,r.dispatchEvent({type:"sessionstart"})}});return function(ee){return G.apply(this,arguments)}}(),this.getEnvironmentBlendMode=function(){if(null!==i)return i.environmentBlendMode};const N=new L,H=new L;function se(G,ee){null===ee?G.matrixWorld.copy(G.matrix):G.matrixWorld.multiplyMatrices(ee.matrixWorld,G.matrix),G.matrixWorldInverse.copy(G.matrixWorld).invert()}this.updateCamera=function(G){if(null===i)return;w.near=M.near=x.near=G.near,w.far=M.far=x.far=G.far,(A!==w.near||T!==w.far)&&(i.updateRenderState({depthNear:w.near,depthFar:w.far}),A=w.near,T=w.far);const ee=G.parent,Te=w.cameras;se(w,ee);for(let He=0;He<Te.length;He++)se(Te[He],ee);2===Te.length?function K(G,ee,Te){N.setFromMatrixPosition(ee.matrixWorld),H.setFromMatrixPosition(Te.matrixWorld);const He=N.distanceTo(H),Ue=ee.projectionMatrix.elements,ut=Te.projectionMatrix.elements,it=Ue[14]/(Ue[10]-1),at=Ue[14]/(Ue[10]+1),yt=(Ue[9]+1)/Ue[5],Ft=(Ue[9]-1)/Ue[5],st=(Ue[8]-1)/Ue[0],U=(ut[8]+1)/ut[0],De=it*st,ie=it*U,ve=He/(-st+U),he=ve*-st;ee.matrixWorld.decompose(G.position,G.quaternion,G.scale),G.translateX(he),G.translateZ(ve),G.matrixWorld.compose(G.position,G.quaternion,G.scale),G.matrixWorldInverse.copy(G.matrixWorld).invert();const Qe=it+ve,Le=at+ve;G.projectionMatrix.makePerspective(De-he,ie+(He-he),yt*at/Le*Qe,Ft*at/Le*Qe,Qe,Le),G.projectionMatrixInverse.copy(G.projectionMatrix).invert()}(w,x,M):w.projectionMatrix.copy(x.projectionMatrix),function ne(G,ee,Te){null===Te?G.matrix.copy(ee.matrixWorld):(G.matrix.copy(Te.matrixWorld),G.matrix.invert(),G.matrix.multiply(ee.matrixWorld)),G.matrix.decompose(G.position,G.quaternion,G.scale),G.updateMatrixWorld(!0),G.projectionMatrix.copy(ee.projectionMatrix),G.projectionMatrixInverse.copy(ee.projectionMatrixInverse),G.isPerspectiveCamera&&(G.fov=2*Rf*Math.atan(1/G.projectionMatrix.elements[5]),G.zoom=1)}(G,w,ee)},this.getCamera=function(){return w},this.getFoveation=function(){if(null!==h||null!==f)return c},this.setFoveation=function(G){c=G,null!==h&&(h.fixedFoveation=G),null!==f&&void 0!==f.fixedFoveation&&(f.fixedFoveation=G)};let ye=null;const ge=new YX;ge.setAnimationLoop(function ce(G,ee){if(u=ee.getViewerPose(l||o),m=ee,null!==u){const Te=u.views;null!==f&&(e.setRenderTargetFramebuffer(g,f.framebuffer),e.setRenderTarget(g));let He=!1;Te.length!==w.cameras.length&&(w.cameras.length=0,He=!0);for(let Ue=0;Ue<Te.length;Ue++){const ut=Te[Ue];let it=null;if(null!==f)it=f.getViewport(ut);else{const yt=d.getViewSubImage(h,ut);it=yt.viewport,0===Ue&&(e.setRenderTargetTextures(g,yt.colorTexture,h.ignoreDepthValues?void 0:yt.depthStencilTexture),e.setRenderTarget(g))}let at=C[Ue];void 0===at&&(at=new Or,at.layers.enable(Ue),at.viewport=new mn,C[Ue]=at),at.matrix.fromArray(ut.transform.matrix),at.matrix.decompose(at.position,at.quaternion,at.scale),at.projectionMatrix.fromArray(ut.projectionMatrix),at.projectionMatrixInverse.copy(at.projectionMatrix).invert(),at.viewport.set(it.x,it.y,it.width,it.height),0===Ue&&(w.matrix.copy(at.matrix),w.matrix.decompose(w.position,w.quaternion,w.scale)),!0===He&&w.cameras.push(at)}}for(let Te=0;Te<b.length;Te++){const He=E[Te],Ue=b[Te];null!==He&&void 0!==Ue&&Ue.update(He,ee,l||o)}ye&&ye(G,ee),ee.detectedPlanes&&r.dispatchEvent({type:"planesdetected",data:ee}),m=null}),this.setAnimationLoop=function(G){ye=G},this.dispose=function(){}}}function W1e(n,e){function t(_,g){!0===_.matrixAutoUpdate&&_.updateMatrix(),g.value.copy(_.matrix)}function s(_,g){_.opacity.value=g.opacity,g.color&&_.diffuse.value.copy(g.color),g.emissive&&_.emissive.value.copy(g.emissive).multiplyScalar(g.emissiveIntensity),g.map&&(_.map.value=g.map,t(g.map,_.mapTransform)),g.alphaMap&&(_.alphaMap.value=g.alphaMap,t(g.alphaMap,_.alphaMapTransform)),g.bumpMap&&(_.bumpMap.value=g.bumpMap,t(g.bumpMap,_.bumpMapTransform),_.bumpScale.value=g.bumpScale,1===g.side&&(_.bumpScale.value*=-1)),g.normalMap&&(_.normalMap.value=g.normalMap,t(g.normalMap,_.normalMapTransform),_.normalScale.value.copy(g.normalScale),1===g.side&&_.normalScale.value.negate()),g.displacementMap&&(_.displacementMap.value=g.displacementMap,t(g.displacementMap,_.displacementMapTransform),_.displacementScale.value=g.displacementScale,_.displacementBias.value=g.displacementBias),g.emissiveMap&&(_.emissiveMap.value=g.emissiveMap,t(g.emissiveMap,_.emissiveMapTransform)),g.specularMap&&(_.specularMap.value=g.specularMap,t(g.specularMap,_.specularMapTransform)),g.alphaTest>0&&(_.alphaTest.value=g.alphaTest);const b=e.get(g).envMap;if(b&&(_.envMap.value=b,_.flipEnvMap.value=b.isCubeTexture&&!1===b.isRenderTargetTexture?-1:1,_.reflectivity.value=g.reflectivity,_.ior.value=g.ior,_.refractionRatio.value=g.refractionRatio),g.lightMap){_.lightMap.value=g.lightMap;const E=!0===n._useLegacyLights?Math.PI:1;_.lightMapIntensity.value=g.lightMapIntensity*E,t(g.lightMap,_.lightMapTransform)}g.aoMap&&(_.aoMap.value=g.aoMap,_.aoMapIntensity.value=g.aoMapIntensity,t(g.aoMap,_.aoMapTransform))}return{refreshFogUniforms:function r(_,g){g.color.getRGB(_.fogColor.value,KX(n)),g.isFog?(_.fogNear.value=g.near,_.fogFar.value=g.far):g.isFogExp2&&(_.fogDensity.value=g.density)},refreshMaterialUniforms:function i(_,g,b,E,x){g.isMeshBasicMaterial||g.isMeshLambertMaterial?s(_,g):g.isMeshToonMaterial?(s(_,g),function d(_,g){g.gradientMap&&(_.gradientMap.value=g.gradientMap)}(_,g)):g.isMeshPhongMaterial?(s(_,g),function u(_,g){_.specular.value.copy(g.specular),_.shininess.value=Math.max(g.shininess,1e-4)}(_,g)):g.isMeshStandardMaterial?(s(_,g),function h(_,g){_.metalness.value=g.metalness,g.metalnessMap&&(_.metalnessMap.value=g.metalnessMap,t(g.metalnessMap,_.metalnessMapTransform)),_.roughness.value=g.roughness,g.roughnessMap&&(_.roughnessMap.value=g.roughnessMap,t(g.roughnessMap,_.roughnessMapTransform)),e.get(g).envMap&&(_.envMapIntensity.value=g.envMapIntensity)}(_,g),g.isMeshPhysicalMaterial&&function f(_,g,b){_.ior.value=g.ior,g.sheen>0&&(_.sheenColor.value.copy(g.sheenColor).multiplyScalar(g.sheen),_.sheenRoughness.value=g.sheenRoughness,g.sheenColorMap&&(_.sheenColorMap.value=g.sheenColorMap,t(g.sheenColorMap,_.sheenColorMapTransform)),g.sheenRoughnessMap&&(_.sheenRoughnessMap.value=g.sheenRoughnessMap,t(g.sheenRoughnessMap,_.sheenRoughnessMapTransform))),g.clearcoat>0&&(_.clearcoat.value=g.clearcoat,_.clearcoatRoughness.value=g.clearcoatRoughness,g.clearcoatMap&&(_.clearcoatMap.value=g.clearcoatMap,t(g.clearcoatMap,_.clearcoatMapTransform)),g.clearcoatRoughnessMap&&(_.clearcoatRoughnessMap.value=g.clearcoatRoughnessMap,t(g.clearcoatRoughnessMap,_.clearcoatRoughnessMapTransform)),g.clearcoatNormalMap&&(_.clearcoatNormalMap.value=g.clearcoatNormalMap,t(g.clearcoatNormalMap,_.clearcoatNormalMapTransform),_.clearcoatNormalScale.value.copy(g.clearcoatNormalScale),1===g.side&&_.clearcoatNormalScale.value.negate())),g.iridescence>0&&(_.iridescence.value=g.iridescence,_.iridescenceIOR.value=g.iridescenceIOR,_.iridescenceThicknessMinimum.value=g.iridescenceThicknessRange[0],_.iridescenceThicknessMaximum.value=g.iridescenceThicknessRange[1],g.iridescenceMap&&(_.iridescenceMap.value=g.iridescenceMap,t(g.iridescenceMap,_.iridescenceMapTransform)),g.iridescenceThicknessMap&&(_.iridescenceThicknessMap.value=g.iridescenceThicknessMap,t(g.iridescenceThicknessMap,_.iridescenceThicknessMapTransform))),g.transmission>0&&(_.transmission.value=g.transmission,_.transmissionSamplerMap.value=b.texture,_.transmissionSamplerSize.value.set(b.width,b.height),g.transmissionMap&&(_.transmissionMap.value=g.transmissionMap,t(g.transmissionMap,_.transmissionMapTransform)),_.thickness.value=g.thickness,g.thicknessMap&&(_.thicknessMap.value=g.thicknessMap,t(g.thicknessMap,_.thicknessMapTransform)),_.attenuationDistance.value=g.attenuationDistance,_.attenuationColor.value.copy(g.attenuationColor)),g.anisotropy>0&&(_.anisotropyVector.value.set(g.anisotropy*Math.cos(g.anisotropyRotation),g.anisotropy*Math.sin(g.anisotropyRotation)),g.anisotropyMap&&(_.anisotropyMap.value=g.anisotropyMap,t(g.anisotropyMap,_.anisotropyMapTransform))),_.specularIntensity.value=g.specularIntensity,_.specularColor.value.copy(g.specularColor),g.specularColorMap&&(_.specularColorMap.value=g.specularColorMap,t(g.specularColorMap,_.specularColorMapTransform)),g.specularIntensityMap&&(_.specularIntensityMap.value=g.specularIntensityMap,t(g.specularIntensityMap,_.specularIntensityMapTransform))}(_,g,x)):g.isMeshMatcapMaterial?(s(_,g),function m(_,g){g.matcap&&(_.matcap.value=g.matcap)}(_,g)):g.isMeshDepthMaterial?s(_,g):g.isMeshDistanceMaterial?(s(_,g),function y(_,g){const b=e.get(g).light;_.referencePosition.value.setFromMatrixPosition(b.matrixWorld),_.nearDistance.value=b.shadow.camera.near,_.farDistance.value=b.shadow.camera.far}(_,g)):g.isMeshNormalMaterial?s(_,g):g.isLineBasicMaterial?(function o(_,g){_.diffuse.value.copy(g.color),_.opacity.value=g.opacity,g.map&&(_.map.value=g.map,t(g.map,_.mapTransform))}(_,g),g.isLineDashedMaterial&&function a(_,g){_.dashSize.value=g.dashSize,_.totalSize.value=g.dashSize+g.gapSize,_.scale.value=g.scale}(_,g)):g.isPointsMaterial?function c(_,g,b,E){_.diffuse.value.copy(g.color),_.opacity.value=g.opacity,_.size.value=g.size*b,_.scale.value=.5*E,g.map&&(_.map.value=g.map,t(g.map,_.uvTransform)),g.alphaMap&&(_.alphaMap.value=g.alphaMap,t(g.alphaMap,_.alphaMapTransform)),g.alphaTest>0&&(_.alphaTest.value=g.alphaTest)}(_,g,b,E):g.isSpriteMaterial?function l(_,g){_.diffuse.value.copy(g.color),_.opacity.value=g.opacity,_.rotation.value=g.rotation,g.map&&(_.map.value=g.map,t(g.map,_.mapTransform)),g.alphaMap&&(_.alphaMap.value=g.alphaMap,t(g.alphaMap,_.alphaMapTransform)),g.alphaTest>0&&(_.alphaTest.value=g.alphaTest)}(_,g):g.isShadowMaterial?(_.color.value.copy(g.color),_.opacity.value=g.opacity):g.isShaderMaterial&&(g.uniformsNeedUpdate=!1)}}}function j1e(n,e,t,r){let i={},s={},o=[];const a=t.isWebGL2?n.getParameter(n.MAX_UNIFORM_BUFFER_BINDINGS):0;function f(b,E,x){const M=b.value;if(void 0===x[E]){if("number"==typeof M)x[E]=M;else{const C=Array.isArray(M)?M:[M],w=[];for(let A=0;A<C.length;A++)w.push(C[A].clone());x[E]=w}return!0}if("number"==typeof M){if(x[E]!==M)return x[E]=M,!0}else{const C=Array.isArray(x[E])?x[E]:[x[E]],w=Array.isArray(M)?M:[M];for(let A=0;A<C.length;A++){const T=C[A];if(!1===T.equals(w[A]))return T.copy(w[A]),!0}}return!1}function y(b){const E={boundary:0,storage:0};return"number"==typeof b?(E.boundary=4,E.storage=4):b.isVector2?(E.boundary=8,E.storage=8):b.isVector3||b.isColor?(E.boundary=16,E.storage=12):b.isVector4?(E.boundary=16,E.storage=16):b.isMatrix3?(E.boundary=48,E.storage=48):b.isMatrix4?(E.boundary=64,E.storage=64):b.isTexture?console.warn("THREE.WebGLRenderer: Texture samplers can not be part of an uniforms group."):console.warn("THREE.WebGLRenderer: Unsupported uniform value type.",b),E}function _(b){const E=b.target;E.removeEventListener("dispose",_);const x=o.indexOf(E.__bindingPointIndex);o.splice(x,1),n.deleteBuffer(i[E.id]),delete i[E.id],delete s[E.id]}return{bind:function c(b,E){r.uniformBlockBinding(b,E.program)},update:function l(b,E){let x=i[b.id];void 0===x&&(function m(b){const E=b.uniforms;let x=0;let C=0;for(let w=0,A=E.length;w<A;w++){const T=E[w],S={boundary:0,storage:0},R=Array.isArray(T.value)?T.value:[T.value];for(let F=0,N=R.length;F<N;F++){const K=y(R[F]);S.boundary+=K.boundary,S.storage+=K.storage}T.__data=new Float32Array(S.storage/Float32Array.BYTES_PER_ELEMENT),T.__offset=x,w>0&&(C=x%16,0!==C&&16-C-S.boundary<0&&(x+=16-C,T.__offset=x)),x+=S.storage}C=x%16,C>0&&(x+=16-C),b.__size=x,b.__cache={}}(b),x=function u(b){const E=function d(){for(let b=0;b<a;b++)if(-1===o.indexOf(b))return o.push(b),b;return console.error("THREE.WebGLRenderer: Maximum number of simultaneously usable uniforms groups reached."),0}();b.__bindingPointIndex=E;const x=n.createBuffer(),M=b.__size,C=b.usage;return n.bindBuffer(n.UNIFORM_BUFFER,x),n.bufferData(n.UNIFORM_BUFFER,M,C),n.bindBuffer(n.UNIFORM_BUFFER,null),n.bindBufferBase(n.UNIFORM_BUFFER,E,x),x}(b),i[b.id]=x,b.addEventListener("dispose",_)),r.updateUBOMapping(b,E.program);const C=e.render.frame;s[b.id]!==C&&(function h(b){const x=b.uniforms,M=b.__cache;n.bindBuffer(n.UNIFORM_BUFFER,i[b.id]);for(let C=0,w=x.length;C<w;C++){const A=x[C];if(!0===f(A,C,M)){const T=A.__offset,S=Array.isArray(A.value)?A.value:[A.value];let R=0;for(let F=0;F<S.length;F++){const N=S[F],H=y(N);"number"==typeof N?(A.__data[0]=N,n.bufferSubData(n.UNIFORM_BUFFER,T+R,A.__data)):N.isMatrix3?(A.__data[0]=N.elements[0],A.__data[1]=N.elements[1],A.__data[2]=N.elements[2],A.__data[3]=N.elements[0],A.__data[4]=N.elements[3],A.__data[5]=N.elements[4],A.__data[6]=N.elements[5],A.__data[7]=N.elements[0],A.__data[8]=N.elements[6],A.__data[9]=N.elements[7],A.__data[10]=N.elements[8],A.__data[11]=N.elements[0]):(N.toArray(A.__data,R),R+=H.storage/Float32Array.BYTES_PER_ELEMENT)}n.bufferSubData(n.UNIFORM_BUFFER,T,A.__data)}}n.bindBuffer(n.UNIFORM_BUFFER,null)}(b),s[b.id]=C)},dispose:function g(){for(const b in i)n.deleteBuffer(i[b]);o=[],i={},s={}}}}class ew{constructor(e={}){const{canvas:t=IMe(),context:r=null,depth:i=!0,stencil:s=!0,alpha:o=!1,antialias:a=!1,premultipliedAlpha:c=!0,preserveDrawingBuffer:l=!1,powerPreference:u="default",failIfMajorPerformanceCaveat:d=!1}=e;let h;this.isWebGLRenderer=!0,h=null!==r?r.getContextAttributes().alpha:o;const f=new Uint32Array(4),m=new Int32Array(4);let y=null,_=null;const g=[],b=[];this.domElement=t,this.debug={checkShaderErrors:!0,onShaderError:null},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this._outputColorSpace=jr,this._useLegacyLights=!1,this.toneMapping=0,this.toneMappingExposure=1;const E=this;let x=!1,M=0,C=0,w=null,A=-1,T=null;const S=new mn,R=new mn;let F=null;const N=new Ge(0);let H=0,K=t.width,se=t.height,ne=1,ye=null,ce=null;const ge=new mn(0,0,K,se),G=new mn(0,0,K,se);let ee=!1;const Te=new QO;let He=!1,Ue=!1,ut=null;const it=new Pt,at=new oe,yt=new L,Ft={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};function st(){return null===w?ne:1}let ie,ve,he,Qe,Le,je,dt,Nt,yn,V,D,X,be,le,pe,qe,xe,ke,B,we,de,ht,Ke,ot,U=r;function De(k,W){for(let Y=0;Y<k.length;Y++){const Q=t.getContext(k[Y],W);if(null!==Q)return Q}return null}try{const k={alpha:!0,depth:i,stencil:s,antialias:a,premultipliedAlpha:c,preserveDrawingBuffer:l,powerPreference:u,failIfMajorPerformanceCaveat:d};if("setAttribute"in t&&t.setAttribute("data-engine","three.js r158"),t.addEventListener("webglcontextlost",Ht,!1),t.addEventListener("webglcontextrestored",z,!1),t.addEventListener("webglcontextcreationerror",Ce,!1),null===U){const W=["webgl2","webgl","experimental-webgl"];if(!0===E.isWebGL1Renderer&&W.shift(),U=De(W,k),null===U)throw De(W)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}typeof WebGLRenderingContext<"u"&&U instanceof WebGLRenderingContext&&console.warn("THREE.WebGLRenderer: WebGL 1 support was deprecated in r153 and will be removed in r163."),void 0===U.getShaderPrecisionFormat&&(U.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}})}catch(k){throw console.error("THREE.WebGLRenderer: "+k.message),k}function Ye(){ie=new rRe(U),ve=new JDe(U,ie,e),ie.init(ve),ht=new U1e(U,ie,ve),he=new F1e(U,ie,ve),Qe=new oRe(U),Le=new S1e,je=new V1e(U,ie,he,Le,ve,ht,Qe),dt=new QDe(E),Nt=new nRe(E),yn=new YMe(U,ve),Ke=new KDe(U,ie,yn,ve),V=new iRe(U,yn,Qe,Ke),D=new uRe(U,V,yn,Qe),B=new lRe(U,ve,je),qe=new ZDe(Le),X=new I1e(E,dt,Nt,ie,ve,Ke,qe),be=new W1e(E,Le),le=new A1e,pe=new N1e(ie,ve),ke=new XDe(E,dt,Nt,he,D,h,c),xe=new L1e(E,D,ve),ot=new j1e(U,Qe,ve,he),we=new YDe(U,ie,Qe,ve),de=new sRe(U,ie,Qe,ve),Qe.programs=X.programs,E.capabilities=ve,E.extensions=ie,E.properties=Le,E.renderLists=le,E.shadowMap=xe,E.state=he,E.info=Qe}Ye();const We=new G1e(E,U);function Ht(k){k.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),x=!0}function z(){console.log("THREE.WebGLRenderer: Context Restored."),x=!1;const k=Qe.autoReset,W=xe.enabled,Y=xe.autoUpdate,Z=xe.needsUpdate,Q=xe.type;Ye(),Qe.autoReset=k,xe.enabled=W,xe.autoUpdate=Y,xe.needsUpdate=Z,xe.type=Q}function Ce(k){console.error("THREE.WebGLRenderer: A WebGL context could not be created. Reason: ",k.statusMessage)}function _e(k){const W=k.target;W.removeEventListener("dispose",_e),function te(k){(function Ee(k){const W=Le.get(k).programs;void 0!==W&&(W.forEach(function(Y){X.releaseProgram(Y)}),k.isShaderMaterial&&X.releaseShaderCache(k))})(k),Le.remove(k)}(W)}function nt(k,W,Y){!0===k.transparent&&2===k.side&&!1===k.forceSinglePass?(k.side=1,k.needsUpdate=!0,to(k,W,Y),k.side=0,k.needsUpdate=!0,to(k,W,Y),k.side=2):to(k,W,Y)}this.xr=We,this.getContext=function(){return U},this.getContextAttributes=function(){return U.getContextAttributes()},this.forceContextLoss=function(){const k=ie.get("WEBGL_lose_context");k&&k.loseContext()},this.forceContextRestore=function(){const k=ie.get("WEBGL_lose_context");k&&k.restoreContext()},this.getPixelRatio=function(){return ne},this.setPixelRatio=function(k){void 0!==k&&(ne=k,this.setSize(K,se,!1))},this.getSize=function(k){return k.set(K,se)},this.setSize=function(k,W,Y=!0){We.isPresenting?console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting."):(K=k,se=W,t.width=Math.floor(k*ne),t.height=Math.floor(W*ne),!0===Y&&(t.style.width=k+"px",t.style.height=W+"px"),this.setViewport(0,0,k,W))},this.getDrawingBufferSize=function(k){return k.set(K*ne,se*ne).floor()},this.setDrawingBufferSize=function(k,W,Y){K=k,se=W,ne=Y,t.width=Math.floor(k*Y),t.height=Math.floor(W*Y),this.setViewport(0,0,k,W)},this.getCurrentViewport=function(k){return k.copy(S)},this.getViewport=function(k){return k.copy(ge)},this.setViewport=function(k,W,Y,Z){k.isVector4?ge.set(k.x,k.y,k.z,k.w):ge.set(k,W,Y,Z),he.viewport(S.copy(ge).multiplyScalar(ne).floor())},this.getScissor=function(k){return k.copy(G)},this.setScissor=function(k,W,Y,Z){k.isVector4?G.set(k.x,k.y,k.z,k.w):G.set(k,W,Y,Z),he.scissor(R.copy(G).multiplyScalar(ne).floor())},this.getScissorTest=function(){return ee},this.setScissorTest=function(k){he.setScissorTest(ee=k)},this.setOpaqueSort=function(k){ye=k},this.setTransparentSort=function(k){ce=k},this.getClearColor=function(k){return k.copy(ke.getClearColor())},this.setClearColor=function(){ke.setClearColor.apply(ke,arguments)},this.getClearAlpha=function(){return ke.getClearAlpha()},this.setClearAlpha=function(){ke.setClearAlpha.apply(ke,arguments)},this.clear=function(k=!0,W=!0,Y=!0){let Z=0;if(k){let Q=!1;if(null!==w){const ze=w.texture.format;Q=1033===ze||1031===ze||1029===ze}if(Q){const ze=w.texture.type,et=ze===qc||ze===Xc||1012===ze||ze===Ou||1017===ze||1018===ze,ft=ke.getClearColor(),vt=ke.getClearAlpha(),Mt=ft.r,It=ft.g,St=ft.b;et?(f[0]=Mt,f[1]=It,f[2]=St,f[3]=vt,U.clearBufferuiv(U.COLOR,0,f)):(m[0]=Mt,m[1]=It,m[2]=St,m[3]=vt,U.clearBufferiv(U.COLOR,0,m))}else Z|=U.COLOR_BUFFER_BIT}W&&(Z|=U.DEPTH_BUFFER_BIT),Y&&(Z|=U.STENCIL_BUFFER_BIT,this.state.buffers.stencil.setMask(4294967295)),U.clear(Z)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){t.removeEventListener("webglcontextlost",Ht,!1),t.removeEventListener("webglcontextrestored",z,!1),t.removeEventListener("webglcontextcreationerror",Ce,!1),le.dispose(),pe.dispose(),Le.dispose(),dt.dispose(),Nt.dispose(),D.dispose(),Ke.dispose(),ot.dispose(),X.dispose(),We.dispose(),We.removeEventListener("sessionstart",qr),We.removeEventListener("sessionend",cn),ut&&(ut.dispose(),ut=null),en.stop()},this.renderBufferDirect=function(k,W,Y,Z,Q,ze){null===W&&(W=Ft);const et=Q.isMesh&&Q.matrixWorld.determinant()<0,ft=function yp(k,W,Y,Z,Q){!0!==W.isScene&&(W=Ft),je.resetTextureUnits();const ze=W.fog,ft=null===w?E.outputColorSpace:!0===w.isXRRenderTarget?w.texture.colorSpace:Sa,vt=(Z.isMeshStandardMaterial?Nt:dt).get(Z.envMap||(Z.isMeshStandardMaterial?W.environment:null)),Mt=!0===Z.vertexColors&&!!Y.attributes.color&&4===Y.attributes.color.itemSize,It=!!Y.attributes.tangent&&(!!Z.normalMap||Z.anisotropy>0),St=!!Y.morphAttributes.position,vn=!!Y.morphAttributes.normal,_r=!!Y.morphAttributes.color;let ar=0;Z.toneMapped&&(null===w||!0===w.isXRRenderTarget)&&(ar=E.toneMapping);const no=Y.morphAttributes.position||Y.morphAttributes.normal||Y.morphAttributes.color,Fn=void 0!==no?no.length:0,zt=Le.get(Z),vp=_.state.lights;!0!==He||!0!==Ue&&k===T||qe.setState(Z,k,k===T&&Z.id===A);let Wn=!1;Z.version===zt.__version?(zt.needsLights&&zt.lightsStateVersion!==vp.state.version||zt.outputColorSpace!==ft||Q.isInstancedMesh&&!1===zt.instancing||!Q.isInstancedMesh&&!0===zt.instancing||Q.isSkinnedMesh&&!1===zt.skinning||!Q.isSkinnedMesh&&!0===zt.skinning||Q.isInstancedMesh&&!0===zt.instancingColor&&null===Q.instanceColor||Q.isInstancedMesh&&!1===zt.instancingColor&&null!==Q.instanceColor||zt.envMap!==vt||!0===Z.fog&&zt.fog!==ze||void 0!==zt.numClippingPlanes&&(zt.numClippingPlanes!==qe.numPlanes||zt.numIntersection!==qe.numIntersection)||zt.vertexAlphas!==Mt||zt.vertexTangents!==It||zt.morphTargets!==St||zt.morphNormals!==vn||zt.morphColors!==_r||zt.toneMapping!==ar||!0===ve.isWebGL2&&zt.morphTargetsCount!==Fn)&&(Wn=!0):(Wn=!0,zt.__version=Z.version);let ro=zt.currentProgram;!0===Wn&&(ro=to(Z,W,Q));let ry=!1,ol=!1,iy=!1;const ii=ro.getUniforms(),Lo=zt.uniforms;if(he.useProgram(ro.program)&&(ry=!0,ol=!0,iy=!0),Z.id!==A&&(A=Z.id,ol=!0),ry||T!==k){ii.setValue(U,"projectionMatrix",k.projectionMatrix),ii.setValue(U,"viewMatrix",k.matrixWorldInverse);const Li=ii.map.cameraPosition;void 0!==Li&&Li.setValue(U,yt.setFromMatrixPosition(k.matrixWorld)),ve.logarithmicDepthBuffer&&ii.setValue(U,"logDepthBufFC",2/(Math.log(k.far+1)/Math.LN2)),(Z.isMeshPhongMaterial||Z.isMeshToonMaterial||Z.isMeshLambertMaterial||Z.isMeshBasicMaterial||Z.isMeshStandardMaterial||Z.isShaderMaterial)&&ii.setValue(U,"isOrthographic",!0===k.isOrthographicCamera),T!==k&&(T=k,ol=!0,iy=!0)}if(Q.isSkinnedMesh){ii.setOptional(U,Q,"bindMatrix"),ii.setOptional(U,Q,"bindMatrixInverse");const Li=Q.skeleton;Li&&(ve.floatVertexTextures?(null===Li.boneTexture&&Li.computeBoneTexture(),ii.setValue(U,"boneTexture",Li.boneTexture,je),ii.setValue(U,"boneTextureSize",Li.boneTextureSize)):console.warn("THREE.WebGLRenderer: SkinnedMesh can only be used with WebGL 2. With WebGL 1 OES_texture_float and vertex textures support is required."))}const Ep=Y.morphAttributes;if((void 0!==Ep.position||void 0!==Ep.normal||void 0!==Ep.color&&!0===ve.isWebGL2)&&B.update(Q,Y,ro),(ol||zt.receiveShadow!==Q.receiveShadow)&&(zt.receiveShadow=Q.receiveShadow,ii.setValue(U,"receiveShadow",Q.receiveShadow)),Z.isMeshGouraudMaterial&&null!==Z.envMap&&(Lo.envMap.value=vt,Lo.flipEnvMap.value=vt.isCubeTexture&&!1===vt.isRenderTargetTexture?-1:1),ol&&(ii.setValue(U,"toneMappingExposure",E.toneMappingExposure),zt.needsLights&&function Zw(k,W){k.ambientLightColor.needsUpdate=W,k.lightProbe.needsUpdate=W,k.directionalLights.needsUpdate=W,k.directionalLightShadows.needsUpdate=W,k.pointLights.needsUpdate=W,k.pointLightShadows.needsUpdate=W,k.spotLights.needsUpdate=W,k.spotLightShadows.needsUpdate=W,k.rectAreaLights.needsUpdate=W,k.hemisphereLights.needsUpdate=W}(Lo,iy),ze&&!0===Z.fog&&be.refreshFogUniforms(Lo,ze),be.refreshMaterialUniforms(Lo,Z,ne,se,ut),QT.upload(U,Yw(zt),Lo,je)),Z.isShaderMaterial&&!0===Z.uniformsNeedUpdate&&(QT.upload(U,Yw(zt),Lo,je),Z.uniformsNeedUpdate=!1),Z.isSpriteMaterial&&ii.setValue(U,"center",Q.center),ii.setValue(U,"modelViewMatrix",Q.modelViewMatrix),ii.setValue(U,"normalMatrix",Q.normalMatrix),ii.setValue(U,"modelMatrix",Q.matrixWorld),Z.isShaderMaterial||Z.isRawShaderMaterial){const Li=Z.uniformsGroups;for(let io=0,so=Li.length;io<so;io++)if(ve.isWebGL2){const ld=Li[io];ot.update(ld,ro),ot.bind(ld,ro)}else console.warn("THREE.WebGLRenderer: Uniform Buffer Objects can only be used with WebGL 2.")}return ro}(k,W,Y,Z,Q);he.setMaterial(Z,et);let vt=Y.index,Mt=1;if(!0===Z.wireframe){if(vt=V.getWireframeAttribute(Y),void 0===vt)return;Mt=2}const It=Y.drawRange,St=Y.attributes.position;let vn=It.start*Mt,_r=(It.start+It.count)*Mt;null!==ze&&(vn=Math.max(vn,ze.start*Mt),_r=Math.min(_r,(ze.start+ze.count)*Mt)),null!==vt?(vn=Math.max(vn,0),_r=Math.min(_r,vt.count)):null!=St&&(vn=Math.max(vn,0),_r=Math.min(_r,St.count));const ar=_r-vn;if(ar<0||ar===1/0)return;Ke.setup(Q,Z,ft,Y,vt);let no,Fn=we;if(null!==vt&&(no=yn.get(vt),Fn=de,Fn.setIndex(no)),Q.isMesh)!0===Z.wireframe?(he.setLineWidth(Z.wireframeLinewidth*st()),Fn.setMode(U.LINES)):Fn.setMode(U.TRIANGLES);else if(Q.isLine){let zt=Z.linewidth;void 0===zt&&(zt=1),he.setLineWidth(zt*st()),Fn.setMode(Q.isLineSegments?U.LINES:Q.isLineLoop?U.LINE_LOOP:U.LINE_STRIP)}else Q.isPoints?Fn.setMode(U.POINTS):Q.isSprite&&Fn.setMode(U.TRIANGLES);if(Q.isInstancedMesh)Fn.renderInstances(vn,ar,Q.count);else if(Y.isInstancedBufferGeometry){const vp=Math.min(Y.instanceCount,void 0!==Y._maxInstanceCount?Y._maxInstanceCount:1/0);Fn.renderInstances(vn,ar,vp)}else Fn.render(vn,ar)},this.compile=function(k,W,Y=null){null===Y&&(Y=k),_=pe.get(Y),_.init(),b.push(_),Y.traverseVisible(function(Q){Q.isLight&&Q.layers.test(W.layers)&&(_.pushLight(Q),Q.castShadow&&_.pushShadow(Q))}),k!==Y&&k.traverseVisible(function(Q){Q.isLight&&Q.layers.test(W.layers)&&(_.pushLight(Q),Q.castShadow&&_.pushShadow(Q))}),_.setupLights(E._useLegacyLights);const Z=new Set;return k.traverse(function(Q){const ze=Q.material;if(ze)if(Array.isArray(ze))for(let et=0;et<ze.length;et++){const ft=ze[et];nt(ft,Y,Q),Z.add(ft)}else nt(ze,Y,Q),Z.add(ze)}),b.pop(),_=null,Z},this.compileAsync=function(k,W,Y=null){const Z=this.compile(k,W,Y);return new Promise(Q=>{function ze(){Z.forEach(function(et){Le.get(et).currentProgram.isReady()&&Z.delete(et)}),0!==Z.size?setTimeout(ze,10):Q(k)}null!==ie.get("KHR_parallel_shader_compile")?ze():setTimeout(ze,10)})};let kt=null;function qr(){en.stop()}function cn(){en.start()}const en=new YX;function bs(k,W,Y,Z){if(!1===k.visible)return;if(k.layers.test(W.layers))if(k.isGroup)Y=k.renderOrder;else if(k.isLOD)!0===k.autoUpdate&&k.update(W);else if(k.isLight)_.pushLight(k),k.castShadow&&_.pushShadow(k);else if(k.isSprite){if(!k.frustumCulled||Te.intersectsSprite(k)){Z&&yt.setFromMatrixPosition(k.matrixWorld).applyMatrix4(it);const et=D.update(k),ft=k.material;ft.visible&&y.push(k,et,ft,Y,yt.z,null)}}else if((k.isMesh||k.isLine||k.isPoints)&&(!k.frustumCulled||Te.intersectsObject(k))){const et=D.update(k),ft=k.material;if(Z&&(void 0!==k.boundingSphere?(null===k.boundingSphere&&k.computeBoundingSphere(),yt.copy(k.boundingSphere.center)):(null===et.boundingSphere&&et.computeBoundingSphere(),yt.copy(et.boundingSphere.center)),yt.applyMatrix4(k.matrixWorld).applyMatrix4(it)),Array.isArray(ft)){const vt=et.groups;for(let Mt=0,It=vt.length;Mt<It;Mt++){const St=vt[Mt],vn=ft[St.materialIndex];vn&&vn.visible&&y.push(k,et,vn,Y,yt.z,St)}}else ft.visible&&y.push(k,et,ft,Y,yt.z,null)}const ze=k.children;for(let et=0,ft=ze.length;et<ft;et++)bs(ze[et],W,Y,Z)}function sl(k,W,Y,Z){const Q=k.opaque,ze=k.transmissive,et=k.transparent;_.setupLightsView(Y),!0===He&&qe.setGlobalState(E.clippingPlanes,Y),ze.length>0&&function cd(k,W,Y,Z){if(null!==(!0===Y.isScene?Y.overrideMaterial:null))return;const ze=ve.isWebGL2;null===ut&&(ut=new Do(1,1,{generateMipmaps:!0,type:ie.has("EXT_color_buffer_half_float")?S_:qc,minFilter:Nu,samples:ze?4:0})),E.getDrawingBufferSize(at),ze?ut.setSize(at.x,at.y):ut.setSize(MT(at.x),MT(at.y));const et=E.getRenderTarget();E.setRenderTarget(ut),E.getClearColor(N),H=E.getClearAlpha(),H<1&&E.setClearColor(16777215,.5),E.clear();const ft=E.toneMapping;E.toneMapping=0,_p(k,Y,Z),je.updateMultisampleRenderTarget(ut),je.updateRenderTargetMipmap(ut);let vt=!1;for(let Mt=0,It=W.length;Mt<It;Mt++){const St=W[Mt],vn=St.object,_r=St.geometry,ar=St.material,no=St.group;if(2===ar.side&&vn.layers.test(Z.layers)){const Fn=ar.side;ar.side=1,ar.needsUpdate=!0,Kw(vn,Y,Z,_r,ar,no),ar.side=Fn,ar.needsUpdate=!0,vt=!0}}!0===vt&&(je.updateMultisampleRenderTarget(ut),je.updateRenderTargetMipmap(ut)),E.setRenderTarget(et),E.setClearColor(N,H),E.toneMapping=ft}(Q,ze,W,Y),Z&&he.viewport(S.copy(Z)),Q.length>0&&_p(Q,W,Y),ze.length>0&&_p(ze,W,Y),et.length>0&&_p(et,W,Y),he.buffers.depth.setTest(!0),he.buffers.depth.setMask(!0),he.buffers.color.setMask(!0),he.setPolygonOffset(!1)}function _p(k,W,Y){const Z=!0===W.isScene?W.overrideMaterial:null;for(let Q=0,ze=k.length;Q<ze;Q++){const et=k[Q],ft=et.object,vt=et.geometry,Mt=null===Z?et.material:Z,It=et.group;ft.layers.test(Y.layers)&&Kw(ft,W,Y,vt,Mt,It)}}function Kw(k,W,Y,Z,Q,ze){k.onBeforeRender(E,W,Y,Z,Q,ze),k.modelViewMatrix.multiplyMatrices(Y.matrixWorldInverse,k.matrixWorld),k.normalMatrix.getNormalMatrix(k.modelViewMatrix),Q.onBeforeRender(E,W,Y,Z,k,ze),!0===Q.transparent&&2===Q.side&&!1===Q.forceSinglePass?(Q.side=1,Q.needsUpdate=!0,E.renderBufferDirect(Y,W,Z,Q,k,ze),Q.side=0,Q.needsUpdate=!0,E.renderBufferDirect(Y,W,Z,Q,k,ze),Q.side=2):E.renderBufferDirect(Y,W,Z,Q,k,ze),k.onAfterRender(E,W,Y,Z,Q,ze)}function to(k,W,Y){!0!==W.isScene&&(W=Ft);const Z=Le.get(k),Q=_.state.lights,et=Q.state.version,ft=X.getParameters(k,Q.state,_.state.shadowsArray,W,Y),vt=X.getProgramCacheKey(ft);let Mt=Z.programs;Z.environment=k.isMeshStandardMaterial?W.environment:null,Z.fog=W.fog,Z.envMap=(k.isMeshStandardMaterial?Nt:dt).get(k.envMap||Z.environment),void 0===Mt&&(k.addEventListener("dispose",_e),Mt=new Map,Z.programs=Mt);let It=Mt.get(vt);if(void 0!==It){if(Z.currentProgram===It&&Z.lightsStateVersion===et)return Jw(k,ft),It}else ft.uniforms=X.getUniforms(k),k.onBuild(Y,ft,E),k.onBeforeCompile(ft,E),It=X.acquireProgram(ft,vt),Mt.set(vt,It),Z.uniforms=ft.uniforms;const St=Z.uniforms;return(!k.isShaderMaterial&&!k.isRawShaderMaterial||!0===k.clipping)&&(St.clippingPlanes=qe.uniform),Jw(k,ft),Z.needsLights=function ny(k){return k.isMeshLambertMaterial||k.isMeshToonMaterial||k.isMeshPhongMaterial||k.isMeshStandardMaterial||k.isShadowMaterial||k.isShaderMaterial&&!0===k.lights}(k),Z.lightsStateVersion=et,Z.needsLights&&(St.ambientLightColor.value=Q.state.ambient,St.lightProbe.value=Q.state.probe,St.directionalLights.value=Q.state.directional,St.directionalLightShadows.value=Q.state.directionalShadow,St.spotLights.value=Q.state.spot,St.spotLightShadows.value=Q.state.spotShadow,St.rectAreaLights.value=Q.state.rectArea,St.ltc_1.value=Q.state.rectAreaLTC1,St.ltc_2.value=Q.state.rectAreaLTC2,St.pointLights.value=Q.state.point,St.pointLightShadows.value=Q.state.pointShadow,St.hemisphereLights.value=Q.state.hemi,St.directionalShadowMap.value=Q.state.directionalShadowMap,St.directionalShadowMatrix.value=Q.state.directionalShadowMatrix,St.spotShadowMap.value=Q.state.spotShadowMap,St.spotLightMatrix.value=Q.state.spotLightMatrix,St.spotLightMap.value=Q.state.spotLightMap,St.pointShadowMap.value=Q.state.pointShadowMap,St.pointShadowMatrix.value=Q.state.pointShadowMatrix),Z.currentProgram=It,Z.uniformsList=null,It}function Yw(k){if(null===k.uniformsList){const W=k.currentProgram.getUniforms();k.uniformsList=QT.seqWithValue(W.seq,k.uniforms)}return k.uniformsList}function Jw(k,W){const Y=Le.get(k);Y.outputColorSpace=W.outputColorSpace,Y.instancing=W.instancing,Y.instancingColor=W.instancingColor,Y.skinning=W.skinning,Y.morphTargets=W.morphTargets,Y.morphNormals=W.morphNormals,Y.morphColors=W.morphColors,Y.morphTargetsCount=W.morphTargetsCount,Y.numClippingPlanes=W.numClippingPlanes,Y.numIntersection=W.numClipIntersection,Y.vertexAlphas=W.vertexAlphas,Y.vertexTangents=W.vertexTangents,Y.toneMapping=W.toneMapping}en.setAnimationLoop(function Jn(k){kt&&kt(k)}),typeof self<"u"&&en.setContext(self),this.setAnimationLoop=function(k){kt=k,We.setAnimationLoop(k),null===k?en.stop():en.start()},We.addEventListener("sessionstart",qr),We.addEventListener("sessionend",cn),this.render=function(k,W){if(void 0===W||!0===W.isCamera){if(!0!==x){if(!0===k.matrixWorldAutoUpdate&&k.updateMatrixWorld(),null===W.parent&&!0===W.matrixWorldAutoUpdate&&W.updateMatrixWorld(),!0===We.enabled&&!0===We.isPresenting&&(!0===We.cameraAutoUpdate&&We.updateCamera(W),W=We.getCamera()),!0===k.isScene&&k.onBeforeRender(E,k,W,w),_=pe.get(k,b.length),_.init(),b.push(_),it.multiplyMatrices(W.projectionMatrix,W.matrixWorldInverse),Te.setFromProjectionMatrix(it),Ue=this.localClippingEnabled,He=qe.init(this.clippingPlanes,Ue),y=le.get(k,g.length),y.init(),g.push(y),bs(k,W,0,E.sortObjects),y.finish(),!0===E.sortObjects&&y.sort(ye,ce),this.info.render.frame++,!0===He&&qe.beginShadows(),xe.render(_.state.shadowsArray,k,W),!0===He&&qe.endShadows(),!0===this.info.autoReset&&this.info.reset(),ke.render(y,k),_.setupLights(E._useLegacyLights),W.isArrayCamera){const Z=W.cameras;for(let Q=0,ze=Z.length;Q<ze;Q++){const et=Z[Q];sl(y,k,et,et.viewport)}}else sl(y,k,W);null!==w&&(je.updateMultisampleRenderTarget(w),je.updateRenderTargetMipmap(w)),!0===k.isScene&&k.onAfterRender(E,k,W),Ke.resetDefaultState(),A=-1,T=null,b.pop(),_=b.length>0?b[b.length-1]:null,g.pop(),y=g.length>0?g[g.length-1]:null}}else console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.")},this.getActiveCubeFace=function(){return M},this.getActiveMipmapLevel=function(){return C},this.getRenderTarget=function(){return w},this.setRenderTargetTextures=function(k,W,Y){Le.get(k.texture).__webglTexture=W,Le.get(k.depthTexture).__webglTexture=Y;const Z=Le.get(k);Z.__hasExternalTextures=!0,Z.__hasExternalTextures&&(Z.__autoAllocateDepthBuffer=void 0===Y,Z.__autoAllocateDepthBuffer||!0===ie.has("WEBGL_multisampled_render_to_texture")&&(console.warn("THREE.WebGLRenderer: Render-to-texture extension was disabled because an external texture was provided"),Z.__useRenderToTexture=!1))},this.setRenderTargetFramebuffer=function(k,W){const Y=Le.get(k);Y.__webglFramebuffer=W,Y.__useDefaultFramebuffer=void 0===W},this.setRenderTarget=function(k,W=0,Y=0){w=k,M=W,C=Y;let Z=!0,Q=null,ze=!1,et=!1;if(k){const vt=Le.get(k);void 0!==vt.__useDefaultFramebuffer?(he.bindFramebuffer(U.FRAMEBUFFER,null),Z=!1):void 0===vt.__webglFramebuffer?je.setupRenderTarget(k):vt.__hasExternalTextures&&je.rebindTextures(k,Le.get(k.texture).__webglTexture,Le.get(k.depthTexture).__webglTexture);const Mt=k.texture;(Mt.isData3DTexture||Mt.isDataArrayTexture||Mt.isCompressedArrayTexture)&&(et=!0);const It=Le.get(k).__webglFramebuffer;k.isWebGLCubeRenderTarget?(Q=Array.isArray(It[W])?It[W][Y]:It[W],ze=!0):Q=ve.isWebGL2&&k.samples>0&&!1===je.useMultisampledRTT(k)?Le.get(k).__webglMultisampledFramebuffer:Array.isArray(It)?It[Y]:It,S.copy(k.viewport),R.copy(k.scissor),F=k.scissorTest}else S.copy(ge).multiplyScalar(ne).floor(),R.copy(G).multiplyScalar(ne).floor(),F=ee;if(he.bindFramebuffer(U.FRAMEBUFFER,Q)&&ve.drawBuffers&&Z&&he.drawBuffers(k,Q),he.viewport(S),he.scissor(R),he.setScissorTest(F),ze){const vt=Le.get(k.texture);U.framebufferTexture2D(U.FRAMEBUFFER,U.COLOR_ATTACHMENT0,U.TEXTURE_CUBE_MAP_POSITIVE_X+W,vt.__webglTexture,Y)}else if(et){const vt=Le.get(k.texture);U.framebufferTextureLayer(U.FRAMEBUFFER,U.COLOR_ATTACHMENT0,vt.__webglTexture,Y||0,W||0)}A=-1},this.readRenderTargetPixels=function(k,W,Y,Z,Q,ze,et){if(!k||!k.isWebGLRenderTarget)return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");let ft=Le.get(k).__webglFramebuffer;if(k.isWebGLCubeRenderTarget&&void 0!==et&&(ft=ft[et]),ft){he.bindFramebuffer(U.FRAMEBUFFER,ft);try{const vt=k.texture,Mt=vt.format,It=vt.type;if(Mt!==Os&&ht.convert(Mt)!==U.getParameter(U.IMPLEMENTATION_COLOR_READ_FORMAT))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");const St=It===S_&&(ie.has("EXT_color_buffer_half_float")||ve.isWebGL2&&ie.has("EXT_color_buffer_float"));if(!(It===qc||ht.convert(It)===U.getParameter(U.IMPLEMENTATION_COLOR_READ_TYPE)||It===Ia&&(ve.isWebGL2||ie.has("OES_texture_float")||ie.has("WEBGL_color_buffer_float"))||St))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");W>=0&&W<=k.width-Z&&Y>=0&&Y<=k.height-Q&&U.readPixels(W,Y,Z,Q,ht.convert(Mt),ht.convert(It),ze)}finally{const vt=null!==w?Le.get(w).__webglFramebuffer:null;he.bindFramebuffer(U.FRAMEBUFFER,vt)}}},this.copyFramebufferToTexture=function(k,W,Y=0){const Z=Math.pow(2,-Y),Q=Math.floor(W.image.width*Z),ze=Math.floor(W.image.height*Z);je.setTexture2D(W,0),U.copyTexSubImage2D(U.TEXTURE_2D,Y,0,0,k.x,k.y,Q,ze),he.unbindTexture()},this.copyTextureToTexture=function(k,W,Y,Z=0){const Q=W.image.width,ze=W.image.height,et=ht.convert(Y.format),ft=ht.convert(Y.type);je.setTexture2D(Y,0),U.pixelStorei(U.UNPACK_FLIP_Y_WEBGL,Y.flipY),U.pixelStorei(U.UNPACK_PREMULTIPLY_ALPHA_WEBGL,Y.premultiplyAlpha),U.pixelStorei(U.UNPACK_ALIGNMENT,Y.unpackAlignment),W.isDataTexture?U.texSubImage2D(U.TEXTURE_2D,Z,k.x,k.y,Q,ze,et,ft,W.image.data):W.isCompressedTexture?U.compressedTexSubImage2D(U.TEXTURE_2D,Z,k.x,k.y,W.mipmaps[0].width,W.mipmaps[0].height,et,W.mipmaps[0].data):U.texSubImage2D(U.TEXTURE_2D,Z,k.x,k.y,et,ft,W.image),0===Z&&Y.generateMipmaps&&U.generateMipmap(U.TEXTURE_2D),he.unbindTexture()},this.copyTextureToTexture3D=function(k,W,Y,Z,Q=0){if(E.isWebGL1Renderer)return void console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: can only be used with WebGL2.");const ze=k.max.x-k.min.x+1,et=k.max.y-k.min.y+1,ft=k.max.z-k.min.z+1,vt=ht.convert(Z.format),Mt=ht.convert(Z.type);let It;if(Z.isData3DTexture)je.setTexture3D(Z,0),It=U.TEXTURE_3D;else{if(!Z.isDataArrayTexture)return void console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: only supports THREE.DataTexture3D and THREE.DataTexture2DArray.");je.setTexture2DArray(Z,0),It=U.TEXTURE_2D_ARRAY}U.pixelStorei(U.UNPACK_FLIP_Y_WEBGL,Z.flipY),U.pixelStorei(U.UNPACK_PREMULTIPLY_ALPHA_WEBGL,Z.premultiplyAlpha),U.pixelStorei(U.UNPACK_ALIGNMENT,Z.unpackAlignment);const St=U.getParameter(U.UNPACK_ROW_LENGTH),vn=U.getParameter(U.UNPACK_IMAGE_HEIGHT),_r=U.getParameter(U.UNPACK_SKIP_PIXELS),ar=U.getParameter(U.UNPACK_SKIP_ROWS),no=U.getParameter(U.UNPACK_SKIP_IMAGES),Fn=Y.isCompressedTexture?Y.mipmaps[0]:Y.image;U.pixelStorei(U.UNPACK_ROW_LENGTH,Fn.width),U.pixelStorei(U.UNPACK_IMAGE_HEIGHT,Fn.height),U.pixelStorei(U.UNPACK_SKIP_PIXELS,k.min.x),U.pixelStorei(U.UNPACK_SKIP_ROWS,k.min.y),U.pixelStorei(U.UNPACK_SKIP_IMAGES,k.min.z),Y.isDataTexture||Y.isData3DTexture?U.texSubImage3D(It,Q,W.x,W.y,W.z,ze,et,ft,vt,Mt,Fn.data):Y.isCompressedArrayTexture?(console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: untested support for compressed srcTexture."),U.compressedTexSubImage3D(It,Q,W.x,W.y,W.z,ze,et,ft,vt,Fn.data)):U.texSubImage3D(It,Q,W.x,W.y,W.z,ze,et,ft,vt,Mt,Fn),U.pixelStorei(U.UNPACK_ROW_LENGTH,St),U.pixelStorei(U.UNPACK_IMAGE_HEIGHT,vn),U.pixelStorei(U.UNPACK_SKIP_PIXELS,_r),U.pixelStorei(U.UNPACK_SKIP_ROWS,ar),U.pixelStorei(U.UNPACK_SKIP_IMAGES,no),0===Q&&Z.generateMipmaps&&U.generateMipmap(It),he.unbindTexture()},this.initTexture=function(k){k.isCubeTexture?je.setTextureCube(k,0):k.isData3DTexture?je.setTexture3D(k,0):k.isDataArrayTexture||k.isCompressedArrayTexture?je.setTexture2DArray(k,0):je.setTexture2D(k,0),he.unbindTexture()},this.resetState=function(){M=0,C=0,w=null,he.reset(),Ke.reset()},typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}get coordinateSystem(){return xa}get outputColorSpace(){return this._outputColorSpace}set outputColorSpace(e){this._outputColorSpace=e;const t=this.getContext();t.drawingBufferColorSpace=e===CO?"display-p3":"srgb",t.unpackColorSpace=pn.workingColorSpace===TT?"display-p3":"srgb"}get physicallyCorrectLights(){return console.warn("THREE.WebGLRenderer: The property .physicallyCorrectLights has been removed. Set renderer.useLegacyLights instead."),!this.useLegacyLights}set physicallyCorrectLights(e){console.warn("THREE.WebGLRenderer: The property .physicallyCorrectLights has been removed. Set renderer.useLegacyLights instead."),this.useLegacyLights=!e}get outputEncoding(){return console.warn("THREE.WebGLRenderer: Property .outputEncoding has been removed. Use .outputColorSpace instead."),this.outputColorSpace===jr?Lu:3e3}set outputEncoding(e){console.warn("THREE.WebGLRenderer: Property .outputEncoding has been removed. Use .outputColorSpace instead."),this.outputColorSpace=e===Lu?jr:Sa}get useLegacyLights(){return console.warn("THREE.WebGLRenderer: The property .useLegacyLights has been deprecated. Migrate your lighting according to the following guide: https://discourse.threejs.org/t/updates-to-lighting-in-three-js-r155/53733."),this._useLegacyLights}set useLegacyLights(e){console.warn("THREE.WebGLRenderer: The property .useLegacyLights has been deprecated. Migrate your lighting according to the following guide: https://discourse.threejs.org/t/updates-to-lighting-in-three-js-r155/53733."),this._useLegacyLights=e}}(class $1e extends ew{}).prototype.isWebGL1Renderer=!0;class dk extends Gn{constructor(){super(),this.isScene=!0,this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.backgroundBlurriness=0,this.backgroundIntensity=1,this.overrideMaterial=null,typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(e,t){return super.copy(e,t),null!==e.background&&(this.background=e.background.clone()),null!==e.environment&&(this.environment=e.environment.clone()),null!==e.fog&&(this.fog=e.fog.clone()),this.backgroundBlurriness=e.backgroundBlurriness,this.backgroundIntensity=e.backgroundIntensity,null!==e.overrideMaterial&&(this.overrideMaterial=e.overrideMaterial.clone()),this.matrixAutoUpdate=e.matrixAutoUpdate,this}toJSON(e){const t=super.toJSON(e);return null!==this.fog&&(t.object.fog=this.fog.toJSON()),this.backgroundBlurriness>0&&(t.object.backgroundBlurriness=this.backgroundBlurriness),1!==this.backgroundIntensity&&(t.object.backgroundIntensity=this.backgroundIntensity),t}}class yk extends Ni{constructor(e){super(),this.isPointsMaterial=!0,this.type="PointsMaterial",this.color=new Ge(16777215),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.size=e.size,this.sizeAttenuation=e.sizeAttenuation,this.fog=e.fog,this}}const WK=new Pt,vk=new Uf,cw=new Po,lw=new L;class Ek extends Gn{constructor(e=new Bt,t=new yk){super(),this.isPoints=!0,this.type="Points",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),this.material=Array.isArray(e.material)?e.material.slice():e.material,this.geometry=e.geometry,this}raycast(e,t){const r=this.geometry,i=this.matrixWorld,s=e.params.Points.threshold,o=r.drawRange;if(null===r.boundingSphere&&r.computeBoundingSphere(),cw.copy(r.boundingSphere),cw.applyMatrix4(i),cw.radius+=s,!1===e.ray.intersectsSphere(cw))return;WK.copy(i).invert(),vk.copy(e.ray).applyMatrix4(WK);const a=s/((this.scale.x+this.scale.y+this.scale.z)/3),c=a*a,l=r.index,d=r.attributes.position;if(null!==l)for(let m=Math.max(0,o.start),y=Math.min(l.count,o.start+o.count);m<y;m++){const _=l.getX(m);lw.fromBufferAttribute(d,_),jK(lw,_,c,i,e,t,this)}else for(let m=Math.max(0,o.start),y=Math.min(d.count,o.start+o.count);m<y;m++)lw.fromBufferAttribute(d,m),jK(lw,m,c,i,e,t,this)}updateMorphTargets(){const t=this.geometry.morphAttributes,r=Object.keys(t);if(r.length>0){const i=t[r[0]];if(void 0!==i){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let s=0,o=i.length;s<o;s++){const a=i[s].name||String(s);this.morphTargetInfluences.push(0),this.morphTargetDictionary[a]=s}}}}}function jK(n,e,t,r,i,s,o){const a=vk.distanceSqToPoint(n);if(a<t){const c=new L;vk.closestPointToPoint(n,c),c.applyMatrix4(r);const l=i.ray.origin.distanceTo(c);if(l<i.near||l>i.far)return;s.push({distance:l,distanceToRay:Math.sqrt(a),point:c,index:e,face:null,object:o})}}class tPe extends gs{constructor(e,t,r,i,s,o,a,c,l){super(e,t,r,i,s,o,a,c,l),this.isCanvasTexture=!0,this.needsUpdate=!0}}class j_ extends Bt{constructor(e=1,t=1,r=1,i=32,s=1,o=!1,a=0,c=2*Math.PI){super(),this.type="CylinderGeometry",this.parameters={radiusTop:e,radiusBottom:t,height:r,radialSegments:i,heightSegments:s,openEnded:o,thetaStart:a,thetaLength:c};const l=this;i=Math.floor(i),s=Math.floor(s);const u=[],d=[],h=[],f=[];let m=0;const y=[],_=r/2;let g=0;function E(x){const M=m,C=new oe,w=new L;let A=0;const T=!0===x?e:t,S=!0===x?1:-1;for(let F=1;F<=i;F++)d.push(0,_*S,0),h.push(0,S,0),f.push(.5,.5),m++;const R=m;for(let F=0;F<=i;F++){const H=F/i*c+a,K=Math.cos(H),se=Math.sin(H);w.x=T*se,w.y=_*S,w.z=T*K,d.push(w.x,w.y,w.z),h.push(0,S,0),C.x=.5*K+.5,C.y=.5*se*S+.5,f.push(C.x,C.y),m++}for(let F=0;F<i;F++){const N=M+F,H=R+F;!0===x?u.push(H,H+1,N):u.push(H+1,H,N),A+=3}l.addGroup(g,A,!0===x?1:2),g+=A}(function b(){const x=new L,M=new L;let C=0;const w=(t-e)/r;for(let A=0;A<=s;A++){const T=[],S=A/s,R=S*(t-e)+e;for(let F=0;F<=i;F++){const N=F/i,H=N*c+a,K=Math.sin(H),se=Math.cos(H);M.x=R*K,M.y=-S*r+_,M.z=R*se,d.push(M.x,M.y,M.z),x.set(K,w,se).normalize(),h.push(x.x,x.y,x.z),f.push(N,1-S),T.push(m++)}y.push(T)}for(let A=0;A<i;A++)for(let T=0;T<s;T++){const R=y[T+1][A],F=y[T+1][A+1],N=y[T][A+1];u.push(y[T][A],R,N),u.push(R,F,N),C+=6}l.addGroup(g,C,0),g+=C})(),!1===o&&(e>0&&E(!0),t>0&&E(!1)),this.setIndex(u),this.setAttribute("position",new Xe(d,3)),this.setAttribute("normal",new Xe(h,3)),this.setAttribute("uv",new Xe(f,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new j_(e.radiusTop,e.radiusBottom,e.height,e.radialSegments,e.heightSegments,e.openEnded,e.thetaStart,e.thetaLength)}}class pw extends j_{constructor(e=1,t=1,r=32,i=1,s=!1,o=0,a=2*Math.PI){super(0,e,t,r,i,s,o,a),this.type="ConeGeometry",this.parameters={radius:e,height:t,radialSegments:r,heightSegments:i,openEnded:s,thetaStart:o,thetaLength:a}}static fromJSON(e){return new pw(e.radius,e.height,e.radialSegments,e.heightSegments,e.openEnded,e.thetaStart,e.thetaLength)}}class Tw extends Bt{constructor(e=.5,t=1,r=32,i=1,s=0,o=2*Math.PI){super(),this.type="RingGeometry",this.parameters={innerRadius:e,outerRadius:t,thetaSegments:r,phiSegments:i,thetaStart:s,thetaLength:o},r=Math.max(3,r);const a=[],c=[],l=[],u=[];let d=e;const h=(t-e)/(i=Math.max(1,i)),f=new L,m=new oe;for(let y=0;y<=i;y++){for(let _=0;_<=r;_++){const g=s+_/r*o;f.x=d*Math.cos(g),f.y=d*Math.sin(g),c.push(f.x,f.y,f.z),l.push(0,0,1),m.x=(f.x/t+1)/2,m.y=(f.y/t+1)/2,u.push(m.x,m.y)}d+=h}for(let y=0;y<i;y++){const _=y*(r+1);for(let g=0;g<r;g++){const b=g+_,x=b+r+1,M=b+r+2,C=b+1;a.push(b,x,C),a.push(x,M,C)}}this.setIndex(a),this.setAttribute("position",new Xe(c,3)),this.setAttribute("normal",new Xe(l,3)),this.setAttribute("uv",new Xe(u,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new Tw(e.innerRadius,e.outerRadius,e.thetaSegments,e.phiSegments,e.thetaStart,e.thetaLength)}}function Xu(n,e,t){return!n||!t&&n.constructor===e?n:"number"==typeof e.BYTES_PER_ELEMENT?new e(n):Array.prototype.slice.call(n)}class Iw{constructor(e,t,r,i){this.parameterPositions=e,this._cachedIndex=0,this.resultBuffer=void 0!==i?i:new t.constructor(r),this.sampleValues=t,this.valueSize=r,this.settings=null,this.DefaultSettings_={}}evaluate(e){const t=this.parameterPositions;let r=this._cachedIndex,i=t[r],s=t[r-1];e:{t:{let o;n:{r:if(!(e<i)){for(let a=r+2;;){if(void 0===i){if(e<s)break r;return r=t.length,this._cachedIndex=r,this.copySampleValue_(r-1)}if(r===a)break;if(s=i,i=t[++r],e<i)break t}o=t.length;break n}if(!(e>=s)){const a=t[1];e<a&&(r=2,s=a);for(let c=r-2;;){if(void 0===s)return this._cachedIndex=0,this.copySampleValue_(0);if(r===c)break;if(i=s,s=t[--r-1],e>=s)break t}o=r,r=0;break n}break e}for(;r<o;){const a=r+o>>>1;e<t[a]?o=a:r=a+1}if(i=t[r],s=t[r-1],void 0===s)return this._cachedIndex=0,this.copySampleValue_(0);if(void 0===i)return r=t.length,this._cachedIndex=r,this.copySampleValue_(r-1)}this._cachedIndex=r,this.intervalChanged_(r,s,i)}return this.interpolate_(r,s,e,i)}getSettings_(){return this.settings||this.DefaultSettings_}copySampleValue_(e){const t=this.resultBuffer,r=this.sampleValues,i=this.valueSize,s=e*i;for(let o=0;o!==i;++o)t[o]=r[s+o];return t}interpolate_(){throw new Error("call to abstract method")}intervalChanged_(){}}class qPe extends Iw{constructor(e,t,r,i){super(e,t,r,i),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0,this.DefaultSettings_={endingStart:2400,endingEnd:2400}}intervalChanged_(e,t,r){const i=this.parameterPositions;let s=e-2,o=e+1,a=i[s],c=i[o];if(void 0===a)switch(this.getSettings_().endingStart){case 2401:s=e,a=2*t-r;break;case 2402:s=i.length-2,a=t+i[s]-i[s+1];break;default:s=e,a=r}if(void 0===c)switch(this.getSettings_().endingEnd){case 2401:o=e,c=2*r-t;break;case 2402:o=1,c=r+i[1]-i[0];break;default:o=e-1,c=t}const l=.5*(r-t),u=this.valueSize;this._weightPrev=l/(t-a),this._weightNext=l/(c-r),this._offsetPrev=s*u,this._offsetNext=o*u}interpolate_(e,t,r,i){const s=this.resultBuffer,o=this.sampleValues,a=this.valueSize,c=e*a,l=c-a,u=this._offsetPrev,d=this._offsetNext,h=this._weightPrev,f=this._weightNext,m=(r-t)/(i-t),y=m*m,_=y*m,g=-h*_+2*h*y-h*m,b=(1+h)*_+(-1.5-2*h)*y+(-.5+h)*m+1,E=(-1-f)*_+(1.5+f)*y+.5*m,x=f*_-f*y;for(let M=0;M!==a;++M)s[M]=g*o[u+M]+b*o[l+M]+E*o[c+M]+x*o[d+M];return s}}class lY extends Iw{constructor(e,t,r,i){super(e,t,r,i)}interpolate_(e,t,r,i){const s=this.resultBuffer,o=this.sampleValues,a=this.valueSize,c=e*a,l=c-a,u=(r-t)/(i-t),d=1-u;for(let h=0;h!==a;++h)s[h]=o[l+h]*d+o[c+h]*u;return s}}class XPe extends Iw{constructor(e,t,r,i){super(e,t,r,i)}interpolate_(e){return this.copySampleValue_(e-1)}}class ko{constructor(e,t,r,i){if(void 0===e)throw new Error("THREE.KeyframeTrack: track name is undefined");if(void 0===t||0===t.length)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+e);this.name=e,this.times=Xu(t,this.TimeBufferType),this.values=Xu(r,this.ValueBufferType),this.setInterpolation(i||this.DefaultInterpolation)}static toJSON(e){const t=e.constructor;let r;if(t.toJSON!==this.toJSON)r=t.toJSON(e);else{r={name:e.name,times:Xu(e.times,Array),values:Xu(e.values,Array)};const i=e.getInterpolation();i!==e.DefaultInterpolation&&(r.interpolation=i)}return r.type=e.ValueTypeName,r}InterpolantFactoryMethodDiscrete(e){return new XPe(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodLinear(e){return new lY(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodSmooth(e){return new qPe(this.times,this.values,this.getValueSize(),e)}setInterpolation(e){let t;switch(e){case 2300:t=this.InterpolantFactoryMethodDiscrete;break;case 2301:t=this.InterpolantFactoryMethodLinear;break;case 2302:t=this.InterpolantFactoryMethodSmooth}if(void 0===t){const r="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(void 0===this.createInterpolant){if(e===this.DefaultInterpolation)throw new Error(r);this.setInterpolation(this.DefaultInterpolation)}return console.warn("THREE.KeyframeTrack:",r),this}return this.createInterpolant=t,this}getInterpolation(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return 2300;case this.InterpolantFactoryMethodLinear:return 2301;case this.InterpolantFactoryMethodSmooth:return 2302}}getValueSize(){return this.values.length/this.times.length}shift(e){if(0!==e){const t=this.times;for(let r=0,i=t.length;r!==i;++r)t[r]+=e}return this}scale(e){if(1!==e){const t=this.times;for(let r=0,i=t.length;r!==i;++r)t[r]*=e}return this}trim(e,t){const r=this.times,i=r.length;let s=0,o=i-1;for(;s!==i&&r[s]<e;)++s;for(;-1!==o&&r[o]>t;)--o;if(++o,0!==s||o!==i){s>=o&&(o=Math.max(o,1),s=o-1);const a=this.getValueSize();this.times=r.slice(s,o),this.values=this.values.slice(s*a,o*a)}return this}validate(){let e=!0;const t=this.getValueSize();t-Math.floor(t)!==0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),e=!1);const r=this.times,i=this.values,s=r.length;0===s&&(console.error("THREE.KeyframeTrack: Track is empty.",this),e=!1);let o=null;for(let a=0;a!==s;a++){const c=r[a];if("number"==typeof c&&isNaN(c)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,a,c),e=!1;break}if(null!==o&&o>c){console.error("THREE.KeyframeTrack: Out of order keys.",this,a,c,o),e=!1;break}o=c}if(void 0!==i&&function aY(n){return ArrayBuffer.isView(n)&&!(n instanceof DataView)}(i))for(let a=0,c=i.length;a!==c;++a){const l=i[a];if(isNaN(l)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,a,l),e=!1;break}}return e}optimize(){const e=this.times.slice(),t=this.values.slice(),r=this.getValueSize(),i=2302===this.getInterpolation(),s=e.length-1;let o=1;for(let a=1;a<s;++a){let c=!1;const l=e[a];if(l!==e[a+1]&&(1!==a||l!==e[0]))if(i)c=!0;else{const d=a*r,h=d-r,f=d+r;for(let m=0;m!==r;++m){const y=t[d+m];if(y!==t[h+m]||y!==t[f+m]){c=!0;break}}}if(c){if(a!==o){e[o]=e[a];const d=a*r,h=o*r;for(let f=0;f!==r;++f)t[h+f]=t[d+f]}++o}}if(s>0){e[o]=e[s];for(let a=s*r,c=o*r,l=0;l!==r;++l)t[c+l]=t[a+l];++o}return o!==e.length?(this.times=e.slice(0,o),this.values=t.slice(0,o*r)):(this.times=e,this.values=t),this}clone(){const e=this.times.slice(),t=this.values.slice(),i=new(0,this.constructor)(this.name,e,t);return i.createInterpolant=this.createInterpolant,i}}ko.prototype.TimeBufferType=Float32Array,ko.prototype.ValueBufferType=Float32Array,ko.prototype.DefaultInterpolation=2301;class up extends ko{}up.prototype.ValueTypeName="bool",up.prototype.ValueBufferType=Array,up.prototype.DefaultInterpolation=2300,up.prototype.InterpolantFactoryMethodLinear=void 0,up.prototype.InterpolantFactoryMethodSmooth=void 0;(class uY extends ko{}).prototype.ValueTypeName="color";(class Sw extends ko{}).prototype.ValueTypeName="number";class KPe extends Iw{constructor(e,t,r,i){super(e,t,r,i)}interpolate_(e,t,r,i){const s=this.resultBuffer,o=this.sampleValues,a=this.valueSize,c=(r-t)/(i-t);let l=e*a;for(let u=l+a;l!==u;l+=4)Pi.slerpFlat(s,0,o,l-a,o,l,c);return s}}class K_ extends ko{InterpolantFactoryMethodLinear(e){return new KPe(this.times,this.values,this.getValueSize(),e)}}K_.prototype.ValueTypeName="quaternion",K_.prototype.DefaultInterpolation=2301,K_.prototype.InterpolantFactoryMethodSmooth=void 0;class dp extends ko{}dp.prototype.ValueTypeName="string",dp.prototype.ValueBufferType=Array,dp.prototype.DefaultInterpolation=2300,dp.prototype.InterpolantFactoryMethodLinear=void 0,dp.prototype.InterpolantFactoryMethodSmooth=void 0;(class xw extends ko{}).prototype.ValueTypeName="vector";const hp={enabled:!1,files:{},add:function(n,e){!1!==this.enabled&&(this.files[n]=e)},get:function(n){if(!1!==this.enabled)return this.files[n]},remove:function(n){delete this.files[n]},clear:function(){this.files={}}};class dY{constructor(e,t,r){const i=this;let c,s=!1,o=0,a=0;const l=[];this.onStart=void 0,this.onLoad=e,this.onProgress=t,this.onError=r,this.itemStart=function(u){a++,!1===s&&void 0!==i.onStart&&i.onStart(u,o,a),s=!0},this.itemEnd=function(u){o++,void 0!==i.onProgress&&i.onProgress(u,o,a),o===a&&(s=!1,void 0!==i.onLoad&&i.onLoad())},this.itemError=function(u){void 0!==i.onError&&i.onError(u)},this.resolveURL=function(u){return c?c(u):u},this.setURLModifier=function(u){return c=u,this},this.addHandler=function(u,d){return l.push(u,d),this},this.removeHandler=function(u){const d=l.indexOf(u);return-1!==d&&l.splice(d,2),this},this.getHandler=function(u){for(let d=0,h=l.length;d<h;d+=2){const f=l[d],m=l[d+1];if(f.global&&(f.lastIndex=0),f.test(u))return m}return null}}}const ZPe=new dY;let Fs=(()=>{class n{constructor(t){this.manager=void 0!==t?t:ZPe,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}load(){}loadAsync(t,r){const i=this;return new Promise(function(s,o){i.load(t,s,r,o)})}parse(){}setCrossOrigin(t){return this.crossOrigin=t,this}setWithCredentials(t){return this.withCredentials=t,this}setPath(t){return this.path=t,this}setResourcePath(t){return this.resourcePath=t,this}setRequestHeader(t){return this.requestHeader=t,this}}return n.DEFAULT_MATERIAL_NAME="__DEFAULT",n})();Error;class Mw extends Fs{constructor(e){super(e)}load(e,t,r,i){void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e);const s=this,o=hp.get(e);if(void 0!==o)return s.manager.itemStart(e),setTimeout(function(){t&&t(o),s.manager.itemEnd(e)},0),o;const a=A_("img");function c(){u(),hp.add(e,this),t&&t(this),s.manager.itemEnd(e)}function l(d){u(),i&&i(d),s.manager.itemError(e),s.manager.itemEnd(e)}function u(){a.removeEventListener("load",c,!1),a.removeEventListener("error",l,!1)}return a.addEventListener("load",c,!1),a.addEventListener("error",l,!1),"data:"!==e.slice(0,5)&&void 0!==this.crossOrigin&&(a.crossOrigin=this.crossOrigin),s.manager.itemStart(e),a.src=e,a}}class hY extends Fs{constructor(e){super(e)}load(e,t,r,i){const s=new gs,o=new Mw(this.manager);return o.setCrossOrigin(this.crossOrigin),o.setPath(this.path),o.load(e,function(a){s.image=a,s.needsUpdate=!0,void 0!==t&&t(s)},r,i),s}}class Ku extends Gn{constructor(e,t=1){super(),this.isLight=!0,this.type="Light",this.color=new Ge(e),this.intensity=t}dispose(){}copy(e,t){return super.copy(e,t),this.color.copy(e.color),this.intensity=e.intensity,this}toJSON(e){const t=super.toJSON(e);return t.object.color=this.color.getHex(),t.object.intensity=this.intensity,void 0!==this.groundColor&&(t.object.groundColor=this.groundColor.getHex()),void 0!==this.distance&&(t.object.distance=this.distance),void 0!==this.angle&&(t.object.angle=this.angle),void 0!==this.decay&&(t.object.decay=this.decay),void 0!==this.penumbra&&(t.object.penumbra=this.penumbra),void 0!==this.shadow&&(t.object.shadow=this.shadow.toJSON()),t}}class fY extends Ku{constructor(e,t,r){super(e,r),this.isHemisphereLight=!0,this.type="HemisphereLight",this.position.copy(Gn.DEFAULT_UP),this.updateMatrix(),this.groundColor=new Ge(t)}copy(e,t){return super.copy(e,t),this.groundColor.copy(e.groundColor),this}}const $k="\\[\\]\\.:\\/",yNe=new RegExp("["+$k+"]","g"),qk="[^"+$k+"]",vNe="[^"+$k.replace("\\.","")+"]",INe=new RegExp("^"+/((?:WC+[\/:])*)/.source.replace("WC",qk)+/(WCOD+)?/.source.replace("WCOD",vNe)+/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",qk)+/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",qk)+"$"),SNe=["material","materials","bones","map"];class xNe{constructor(e,t,r){const i=r||kn.parseTrackName(t);this._targetGroup=e,this._bindings=e.subscribe_(t,i)}getValue(e,t){this.bind();const i=this._bindings[this._targetGroup.nCachedObjects_];void 0!==i&&i.getValue(e,t)}setValue(e,t){const r=this._bindings;for(let i=this._targetGroup.nCachedObjects_,s=r.length;i!==s;++i)r[i].setValue(e,t)}bind(){const e=this._bindings;for(let t=this._targetGroup.nCachedObjects_,r=e.length;t!==r;++t)e[t].bind()}unbind(){const e=this._bindings;for(let t=this._targetGroup.nCachedObjects_,r=e.length;t!==r;++t)e[t].unbind()}}let kn=(()=>{class n{constructor(t,r,i){this.path=r,this.parsedPath=i||n.parseTrackName(r),this.node=n.findNode(t,this.parsedPath.nodeName),this.rootNode=t,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}static create(t,r,i){return t&&t.isAnimationObjectGroup?new n.Composite(t,r,i):new n(t,r,i)}static sanitizeNodeName(t){return t.replace(/\s/g,"_").replace(yNe,"")}static parseTrackName(t){const r=INe.exec(t);if(null===r)throw new Error("PropertyBinding: Cannot parse trackName: "+t);const i={nodeName:r[2],objectName:r[3],objectIndex:r[4],propertyName:r[5],propertyIndex:r[6]},s=i.nodeName&&i.nodeName.lastIndexOf(".");if(void 0!==s&&-1!==s){const o=i.nodeName.substring(s+1);-1!==SNe.indexOf(o)&&(i.nodeName=i.nodeName.substring(0,s),i.objectName=o)}if(null===i.propertyName||0===i.propertyName.length)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+t);return i}static findNode(t,r){if(void 0===r||""===r||"."===r||-1===r||r===t.name||r===t.uuid)return t;if(t.skeleton){const i=t.skeleton.getBoneByName(r);if(void 0!==i)return i}if(t.children){const i=function(o){for(let a=0;a<o.length;a++){const c=o[a];if(c.name===r||c.uuid===r)return c;const l=i(c.children);if(l)return l}return null},s=i(t.children);if(s)return s}return null}_getValue_unavailable(){}_setValue_unavailable(){}_getValue_direct(t,r){t[r]=this.targetObject[this.propertyName]}_getValue_array(t,r){const i=this.resolvedProperty;for(let s=0,o=i.length;s!==o;++s)t[r++]=i[s]}_getValue_arrayElement(t,r){t[r]=this.resolvedProperty[this.propertyIndex]}_getValue_toArray(t,r){this.resolvedProperty.toArray(t,r)}_setValue_direct(t,r){this.targetObject[this.propertyName]=t[r]}_setValue_direct_setNeedsUpdate(t,r){this.targetObject[this.propertyName]=t[r],this.targetObject.needsUpdate=!0}_setValue_direct_setMatrixWorldNeedsUpdate(t,r){this.targetObject[this.propertyName]=t[r],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_array(t,r){const i=this.resolvedProperty;for(let s=0,o=i.length;s!==o;++s)i[s]=t[r++]}_setValue_array_setNeedsUpdate(t,r){const i=this.resolvedProperty;for(let s=0,o=i.length;s!==o;++s)i[s]=t[r++];this.targetObject.needsUpdate=!0}_setValue_array_setMatrixWorldNeedsUpdate(t,r){const i=this.resolvedProperty;for(let s=0,o=i.length;s!==o;++s)i[s]=t[r++];this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_arrayElement(t,r){this.resolvedProperty[this.propertyIndex]=t[r]}_setValue_arrayElement_setNeedsUpdate(t,r){this.resolvedProperty[this.propertyIndex]=t[r],this.targetObject.needsUpdate=!0}_setValue_arrayElement_setMatrixWorldNeedsUpdate(t,r){this.resolvedProperty[this.propertyIndex]=t[r],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_fromArray(t,r){this.resolvedProperty.fromArray(t,r)}_setValue_fromArray_setNeedsUpdate(t,r){this.resolvedProperty.fromArray(t,r),this.targetObject.needsUpdate=!0}_setValue_fromArray_setMatrixWorldNeedsUpdate(t,r){this.resolvedProperty.fromArray(t,r),this.targetObject.matrixWorldNeedsUpdate=!0}_getValue_unbound(t,r){this.bind(),this.getValue(t,r)}_setValue_unbound(t,r){this.bind(),this.setValue(t,r)}bind(){let t=this.node;const r=this.parsedPath,i=r.objectName,s=r.propertyName;let o=r.propertyIndex;if(t||(t=n.findNode(this.rootNode,r.nodeName),this.node=t),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,!t)return void console.warn("THREE.PropertyBinding: No target node found for track: "+this.path+".");if(i){let u=r.objectIndex;switch(i){case"materials":if(!t.material)return void console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);if(!t.material.materials)return void console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);t=t.material.materials;break;case"bones":if(!t.skeleton)return void console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);t=t.skeleton.bones;for(let d=0;d<t.length;d++)if(t[d].name===u){u=d;break}break;case"map":if("map"in t){t=t.map;break}if(!t.material)return void console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);if(!t.material.map)return void console.error("THREE.PropertyBinding: Can not bind to material.map as node.material does not have a map.",this);t=t.material.map;break;default:if(void 0===t[i])return void console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);t=t[i]}if(void 0!==u){if(void 0===t[u])return void console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,t);t=t[u]}}const a=t[s];if(void 0===a)return void console.error("THREE.PropertyBinding: Trying to update property for track: "+r.nodeName+"."+s+" but it wasn't found.",t);let c=this.Versioning.None;this.targetObject=t,void 0!==t.needsUpdate?c=this.Versioning.NeedsUpdate:void 0!==t.matrixWorldNeedsUpdate&&(c=this.Versioning.MatrixWorldNeedsUpdate);let l=this.BindingType.Direct;if(void 0!==o){if("morphTargetInfluences"===s){if(!t.geometry)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);if(!t.geometry.morphAttributes)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);void 0!==t.morphTargetDictionary[o]&&(o=t.morphTargetDictionary[o])}l=this.BindingType.ArrayElement,this.resolvedProperty=a,this.propertyIndex=o}else void 0!==a.fromArray&&void 0!==a.toArray?(l=this.BindingType.HasFromToArray,this.resolvedProperty=a):Array.isArray(a)?(l=this.BindingType.EntireArray,this.resolvedProperty=a):this.propertyName=s;this.getValue=this.GetterByBindingType[l],this.setValue=this.SetterByBindingTypeAndVersioning[l][c]}unbind(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}return n.Composite=xNe,n})();kn.prototype.BindingType={Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3},kn.prototype.Versioning={None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2},kn.prototype.GetterByBindingType=[kn.prototype._getValue_direct,kn.prototype._getValue_array,kn.prototype._getValue_arrayElement,kn.prototype._getValue_toArray],kn.prototype.SetterByBindingTypeAndVersioning=[[kn.prototype._setValue_direct,kn.prototype._setValue_direct_setNeedsUpdate,kn.prototype._setValue_direct_setMatrixWorldNeedsUpdate],[kn.prototype._setValue_array,kn.prototype._setValue_array_setNeedsUpdate,kn.prototype._setValue_array_setMatrixWorldNeedsUpdate],[kn.prototype._setValue_arrayElement,kn.prototype._setValue_arrayElement_setNeedsUpdate,kn.prototype._setValue_arrayElement_setMatrixWorldNeedsUpdate],[kn.prototype._setValue_fromArray,kn.prototype._setValue_fromArray_setNeedsUpdate,kn.prototype._setValue_fromArray_setMatrixWorldNeedsUpdate]],new Float32Array(1);class AY{constructor(e,t,r=0,i=1/0){this.ray=new Uf(e,t),this.near=r,this.far=i,this.camera=null,this.layers=new GO,this.params={Mesh:{},Line:{threshold:1},LOD:{},Points:{threshold:1},Sprite:{}}}set(e,t){this.ray.set(e,t)}setFromCamera(e,t){t.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(t.matrixWorld),this.ray.direction.set(e.x,e.y,.5).unproject(t).sub(this.ray.origin).normalize(),this.camera=t):t.isOrthographicCamera?(this.ray.origin.set(e.x,e.y,(t.near+t.far)/(t.near-t.far)).unproject(t),this.ray.direction.set(0,0,-1).transformDirection(t.matrixWorld),this.camera=t):console.error("THREE.Raycaster: Unsupported camera type: "+t.type)}intersectObject(e,t=!0,r=[]){return Xk(e,this,r,t),r.sort(MY),r}intersectObjects(e,t=!0,r=[]){for(let i=0,s=e.length;i<s;i++)Xk(e[i],this,r,t);return r.sort(MY),r}}function MY(n,e){return n.distance-e.distance}function Xk(n,e,t,r){if(n.layers.test(e.layers)&&n.raycast(e,t),!0===r){const i=n.children;for(let s=0,o=i.length;s<o;s++)Xk(i[s],e,t,!0)}}class CY{constructor(e=1,t=0,r=0){return this.radius=e,this.phi=t,this.theta=r,this}set(e,t,r){return this.radius=e,this.phi=t,this.theta=r,this}copy(e){return this.radius=e.radius,this.phi=e.phi,this.theta=e.theta,this}makeSafe(){return this.phi=Math.max(1e-6,Math.min(Math.PI-1e-6,this.phi)),this}setFromVector3(e){return this.setFromCartesianCoords(e.x,e.y,e.z)}setFromCartesianCoords(e,t,r){return this.radius=Math.sqrt(e*e+t*t+r*r),0===this.radius?(this.theta=0,this.phi=0):(this.theta=Math.atan2(e,r),this.phi=Math.acos(sr(t/this.radius,-1,1))),this}clone(){return(new this.constructor).copy(this)}}typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:"158"}})),typeof window<"u"&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__="158");const UY={type:"change"},Jk={type:"start"},BY={type:"end"},Lw=new Uf,HY=new el,RNe=Math.cos(70*TMe_DEG2RAD);class PNe extends Aa{constructor(e,t){super(),this.object=e,this.domElement=t,this.domElement.style.touchAction="none",this.enabled=!0,this.target=new L,this.cursor=new L,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minTargetRadius=0,this.maxTargetRadius=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.05,this.enableZoom=!0,this.zoomSpeed=1,this.enableRotate=!0,this.rotateSpeed=1,this.enablePan=!0,this.panSpeed=1,this.screenSpacePanning=!0,this.keyPanSpeed=7,this.zoomToCursor=!1,this.autoRotate=!1,this.autoRotateSpeed=2,this.keys={LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",BOTTOM:"ArrowDown"},this.mouseButtons={LEFT:0,MIDDLE:1,RIGHT:2},this.touches={ONE:0,TWO:2},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this._domElementKeyEvents=null,this.getPolarAngle=function(){return a.phi},this.getAzimuthalAngle=function(){return a.theta},this.getDistance=function(){return this.object.position.distanceTo(this.target)},this.listenToKeyEvents=function(B){B.addEventListener("keydown",D),this._domElementKeyEvents=B},this.stopListenToKeyEvents=function(){this._domElementKeyEvents.removeEventListener("keydown",D),this._domElementKeyEvents=null},this.saveState=function(){r.target0.copy(r.target),r.position0.copy(r.object.position),r.zoom0=r.object.zoom},this.reset=function(){r.target.copy(r.target0),r.object.position.copy(r.position0),r.object.zoom=r.zoom0,r.object.updateProjectionMatrix(),r.dispatchEvent(UY),r.update(),s=i.NONE},this.update=function(){const B=new L,we=(new Pi).setFromUnitVectors(e.up,new L(0,1,0)),de=we.clone().invert(),ht=new L,Ke=new Pi,ot=new L,Ye=2*Math.PI;return function(Ht=null){const z=r.object.position;B.copy(z).sub(r.target),B.applyQuaternion(we),a.setFromVector3(B),r.autoRotate&&s===i.NONE&&R(function T(B){return null!==B?2*Math.PI/60*r.autoRotateSpeed*B:2*Math.PI/60/60*r.autoRotateSpeed}(Ht)),r.enableDamping?(a.theta+=c.theta*r.dampingFactor,a.phi+=c.phi*r.dampingFactor):(a.theta+=c.theta,a.phi+=c.phi);let Ce=r.minAzimuthAngle,_e=r.maxAzimuthAngle;isFinite(Ce)&&isFinite(_e)&&(Ce<-Math.PI?Ce+=Ye:Ce>Math.PI&&(Ce-=Ye),_e<-Math.PI?_e+=Ye:_e>Math.PI&&(_e-=Ye),a.theta=Ce<=_e?Math.max(Ce,Math.min(_e,a.theta)):a.theta>(Ce+_e)/2?Math.max(Ce,a.theta):Math.min(_e,a.theta)),a.phi=Math.max(r.minPolarAngle,Math.min(r.maxPolarAngle,a.phi)),a.makeSafe(),!0===r.enableDamping?r.target.addScaledVector(u,r.dampingFactor):r.target.add(u),r.target.sub(r.cursor),r.target.clampLength(r.minTargetRadius,r.maxTargetRadius),r.target.add(r.cursor),a.radius=ce(r.zoomToCursor&&C||r.object.isOrthographicCamera?a.radius:a.radius*l),B.setFromSpherical(a),B.applyQuaternion(de),z.copy(r.target).add(B),r.object.lookAt(r.target),!0===r.enableDamping?(c.theta*=1-r.dampingFactor,c.phi*=1-r.dampingFactor,u.multiplyScalar(1-r.dampingFactor)):(c.set(0,0,0),u.set(0,0,0));let te=!1;if(r.zoomToCursor&&C){let Ee=null;if(r.object.isPerspectiveCamera){const nt=B.length();Ee=ce(nt*l),r.object.position.addScaledVector(x,nt-Ee),r.object.updateMatrixWorld()}else if(r.object.isOrthographicCamera){const nt=new L(M.x,M.y,0);nt.unproject(r.object),r.object.zoom=Math.max(r.minZoom,Math.min(r.maxZoom,r.object.zoom/l)),r.object.updateProjectionMatrix(),te=!0;const kt=new L(M.x,M.y,0);kt.unproject(r.object),r.object.position.sub(kt).add(nt),r.object.updateMatrixWorld(),Ee=B.length()}else console.warn("WARNING: OrbitControls.js encountered an unknown camera type - zoom to cursor disabled."),r.zoomToCursor=!1;null!==Ee&&(this.screenSpacePanning?r.target.set(0,0,-1).transformDirection(r.object.matrix).multiplyScalar(Ee).add(r.object.position):(Lw.origin.copy(r.object.position),Lw.direction.set(0,0,-1).transformDirection(r.object.matrix),Math.abs(r.object.up.dot(Lw.direction))<RNe?e.lookAt(r.target):(HY.setFromNormalAndCoplanarPoint(r.object.up,r.target),Lw.intersectPlane(HY,r.target))))}else r.object.isOrthographicCamera&&(r.object.zoom=Math.max(r.minZoom,Math.min(r.maxZoom,r.object.zoom/l)),r.object.updateProjectionMatrix(),te=!0);return l=1,C=!1,!!(te||ht.distanceToSquared(r.object.position)>o||8*(1-Ke.dot(r.object.quaternion))>o||ot.distanceToSquared(r.target)>0)&&(r.dispatchEvent(UY),ht.copy(r.object.position),Ke.copy(r.object.quaternion),ot.copy(r.target),te=!1,!0)}}(),this.dispose=function(){r.domElement.removeEventListener("contextmenu",le),r.domElement.removeEventListener("pointerdown",Le),r.domElement.removeEventListener("pointercancel",dt),r.domElement.removeEventListener("wheel",V),r.domElement.removeEventListener("pointermove",je),r.domElement.removeEventListener("pointerup",dt),null!==r._domElementKeyEvents&&(r._domElementKeyEvents.removeEventListener("keydown",D),r._domElementKeyEvents=null)};const r=this,i={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6};let s=i.NONE;const o=1e-6,a=new CY,c=new CY;let l=1;const u=new L,d=new oe,h=new oe,f=new oe,m=new oe,y=new oe,_=new oe,g=new oe,b=new oe,E=new oe,x=new L,M=new oe;let C=!1;const w=[],A={};function S(){return Math.pow(.95,r.zoomSpeed)}function R(B){c.theta-=B}function F(B){c.phi-=B}const N=function(){const B=new L;return function(de,ht){B.setFromMatrixColumn(ht,0),B.multiplyScalar(-de),u.add(B)}}(),H=function(){const B=new L;return function(de,ht){!0===r.screenSpacePanning?B.setFromMatrixColumn(ht,1):(B.setFromMatrixColumn(ht,0),B.crossVectors(r.object.up,B)),B.multiplyScalar(de),u.add(B)}}(),K=function(){const B=new L;return function(de,ht){const Ke=r.domElement;if(r.object.isPerspectiveCamera){B.copy(r.object.position).sub(r.target);let Ye=B.length();Ye*=Math.tan(r.object.fov/2*Math.PI/180),N(2*de*Ye/Ke.clientHeight,r.object.matrix),H(2*ht*Ye/Ke.clientHeight,r.object.matrix)}else r.object.isOrthographicCamera?(N(de*(r.object.right-r.object.left)/r.object.zoom/Ke.clientWidth,r.object.matrix),H(ht*(r.object.top-r.object.bottom)/r.object.zoom/Ke.clientHeight,r.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),r.enablePan=!1)}}();function se(B){r.object.isPerspectiveCamera||r.object.isOrthographicCamera?l/=B:(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),r.enableZoom=!1)}function ne(B){r.object.isPerspectiveCamera||r.object.isOrthographicCamera?l*=B:(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),r.enableZoom=!1)}function ye(B){if(!r.zoomToCursor)return;C=!0;const we=r.domElement.getBoundingClientRect(),ht=B.clientY-we.top,ot=we.height;M.x=(B.clientX-we.left)/we.width*2-1,M.y=-ht/ot*2+1,x.set(M.x,M.y,1).unproject(r.object).sub(r.object.position).normalize()}function ce(B){return Math.max(r.minDistance,Math.min(r.maxDistance,B))}function ge(B){d.set(B.clientX,B.clientY)}function ee(B){m.set(B.clientX,B.clientY)}function at(){1===w.length?d.set(w[0].pageX,w[0].pageY):d.set(.5*(w[0].pageX+w[1].pageX),.5*(w[0].pageY+w[1].pageY))}function yt(){1===w.length?m.set(w[0].pageX,w[0].pageY):m.set(.5*(w[0].pageX+w[1].pageX),.5*(w[0].pageY+w[1].pageY))}function Ft(){const B=w[0].pageX-w[1].pageX,we=w[0].pageY-w[1].pageY,de=Math.sqrt(B*B+we*we);g.set(0,de)}function De(B){if(1==w.length)h.set(B.pageX,B.pageY);else{const de=ke(B);h.set(.5*(B.pageX+de.x),.5*(B.pageY+de.y))}f.subVectors(h,d).multiplyScalar(r.rotateSpeed);const we=r.domElement;R(2*Math.PI*f.x/we.clientHeight),F(2*Math.PI*f.y/we.clientHeight),d.copy(h)}function ie(B){if(1===w.length)y.set(B.pageX,B.pageY);else{const we=ke(B);y.set(.5*(B.pageX+we.x),.5*(B.pageY+we.y))}_.subVectors(y,m).multiplyScalar(r.panSpeed),K(_.x,_.y),m.copy(y)}function ve(B){const we=ke(B),de=B.pageX-we.x,ht=B.pageY-we.y,Ke=Math.sqrt(de*de+ht*ht);b.set(0,Ke),E.set(0,Math.pow(b.y/g.y,r.zoomSpeed)),se(E.y),g.copy(b)}function Le(B){!1!==r.enabled&&(0===w.length&&(r.domElement.setPointerCapture(B.pointerId),r.domElement.addEventListener("pointermove",je),r.domElement.addEventListener("pointerup",dt)),function pe(B){w.push(B)}(B),"touch"===B.pointerType?function X(B){switch(xe(B),w.length){case 1:switch(r.touches.ONE){case 0:if(!1===r.enableRotate)return;at(),s=i.TOUCH_ROTATE;break;case 1:if(!1===r.enablePan)return;yt(),s=i.TOUCH_PAN;break;default:s=i.NONE}break;case 2:switch(r.touches.TWO){case 2:if(!1===r.enableZoom&&!1===r.enablePan)return;(function st(){r.enableZoom&&Ft(),r.enablePan&&yt()})(),s=i.TOUCH_DOLLY_PAN;break;case 3:if(!1===r.enableZoom&&!1===r.enableRotate)return;(function U(){r.enableZoom&&Ft(),r.enableRotate&&at()})(),s=i.TOUCH_DOLLY_ROTATE;break;default:s=i.NONE}break;default:s=i.NONE}s!==i.NONE&&r.dispatchEvent(Jk)}(B):function Nt(B){let we;switch(B.button){case 0:we=r.mouseButtons.LEFT;break;case 1:we=r.mouseButtons.MIDDLE;break;case 2:we=r.mouseButtons.RIGHT;break;default:we=-1}switch(we){case 1:if(!1===r.enableZoom)return;(function G(B){ye(B),g.set(B.clientX,B.clientY)})(B),s=i.DOLLY;break;case 0:if(B.ctrlKey||B.metaKey||B.shiftKey){if(!1===r.enablePan)return;ee(B),s=i.PAN}else{if(!1===r.enableRotate)return;ge(B),s=i.ROTATE}break;case 2:if(B.ctrlKey||B.metaKey||B.shiftKey){if(!1===r.enableRotate)return;ge(B),s=i.ROTATE}else{if(!1===r.enablePan)return;ee(B),s=i.PAN}break;default:s=i.NONE}s!==i.NONE&&r.dispatchEvent(Jk)}(B))}function je(B){!1!==r.enabled&&("touch"===B.pointerType?function be(B){switch(xe(B),s){case i.TOUCH_ROTATE:if(!1===r.enableRotate)return;De(B),r.update();break;case i.TOUCH_PAN:if(!1===r.enablePan)return;ie(B),r.update();break;case i.TOUCH_DOLLY_PAN:if(!1===r.enableZoom&&!1===r.enablePan)return;(function he(B){r.enableZoom&&ve(B),r.enablePan&&ie(B)})(B),r.update();break;case i.TOUCH_DOLLY_ROTATE:if(!1===r.enableZoom&&!1===r.enableRotate)return;(function Qe(B){r.enableZoom&&ve(B),r.enableRotate&&De(B)})(B),r.update();break;default:s=i.NONE}}(B):function yn(B){switch(s){case i.ROTATE:if(!1===r.enableRotate)return;!function Te(B){h.set(B.clientX,B.clientY),f.subVectors(h,d).multiplyScalar(r.rotateSpeed);const we=r.domElement;R(2*Math.PI*f.x/we.clientHeight),F(2*Math.PI*f.y/we.clientHeight),d.copy(h),r.update()}(B);break;case i.DOLLY:if(!1===r.enableZoom)return;!function He(B){b.set(B.clientX,B.clientY),E.subVectors(b,g),E.y>0?se(S()):E.y<0&&ne(S()),g.copy(b),r.update()}(B);break;case i.PAN:if(!1===r.enablePan)return;!function Ue(B){y.set(B.clientX,B.clientY),_.subVectors(y,m).multiplyScalar(r.panSpeed),K(_.x,_.y),m.copy(y),r.update()}(B)}}(B))}function dt(B){(function qe(B){delete A[B.pointerId];for(let we=0;we<w.length;we++)if(w[we].pointerId==B.pointerId)return void w.splice(we,1)})(B),0===w.length&&(r.domElement.releasePointerCapture(B.pointerId),r.domElement.removeEventListener("pointermove",je),r.domElement.removeEventListener("pointerup",dt)),r.dispatchEvent(BY),s=i.NONE}function V(B){!1===r.enabled||!1===r.enableZoom||s!==i.NONE||(B.preventDefault(),r.dispatchEvent(Jk),function ut(B){ye(B),B.deltaY<0?ne(S()):B.deltaY>0&&se(S()),r.update()}(B),r.dispatchEvent(BY))}function D(B){!1===r.enabled||!1===r.enablePan||function it(B){let we=!1;switch(B.code){case r.keys.UP:B.ctrlKey||B.metaKey||B.shiftKey?F(2*Math.PI*r.rotateSpeed/r.domElement.clientHeight):K(0,r.keyPanSpeed),we=!0;break;case r.keys.BOTTOM:B.ctrlKey||B.metaKey||B.shiftKey?F(-2*Math.PI*r.rotateSpeed/r.domElement.clientHeight):K(0,-r.keyPanSpeed),we=!0;break;case r.keys.LEFT:B.ctrlKey||B.metaKey||B.shiftKey?R(2*Math.PI*r.rotateSpeed/r.domElement.clientHeight):K(r.keyPanSpeed,0),we=!0;break;case r.keys.RIGHT:B.ctrlKey||B.metaKey||B.shiftKey?R(-2*Math.PI*r.rotateSpeed/r.domElement.clientHeight):K(-r.keyPanSpeed,0),we=!0}we&&(B.preventDefault(),r.update())}(B)}function le(B){!1!==r.enabled&&B.preventDefault()}function xe(B){let we=A[B.pointerId];void 0===we&&(we=new oe,A[B.pointerId]=we),we.set(B.pageX,B.pageY)}function ke(B){return A[(B.pointerId===w[0].pointerId?w[1]:w[0]).pointerId]}r.domElement.addEventListener("contextmenu",le),r.domElement.addEventListener("pointerdown",Le),r.domElement.addEventListener("pointercancel",dt),r.domElement.addEventListener("wheel",V,{passive:!1}),this.update()}}const zY=gI(n=>function(){n(this),this.name="EmptyError",this.message="no elements in sequence"}),GY=new jn(n=>n.complete());function LNe(n=FNe){return Ss((e,t)=>{let r=!1;e.subscribe(os(t,i=>{r=!0,t.next(i)},()=>r?t.complete():t.error(n())))})}function FNe(){return new zY}function fp(n,e){const t=arguments.length>=2;return r=>r.pipe(n?b6((i,s)=>n(i,s,r)):II,function ONe(n){return n<=0?()=>GY:Ss((e,t)=>{let r=0;e.subscribe(os(t,i=>{++r<=n&&(t.next(i),n<=r&&t.complete())}))})}(1),t?function kNe(n){return Ss((e,t)=>{let r=!1;e.subscribe(os(t,i=>{r=!0,t.next(i)},()=>{r||t.next(n),t.complete()}))})}(e):LNe(()=>new zY))}const td_firebase={apiKey:"YOUR_API_KEY",authDomain:"YOUR_AUTH_DOMAIN",projectId:"YOUR_PROJECT_ID",storageBucket:"YOUR_STORAGE_BUCKET",messagingSenderId:"YOUR_MESSAGING_SENDER_ID",appId:"YOUR_APP_ID"},td_apis_generateMemoryPlant="http://127.0.0.1:5001/cziczere-ai/us-central1/generateMemoryPlant",td_apis_analyzeMemories="http://127.0.0.1:5001/cziczere-ai/us-central1/analyzeMemories",td_apis_getAtmosphere="http://127.0.0.1:5001/cziczere-ai/us-central1/getAtmosphere",td_apis_exportGarden="http://127.0.0.1:5001/cziczere-ai/us-central1/exportGarden",td_apis_getInsightAudio="http://127.0.0.1:5001/cziczere-ai/us-central1/getInsightAudio",td_apis_poeticRephrasing="http://127.0.0.1:5001/cziczere-ai/us-central1/poeticRephrasing";let Fw=(()=>{var n;class e{constructor(){this.auth=Ie(Dh),this.firestore=Ie(Tf),this.http=Ie(R6),this.user$=i8(this.auth),this.gardenStateSubject=new ao({memories:[],insights:[],atmosphere:null,totalPlants:0,lastUpdated:new Date,isLoading:!1,error:null}),this.gardenState$=this.gardenStateSubject.asObservable(),this.updatesSubject=new ao(null),this.updates$=this.updatesSubject.asObservable(),this.generateFunctionUrl=td_apis_generateMemoryPlant,this.analyzeFunctionUrl=td_apis_analyzeMemories,this.atmosphereFunctionUrl=td_apis_getAtmosphere,this.exportGardenFunctionUrl=td_apis_exportGarden,this.insightAudioFunctionUrl=td_apis_getInsightAudio,this.poeticRephrasingUrl=td_apis_poeticRephrasing,this.user$.subscribe(r=>{r?this.initializeRealTimeListeners(r.uid):(this.cleanup(),this.resetGardenState())})}getInsightAudioUrl(r){return Rh(this.auth).pipe(fp(),qs(i=>{if(!i)throw new Error("User not logged in!");const s=(new Qr).set("Authorization",`Bearer ${i}`);return this.http.get(this.insightAudioFunctionUrl,{headers:s,params:{insightId:r}})}))}exportGardenAsPoster(){return Rh(this.auth).pipe(fp(),qs(r=>{if(!r)throw new Error("User not logged in!");const i=(new Qr).set("Authorization",`Bearer ${r}`);return this.http.post(this.exportGardenFunctionUrl,{},{headers:i})}))}getAtmosphere(){return Rh(this.auth).pipe(fp(),qs(r=>{if(!r)throw new Error("User not logged in!");const i=(new Qr).set("Authorization",`Bearer ${r}`);return this.http.post(this.atmosphereFunctionUrl,{},{headers:i})}))}createMemory(r){return Rh(this.auth).pipe(fp(),qs(i=>{if(!i)throw new Error("User not logged in!");const s=(new Qr).set("Authorization",`Bearer ${i}`);return this.http.post(this.generateFunctionUrl,{text:r},{headers:s})}))}requestInsight(r="insight"){return Rh(this.auth).pipe(fp(),qs(i=>{if(!i)throw new Error("User not logged in!");const s=(new Qr).set("Authorization",`Bearer ${i}`);return this.http.post(this.analyzeFunctionUrl,{},{headers:s,params:{type:r}})}))}getLatestInsight(){return this.user$.pipe(qs(r=>{if(!r)return _o(null);const i=aT(this.firestore,"insights"),s=cT(i,lT("userId","==",r.uid),sO("timestamp","desc"),I7(1));return w7(s,{idField:"id"}).pipe(Hs(o=>o.length>0?o[0]:null))}))}getMemories(){return this.user$.pipe(qs(r=>{if(!r)return _o([]);const i=aT(this.firestore,"memories"),s=cT(i,lT("userId","==",r.uid));return w7(s)}))}getPoeticRephrasing(r){return Rh(this.auth).pipe(fp(),qs(i=>{if(!i)throw new Error("User not logged in!");const s=(new Qr).set("Authorization",`Bearer ${i}`);return this.http.post(this.poeticRephrasingUrl,{originalText:r},{headers:s})}))}initializeRealTimeListeners(r){this.cleanup(),this.setLoading(!0);const i=aT(this.firestore,"memories"),s=cT(i,lT("userId","==",r),sO("timestamp","desc"));this.memoriesUnsubscribe=S7(s,c=>{const l=[];c.forEach(u=>{const d=u.data();d&&l.push({...d,id:u.id})}),this.updateGardenState({memories:l,totalPlants:l.length,lastUpdated:new Date,isLoading:!1,error:null}),this.updatesSubject.next({type:"memory_updated",data:{count:l.length},timestamp:new Date})},c=>{console.error("Error listening to memories:",c),this.updateGardenState({error:"Failed to load memories",isLoading:!1})});const o=aT(this.firestore,"insights"),a=cT(o,lT("userId","==",r),sO("timestamp","desc"),I7(10));this.insightsUnsubscribe=S7(a,c=>{const l=[];c.forEach(u=>{l.push({...u.data(),id:u.id})}),this.updateGardenState({insights:l}),this.updatesSubject.next({type:"insight_added",data:{count:l.length},timestamp:new Date})},c=>{console.error("Error listening to insights:",c)}),this.refreshAtmosphere()}updateGardenState(r){this.gardenStateSubject.next({...this.gardenStateSubject.value,...r})}setLoading(r){this.updateGardenState({isLoading:r})}resetGardenState(){this.gardenStateSubject.next({memories:[],insights:[],atmosphere:null,totalPlants:0,lastUpdated:new Date,isLoading:!1,error:null})}cleanup(){this.memoriesUnsubscribe&&(this.memoriesUnsubscribe(),this.memoriesUnsubscribe=void 0),this.insightsUnsubscribe&&(this.insightsUnsubscribe(),this.insightsUnsubscribe=void 0)}refreshAtmosphere(){this.getAtmosphere().subscribe({next:r=>{this.updateGardenState({atmosphere:r}),this.updatesSubject.next({type:"atmosphere_changed",data:r,timestamp:new Date})},error:r=>{console.error("Error refreshing atmosphere:",r)}})}deleteMemory(r){const i=w_(this.firestore,"memories",r);return new jn(s=>{Dxe(i).then(()=>{this.updatesSubject.next({type:"memory_deleted",data:{id:r},timestamp:new Date}),s.next(),s.complete()}).catch(o=>{s.error(o)})})}updateMemory(r,i){const s=w_(this.firestore,"memories",r);return new jn(o=>{Pxe(s,i).then(()=>{o.next(),o.complete()}).catch(a=>{o.error(a)})})}getCurrentGardenState(){return this.gardenStateSubject.value}createMemoryWithOptimisticUpdate(r){const i={userId:this.auth.currentUser?.uid||"",userText:r,imagePrompt:"Generating...",imageUrl:"",timestamp:Date.now(),type:"memory",emotions:{}},s=this.getCurrentGardenState();return this.updateGardenState({memories:[i,...s.memories],totalPlants:s.totalPlants+1}),this.createMemory(r)}ngOnDestroy(){this.cleanup()}static#e=n=()=>(this.\u0275fac=function(i){return new(i||e)},this.\u0275prov=Et({token:e,factory:e.\u0275fac,providedIn:"root"}))}return n(),e})();const VNe=["canvas"];let Zk=(()=>{var n;class e{constructor(r){this.apiService=r,this.memoryClicked=new Er,this.memories=[],this.atmosphere=null,this.memoryMeshes=[],this.weatherParticles=null,this.audioPlayer=new Audio,this.emptyGardenCenter=null}ngAfterViewInit(){this.createScene(),this.createControls(),this.startRenderingLoop(),this.getAtmosphere(),this.getMemories()}ngOnDestroy(){this.memorySubscription&&this.memorySubscription.unsubscribe(),this.atmosphereSubscription&&this.atmosphereSubscription.unsubscribe(),this.audioPlayer.pause(),this.renderer.dispose(),this.scene.traverse(r=>{if(r instanceof mr||r instanceof Ek){r.geometry.dispose();const i=r.material;Array.isArray(i)?i.forEach(s=>s.dispose()):i.dispose()}})}createScene(){this.scene=new dk,this.scene.background=new Ge(this.getTimeBasedColor()),this.camera=new Or(75,this.getAspectRatio(),.1,1e3),this.camera.position.z=10}getAtmosphere(){this.atmosphereSubscription=this.apiService.getAtmosphere().subscribe({next:r=>{this.atmosphere=r,this.scene&&(this.scene.background=new Ge(r.backgroundColor),this.createWeatherParticles(r.weather)),this.audioPlayer.src=`assets/${r.soundUrl}`,this.audioPlayer.loop=!0,this.audioPlayer.play().catch(i=>console.error("Error playing audio:",i)),console.log("Atmosphere data:",r)},error:r=>{console.error("Error getting atmosphere:",r),this.scene.background=new Ge(this.getTimeBasedColor())}})}getMemories(){this.memorySubscription=this.apiService.getMemories().subscribe({next:r=>{this.memories=r,this.recreateMemoryVisuals()},error:r=>{console.error("Error getting memories:",r),this.memories=this.memories||[]}})}createWeatherParticles(r){if(this.weatherParticles&&(this.scene.remove(this.weatherParticles),this.weatherParticles.geometry.dispose(),this.weatherParticles.material.dispose(),this.weatherParticles=null),"Rainy"!==r&&"Snowy"!==r)return;const s=[];for(let c=0;c<5e3;c++){const l=200*Math.random()-100,u=100*Math.random()-50,d=100*Math.random()-50;s.push(l,u,d)}const o=new Bt;o.setAttribute("position",new Xe(s,3));const a=new yk({color:16777215,size:"Snowy"===r?.2:.1,transparent:!0,opacity:.7});this.weatherParticles=new Ek(o,a),this.scene.add(this.weatherParticles)}recreateMemoryVisuals(){if(this.memoryMeshes.forEach(s=>this.scene.remove(s)),this.memoryMeshes=[],0===this.memories.length)return void this.createEmptyGardenCenter();this.removeEmptyGardenCenter();const r=new hY,i=new Zf(1,1);this.memories.forEach((s,o)=>{const a=r.load(s.imageUrl),c=new eo({map:a,transparent:!0}),l=new mr(i,c);l.userData={memory:s};const d=137.5*o,h=2*Math.sqrt(o),f=h*Math.cos(d*Math.PI/180),m=h*Math.sin(d*Math.PI/180);l.position.set(f,m,0),this.scene.add(l),this.memoryMeshes.push(l)})}createControls(){this.renderer=new ew({canvas:this.canvasRef.nativeElement,antialias:!0}),this.renderer.setSize(window.innerWidth,window.innerHeight),this.controls=new PNe(this.camera,this.renderer.domElement),this.controls.enableDamping=!0}animateWeather(){if(this.weatherParticles){const r=this.weatherParticles.geometry.attributes.position.array,i="Snowy"===this.atmosphere?.weather?-.05:-.2;for(let s=1;s<r.length;s+=3)r[s]+=i,r[s]<-50&&(r[s]=50);this.weatherParticles.geometry.attributes.position.needsUpdate=!0}}startRenderingLoop(){const r=this;!function i(){requestAnimationFrame(i),r.controls.update(),r.animateWeather(),r.renderer.render(r.scene,r.camera)}()}getAspectRatio(){return this.canvasRef.nativeElement.clientWidth/this.canvasRef.nativeElement.clientHeight}onCanvasClick(r){const s=this.canvasRef.nativeElement.getBoundingClientRect(),c=new oe((r.clientX-s.left)/s.width*2-1,-(r.clientY-s.top)/s.height*2+1),l=new AY;l.setFromCamera(c,this.camera);const u=l.intersectObjects(this.memoryMeshes);if(u.length>0){const h=u[0].object.userData.memory;h&&this.memoryClicked.emit(h)}}getTimeBasedColor(){const i=(new Date).getHours();return i>=5&&i<8?16766906:i>=8&&i<12?8900331:i>=12&&i<17?11259375:i>=17&&i<20?16753920:i>=20&&i<23?1644912:3087209}createEmptyGardenCenter(){if(this.emptyGardenCenter)return;const r=new pw(.3,1,8),i=new eo({color:9139029,transparent:!0,opacity:.7});this.emptyGardenCenter=new mr(r,i),this.emptyGardenCenter.position.set(0,-.3,0),this.emptyGardenCenter.userData={isEmptyCenter:!0},this.scene.add(this.emptyGardenCenter)}removeEmptyGardenCenter(){this.emptyGardenCenter&&(this.scene.remove(this.emptyGardenCenter),this.emptyGardenCenter.geometry.dispose(),this.emptyGardenCenter.material.dispose(),this.emptyGardenCenter=null)}exportAsPoster(){const s=new ew({antialias:!0,preserveDrawingBuffer:!0});s.setSize(4096,4096),s.domElement.style.position="absolute",s.domElement.style.left="-9999px",document.body.appendChild(s.domElement);const o=(new Ro).setFromObject(this.scene),a=o.getCenter(new L),c=o.getSize(new L),l=Math.max(c.x,c.y,c.z),u=this.camera.fov*(Math.PI/180);let d=Math.abs(l/2*Math.tan(2*u));d*=1.1;const h=new Or(this.camera.fov,1,.1,1e3);h.position.set(a.x,a.y,a.z+d),h.lookAt(a),s.render(this.scene,h);const f=document.createElement("a");f.download="kert-poszter.png",f.href=s.domElement.toDataURL("image/png"),f.click(),document.body.removeChild(s.domElement)}static#e=n=()=>(this.\u0275fac=function(i){return new(i||e)(Me(Fw))},this.\u0275cmp=Ll({type:e,selectors:[["app-garden"]],viewQuery:function(i,s){if(1&i&&sE(VNe,5),2&i){let o;oE(o=aE())&&(s.canvasRef=o.first)}},outputs:{memoryClicked:"memoryClicked"},decls:5,vars:0,consts:[["canvas",""],[1,"garden-container"],[3,"click"]],template:function(i,s){if(1&i){const o=$i();Cm(0,"div",1)(1,"canvas",2,0),iE("click",function(c){return An(o),Mn(s.onCanvasClick(c))}),Dm(),Cm(3,"button",2),iE("click",function(){return An(o),Mn(s.exportAsPoster())}),tt(4,"Export as Poster"),Dm()()}},dependencies:[ql],styles:["canvas[_ngcontent-%COMP%]{width:100%;height:500px;display:block}"]}))}return n(),e})();function UNe(n,e){1&n&&(Fe(0,"small"),tt(1,"A memory is required."),Ve())}function BNe(n,e){1&n&&(Fe(0,"small"),tt(1,"Please elaborate a bit more on your memory (at least 10 characters)."),Ve())}function HNe(n,e){if(1&n&&(Fe(0,"div",10),un(1,UNe,2,0,"small",6)(2,BNe,2,0,"small",6),Ve()),2&n){const t=Wt();Je(),mt("ngIf",null==t.memoryForm.controls.text.errors?null:t.memoryForm.controls.text.errors.required),Je(),mt("ngIf",null==t.memoryForm.controls.text.errors?null:t.memoryForm.controls.text.errors.minlength)}}function zNe(n,e){if(1&n&&(Fe(0,"div",10)(1,"small"),tt(2),Ve()()),2&n){const t=Wt();Je(2),as(t.error)}}function GNe(n,e){1&n&&(Fe(0,"span"),tt(1,"\u2728 Get AI Poetic Version"),Ve())}function WNe(n,e){1&n&&(Fe(0,"span"),tt(1,"\u2728 Creating Magic..."),Ve())}function jNe(n,e){1&n&&(Fe(0,"span"),tt(1,"\u{1f331} Plant Memory Seed"),Ve())}function $Ne(n,e){1&n&&(Fe(0,"span"),tt(1,"\u{1f331} Planting..."),Ve())}function qNe(n,e){1&n&&(Fe(0,"p",17),tt(1,"Thinking of inspiration..."),Ve())}function XNe(n,e){if(1&n){const t=$i();Fe(0,"div",18)(1,"p")(2,"em"),tt(3),Ve()(),Fe(4,"button",19),Gt("click",function(){return An(t),Mn(Wt(2).useAssistantSuggestion())}),tt(5," \u2728 Use This Suggestion "),Ve(),Fe(6,"button",20),Gt("click",function(){return An(t),Mn(Wt(2).generateSuggestion())}),tt(7," \u{1f504} Get Another Idea "),Ve()()}if(2&n){const t=Wt(2);Je(3),as(t.assistantSuggestion)}}function KNe(n,e){if(1&n){const t=$i();Fe(0,"div",11)(1,"div",12)(2,"h3"),tt(3,"\u{1f338} Creative Assistant"),Ve(),Fe(4,"button",13),Gt("click",function(){return An(t),Mn(Wt().hideCreativeAssistant())}),tt(5,"\u2715"),Ve()(),Fe(6,"div",14),un(7,qNe,2,0,"p",15)(8,XNe,8,1,"div",16),Ve()()}if(2&n){const t=Wt();Je(7),mt("ngIf",t.assistantLoading),Je(),mt("ngIf",!t.assistantLoading&&t.assistantSuggestion)}}function YNe(n,e){if(1&n){const t=$i();Fe(0,"div",21)(1,"div",22)(2,"h3"),tt(3,"\u2728 AI Enhanced Version"),Ve(),Fe(4,"button",13),Gt("click",function(){return An(t),Mn(Wt().hidePoeticOption())}),tt(5,"\u2715"),Ve()(),Fe(6,"div",23)(7,"div",24)(8,"div",25)(9,"p",26),tt(10),Ve(),Fe(11,"small",27),tt(12),Ve()()(),Fe(13,"div",28)(14,"button",29),Gt("click",function(){return An(t),Mn(Wt().usePoeticVersion())}),tt(15," \u2728 Use This Beautiful Version "),Ve(),Fe(16,"button",30),Gt("click",function(){return An(t),Mn(Wt().generatePoeticVersion())}),tt(17," \u{1f504} Try Another Style "),Ve()()()()}if(2&n){const t=Wt();Je(10),as(t.poeticRephrasing.poeticVersion),Je(2),as(t.poeticRephrasing.suggestion),Je(4),mt("disabled",t.assistantLoading)}}let WY=(()=>{var n;class e{constructor(){this.memorySubmit=new Er,this.isLoading=!1,this.error=null,this.apiService=Ie(Fw),this.showCreativeAssistant=!1,this.assistantSuggestion="",this.assistantLoading=!1,this.poeticRephrasing=null,this.showPoeticOption=!1,this.memoryForm=new KE({text:new QM("",[v5.required,v5.minLength(10)])})}onSubmit(){this.memoryForm.valid&&this.memoryForm.value.text&&(this.memorySubmit.emit(this.memoryForm.value.text),this.memoryForm.reset(),this.hideCreativeAssistant())}toggleCreativeAssistant(){this.showCreativeAssistant=!this.showCreativeAssistant,this.showCreativeAssistant&&!this.assistantSuggestion&&this.generateSuggestion()}hideCreativeAssistant(){this.showCreativeAssistant=!1,this.assistantSuggestion=""}generateSuggestion(){this.assistantLoading=!0;const r=["Think of a moment when you felt completely at peace...","Recall a time when you laughed until your stomach hurt...","Remember a beautiful sunrise, sunset, or starry night...","Consider a moment of unexpected kindness you experienced...","Think about the smell, taste, or sound that brings you joy...","Recall a conversation that changed your perspective...","Remember a place where you felt truly safe and happy...","Think of a moment when you felt proud of yourself..."];setTimeout(()=>{this.assistantSuggestion=r[Math.floor(Math.random()*r.length)],this.assistantLoading=!1},800)}useAssistantSuggestion(){this.assistantSuggestion&&(this.memoryForm.patchValue({text:this.assistantSuggestion}),this.hideCreativeAssistant())}generatePoeticVersion(){const r=this.memoryForm.get("text")?.value;!r||r.trim().length<10||(this.assistantLoading=!0,this.poeticRephrasing=null,this.apiService.getPoeticRephrasing(r.trim()).subscribe({next:i=>{this.poeticRephrasing=i,this.showPoeticOption=!0,this.assistantLoading=!1},error:i=>{console.error("Error generating poetic rephrasing:",i),this.assistantLoading=!1,this.poeticRephrasing={poeticVersion:this.enhanceTextLocally(r),suggestion:"I created a local enhancement as the AI service wasn't available."},this.showPoeticOption=!0}}))}enhanceTextLocally(r){return r.replace(/I /g,"I gently ").replace(/was /g,"found myself ").replace(/walked/g,"wandered").replace(/saw/g,"witnessed").replace(/felt/g,"experienced")}usePoeticVersion(){this.poeticRephrasing?.poeticVersion&&(this.memoryForm.patchValue({text:this.poeticRephrasing.poeticVersion}),this.hidePoeticOption())}hidePoeticOption(){this.showPoeticOption=!1,this.poeticRephrasing=null}static#e=n=()=>(this.\u0275fac=function(i){return new(i||e)},this.\u0275cmp=Ll({type:e,selectors:[["app-memory-create"]],inputs:{isLoading:"isLoading",error:"error"},outputs:{memorySubmit:"memorySubmit"},decls:15,vars:14,consts:[[1,"memory-form",3,"ngSubmit","formGroup"],["formControlName","text","placeholder","What beautiful memory will you plant today?","rows","4",3,"disabled"],["class","error-message",4,"ngIf"],[1,"form-actions"],["type","button",1,"assistant-button",3,"click","disabled"],["type","button",1,"poetic-button",3,"click","disabled"],[4,"ngIf"],["type","submit",1,"submit-button",3,"disabled"],["class","creative-assistant",4,"ngIf"],["class","poetic-panel",4,"ngIf"],[1,"error-message"],[1,"creative-assistant"],[1,"assistant-header"],["type","button",1,"close-button",3,"click"],[1,"assistant-content"],["class","loading",4,"ngIf"],["class","suggestion",4,"ngIf"],[1,"loading"],[1,"suggestion"],["type","button",1,"use-suggestion-button",3,"click"],["type","button",1,"refresh-button",3,"click"],[1,"poetic-panel"],[1,"panel-header"],[1,"poetic-content"],[1,"original-vs-poetic"],[1,"poetic-version"],[1,"poetic-text"],[1,"suggestion-text"],[1,"poetic-actions"],["type","button",1,"use-poetic-button",3,"click"],["type","button",1,"regenerate-button",3,"click","disabled"]],template:function(i,s){if(1&i&&(Fe(0,"form",0),Gt("ngSubmit",function(){return s.onSubmit()}),Ms(1,"textarea",1),un(2,HNe,3,2,"div",2)(3,zNe,3,1,"div",2),Fe(4,"div",3)(5,"button",4),Gt("click",function(){return s.toggleCreativeAssistant()}),tt(6),Ve(),Fe(7,"button",5),Gt("click",function(){return s.generatePoeticVersion()}),un(8,GNe,2,0,"span",6)(9,WNe,2,0,"span",6),Ve(),Fe(10,"button",7),un(11,jNe,2,0,"span",6)(12,$Ne,2,0,"span",6),Ve()()(),un(13,KNe,9,2,"div",8)(14,YNe,18,3,"div",9)),2&i){let o;mt("formGroup",s.memoryForm),Je(),mt("disabled",s.isLoading),Je(),mt("ngIf",s.memoryForm.controls.text.invalid&&(s.memoryForm.controls.text.dirty||s.memoryForm.controls.text.touched)),Je(),mt("ngIf",s.error),Je(2),mt("disabled",s.isLoading),Je(),jl(" \u{1f4a1} ",s.showCreativeAssistant?"Hide":"Need"," Creative Help "),Je(),mt("disabled",s.isLoading||s.assistantLoading||((null==(o=s.memoryForm.get("text"))||null==o.value?null:o.value.length)||0)<10),Je(),mt("ngIf",!s.assistantLoading),Je(),mt("ngIf",s.assistantLoading),Je(),mt("disabled",s.memoryForm.invalid||s.isLoading),Je(),mt("ngIf",!s.isLoading),Je(),mt("ngIf",s.isLoading),Je(),mt("ngIf",s.showCreativeAssistant),Je(),mt("ngIf",s.showPoeticOption&&s.poeticRephrasing)}},dependencies:[ql,qm,E6,r6,zE,z5,G5,Qm,tC],styles:[".memory-form[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:1rem;padding:1.5rem;border:1px solid #e0e0e0;border-radius:8px;background-color:#f9f9f9}textarea[_ngcontent-%COMP%]{width:100%;padding:.75rem;font-size:1rem;border-radius:4px;border:1px solid #ccc;resize:vertical;box-sizing:border-box}.error-message[_ngcontent-%COMP%]{color:#d32f2f;font-size:.875rem}button[_ngcontent-%COMP%]:disabled{background-color:#ccc;cursor:not-allowed}"]}))}return n(),e})();function JNe(n,e){1&n&&(Fe(0,"div",6)(1,"p"),tt(2,"Your Gardener's Assistant is reflecting..."),Ve(),Ms(3,"div",7),Ve())}function ZNe(n,e){if(1&n&&(Fe(0,"div",8)(1,"p"),tt(2),Ve()()),2&n){const t=Wt(2);Je(2),as(t.error)}}function QNe(n,e){1&n&&(ac(0),tt(1," Listen \u{1f50a} "),ta())}function eOe(n,e){1&n&&Ms(0,"div",16)}function tOe(n,e){if(1&n){const t=$i();Fe(0,"div",9)(1,"p",10),tt(2,"\u201c"),Ve(),Fe(3,"p",11),tt(4),Ve(),Fe(5,"div",12)(6,"p",13),tt(7),Rr(8,"date"),Ve(),Fe(9,"button",14),Rr(10,"async"),Gt("click",function(){An(t);const i=Wt(2);return Mn(i.playInsightAudio(i.insight.id))}),un(11,QNe,2,0,"ng-container",15),Rr(12,"async"),un(13,eOe,1,0,"ng-template",null,0,fh),Ve()()()}if(2&n){const t=Lm(14),r=Wt(2);Je(4),as(r.insight.text),Je(3),as(HA(8,5,r.insight.timestamp,"medium")),Je(2),mt("disabled",!0===Zr(10,8,r.isAudioLoading$)),Je(2),mt("ngIf",!Zr(12,10,r.isAudioLoading$))("ngIfElse",t)}}function nOe(n,e){if(1&n&&(Fe(0,"div",2),un(1,JNe,4,0,"div",3)(2,ZNe,3,1,"div",4)(3,tOe,15,12,"div",5),Ve()),2&n){const t=Wt();Je(),mt("ngIf",t.isLoading),Je(),mt("ngIf",t.error),Je(),mt("ngIf",t.insight&&!t.isLoading)}}let jY=(()=>{var n;class e{constructor(){this.insight=null,this.isLoading=!1,this.error=null,this.apiService=Ie(Fw),this.audioPlayer=new Audio,this.isAudioLoading$=new ao(!1)}playInsightAudio(r){r&&(this.isAudioLoading$.next(!0),this.apiService.getInsightAudioUrl(r).subscribe({next:i=>{this.audioPlayer.src=i.audioUrl,this.audioPlayer.play(),this.isAudioLoading$.next(!1)},error:i=>{console.error("Error getting insight audio:",i),this.isAudioLoading$.next(!1)}}))}static#e=n=()=>(this.\u0275fac=function(i){return new(i||e)},this.\u0275cmp=Ll({type:e,selectors:[["app-insight-display"]],inputs:{insight:"insight",isLoading:"isLoading",error:"error"},decls:1,vars:1,consts:[["audioLoading",""],["class","insight-container",4,"ngIf"],[1,"insight-container"],["class","loading-spinner",4,"ngIf"],["class","error-message",4,"ngIf"],["class","insight-content fade-in",4,"ngIf"],[1,"loading-spinner"],[1,"spinner"],[1,"error-message"],[1,"insight-content","fade-in"],[1,"quote"],[1,"insight-text"],[1,"insight-footer"],[1,"timestamp"],[1,"listen-button",3,"click","disabled"],[4,"ngIf","ngIfElse"],[1,"spinner-small"]],template:function(i,s){1&i&&un(0,nOe,4,3,"div",1),2&i&&mt("ngIf",s.insight||s.isLoading||s.error)},dependencies:[ql,qm,yM,vM],styles:['[_nghost-%COMP%]{display:block;font-family:"Averia Serif Libre",serif}.insight-container[_ngcontent-%COMP%]{background-color:#fdfaf6;border:1px solid #e0dcd7;border-radius:8px;padding:24px;max-width:500px;margin:20px auto;text-align:center;box-shadow:0 4px 12px #0000000d;position:relative;overflow:hidden}.insight-content[_ngcontent-%COMP%]{opacity:0;animation:_ngcontent-%COMP%_fadeIn 1s forwards}.quote[_ngcontent-%COMP%]{font-size:48px;color:#d4c4a2;margin:0;line-height:1}.insight-text[_ngcontent-%COMP%]{font-size:1.2rem;color:#5a524c;margin:16px 0;line-height:1.6}.timestamp[_ngcontent-%COMP%]{font-size:.8rem;color:#a89f94;margin-top:20px}.loading-spinner[_ngcontent-%COMP%], .error-message[_ngcontent-%COMP%], .no-insight[_ngcontent-%COMP%]{padding:40px 20px;color:#7a726a}.spinner[_ngcontent-%COMP%]{border:4px solid rgba(0,0,0,.1);width:36px;height:36px;border-radius:50%;border-left-color:#8b7e6a;animation:_ngcontent-%COMP%_spin 1s ease infinite;margin:20px auto 0}.insight-button[_ngcontent-%COMP%]{background-color:#8b7e6a;color:#fff;border:none;border-radius:20px;padding:10px 20px;font-family:"Averia Serif Libre",serif;font-size:1rem;cursor:pointer;transition:background-color .3s ease;margin-top:20px}.insight-button[_ngcontent-%COMP%]:disabled{background-color:#c5bfb6;cursor:not-allowed}.insight-button[_ngcontent-%COMP%]:hover:not(:disabled){background-color:#7a726a}@keyframes _ngcontent-%COMP%_spin{0%{transform:rotate(0)}to{transform:rotate(360deg)}}@keyframes _ngcontent-%COMP%_fadeIn{to{opacity:1}}']}))}return n(),e})();function rOe(n,e){if(1&n&&(Fe(0,"li")(1,"span",14),tt(2),Ve(),Fe(3,"div",15),Ms(4,"div",16),Ve(),Fe(5,"span",17),tt(6),Ve()()),2&n){const t=e.$implicit;Je(2),as(t[0]),Je(2),kA("width",100*t[1],"%"),Je(2),jl("",(100*t[1]).toFixed(0),"%")}}function iOe(n,e){if(1&n&&(Fe(0,"div",12)(1,"h3"),tt(2,"Detected Emotions"),Ve(),Fe(3,"ul"),un(4,rOe,7,4,"li",13),Ve()()),2&n){const t=Wt(2);Je(4),mt("ngForOf",t.emotionsArray)}}function sOe(n,e){if(1&n){const t=$i();Fe(0,"div"),Ms(1,"img",4),Fe(2,"h2"),tt(3,"Your Memory"),Ve(),Fe(4,"p",5),tt(5),Ve(),un(6,iOe,5,1,"div",6),Fe(7,"div",7)(8,"h3"),tt(9,"AI Image Prompt"),Ve(),Fe(10,"p",8),tt(11),Ve()(),Fe(12,"p",9),tt(13),Rr(14,"date"),Ve(),Fe(15,"div",10)(16,"button",11),Gt("click",function(){return An(t),Mn(Wt().onEnterAr())}),tt(17,"Place in AR"),Ve()()()}if(2&n){const t=Wt();Je(),mt("src",t.memory.imageUrl,JS),Je(4),as(t.memory.userText),Je(),mt("ngIf",t.emotionsArray.length>0),Je(5),as(t.memory.imagePrompt),Je(2),as(HA(14,5,t.memory.timestamp,"full"))}}let oOe=(()=>{var n;class e{constructor(){this.memory=null,this.close=new Er,this.enterAr=new Er}get emotionsArray(){return this.memory?.emotions?Object.entries(this.memory.emotions).sort((r,i)=>i[1]-r[1]):[]}onClose(){this.close.emit()}onEnterAr(){this.memory&&this.enterAr.emit(this.memory)}static#e=n=()=>(this.\u0275fac=function(i){return new(i||e)},this.\u0275cmp=Ll({type:e,selectors:[["app-memory-detail"]],inputs:{memory:"memory"},outputs:{close:"close",enterAr:"enterAr"},decls:5,vars:1,consts:[[1,"overlay",3,"click"],[1,"detail-card",3,"click"],[1,"close-button",3,"click"],[4,"ngIf"],["alt","Memory visualization",1,"detail-image",3,"src"],[1,"memory-text"],["class","emotions-section",4,"ngIf"],[1,"prompt-section"],[1,"prompt-text"],[1,"timestamp"],[1,"actions"],[1,"ar-button",3,"click"],[1,"emotions-section"],[4,"ngFor","ngForOf"],[1,"emotion-name"],[1,"emotion-bar-container"],[1,"emotion-bar"],[1,"emotion-score"]],template:function(i,s){1&i&&(Fe(0,"div",0),Gt("click",function(){return s.onClose()}),Fe(1,"div",1),Gt("click",function(a){return a.stopPropagation()}),Fe(2,"button",2),Gt("click",function(){return s.onClose()}),tt(3,"\xd7"),Ve(),un(4,sOe,18,8,"div",3),Ve()()),2&i&&(Je(4),mt("ngIf",s.memory))},dependencies:[ql,LG,qm,vM],styles:['[_nghost-%COMP%]{position:fixed;top:0;left:0;width:100%;height:100%;z-index:1000;display:flex;justify-content:center;align-items:center}.overlay[_ngcontent-%COMP%]{position:absolute;top:0;left:0;width:100%;height:100%;background-color:#0009;animation:_ngcontent-%COMP%_fadeIn .3s ease}.detail-card[_ngcontent-%COMP%]{background-color:#fff;border-radius:12px;box-shadow:0 10px 30px #0003;width:90%;max-width:600px;max-height:90vh;overflow-y:auto;position:relative;z-index:1001;animation:_ngcontent-%COMP%_slideIn .4s ease-out;padding:20px}.close-button[_ngcontent-%COMP%]{position:absolute;top:10px;right:15px;background:none;border:none;font-size:2rem;color:#aaa;cursor:pointer}.detail-image[_ngcontent-%COMP%]{width:100%;height:auto;max-height:400px;object-fit:cover;border-radius:8px;margin-bottom:20px}h2[_ngcontent-%COMP%], h3[_ngcontent-%COMP%]{font-family:"Averia Serif Libre",serif;color:#333;border-bottom:1px solid #eee;padding-bottom:8px;margin-top:24px}.memory-text[_ngcontent-%COMP%]{font-size:1.1rem;line-height:1.7;color:#444;white-space:pre-wrap}.emotions-section[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]{list-style:none;padding:0}.emotions-section[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]{display:flex;align-items:center;margin-bottom:8px}.emotion-name[_ngcontent-%COMP%]{width:120px;text-transform:capitalize;color:#555}.emotion-bar-container[_ngcontent-%COMP%]{flex-grow:1;height:10px;background-color:#f0f0f0;border-radius:5px;overflow:hidden}.emotion-bar[_ngcontent-%COMP%]{height:100%;background-color:#8b7e6a;border-radius:5px}.emotion-score[_ngcontent-%COMP%]{width:50px;text-align:right;font-size:.9rem;color:#777}.prompt-section[_ngcontent-%COMP%]   .prompt-text[_ngcontent-%COMP%]{background-color:#f8f8f8;border:1px solid #eee;padding:12px;border-radius:4px;font-family:Courier New,Courier,monospace;font-size:.9rem;color:#666;word-wrap:break-word}.timestamp[_ngcontent-%COMP%]{text-align:center;margin-top:30px;font-size:.8rem;color:#999}@keyframes _ngcontent-%COMP%_fadeIn{0%{opacity:0}to{opacity:1}}@keyframes _ngcontent-%COMP%_slideIn{0%{opacity:0;transform:translateY(-30px)}to{opacity:1;transform:translateY(0)}}']}))}return n(),e})();class aOe{static createButton(e,t={}){const r=document.createElement("button");function s(){r.style.display="",r.style.cursor="auto",r.style.left="calc(50% - 75px)",r.style.width="150px",r.onmouseenter=null,r.onmouseleave=null,r.onclick=null}function c(l){l.style.position="absolute",l.style.bottom="20px",l.style.padding="12px 6px",l.style.border="1px solid #fff",l.style.borderRadius="4px",l.style.background="rgba(0,0,0,0.1)",l.style.color="#fff",l.style.font="normal 13px sans-serif",l.style.textAlign="center",l.style.opacity="0.5",l.style.outline="none",l.style.zIndex="999"}if("xr"in navigator)return r.id="ARButton",r.style.display="none",c(r),navigator.xr.isSessionSupported("immersive-ar").then(function(l){l?function i(){if(void 0===t.domOverlay){const f=document.createElement("div");f.style.display="none",document.body.appendChild(f);const m=document.createElementNS("http://www.w3.org/2000/svg","svg");m.setAttribute("width",38),m.setAttribute("height",38),m.style.position="absolute",m.style.right="20px",m.style.top="20px",m.addEventListener("click",function(){l.end()}),f.appendChild(m);const y=document.createElementNS("http://www.w3.org/2000/svg","path");y.setAttribute("d","M 12,12 L 28,28 M 28,12 12,28"),y.setAttribute("stroke","#fff"),y.setAttribute("stroke-width",2),m.appendChild(y),void 0===t.optionalFeatures&&(t.optionalFeatures=[]),t.optionalFeatures.push("dom-overlay"),t.domOverlay={root:f}}let l=null;function u(f){return d.apply(this,arguments)}function d(){return(d=O(function*(f){f.addEventListener("end",h),e.xr.setReferenceSpaceType("local"),yield e.xr.setSession(f),r.textContent="STOP AR",t.domOverlay.root.style.display="",l=f})).apply(this,arguments)}function h(){l.removeEventListener("end",h),r.textContent="START AR",t.domOverlay.root.style.display="none",l=null}r.style.display="",r.style.cursor="pointer",r.style.left="calc(50% - 50px)",r.style.width="100px",r.textContent="START AR",r.onmouseenter=function(){r.style.opacity="1.0"},r.onmouseleave=function(){r.style.opacity="0.5"},r.onclick=function(){null===l?navigator.xr.requestSession("immersive-ar",t).then(u):l.end()}}():function o(){s(),r.textContent="AR NOT SUPPORTED"}()}).catch(function a(l){s(),console.warn("Exception when trying to call xr.isSessionSupported",l),r.textContent="AR NOT ALLOWED"}),r;{const l=document.createElement("a");return!1===window.isSecureContext?(l.href=document.location.href.replace(/^http:/,"https:"),l.innerHTML="WEBXR NEEDS HTTPS"):(l.href="https://immersiveweb.dev/",l.innerHTML="WEBXR NOT AVAILABLE"),l.style.left="calc(50% - 90px)",l.style.width="180px",l.style.textDecoration="none",c(l),l}}}let $Y=(()=>{var n;class e{constructor(){this.selectedMemorySource=new ao(null),this.selectedMemory$=this.selectedMemorySource.asObservable()}setSelectedMemory(r){this.selectedMemorySource.next(r)}static#e=n=()=>(this.\u0275fac=function(i){return new(i||e)},this.\u0275prov=Et({token:e,factory:e.\u0275fac,providedIn:"root"}))}return n(),e})();const cOe=["arContainer"];let qY=(()=>{var n;class e{constructor(){this.arStateService=Ie($Y),this.currentMemory=null,this.textureLoader=new hY,this.hitTestSource=null,this.hitTestSourceRequested=!1,this.placedObjects=[],this.raycaster=new AY,this.memorySelected=new Er}ngOnInit(){this.initXR(),this.memorySubscription=this.arStateService.selectedMemory$.subscribe(r=>{this.currentMemory=r})}ngOnDestroy(){this.memorySubscription&&this.memorySubscription.unsubscribe(),this.renderer&&(this.renderer.xr.getSession()?.end(),this.renderer.dispose())}initXR(){const r=this.arContainer.nativeElement;this.scene=new dk,this.camera=new Or(70,window.innerWidth/window.innerHeight,.01,20),this.renderer=new ew({antialias:!0,alpha:!0}),this.renderer.setPixelRatio(window.devicePixelRatio),this.renderer.setSize(window.innerWidth,window.innerHeight),this.renderer.xr.enabled=!0,r.appendChild(this.renderer.domElement);const i=aOe.createButton(this.renderer,{requiredFeatures:["hit-test"]});r.appendChild(i),this.setupContent(),this.renderer.setAnimationLoop((s,o)=>{o&&this.updateHitTest(o),this.placedObjects.forEach(a=>{a.mesh.quaternion.copy(this.camera.quaternion)}),this.renderer.render(this.scene,this.camera)})}setupContent(){const r=new fY(16777215,12303359,1);r.position.set(.5,1,.25),this.scene.add(r),this.reticle=new mr(new Tw(.05,.07,32).rotateX(-Math.PI/2),new eo),this.reticle.matrixAutoUpdate=!1,this.reticle.visible=!1,this.scene.add(this.reticle),this.controller=this.renderer.xr.getController(0),this.controller.addEventListener("select",this.onSelect.bind(this)),this.scene.add(this.controller)}onSelect(){this.raycaster.setFromCamera(new oe(0,0),this.camera);const r=this.raycaster.intersectObjects(this.placedObjects.map(i=>i.mesh));if(r.length>0){const i=this.placedObjects.find(s=>s.mesh===r[0].object);if(i)return void this.memorySelected.emit(i.memory)}if(this.reticle.visible&&this.currentMemory){const i=this.currentMemory,s=o=>{const a=new eo({map:o,transparent:!0}),c=new Zf(.2,.2),l=new mr(c,a);l.position.setFromMatrixPosition(this.reticle.matrix),this.scene.add(l),this.placedObjects.push({mesh:l,memory:i})};if(i.imageUrl)this.textureLoader.load(i.imageUrl,s);else{const o=this.createTextCanvas(i.userText);s(new tPe(o))}}}createTextCanvas(r){const i=document.createElement("canvas"),s=i.getContext("2d");i.width=256,i.height=256,s.fillStyle="rgba(255, 255, 255, 0.8)",s.fillRect(0,0,256,256),s.fillStyle="black",s.font="16px Arial",s.textAlign="center",s.textBaseline="middle";const c=r.split(" ");let l="",u=128-c.length/4*10;for(let d=0;d<c.length;d++){const h=l+c[d]+" ";s.measureText(h).width>236&&d>0?(s.fillText(l,128,u),l=c[d]+" ",u+=20):l=h}return s.fillText(l,128,u),i}updateHitTest(r){var i=this;return O(function*(){const s=i.renderer.xr.getSession();if(s){if(!i.hitTestSourceRequested){const o=yield s.requestReferenceSpace("viewer");i.hitTestSource=yield s.requestHitTestSource?.({space:o}),i.hitTestSourceRequested=!0}if(i.hitTestSource){const o=r.getHitTestResults(i.hitTestSource);if(o.length>0){const a=o[0],c=i.renderer.xr.getReferenceSpace();if(c){const l=a.getPose(c);l&&(i.reticle.visible=!0,i.reticle.matrix.fromArray(l.transform.matrix))}}else i.reticle.visible=!1}}})()}static#e=n=()=>(this.\u0275fac=function(i){return new(i||e)},this.\u0275cmp=Ll({type:e,selectors:[["app-ar-view"]],viewQuery:function(i,s){if(1&i&&sE(cOe,7),2&i){let o;oE(o=aE())&&(s.arContainer=o.first)}},outputs:{memorySelected:"memorySelected"},decls:2,vars:0,consts:[["arContainer",""],[1,"ar-container"]],template:function(i,s){1&i&&SA(0,"div",1,0)},dependencies:[ql],styles:[".ar-container[_ngcontent-%COMP%]{position:fixed;top:0;left:0;width:100%;height:100%;z-index:1000}#ARButton[_ngcontent-%COMP%]{position:absolute;bottom:20px;left:50%;transform:translate(-50%);padding:12px 24px;border-radius:4px;background-color:#007bff;color:#fff;font-size:16px;border:none;cursor:pointer}"]}))}return n(),e})();const XY=function(n){const e=[];let t=0;for(let r=0;r<n.length;r++){let i=n.charCodeAt(r);i<128?e[t++]=i:i<2048?(e[t++]=i>>6|192,e[t++]=63&i|128):55296==(64512&i)&&r+1<n.length&&56320==(64512&n.charCodeAt(r+1))?(i=65536+((1023&i)<<10)+(1023&n.charCodeAt(++r)),e[t++]=i>>18|240,e[t++]=i>>12&63|128,e[t++]=i>>6&63|128,e[t++]=63&i|128):(e[t++]=i>>12|224,e[t++]=i>>6&63|128,e[t++]=63&i|128)}return e},KY={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:"function"==typeof atob,encodeByteArray(n,e){if(!Array.isArray(n))throw Error("encodeByteArray takes an array as a parameter");this.init_();const t=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[];for(let i=0;i<n.length;i+=3){const s=n[i],o=i+1<n.length,a=o?n[i+1]:0,c=i+2<n.length,l=c?n[i+2]:0;let h=(15&a)<<2|l>>6,f=63&l;c||(f=64,o||(h=64)),r.push(t[s>>2],t[(3&s)<<4|a>>4],t[h],t[f])}return r.join("")},encodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(n):this.encodeByteArray(XY(n),e)},decodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(n):function(n){const e=[];let t=0,r=0;for(;t<n.length;){const i=n[t++];if(i<128)e[r++]=String.fromCharCode(i);else if(i>191&&i<224){const s=n[t++];e[r++]=String.fromCharCode((31&i)<<6|63&s)}else if(i>239&&i<365){const c=((7&i)<<18|(63&n[t++])<<12|(63&n[t++])<<6|63&n[t++])-65536;e[r++]=String.fromCharCode(55296+(c>>10)),e[r++]=String.fromCharCode(56320+(1023&c))}else{const s=n[t++],o=n[t++];e[r++]=String.fromCharCode((15&i)<<12|(63&s)<<6|63&o)}}return e.join("")}(this.decodeStringToByteArray(n,e))},decodeStringToByteArray(n,e){this.init_();const t=e?this.charToByteMapWebSafe_:this.charToByteMap_,r=[];for(let i=0;i<n.length;){const s=t[n.charAt(i++)],a=i<n.length?t[n.charAt(i)]:0;++i;const l=i<n.length?t[n.charAt(i)]:64;++i;const d=i<n.length?t[n.charAt(i)]:64;if(++i,null==s||null==a||null==l||null==d)throw new fOe;r.push(s<<2|a>>4),64!==l&&(r.push(a<<4&240|l>>2),64!==d&&r.push(l<<6&192|d))}return r},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let n=0;n<this.ENCODED_VALS.length;n++)this.byteToCharMap_[n]=this.ENCODED_VALS.charAt(n),this.charToByteMap_[this.byteToCharMap_[n]]=n,this.byteToCharMapWebSafe_[n]=this.ENCODED_VALS_WEBSAFE.charAt(n),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[n]]=n,n>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(n)]=n,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(n)]=n)}}};class fOe extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const Vw=function(n){return function(n){const e=XY(n);return KY.encodeByteArray(e,!0)}(n).replace(/\./g,"")},Bw=()=>{try{return function gOe(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}().__FIREBASE_DEFAULTS__||(()=>{if(typeof process>"u"||typeof process.env>"u")return;const n=process.env.__FIREBASE_DEFAULTS__;return n?JSON.parse(n):void 0})()||(()=>{if(typeof document>"u")return;let n;try{n=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const e=n&&function(n){try{return KY.decodeString(n,!0)}catch(e){console.error("base64Decode failed: ",e)}return null}(n[1]);return e&&JSON.parse(e)})()}catch(n){return void console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${n}`)}},JY=()=>Bw()?.config;class ZY{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}wrapCallback(e){return(t,r)=>{t?this.reject(t):this.resolve(r),"function"==typeof e&&(this.promise.catch(()=>{}),1===e.length?e(t):e(t,r))}}}function tJ(){try{return"object"==typeof indexedDB}catch{return!1}}function nJ(){return new Promise((n,e)=>{try{let t=!0;const r="validate-browser-context-for-indexeddb-analytics-module",i=self.indexedDB.open(r);i.onsuccess=()=>{i.result.close(),t||self.indexedDB.deleteDatabase(r),n(!0)},i.onupgradeneeded=()=>{t=!1},i.onerror=()=>{e(i.error?.message||"")}}catch(t){e(t)}})}class pp extends Error{constructor(e,t,r){super(t),this.code=e,this.customData=r,this.name="FirebaseError",Object.setPrototypeOf(this,pp.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,zw.prototype.create)}}class zw{constructor(e,t,r){this.service=e,this.serviceName=t,this.errors=r}create(e,...t){const r=t[0]||{},i=`${this.service}/${e}`,s=this.errors[e],o=s?function AOe(n,e){return n.replace(MOe,(t,r)=>{const i=e[r];return null!=i?String(i):`<${r}?>`})}(s,r):"Error";return new pp(i,`${this.serviceName}: ${o} (${i}).`,r)}}const MOe=/\{\$([^}]+)}/g;function tL(n,e){if(n===e)return!0;const t=Object.keys(n),r=Object.keys(e);for(const i of t){if(!r.includes(i))return!1;const s=n[i],o=e[i];if(iJ(s)&&iJ(o)){if(!tL(s,o))return!1}else if(s!==o)return!1}for(const i of r)if(!t.includes(i))return!1;return!0}function iJ(n){return null!==n&&"object"==typeof n}function iL(n){return n&&n._delegate?n._delegate:n}class rl{constructor(e,t,r){this.name=e,this.instanceFactory=t,this.type=r,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}const nd="[DEFAULT]";class LOe{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){const r=new ZY;if(this.instancesDeferred.set(t,r),this.isInitialized(t)||this.shouldAutoInitialize())try{const i=this.getOrInitializeService({instanceIdentifier:t});i&&r.resolve(i)}catch{}}return this.instancesDeferred.get(t).promise}getImmediate(e){const t=this.normalizeInstanceIdentifier(e?.identifier),r=e?.optional??!1;if(!this.isInitialized(t)&&!this.shouldAutoInitialize()){if(r)return null;throw Error(`Service ${this.name} is not available`)}try{return this.getOrInitializeService({instanceIdentifier:t})}catch(i){if(r)return null;throw i}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,this.shouldAutoInitialize()){if(function VOe(n){return"EAGER"===n.instantiationMode}(e))try{this.getOrInitializeService({instanceIdentifier:nd})}catch{}for(const[t,r]of this.instancesDeferred.entries()){const i=this.normalizeInstanceIdentifier(t);try{const s=this.getOrInitializeService({instanceIdentifier:i});r.resolve(s)}catch{}}}}clearInstance(e=nd){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}delete(){var e=this;return O(function*(){const t=Array.from(e.instances.values());yield Promise.all([...t.filter(r=>"INTERNAL"in r).map(r=>r.INTERNAL.delete()),...t.filter(r=>"_delete"in r).map(r=>r._delete())])})()}isComponentSet(){return null!=this.component}isInitialized(e=nd){return this.instances.has(e)}getOptions(e=nd){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:t={}}=e,r=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(r))throw Error(`${this.name}(${r}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const i=this.getOrInitializeService({instanceIdentifier:r,options:t});for(const[s,o]of this.instancesDeferred.entries())r===this.normalizeInstanceIdentifier(s)&&o.resolve(i);return i}onInit(e,t){const r=this.normalizeInstanceIdentifier(t),i=this.onInitCallbacks.get(r)??new Set;i.add(e),this.onInitCallbacks.set(r,i);const s=this.instances.get(r);return s&&e(s,r),()=>{i.delete(e)}}invokeOnInitCallbacks(e,t){const r=this.onInitCallbacks.get(t);if(r)for(const i of r)try{i(e,t)}catch{}}getOrInitializeService({instanceIdentifier:e,options:t={}}){let r=this.instances.get(e);if(!r&&this.component&&(r=this.component.instanceFactory(this.container,{instanceIdentifier:(n=e,n===nd?void 0:n),options:t}),this.instances.set(e,r),this.instancesOptions.set(e,t),this.invokeOnInitCallbacks(r,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,r)}catch{}var n;return r||null}normalizeInstanceIdentifier(e=nd){return this.component?this.component.multipleInstances?e:nd:e}shouldAutoInitialize(){return!!this.component&&"EXPLICIT"!==this.component.instantiationMode}}class UOe{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const t=this.getProvider(e.name);if(t.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);t.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const t=new LOe(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}}const sL=[];var Ln=function(n){return n[n.DEBUG=0]="DEBUG",n[n.VERBOSE=1]="VERBOSE",n[n.INFO=2]="INFO",n[n.WARN=3]="WARN",n[n.ERROR=4]="ERROR",n[n.SILENT=5]="SILENT",n}(Ln||{});const sJ={debug:Ln.DEBUG,verbose:Ln.VERBOSE,info:Ln.INFO,warn:Ln.WARN,error:Ln.ERROR,silent:Ln.SILENT},BOe=Ln.INFO,HOe={[Ln.DEBUG]:"log",[Ln.VERBOSE]:"log",[Ln.INFO]:"info",[Ln.WARN]:"warn",[Ln.ERROR]:"error"},zOe=(n,e,...t)=>{if(e<n.logLevel)return;const r=(new Date).toISOString(),i=HOe[e];if(!i)throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`);console[i](`[${r}]  ${n.name}:`,...t)};class WOe{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(t=>{if(function jOe(n){return"VERSION"===n.getComponent()?.type}(t)){const r=t.getImmediate();return`${r.library}/${r.version}`}return null}).filter(t=>t).join(" ")}}const Ww="@firebase/app",Va=new class GOe{constructor(e){this.name=e,this._logLevel=BOe,this._logHandler=zOe,this._userLogHandler=null,sL.push(this)}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in Ln))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel="string"==typeof e?sJ[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if("function"!=typeof e)throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,Ln.DEBUG,...e),this._logHandler(this,Ln.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,Ln.VERBOSE,...e),this._logHandler(this,Ln.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,Ln.INFO,...e),this._logHandler(this,Ln.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,Ln.WARN,...e),this._logHandler(this,Ln.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,Ln.ERROR,...e),this._logHandler(this,Ln.ERROR,...e)}}("@firebase/app"),$Oe="@firebase/app-compat",qOe="@firebase/analytics-compat",XOe="@firebase/analytics",KOe="@firebase/app-check-compat",YOe="@firebase/app-check",JOe="@firebase/auth",ZOe="@firebase/auth-compat",QOe="@firebase/database",eke="@firebase/data-connect",tke="@firebase/database-compat",nke="@firebase/functions",rke="@firebase/functions-compat",ike="@firebase/installations",ske="@firebase/installations-compat",oke="@firebase/messaging",ake="@firebase/messaging-compat",cke="@firebase/performance",lke="@firebase/performance-compat",uke="@firebase/remote-config",dke="@firebase/remote-config-compat",hke="@firebase/storage",fke="@firebase/storage-compat",pke="@firebase/firestore",mke="@firebase/ai",gke="@firebase/firestore-compat",_ke="firebase",jw="[DEFAULT]",yke={[Ww]:"fire-core",[$Oe]:"fire-core-compat",[XOe]:"fire-analytics",[qOe]:"fire-analytics-compat",[YOe]:"fire-app-check",[KOe]:"fire-app-check-compat",[JOe]:"fire-auth",[ZOe]:"fire-auth-compat",[QOe]:"fire-rtdb",[eke]:"fire-data-connect",[tke]:"fire-rtdb-compat",[nke]:"fire-fn",[rke]:"fire-fn-compat",[ike]:"fire-iid",[ske]:"fire-iid-compat",[oke]:"fire-fcm",[ake]:"fire-fcm-compat",[cke]:"fire-perf",[lke]:"fire-perf-compat",[uke]:"fire-rc",[dke]:"fire-rc-compat",[hke]:"fire-gcs",[fke]:"fire-gcs-compat",[pke]:"fire-fst",[gke]:"fire-fst-compat",[mke]:"fire-vertex","fire-js":"fire-js",[_ke]:"fire-js-all"},rd=new Map,Z_=new Map,Q_=new Map;function oJ(n,e){try{n.container.addComponent(e)}catch(t){Va.debug(`Component ${e.name} failed to register with FirebaseApp ${n.name}`,t)}}function id(n){const e=n.name;if(Q_.has(e))return Va.debug(`There were multiple attempts to register component ${e}.`),!1;Q_.set(e,n);for(const t of rd.values())oJ(t,n);for(const t of Z_.values())oJ(t,n);return!0}function $w(n,e){const t=n.container.getProvider("heartbeat").getImmediate({optional:!0});return t&&t.triggerHeartbeat(),n.container.getProvider(e)}const Es=new zw("app","Firebase",{"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."});class cJ{constructor(e,t,r){this._isDeleted=!1,this._options={...e},this._config={...t},this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=r,this.container.addComponent(new rl("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw Es.create("app-deleted",{appName:this._name})}}function il(n,e,t){let r=yke[n]??n;t&&(r+=`-${t}`);const i=r.match(/\s|\//),s=e.match(/\s|\//);if(i||s){const o=[`Unable to register library "${r}" with version "${e}":`];return i&&o.push(`library name "${r}" contains illegal characters (whitespace or "/")`),i&&s&&o.push("and"),s&&o.push(`version name "${e}" contains illegal characters (whitespace or "/")`),void Va.warn(o.join(" "))}id(new rl(`${r}-version`,()=>({library:r,version:e}),"VERSION"))}const ey="firebase-heartbeat-store";let cL=null;function uJ(){return cL||(cL=cg("firebase-heartbeat-database",1,{upgrade:(n,e)=>{if(0===e)try{n.createObjectStore(ey)}catch(t){console.warn(t)}}}).catch(n=>{throw Es.create("idb-open",{originalErrorMessage:n.message})})),cL}function lL(){return(lL=O(function*(n){try{const t=(yield uJ()).transaction(ey),r=yield t.objectStore(ey).get(hJ(n));return yield t.done,r}catch(e){if(e instanceof pp)Va.warn(e.message);else{const t=Es.create("idb-get",{originalErrorMessage:e?.message});Va.warn(t.message)}}})).apply(this,arguments)}function dJ(n,e){return uL.apply(this,arguments)}function uL(){return(uL=O(function*(n,e){try{const r=(yield uJ()).transaction(ey,"readwrite");yield r.objectStore(ey).put(e,hJ(n)),yield r.done}catch(t){if(t instanceof pp)Va.warn(t.message);else{const r=Es.create("idb-set",{originalErrorMessage:t?.message});Va.warn(r.message)}}})).apply(this,arguments)}function hJ(n){return`${n.name}!${n.options.appId}`}class Dke{constructor(e){this.container=e,this._heartbeatsCache=null;const t=this.container.getProvider("app").getImmediate();this._storage=new Pke(t),this._heartbeatsCachePromise=this._storage.read().then(r=>(this._heartbeatsCache=r,r))}triggerHeartbeat(){var e=this;return O(function*(){try{const r=e.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),i=fJ();if(null==e._heartbeatsCache?.heartbeats&&(e._heartbeatsCache=yield e._heartbeatsCachePromise,null==e._heartbeatsCache?.heartbeats)||e._heartbeatsCache.lastSentHeartbeatDate===i||e._heartbeatsCache.heartbeats.some(s=>s.date===i))return;if(e._heartbeatsCache.heartbeats.push({date:i,agent:r}),e._heartbeatsCache.heartbeats.length>30){const s=function Nke(n){if(0===n.length)return-1;let e=0,t=n[0].date;for(let r=1;r<n.length;r++)n[r].date<t&&(t=n[r].date,e=r);return e}(e._heartbeatsCache.heartbeats);e._heartbeatsCache.heartbeats.splice(s,1)}return e._storage.overwrite(e._heartbeatsCache)}catch(t){Va.warn(t)}})()}getHeartbeatsHeader(){var e=this;return O(function*(){try{if(null===e._heartbeatsCache&&(yield e._heartbeatsCachePromise),null==e._heartbeatsCache?.heartbeats||0===e._heartbeatsCache.heartbeats.length)return"";const t=fJ(),{heartbeatsToSend:r,unsentEntries:i}=function Rke(n,e=1024){const t=[];let r=n.slice();for(const i of n){const s=t.find(o=>o.agent===i.agent);if(s){if(s.dates.push(i.date),pJ(t)>e){s.dates.pop();break}}else if(t.push({agent:i.agent,dates:[i.date]}),pJ(t)>e){t.pop();break}r=r.slice(1)}return{heartbeatsToSend:t,unsentEntries:r}}(e._heartbeatsCache.heartbeats),s=Vw(JSON.stringify({version:2,heartbeats:r}));return e._heartbeatsCache.lastSentHeartbeatDate=t,i.length>0?(e._heartbeatsCache.heartbeats=i,yield e._storage.overwrite(e._heartbeatsCache)):(e._heartbeatsCache.heartbeats=[],e._storage.overwrite(e._heartbeatsCache)),s}catch(t){return Va.warn(t),""}})()}}function fJ(){return(new Date).toISOString().substring(0,10)}class Pke{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}runIndexedDBEnvironmentCheck(){return O(function*(){return!!tJ()&&nJ().then(()=>!0).catch(()=>!1)})()}read(){var e=this;return O(function*(){if(yield e._canUseIndexedDBPromise){const r=yield function Ake(n){return lL.apply(this,arguments)}(e.app);return r?.heartbeats?r:{heartbeats:[]}}return{heartbeats:[]}})()}overwrite(e){var t=this;return O(function*(){if(yield t._canUseIndexedDBPromise){const i=yield t.read();return dJ(t.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??i.lastSentHeartbeatDate,heartbeats:e.heartbeats})}})()}add(e){var t=this;return O(function*(){if(yield t._canUseIndexedDBPromise){const i=yield t.read();return dJ(t.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??i.lastSentHeartbeatDate,heartbeats:[...i.heartbeats,...e.heartbeats]})}})()}}function pJ(n){return Vw(JSON.stringify({version:2,heartbeats:n})).length}!function Oke(n){id(new rl("platform-logger",e=>new WOe(e),"PRIVATE")),id(new rl("heartbeat",e=>new Dke(e),"PRIVATE")),il(Ww,"0.14.2",n),il(Ww,"0.14.2","esm2020"),il("fire-js","")}("");const mJ="@firebase/installations",dL="0.6.19",_J=`w:${dL}`,Ua=new zw("installations","Installations",{"missing-app-config-values":'Missing App configuration value: "{$valueName}"',"not-registered":"Firebase Installation is not registered.","installation-not-found":"Firebase Installation not found.","request-failed":'{$requestName} request failed with error "{$serverCode} {$serverStatus}: {$serverMessage}"',"app-offline":"Could not process request. Application offline.","delete-pending-registration":"Can't delete installation while there is a pending registration request."});function vJ(n){return n instanceof pp&&n.code.includes("request-failed")}function hL({projectId:n}){return`https://firebaseinstallations.googleapis.com/v1/projects/${n}/installations`}function EJ(n){return{token:n.token,requestStatus:2,expiresIn:Bke(n.expiresIn),creationTime:Date.now()}}function fL(n,e){return pL.apply(this,arguments)}function pL(){return(pL=O(function*(n,e){const r=(yield e.json()).error;return Ua.create("request-failed",{requestName:n,serverCode:r.code,serverMessage:r.message,serverStatus:r.status})})).apply(this,arguments)}function bJ({apiKey:n}){return new Headers({"Content-Type":"application/json",Accept:"application/json","x-goog-api-key":n})}function mL(n){return gL.apply(this,arguments)}function gL(){return(gL=O(function*(n){const e=yield n();return e.status>=500&&e.status<600?n():e})).apply(this,arguments)}function Bke(n){return Number(n.replace("s","000"))}function _L(){return(_L=O(function*({appConfig:n,heartbeatServiceProvider:e},{fid:t}){const r=hL(n),i=bJ(n),s=e.getImmediate({optional:!0});if(s){const l=yield s.getHeartbeatsHeader();l&&i.append("x-firebase-client",l)}const a={method:"POST",headers:i,body:JSON.stringify({fid:t,authVersion:"FIS_v2",appId:n.appId,sdkVersion:_J})},c=yield mL(()=>fetch(r,a));if(c.ok){const l=yield c.json();return{fid:l.fid||t,registrationStatus:2,refreshToken:l.refreshToken,authToken:EJ(l.authToken)}}throw yield fL("Create Installation",c)})).apply(this,arguments)}function wJ(n){return new Promise(e=>{setTimeout(e,n)})}const Wke=/^[cdef][\w-]{21}$/;function jke(){try{const n=new Uint8Array(17);(self.crypto||self.msCrypto).getRandomValues(n),n[0]=112+n[0]%16;const t=function $ke(n){return function Gke(n){return btoa(String.fromCharCode(...n)).replace(/\+/g,"-").replace(/\//g,"_")}(n).substr(0,22)}(n);return Wke.test(t)?t:""}catch{return""}}function mp(n){return`${n.appName}!${n.appId}`}const gp=new Map;function IJ(n,e){const t=mp(n);SJ(t,e),function Kke(n,e){const t=function xJ(){return!sd&&"BroadcastChannel"in self&&(sd=new BroadcastChannel("[Firebase] FID Change"),sd.onmessage=n=>{SJ(n.data.key,n.data.fid)}),sd}();t&&t.postMessage({key:n,fid:e}),function AJ(){0===gp.size&&sd&&(sd.close(),sd=null)}()}(t,e)}function SJ(n,e){const t=gp.get(n);if(t)for(const r of t)r(e)}let sd=null;const od="firebase-installations-store";let vL=null;function EL(){return vL||(vL=cg("firebase-installations-database",1,{upgrade:(n,e)=>{0===e&&n.createObjectStore(od)}})),vL}function qw(n,e){return bL.apply(this,arguments)}function bL(){return(bL=O(function*(n,e){const t=mp(n),i=(yield EL()).transaction(od,"readwrite"),s=i.objectStore(od),o=yield s.get(t);return yield s.put(e,t),yield i.done,(!o||o.fid!==e.fid)&&IJ(n,e.fid),e})).apply(this,arguments)}function TL(n){return wL.apply(this,arguments)}function wL(){return(wL=O(function*(n){const e=mp(n),r=(yield EL()).transaction(od,"readwrite");yield r.objectStore(od).delete(e),yield r.done})).apply(this,arguments)}function ty(n,e){return IL.apply(this,arguments)}function IL(){return(IL=O(function*(n,e){const t=mp(n),i=(yield EL()).transaction(od,"readwrite"),s=i.objectStore(od),o=yield s.get(t),a=e(o);return void 0===a?yield s.delete(t):yield s.put(a,t),yield i.done,a&&(!o||o.fid!==a.fid)&&IJ(n,a.fid),a})).apply(this,arguments)}function SL(n){return xL.apply(this,arguments)}function xL(){return xL=O(function*(n){let e;const t=yield ty(n.appConfig,r=>{const i=function Zke(n){return CJ(n||{fid:jke(),registrationStatus:0})}(r),s=function Qke(n,e){if(0===e.registrationStatus){if(!navigator.onLine)return{installationEntry:e,registrationPromise:Promise.reject(Ua.create("app-offline"))};const t={fid:e.fid,registrationStatus:1,registrationTime:Date.now()},r=function eLe(n,e){return AL.apply(this,arguments)}(n,t);return{installationEntry:t,registrationPromise:r}}return 1===e.registrationStatus?{installationEntry:e,registrationPromise:tLe(n)}:{installationEntry:e}}(n,i);return e=s.registrationPromise,s.installationEntry});return""===t.fid?{installationEntry:yield e}:{installationEntry:t,registrationPromise:e}}),xL.apply(this,arguments)}function AL(){return AL=O(function*(n,e){try{const t=yield function zke(n,e){return _L.apply(this,arguments)}(n,e);return qw(n.appConfig,t)}catch(t){throw vJ(t)&&409===t.customData.serverCode?yield TL(n.appConfig):yield qw(n.appConfig,{fid:e.fid,registrationStatus:0}),t}}),AL.apply(this,arguments)}function tLe(n){return ML.apply(this,arguments)}function ML(){return(ML=O(function*(n){let e=yield MJ(n.appConfig);for(;1===e.registrationStatus;)yield wJ(100),e=yield MJ(n.appConfig);if(0===e.registrationStatus){const{installationEntry:t,registrationPromise:r}=yield SL(n);return r||t}return e})).apply(this,arguments)}function MJ(n){return ty(n,e=>{if(!e)throw Ua.create("installation-not-found");return CJ(e)})}function CJ(n){return function nLe(n){return 1===n.registrationStatus&&n.registrationTime+1e4<Date.now()}(n)?{fid:n.fid,registrationStatus:0}:n}function CL(){return(CL=O(function*({appConfig:n,heartbeatServiceProvider:e},t){const r=function iLe(n,{fid:e}){return`${hL(n)}/${e}/authTokens:generate`}(n,t),i=function TJ(n,{refreshToken:e}){const t=bJ(n);return t.append("Authorization",function Hke(n){return`FIS_v2 ${n}`}(e)),t}(n,t),s=e.getImmediate({optional:!0});if(s){const l=yield s.getHeartbeatsHeader();l&&i.append("x-firebase-client",l)}const a={method:"POST",headers:i,body:JSON.stringify({installation:{sdkVersion:_J,appId:n.appId}})},c=yield mL(()=>fetch(r,a));if(c.ok)return EJ(yield c.json());throw yield fL("Generate Auth Token",c)})).apply(this,arguments)}function DL(n){return RL.apply(this,arguments)}function RL(){return RL=O(function*(n,e=!1){let t;const r=yield ty(n.appConfig,s=>{if(!RJ(s))throw Ua.create("not-registered");const o=s.authToken;if(!e&&function aLe(n){return 2===n.requestStatus&&!function cLe(n){const e=Date.now();return e<n.creationTime||n.creationTime+n.expiresIn<e+36e5}(n)}(o))return s;if(1===o.requestStatus)return t=function sLe(n,e){return PL.apply(this,arguments)}(n,e),s;{if(!navigator.onLine)throw Ua.create("app-offline");const a=function lLe(n){return{...n,authToken:{requestStatus:1,requestTime:Date.now()}}}(s);return t=function oLe(n,e){return NL.apply(this,arguments)}(n,a),a}});return t?yield t:r.authToken}),RL.apply(this,arguments)}function PL(){return(PL=O(function*(n,e){let t=yield DJ(n.appConfig);for(;1===t.authToken.requestStatus;)yield wJ(100),t=yield DJ(n.appConfig);const r=t.authToken;return 0===r.requestStatus?DL(n,e):r})).apply(this,arguments)}function DJ(n){return ty(n,e=>{if(!RJ(e))throw Ua.create("not-registered");return function uLe(n){return 1===n.requestStatus&&n.requestTime+1e4<Date.now()}(e.authToken)?{...e,authToken:{requestStatus:0}}:e})}function NL(){return NL=O(function*(n,e){try{const t=yield function rLe(n,e){return CL.apply(this,arguments)}(n,e),r={...e,authToken:t};return yield qw(n.appConfig,r),t}catch(t){if(!vJ(t)||401!==t.customData.serverCode&&404!==t.customData.serverCode){const r={...e,authToken:{requestStatus:0}};yield qw(n.appConfig,r)}else yield TL(n.appConfig);throw t}}),NL.apply(this,arguments)}function RJ(n){return void 0!==n&&2===n.registrationStatus}function OL(){return(OL=O(function*(n){const e=n,{installationEntry:t,registrationPromise:r}=yield SL(e);return r?r.catch(console.error):DL(e).catch(console.error),t.fid})).apply(this,arguments)}function kL(){return kL=O(function*(n,e=!1){const t=n;return yield function fLe(n){return LL.apply(this,arguments)}(t),(yield DL(t,e)).token}),kL.apply(this,arguments)}function LL(){return(LL=O(function*(n){const{registrationPromise:e}=yield SL(n);e&&(yield e)})).apply(this,arguments)}function UL(n){return Ua.create("missing-app-config-values",{valueName:n})}const PJ="installations",yLe=n=>{const e=n.getProvider("app").getImmediate(),t=function gLe(n){if(!n||!n.options)throw UL("App Configuration");if(!n.name)throw UL("App Name");const e=["projectId","apiKey","appId"];for(const t of e)if(!n.options[t])throw UL(t);return{appName:n.name,projectId:n.options.projectId,apiKey:n.options.apiKey,appId:n.options.appId}}(e);return{app:e,appConfig:t,heartbeatServiceProvider:$w(e,"heartbeat"),_delete:()=>Promise.resolve()}},vLe=n=>{const t=$w(n.getProvider("app").getImmediate(),PJ).getImmediate();return{getId:()=>function dLe(n){return OL.apply(this,arguments)}(t),getToken:i=>function hLe(n){return kL.apply(this,arguments)}(t,i)}};(function ELe(){id(new rl(PJ,yLe,"PUBLIC")),id(new rl("installations-internal",vLe,"PRIVATE"))})(),il(mJ,dL),il(mJ,dL,"esm2020");const NJ="BDOU99-h67HcA6JeFXHbSNMu7e2yNNu3RzoMj8TM4W88jITfq7ZmPvIM1Iv-4_l2LxQcYwhqby2xGpWwzjfAnG4",OJ="google.c.a.c_id";var Xw=function(n){return n.PUSH_RECEIVED="push-received",n.NOTIFICATION_CLICKED="notification-clicked",n}(Xw||{});function Ba(n){const e=new Uint8Array(n);return btoa(String.fromCharCode(...e)).replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_")}function MLe(n){const t=(n+"=".repeat((4-n.length%4)%4)).replace(/\-/g,"+").replace(/_/g,"/"),r=atob(t),i=new Uint8Array(r.length);for(let s=0;s<r.length;++s)i[s]=r.charCodeAt(s);return i}const BL="fcm_token_details_db",LJ="fcm_token_object_Store";function HL(){return HL=O(function*(n){if("databases"in indexedDB&&!(yield indexedDB.databases()).map(s=>s.name).includes(BL))return null;let e=null;return(yield cg(BL,5,{upgrade:(r=O(function*(i,s,o,a){if(s<2||!i.objectStoreNames.contains(LJ))return;const c=a.objectStore(LJ),l=yield c.index("fcmSenderId").get(n);if(yield c.clear(),l)if(2===s){const u=l;if(!u.auth||!u.p256dh||!u.endpoint)return;e={token:u.fcmToken,createTime:u.createTime??Date.now(),subscriptionOptions:{auth:u.auth,p256dh:u.p256dh,endpoint:u.endpoint,swScope:u.swScope,vapidKey:"string"==typeof u.vapidKey?u.vapidKey:Ba(u.vapidKey)}}}else if(3===s){const u=l;e={token:u.fcmToken,createTime:u.createTime,subscriptionOptions:{auth:Ba(u.auth),p256dh:Ba(u.p256dh),endpoint:u.endpoint,swScope:u.swScope,vapidKey:Ba(u.vapidKey)}}}else if(4===s){const u=l;e={token:u.fcmToken,createTime:u.createTime,subscriptionOptions:{auth:Ba(u.auth),p256dh:Ba(u.p256dh),endpoint:u.endpoint,swScope:u.swScope,vapidKey:Ba(u.vapidKey)}}}}),function(s,o,a,c){return r.apply(this,arguments)})})).close(),yield xC(BL),yield xC("fcm_vapid_details_db"),yield xC("undefined"),function RLe(n){if(!n||!n.subscriptionOptions)return!1;const{subscriptionOptions:e}=n;return"number"==typeof n.createTime&&n.createTime>0&&"string"==typeof n.token&&n.token.length>0&&"string"==typeof e.auth&&e.auth.length>0&&"string"==typeof e.p256dh&&e.p256dh.length>0&&"string"==typeof e.endpoint&&e.endpoint.length>0&&"string"==typeof e.swScope&&e.swScope.length>0&&"string"==typeof e.vapidKey&&e.vapidKey.length>0}(e)?e:null;var r}),HL.apply(this,arguments)}const ad="firebase-messaging-store";let zL=null;function GL(){return zL||(zL=cg("firebase-messaging-database",1,{upgrade:(n,e)=>{0===e&&n.createObjectStore(ad)}})),zL}function WL(){return WL=O(function*(n){const e=XL(n),r=yield(yield GL()).transaction(ad).objectStore(ad).get(e);if(r)return r;{const i=yield function DLe(n){return HL.apply(this,arguments)}(n.appConfig.senderId);if(i)return yield jL(n,i),i}}),WL.apply(this,arguments)}function jL(n,e){return $L.apply(this,arguments)}function $L(){return($L=O(function*(n,e){const t=XL(n),i=(yield GL()).transaction(ad,"readwrite");return yield i.objectStore(ad).put(e,t),yield i.done,e})).apply(this,arguments)}function XL({appConfig:n}){return n.appId}const ri=new zw("messaging","Messaging",{"missing-app-config-values":'Missing App configuration value: "{$valueName}"',"only-available-in-window":"This method is available in a Window context.","only-available-in-sw":"This method is available in a service worker context.","permission-default":"The notification permission was not granted and dismissed instead.","permission-blocked":"The notification permission was not granted and blocked instead.","unsupported-browser":"This browser doesn't support the API's required to use the Firebase SDK.","indexed-db-unsupported":"This browser doesn't support indexedDb.open() (ex. Safari iFrame, Firefox Private Browsing, etc)","failed-service-worker-registration":"We are unable to register the default service worker. {$browserErrorMessage}","token-subscribe-failed":"A problem occurred while subscribing the user to FCM: {$errorInfo}","token-subscribe-no-token":"FCM returned no token when subscribing the user to push.","token-unsubscribe-failed":"A problem occurred while unsubscribing the user from FCM: {$errorInfo}","token-update-failed":"A problem occurred while updating the user from FCM: {$errorInfo}","token-update-no-token":"FCM returned no token when updating the user to push.","use-sw-after-get-token":"The useServiceWorker() method may only be called once and must be called before calling getToken() to ensure your service worker is used.","invalid-sw-registration":"The input to useServiceWorker() must be a ServiceWorkerRegistration.","invalid-bg-handler":"The input to setBackgroundMessageHandler() must be a function.","invalid-vapid-key":"The public VAPID key must be a string.","use-vapid-key-after-get-token":"The usePublicVapidKey() method may only be called once and must be called before calling getToken() to ensure your VAPID key is used."});function LLe(n,e){return KL.apply(this,arguments)}function KL(){return(KL=O(function*(n,e){const t=yield QL(n),r=UJ(e),i={method:"POST",headers:t,body:JSON.stringify(r)};let s;try{s=yield(yield fetch(ZL(n.appConfig),i)).json()}catch(o){throw ri.create("token-subscribe-failed",{errorInfo:o?.toString()})}if(s.error)throw ri.create("token-subscribe-failed",{errorInfo:s.error.message});if(!s.token)throw ri.create("token-subscribe-no-token");return s.token})).apply(this,arguments)}function YL(){return(YL=O(function*(n,e){const t=yield QL(n),r=UJ(e.subscriptionOptions),i={method:"PATCH",headers:t,body:JSON.stringify(r)};let s;try{s=yield(yield fetch(`${ZL(n.appConfig)}/${e.token}`,i)).json()}catch(o){throw ri.create("token-update-failed",{errorInfo:o?.toString()})}if(s.error)throw ri.create("token-update-failed",{errorInfo:s.error.message});if(!s.token)throw ri.create("token-update-no-token");return s.token})).apply(this,arguments)}function JL(){return(JL=O(function*(n,e){const r={method:"DELETE",headers:yield QL(n)};try{const s=yield(yield fetch(`${ZL(n.appConfig)}/${e}`,r)).json();if(s.error)throw ri.create("token-unsubscribe-failed",{errorInfo:s.error.message})}catch(i){throw ri.create("token-unsubscribe-failed",{errorInfo:i?.toString()})}})).apply(this,arguments)}function ZL({projectId:n}){return`https://fcmregistrations.googleapis.com/v1/projects/${n}/registrations`}function QL(n){return eF.apply(this,arguments)}function eF(){return(eF=O(function*({appConfig:n,installations:e}){const t=yield e.getToken();return new Headers({"Content-Type":"application/json",Accept:"application/json","x-goog-api-key":n.apiKey,"x-goog-firebase-installations-auth":`FIS ${t}`})})).apply(this,arguments)}function UJ({p256dh:n,auth:e,endpoint:t,vapidKey:r}){const i={web:{endpoint:t,auth:e,p256dh:n}};return r!==NJ&&(i.web.applicationPubKey=r),i}function tF(){return tF=O(function*(n){const e=yield function zLe(n,e){return sF.apply(this,arguments)}(n.swRegistration,n.vapidKey),t={vapidKey:n.vapidKey,swScope:n.swRegistration.scope,endpoint:e.endpoint,auth:Ba(e.getKey("auth")),p256dh:Ba(e.getKey("p256dh"))},r=yield function FJ(n){return WL.apply(this,arguments)}(n.firebaseDependencies);if(r){if(function GLe(n,e){return e.vapidKey===n.vapidKey&&e.endpoint===n.endpoint&&e.auth===n.auth&&e.p256dh===n.p256dh}(r.subscriptionOptions,t))return Date.now()>=r.createTime+6048e5?function HLe(n,e){return rF.apply(this,arguments)}(n,{token:r.token,createTime:Date.now(),subscriptionOptions:t}):r.token;try{yield function VJ(n,e){return JL.apply(this,arguments)}(n.firebaseDependencies,r.token)}catch(i){console.warn(i)}return BJ(n.firebaseDependencies,t)}return BJ(n.firebaseDependencies,t)}),tF.apply(this,arguments)}function rF(){return rF=O(function*(n,e){try{const t=yield function FLe(n,e){return YL.apply(this,arguments)}(n.firebaseDependencies,e),r={...e,token:t,createTime:Date.now()};return yield jL(n.firebaseDependencies,r),t}catch(t){throw t}}),rF.apply(this,arguments)}function BJ(n,e){return iF.apply(this,arguments)}function iF(){return(iF=O(function*(n,e){const r={token:yield LLe(n,e),createTime:Date.now(),subscriptionOptions:e};return yield jL(n,r),r.token})).apply(this,arguments)}function sF(){return(sF=O(function*(n,e){return(yield n.pushManager.getSubscription())||n.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:MLe(e)})})).apply(this,arguments)}function HJ(n){const e={from:n.from,collapseKey:n.collapse_key,messageId:n.fcmMessageId};return function WLe(n,e){if(!e.notification)return;n.notification={};const t=e.notification.title;t&&(n.notification.title=t);const r=e.notification.body;r&&(n.notification.body=r);const i=e.notification.image;i&&(n.notification.image=i);const s=e.notification.icon;s&&(n.notification.icon=s)}(e,n),function jLe(n,e){e.data&&(n.data=e.data)}(e,n),function $Le(n,e){if(!e.fcmOptions&&!e.notification?.click_action)return;n.fcmOptions={};const t=e.fcmOptions?.link??e.notification?.click_action;t&&(n.fcmOptions.link=t);const r=e.fcmOptions?.analytics_label;r&&(n.fcmOptions.analyticsLabel=r)}(e,n),e}function oF(n){return ri.create("missing-app-config-values",{valueName:n})}!function XLe(n,e){const t=[];for(let r=0;r<n.length;r++)t.push(n.charAt(r)),r<e.length&&t.push(e.charAt(r));t.join("")}("AzSCbw63g1R0nCw85jG8","Iaya3yLKwmgvh7cF0q4");class YLe{constructor(e,t,r){this.deliveryMetricsExportedToBigQueryEnabled=!1,this.onBackgroundMessageHandler=null,this.onMessageHandler=null,this.logEvents=[],this.isLogServiceStarted=!1;const i=function KLe(n){if(!n||!n.options)throw oF("App Configuration Object");if(!n.name)throw oF("App Name");const e=["projectId","apiKey","appId","messagingSenderId"],{options:t}=n;for(const r of e)if(!t[r])throw oF(r);return{appName:n.name,projectId:t.projectId,apiKey:t.apiKey,appId:t.appId,senderId:t.messagingSenderId}}(e);this.firebaseDependencies={app:e,appConfig:i,installations:t,analyticsProvider:r}}_delete(){return Promise.resolve()}}function aF(){return aF=O(function*(n){try{n.swRegistration=yield navigator.serviceWorker.register("/firebase-messaging-sw.js",{scope:"/firebase-cloud-messaging-push-scope"}),n.swRegistration.update().catch(()=>{}),yield function JLe(n){return cF.apply(this,arguments)}(n.swRegistration)}catch(e){throw ri.create("failed-service-worker-registration",{browserErrorMessage:e?.message})}}),aF.apply(this,arguments)}function cF(){return(cF=O(function*(n){return new Promise((e,t)=>{const r=setTimeout(()=>t(new Error("Service worker not registered after 10000 ms")),1e4),i=n.installing||n.waiting;n.active?(clearTimeout(r),e()):i?i.onstatechange=s=>{"activated"===s.target?.state&&(i.onstatechange=null,clearTimeout(r),e())}:(clearTimeout(r),t(new Error("No incoming service worker found.")))})})).apply(this,arguments)}function lF(){return(lF=O(function*(n,e){if(!e&&!n.swRegistration&&(yield function zJ(n){return aF.apply(this,arguments)}(n)),e||!n.swRegistration){if(!(e instanceof ServiceWorkerRegistration))throw ri.create("invalid-sw-registration");n.swRegistration=e}})).apply(this,arguments)}function uF(){return(uF=O(function*(n,e){e?n.vapidKey=e:n.vapidKey||(n.vapidKey=NJ)})).apply(this,arguments)}function GJ(n,e){return dF.apply(this,arguments)}function dF(){return dF=O(function*(n,e){if(!navigator)throw ri.create("only-available-in-window");if("default"===Notification.permission&&(yield Notification.requestPermission()),"granted"!==Notification.permission)throw ri.create("permission-blocked");return yield function QLe(n,e){return uF.apply(this,arguments)}(n,e?.vapidKey),yield function ZLe(n,e){return lF.apply(this,arguments)}(n,e?.serviceWorkerRegistration),function ULe(n){return tF.apply(this,arguments)}(n)}),dF.apply(this,arguments)}function hF(){return(hF=O(function*(n,e,t){const r=function tFe(n){switch(n){case Xw.NOTIFICATION_CLICKED:return"notification_open";case Xw.PUSH_RECEIVED:return"notification_foreground";default:throw new Error}}(e);(yield n.firebaseDependencies.analyticsProvider.get()).logEvent(r,{message_id:t[OJ],message_name:t["google.c.a.c_l"],message_time:t["google.c.a.ts"],message_device_time:Math.floor(Date.now()/1e3)})})).apply(this,arguments)}function fF(){return fF=O(function*(n,e){const t=e.data;if(!t.isFirebaseMessaging)return;n.onMessageHandler&&t.messageType===Xw.PUSH_RECEIVED&&("function"==typeof n.onMessageHandler?n.onMessageHandler(HJ(t)):n.onMessageHandler.next(HJ(t)));const r=t.data;(function qLe(n){return"object"==typeof n&&!!n&&OJ in n})(r)&&"1"===r["google.c.a.e"]&&(yield function eFe(n,e,t){return hF.apply(this,arguments)}(n,t.messageType,r))}),fF.apply(this,arguments)}const WJ="@firebase/messaging",jJ="0.12.23",rFe=n=>{const e=new YLe(n.getProvider("app").getImmediate(),n.getProvider("installations-internal").getImmediate(),n.getProvider("analytics-internal"));return navigator.serviceWorker.addEventListener("message",t=>function nFe(n,e){return fF.apply(this,arguments)}(e,t)),e},iFe=n=>{const e=n.getProvider("messaging").getImmediate();return{getToken:r=>GJ(e,r)}};function pF(){return(pF=O(function*(){try{yield nJ()}catch{return!1}return typeof window<"u"&&tJ()&&function SOe(){return!(typeof navigator>"u"||!navigator.cookieEnabled)}()&&"serviceWorker"in navigator&&"PushManager"in window&&"Notification"in window&&"fetch"in window&&ServiceWorkerRegistration.prototype.hasOwnProperty("showNotification")&&PushSubscription.prototype.hasOwnProperty("getKey")})).apply(this,arguments)}function $J(n=function wke(n=jw){const e=rd.get(n);if(!e&&n===jw&&JY())return function Tke(n,e={}){let t=n;"object"!=typeof e&&(e={name:e});const r={name:jw,automaticDataCollectionEnabled:!0,...e},i=r.name;if("string"!=typeof i||!i)throw Es.create("bad-app-name",{appName:String(i)});if(t||(t=JY()),!t)throw Es.create("no-options");const s=rd.get(i);if(s){if(tL(t,s.options)&&tL(r,s.config))return s;throw Es.create("duplicate-app",{appName:i})}const o=new UOe(i);for(const c of Q_.values())o.addComponent(c);const a=new cJ(t,r,o);return rd.set(i,a),a}();if(!e)throw Es.create("no-app",{appName:n});return e}()){return function oFe(){return pF.apply(this,arguments)}().then(e=>{if(!e)throw ri.create("unsupported-browser")},e=>{throw ri.create("indexed-db-unsupported")}),$w(iL(n),"messaging").getImmediate()}function gF(){return(gF=O(function*(n,e){return GJ(n=iL(n),e)})).apply(this,arguments)}!function sFe(){id(new rl("messaging",rFe,"PUBLIC")),id(new rl("messaging-internal",iFe,"PRIVATE")),il(WJ,jJ),il(WJ,jJ,"esm2020")}();let dFe=(()=>{var n;class e{constructor(){this.firestore=Ie(Tf),this.auth=Ie(Dh)}requestPermission(){(function lFe(n,e){return gF.apply(this,arguments)})($J(),{vapidKey:"YOUR_VAPID_KEY"}).then(i=>{i?this.saveToken(i):console.log("No registration token available. Request permission to generate one.")}).catch(i=>{console.log("An error occurred while retrieving token. ",i)})}saveToken(r){const i=this.auth.currentUser;if(i){const s=w_(this.firestore,`fcm_tokens/${i.uid}`);oO(s,{token:r},{merge:!0})}}listenForMessages(){!function uFe(n,e){return function cFe(n,e){if(!navigator)throw ri.create("only-available-in-window");return n.onMessageHandler=e,()=>{n.onMessageHandler=null}}(n=iL(n),e)}($J(),i=>{console.log("Message received. ",i)})}static#e=n=()=>(this.\u0275fac=function(i){return new(i||e)},this.\u0275prov=Et({token:e,factory:e.\u0275fac,providedIn:"root"}))}return n(),e})();function hFe(n,e){if(1&n){const t=$i();ac(0),Fe(1,"div",9)(2,"button",10),Gt("click",function(){An(t);const i=Wt();return Mn(i.isArViewVisible=!i.isArViewVisible)}),tt(3),Ve(),Fe(4,"span"),tt(5),Ve(),Fe(6,"button",10),Gt("click",function(){return An(t),Mn(Wt().logout())}),tt(7,"Logout"),Ve()(),ta()}if(2&n){const t=e.ngIf,r=Wt();Je(3),jl(" ",r.isArViewVisible?"Exit AR Mode":"Enter AR Mode"," "),Je(2),jl("Welcome, ",t.displayName,"!")}}function fFe(n,e){if(1&n){const t=$i();Fe(0,"button",10),Gt("click",function(){return An(t),Mn(Wt().login())}),tt(1,"Login with Google"),Ve()}}function pFe(n,e){if(1&n){const t=$i();Fe(0,"button",19),Rr(1,"async"),Gt("click",function(){return An(t),Mn(Wt(2).toggleMemoryForm())}),Fe(2,"span",20),tt(3,"\u{1f331}"),Ve(),Fe(4,"span",21),tt(5,"Plant a Memory"),Ve()()}2&n&&mt("disabled",Zr(1,1,Wt(2).isLoading$))}function mFe(n,e){if(1&n){const t=$i();Fe(0,"div",22)(1,"div",23)(2,"h3"),tt(3,"\u{1f331} Plant a New Memory"),Ve(),Fe(4,"button",24),Gt("click",function(){return An(t),Mn(Wt(2).showMemoryForm=!1)}),tt(5,"\u2715"),Ve()(),Fe(6,"app-memory-create",25),Rr(7,"async"),Rr(8,"async"),Gt("memorySubmit",function(i){return An(t),Mn(Wt(2).onMemorySubmit(i))}),Ve()()}if(2&n){const t=Wt(2);Je(6),mt("isLoading",!!Zr(7,2,t.isLoading$))("error",Zr(8,4,t.memoryError$))}}function gFe(n,e){1&n&&(Fe(0,"div",26)(1,"p"),tt(2,"Planting your memory... the AI is hard at work!"),Ve(),Ms(3,"div",27),Ve())}function _Fe(n,e){1&n&&(ac(0),tt(1," Ask for Insight "),ta())}function yFe(n,e){1&n&&(Ms(0,"div",28),tt(1," Reflecting... "))}function vFe(n,e){1&n&&(ac(0),tt(1," Get Weekly Summary "),ta())}function EFe(n,e){1&n&&(Ms(0,"div",28),tt(1," Summarizing... "))}function bFe(n,e){1&n&&(ac(0),tt(1," Export Garden as Poster "),ta())}function TFe(n,e){1&n&&(Ms(0,"div",28),tt(1," Exporting... "))}function wFe(n,e){if(1&n){const t=$i();Fe(0,"main"),un(1,pFe,6,3,"button",11)(2,mFe,9,6,"div",12),Fe(3,"div",13)(4,"h2"),tt(5,"Your Latest Creation"),Ve(),un(6,gFe,4,0,"div",14),Rr(7,"async"),Fe(8,"app-garden",15),Gt("memoryClicked",function(i){return An(t),Mn(Wt().onMemoryClicked(i))}),Ve()(),Fe(9,"div",16)(10,"button",17),Rr(11,"async"),Gt("click",function(){return An(t),Mn(Wt().requestInsight("insight"))}),un(12,_Fe,2,0,"ng-container",4),Rr(13,"async"),un(14,yFe,2,0,"ng-template",null,1,fh),Ve(),Fe(16,"button",17),Rr(17,"async"),Gt("click",function(){return An(t),Mn(Wt().requestInsight("weekly"))}),un(18,vFe,2,0,"ng-container",4),Rr(19,"async"),un(20,EFe,2,0,"ng-template",null,1,fh),Ve(),Fe(22,"button",17),Rr(23,"async"),Gt("click",function(){return An(t),Mn(Wt().onExportPoster())}),un(24,bFe,2,0,"ng-container",4),Rr(25,"async"),un(26,TFe,2,0,"ng-template",null,2,fh),Ve()(),Ms(28,"app-insight-display",18),Rr(29,"async"),Ve()}if(2&n){const t=Lm(15),r=Lm(27),i=Wt();Je(),mt("ngIf",!i.showMemoryForm),Je(),mt("ngIf",i.showMemoryForm),Je(4),mt("ngIf",Zr(7,13,i.isLoading$)),Je(4),mt("disabled",Zr(11,15,i.isInsightLoading$)),Je(2),mt("ngIf",!Zr(13,17,i.isInsightLoading$))("ngIfElse",t),Je(4),mt("disabled",Zr(17,19,i.isInsightLoading$)),Je(2),mt("ngIf",!Zr(19,21,i.isInsightLoading$))("ngIfElse",t),Je(4),mt("disabled",Zr(23,23,i.isExporting$)),Je(2),mt("ngIf",!Zr(25,25,i.isExporting$))("ngIfElse",r),Je(4),mt("insight",Zr(29,27,i.latestInsight$)||null)}}function IFe(n,e){1&n&&(Fe(0,"div",29)(1,"p"),tt(2,"Please log in to cultivate your memory garden."),Ve()())}function SFe(n,e){if(1&n){const t=$i();Fe(0,"app-memory-detail",30),Gt("close",function(){return An(t),Mn(Wt().onDetailClose())})("enterAr",function(i){return An(t),Mn(Wt().enterArModeForMemory(i))}),Ve()}2&n&&mt("memory",Wt().selectedMemoryForDetail)}function xFe(n,e){if(1&n){const t=$i();Fe(0,"div",31)(1,"button",32),Gt("click",function(){return An(t),Mn(Wt().exitArMode())}),tt(2,"Exit AR"),Ve(),Fe(3,"app-ar-view",33),Gt("memorySelected",function(i){return An(t),Mn(Wt().onArMemorySelected(i))}),Ve()()}}let qJ=(()=>{var n;class e{constructor(){this.auth=Ie(Dh),this.apiService=Ie(Fw),this.arStateService=Ie($Y),this.firestore=Ie(Tf),this.notificationService=Ie(dFe),this.user=i8(this.auth),this.selectedMemoryForDetail=null,this.isLoading$=new ao(!1),this.isInsightLoading$=new ao(!1),this.isExporting$=new ao(!1),this.isArViewVisible=!1,this.insightError$=new ao(null),this.memoryError$=new ao(null),this.showMemoryForm=!1,this.memories$=this.apiService.getMemories(),this.latestInsight$=_o(void 0)}ngOnInit(){this.fetchLatestInsight()}login(){gTe(this.auth,new I0e).then(r=>{this.notificationService.requestPermission(),this.notificationService.listenForMessages();const i=w_(this.firestore,`users/${r.user.uid}`);oO(i,{lastActive:Date.now()},{merge:!0})})}logout(){_Te(this.auth)}toggleMemoryForm(){this.showMemoryForm=!this.showMemoryForm}onMemorySubmit(r){this.isLoading$.next(!0),this.memoryError$.next(null),this.apiService.createMemory(r).subscribe({next:i=>{this.isLoading$.next(!1),this.showMemoryForm=!1;const s=this.auth.currentUser;if(s){const o=w_(this.firestore,`users/${s.uid}`);oO(o,{lastActive:i.timestamp},{merge:!0})}},error:i=>{console.error("Memory creation failed:",i),this.isLoading$.next(!1),this.memoryError$.next("Failed to create memory. Please try again later.")}})}fetchLatestInsight(){this.isInsightLoading$.next(!0),this.insightError$.next(null),this.latestInsight$=this.apiService.getLatestInsight().pipe(mO(r=>(console.error("Error fetching latest insight:",r),this.insightError$.next("Could not load the latest insight."),_o(null))),O7(()=>this.isInsightLoading$.next(!1)))}requestInsight(r="insight"){this.isInsightLoading$.next(!0),this.insightError$.next(null),this.latestInsight$=_o(void 0),this.apiService.requestInsight(r).pipe(mO(i=>(console.error("Error requesting new insight:",i),this.insightError$.next("Failed to generate a new insight. There may be no memories to analyze yet."),_o(null))),qs(()=>this.apiService.getLatestInsight()),O7(()=>this.isInsightLoading$.next(!1))).subscribe(i=>{this.latestInsight$=_o(i)})}onExportPoster(){this.gardenComponent?this.gardenComponent.exportAsPoster():console.error("Garden component not available to export.")}onMemoryClicked(r){this.selectedMemoryForDetail=r}onDetailClose(){this.selectedMemoryForDetail=null}enterArModeForMemory(r){this.arStateService.setSelectedMemory(r),this.isArViewVisible=!0,this.onDetailClose()}exitArMode(){this.arStateService.setSelectedMemory(null),this.isArViewVisible=!1}onArMemorySelected(r){this.selectedMemoryForDetail=r}static#e=n=()=>(this.\u0275fac=function(i){return new(i||e)},this.\u0275cmp=Ll({type:e,selectors:[["app-root"]],viewQuery:function(i,s){if(1&i&&sE(Zk,5),2&i){let o;oE(o=aE())&&(s.gardenComponent=o.first)}},decls:14,vars:12,consts:[["showLogin",""],["insightLoading",""],["exporting",""],[1,"container"],[4,"ngIf","ngIfElse"],[4,"ngIf"],["class","login-prompt",4,"ngIf"],[3,"memory","close","enterAr",4,"ngIf"],["class","ar-view-container",4,"ngIf"],[1,"user-info"],[3,"click"],["class","floating-action-button",3,"disabled","click",4,"ngIf"],["class","floating-memory-form",4,"ngIf"],[1,"garden-display"],["class","loading-spinner",4,"ngIf"],[3,"memoryClicked"],[1,"gardener-actions"],[3,"click","disabled"],[3,"insight"],[1,"floating-action-button",3,"click","disabled"],[1,"fab-icon"],[1,"fab-text"],[1,"floating-memory-form"],[1,"form-header"],[1,"close-form-button",3,"click"],[3,"memorySubmit","isLoading","error"],[1,"loading-spinner"],[1,"spinner"],[1,"spinner-small"],[1,"login-prompt"],[3,"close","enterAr","memory"],[1,"ar-view-container"],[1,"close-ar-button",3,"click"],[3,"memorySelected"]],template:function(i,s){if(1&i&&(Fe(0,"div",3)(1,"header")(2,"h1"),tt(3,"\u{1f331} Cziczere: The Digital Memory Garden"),Ve(),un(4,hFe,8,2,"ng-container",4),Rr(5,"async"),un(6,fFe,2,0,"ng-template",null,0,fh),Ve(),un(8,wFe,30,29,"main",5),Rr(9,"async"),un(10,IFe,3,0,"div",6),Rr(11,"async"),Ve(),un(12,SFe,1,1,"app-memory-detail",7)(13,xFe,4,0,"div",8)),2&i){const o=Lm(7);Je(4),mt("ngIf",Zr(5,6,s.user))("ngIfElse",o),Je(4),mt("ngIf",Zr(9,8,s.user)),Je(2),mt("ngIf",!Zr(11,10,s.user)),Je(2),mt("ngIf",s.selectedMemoryForDetail),Je(),mt("ngIf",s.isArViewVisible)}},dependencies:[ql,qm,Zk,WY,jY,oOe,qY,yM],styles:['.floating-action-button[_ngcontent-%COMP%]{position:fixed;bottom:30px;right:30px;width:70px;height:70px;border-radius:50%;background:linear-gradient(135deg,#4caf50,#45a049);border:none;box-shadow:0 4px 20px #4caf5066;cursor:pointer;display:flex;flex-direction:column;align-items:center;justify-content:center;color:#fff;font-size:12px;font-weight:700;transition:all .3s ease;z-index:1000}.floating-action-button[_ngcontent-%COMP%]:hover:not(:disabled){transform:scale(1.1);box-shadow:0 6px 25px #4caf5099}.floating-action-button[_ngcontent-%COMP%]:disabled{opacity:.6;cursor:not-allowed;transform:none}.fab-icon[_ngcontent-%COMP%]{font-size:24px;line-height:1}.fab-text[_ngcontent-%COMP%]{font-size:9px;margin-top:2px;text-align:center}.floating-memory-form[_ngcontent-%COMP%]{position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);background:#fffffff2;-webkit-backdrop-filter:blur(10px);backdrop-filter:blur(10px);border-radius:20px;padding:20px;box-shadow:0 8px 32px #0003;z-index:1001;min-width:400px;max-width:90vw;max-height:90vh;overflow-y:auto;border:1px solid rgba(255,255,255,.2)}.form-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:20px;padding-bottom:10px;border-bottom:1px solid rgba(0,0,0,.1)}.form-header[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:0;color:#4caf50;font-size:18px}.close-form-button[_ngcontent-%COMP%]{background:none;border:none;font-size:18px;cursor:pointer;color:#666;padding:5px;border-radius:50%;width:30px;height:30px;display:flex;align-items:center;justify-content:center;transition:background-color .2s}.close-form-button[_ngcontent-%COMP%]:hover{background-color:#0000001a}.creative-assistant[_ngcontent-%COMP%]{background:#f8f9faf2;border:1px solid #e3f2fd;border-radius:12px;padding:16px;margin-top:16px;box-shadow:0 2px 8px #0000001a}.assistant-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:12px}.assistant-header[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:0;color:#6a4c93;font-size:16px}.assistant-content[_ngcontent-%COMP%]   .loading[_ngcontent-%COMP%]{color:#666;font-style:italic;text-align:center;padding:20px}.suggestion[_ngcontent-%COMP%]{background:#fff;padding:16px;border-radius:8px;border-left:4px solid #6a4c93}.suggestion[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:0 0 12px;color:#333;line-height:1.5}.use-suggestion-button[_ngcontent-%COMP%], .refresh-button[_ngcontent-%COMP%]{padding:8px 16px;margin:4px 8px 4px 0;border:none;border-radius:6px;cursor:pointer;font-size:14px;transition:all .2s}.use-suggestion-button[_ngcontent-%COMP%]{background:#6a4c93;color:#fff}.use-suggestion-button[_ngcontent-%COMP%]:hover{background:#5a3c83}.refresh-button[_ngcontent-%COMP%]{background:#f0f0f0;color:#666}.refresh-button[_ngcontent-%COMP%]:hover{background:#e0e0e0}.assistant-button[_ngcontent-%COMP%]{background:linear-gradient(135deg,#6a4c93,#5a3c83);color:#fff;border:none;padding:10px 16px;border-radius:8px;cursor:pointer;font-size:14px;margin-right:10px;transition:all .2s}.assistant-button[_ngcontent-%COMP%]:hover:not(:disabled){transform:translateY(-1px);box-shadow:0 4px 12px #6a4c934d}.form-actions[_ngcontent-%COMP%]{display:flex;gap:10px;justify-content:flex-end;margin-top:16px}.submit-button[_ngcontent-%COMP%]{background:linear-gradient(135deg,#4caf50,#45a049);color:#fff;border:none;padding:12px 24px;border-radius:8px;cursor:pointer;font-size:14px;font-weight:700;transition:all .2s}.submit-button[_ngcontent-%COMP%]:hover:not(:disabled){transform:translateY(-1px);box-shadow:0 4px 12px #4caf504d}.submit-button[_ngcontent-%COMP%]:disabled{opacity:.6;cursor:not-allowed;transform:none}.poetic-button[_ngcontent-%COMP%]{background:linear-gradient(135deg,#9c27b0,#673ab7);color:#fff;border:none;padding:10px 16px;border-radius:8px;cursor:pointer;font-size:14px;margin-right:10px;transition:all .2s}.poetic-button[_ngcontent-%COMP%]:hover:not(:disabled){transform:translateY(-1px);box-shadow:0 4px 12px #9c27b04d}.poetic-button[_ngcontent-%COMP%]:disabled{opacity:.6;cursor:not-allowed;transform:none}.poetic-panel[_ngcontent-%COMP%]{background:#f5f0fff2;border:1px solid rgba(156,39,176,.2);border-radius:12px;padding:16px;margin-top:16px;box-shadow:0 4px 16px #9c27b01a}.panel-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:16px;padding-bottom:8px;border-bottom:1px solid rgba(156,39,176,.2)}.panel-header[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:0;color:#9c27b0;font-size:16px}.poetic-content[_ngcontent-%COMP%]   .poetic-version[_ngcontent-%COMP%]{background:#fff;padding:16px;border-radius:8px;border-left:4px solid #9c27b0;margin-bottom:12px}.poetic-text[_ngcontent-%COMP%]{font-size:16px;line-height:1.6;color:#333;margin:0 0 8px;font-style:italic}.suggestion-text[_ngcontent-%COMP%]{color:#666;font-size:12px;display:block}.poetic-actions[_ngcontent-%COMP%]{display:flex;gap:10px;justify-content:flex-end}.use-poetic-button[_ngcontent-%COMP%], .regenerate-button[_ngcontent-%COMP%]{padding:8px 16px;border:none;border-radius:6px;cursor:pointer;font-size:14px;transition:all .2s}.use-poetic-button[_ngcontent-%COMP%]{background:#9c27b0;color:#fff}.use-poetic-button[_ngcontent-%COMP%]:hover{background:#7b1fa2}.regenerate-button[_ngcontent-%COMP%]{background:#f0f0f0;color:#666}.regenerate-button[_ngcontent-%COMP%]:hover:not(:disabled){background:#e0e0e0}.regenerate-button[_ngcontent-%COMP%]:disabled{opacity:.6;cursor:not-allowed}[_nghost-%COMP%]{font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica,Arial,sans-serif,"Apple Color Emoji","Segoe UI Emoji",Segoe UI Symbol;font-size:14px;color:#333;box-sizing:border-box;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}.container[_ngcontent-%COMP%]{max-width:960px;margin:0 auto;padding:2rem;text-align:center}header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;padding-bottom:1rem;border-bottom:1px solid #ccc;margin-bottom:2rem}header[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{font-size:1.5rem;margin:0}.user-info[_ngcontent-%COMP%]{display:flex;align-items:center;gap:1rem}button[_ngcontent-%COMP%]{background-color:#3f51b5;color:#fff;border:none;padding:.75rem 1.5rem;font-size:1rem;cursor:pointer;border-radius:4px;transition:background-color .3s}button[_ngcontent-%COMP%]:hover{background-color:#303f9f}.login-prompt[_ngcontent-%COMP%]{margin-top:4rem;font-size:1.2rem;color:#666}.memory-creator[_ngcontent-%COMP%], .garden-display[_ngcontent-%COMP%]{margin-top:2rem;padding:2rem;border:1px solid #e0e0e0;border-radius:8px;background-color:#fff;box-shadow:0 2px 4px #0000000d}.memory-creator.disabled[_ngcontent-%COMP%]{opacity:.5;pointer-events:none}.loading-spinner[_ngcontent-%COMP%]{padding:2rem;text-align:center}.spinner[_ngcontent-%COMP%]{border:4px solid #f3f3f3;border-top:4px solid #3f51b5;border-radius:50%;width:40px;height:40px;animation:_ngcontent-%COMP%_spin 1s linear infinite;margin:1rem auto}@keyframes _ngcontent-%COMP%_spin{0%{transform:rotate(0)}to{transform:rotate(360deg)}}.memory-result[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{max-width:100%;border-radius:8px;margin-bottom:1rem;border:1px solid #eee}.memory-result[_ngcontent-%COMP%]   .prompt-text[_ngcontent-%COMP%]{font-style:italic;color:#666}.gardener-actions[_ngcontent-%COMP%]{display:flex;justify-content:center;margin:2rem 0}.gardener-actions[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{background-color:#38761d;color:#fff;border:none;padding:.8rem 1.5rem;font-size:1rem;border-radius:25px;cursor:pointer;transition:all .3s ease;display:flex;align-items:center;gap:.5rem}.gardener-actions[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:hover:not(:disabled){background-color:#2a5715;transform:translateY(-2px);box-shadow:0 4px 8px #0000001a}.gardener-actions[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:disabled{background-color:#ccc;cursor:not-allowed}.spinner-small[_ngcontent-%COMP%]{border:3px solid #f3f3f3;border-top:3px solid #38761d;border-radius:50%;width:16px;height:16px;animation:_ngcontent-%COMP%_spin 1s linear infinite}.memory-result[_ngcontent-%COMP%]   .user-text[_ngcontent-%COMP%]{font-weight:700}']}))}return n(),e})(),AFe=(()=>{var n;class e{static#e=n=()=>(this.\u0275fac=function(i){return new(i||e)},this.\u0275mod=nc({type:e,bootstrap:[qJ]}),this.\u0275inj=Vo({providers:[xve(()=>Ave(td_firebase)),pTe(()=>mTe()),Cxe(()=>Rxe()),iAe(()=>sAe())],imports:[$pe,qJ,Zk,qY,WY,jY,E6,T_e]}))}return n(),e})();jpe().bootstrapModule(AFe).catch(n=>console.error(n))}},dd=>{dd(dd.s=246)}]);